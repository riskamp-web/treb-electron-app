/*! v11.0.1. Copyright 2018-2021 Structured Data, LLC. All rights reserved. CC BY-ND: https://treb.app/license */
!function(){var e={9742:function(e,t){"use strict";t.b$=function(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}(e),a=n[0],s=n[1],l=new i(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),c=0,d=s>0?a-4:a;for(r=0;r<d;r+=4)t=o[e.charCodeAt(r)]<<18|o[e.charCodeAt(r+1)]<<12|o[e.charCodeAt(r+2)]<<6|o[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===s&&(t=o[e.charCodeAt(r)]<<2|o[e.charCodeAt(r+1)]>>4,l[c++]=255&t),1===s&&(t=o[e.charCodeAt(r)]<<10|o[e.charCodeAt(r+1)]<<4|o[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},t.JQ=function(e){for(var t,o=e.length,i=o%3,n=[],a=16383,s=0,c=o-i;s<c;s+=a)n.push(l(e,s,s+a>c?c:s+a));return 1===i?(t=e[o-1],n.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[o-2]<<8)+e[o-1],n.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),n.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=n.length;a<s;++a)r[a]=n[a],o[n.charCodeAt(a)]=a;function l(e,t,o){for(var i,n,a=[],s=t;s<o;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(n=i)>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},4370:function(e,t,r){r(8783),r(1038);var o=r(857);e.exports=o.Array.from},9116:function(e,t,r){r(9601);var o=r(857);e.exports=o.Object.assign},7633:function(e,t,r){r(9170),r(1539),r(8674),r(7922),r(4668),r(7727),r(8783),r(3948);var o=r(857);e.exports=o.Promise},1045:function(e,t,r){r(7145),r(2472),r(9743),r(5109),r(8255),r(5125),r(9135),r(4197),r(6495),r(6443),e.exports=r(7854)},6443:function(e,t,r){r(8145),r(5206),r(2990),r(8927),r(3105),r(5035),r(4345),r(7174),r(2846),r(4731),r(7209),r(8867),r(7789),r(3739),r(9368),r(4483),r(2056),r(3462),r(678),r(7462),r(3824),r(5021),r(2974),r(5016),r(6319),r(1539)},3099:function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},6077:function(e,t,r){var o=r(111);e.exports=function(e){if(!o(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},1223:function(e,t,r){var o=r(5112),i=r(30),n=r(3070),a=o("unscopables"),s=Array.prototype;null==s[a]&&n.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},5787:function(e){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},9670:function(e,t,r){var o=r(111);e.exports=function(e){if(!o(e))throw TypeError(String(e)+" is not an object");return e}},4019:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(e,t,r){"use strict";var o,i=r(4019),n=r(9781),a=r(7854),s=r(111),l=r(6656),c=r(648),d=r(8880),u=r(1320),h=r(3070).f,f=r(9518),p=r(7674),m=r(5112),v=r(9711),y=a.Int8Array,_=y&&y.prototype,g=a.Uint8ClampedArray,b=g&&g.prototype,w=y&&f(y),x=_&&f(_),C=Object.prototype,S=C.isPrototypeOf,A=m("toStringTag"),k=v("TYPED_ARRAY_TAG"),M=i&&!!p&&"Opera"!==c(a.opera),R=!1,T={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},L={BigInt64Array:8,BigUint64Array:8},E=function(e){if(!s(e))return!1;var t=c(e);return l(T,t)||l(L,t)};for(o in T)a[o]||(M=!1);if((!M||"function"!=typeof w||w===Function.prototype)&&(w=function(){throw TypeError("Incorrect invocation")},M))for(o in T)a[o]&&p(a[o],w);if((!M||!x||x===C)&&(x=w.prototype,M))for(o in T)a[o]&&p(a[o].prototype,x);if(M&&f(b)!==x&&p(b,x),n&&!l(x,A))for(o in R=!0,h(x,A,{get:function(){return s(this)?this[k]:void 0}}),T)a[o]&&d(a[o],k,o);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_TAG:R&&k,aTypedArray:function(e){if(E(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(p){if(S.call(w,e))return e}else for(var t in T)if(l(T,o)){var r=a[t];if(r&&(e===r||S.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(n){if(r)for(var o in T){var i=a[o];if(i&&l(i.prototype,e))try{delete i.prototype[e]}catch(e){}}x[e]&&!r||u(x,e,r?t:M&&_[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var o,i;if(n){if(p){if(r)for(o in T)if((i=a[o])&&l(i,e))try{delete i[e]}catch(e){}if(w[e]&&!r)return;try{return u(w,e,r?t:M&&w[e]||t)}catch(e){}}for(o in T)!(i=a[o])||i[e]&&!r||u(i,e,t)}},isView:function(e){if(!s(e))return!1;var t=c(e);return"DataView"===t||l(T,t)||l(L,t)},isTypedArray:E,TypedArray:w,TypedArrayPrototype:x}},3331:function(e,t,r){"use strict";var o=r(7854),i=r(9781),n=r(4019),a=r(8880),s=r(2248),l=r(7293),c=r(5787),d=r(9958),u=r(7466),h=r(7067),f=r(1179),p=r(9518),m=r(7674),v=r(8006).f,y=r(3070).f,_=r(1285),g=r(8003),b=r(9909),w=b.get,x=b.set,C="ArrayBuffer",S="DataView",A="Wrong index",k=o.ArrayBuffer,M=k,R=o.DataView,T=R&&R.prototype,L=Object.prototype,E=o.RangeError,z=f.pack,D=f.unpack,P=function(e){return[255&e]},N=function(e){return[255&e,e>>8&255]},F=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},I=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},U=function(e){return z(e,23,4)},O=function(e){return z(e,52,8)},V=function(e,t){y(e.prototype,t,{get:function(){return w(this)[t]}})},H=function(e,t,r,o){var i=h(r),n=w(e);if(i+t>n.byteLength)throw E(A);var a=w(n.buffer).bytes,s=i+n.byteOffset,l=a.slice(s,s+t);return o?l:l.reverse()},j=function(e,t,r,o,i,n){var a=h(r),s=w(e);if(a+t>s.byteLength)throw E(A);for(var l=w(s.buffer).bytes,c=a+s.byteOffset,d=o(+i),u=0;u<t;u++)l[c+u]=d[n?u:t-u-1]};if(n){if(!l((function(){k(1)}))||!l((function(){new k(-1)}))||l((function(){return new k,new k(1.5),new k(NaN),k.name!=C}))){for(var G,B=(M=function(e){return c(this,M),new k(h(e))}).prototype=k.prototype,Z=v(k),J=0;Z.length>J;)(G=Z[J++])in M||a(M,G,k[G]);B.constructor=M}m&&p(T)!==L&&m(T,L);var q=new R(new M(2)),W=T.setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||s(T,{setInt8:function(e,t){W.call(this,e,t<<24>>24)},setUint8:function(e,t){W.call(this,e,t<<24>>24)}},{unsafe:!0})}else M=function(e){c(this,M,C);var t=h(e);x(this,{bytes:_.call(new Array(t),0),byteLength:t}),i||(this.byteLength=t)},R=function(e,t,r){c(this,R,S),c(e,M,S);var o=w(e).byteLength,n=d(t);if(n<0||n>o)throw E("Wrong offset");if(n+(r=void 0===r?o-n:u(r))>o)throw E("Wrong length");x(this,{buffer:e,byteLength:r,byteOffset:n}),i||(this.buffer=e,this.byteLength=r,this.byteOffset=n)},i&&(V(M,"byteLength"),V(R,"buffer"),V(R,"byteLength"),V(R,"byteOffset")),s(R.prototype,{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return I(H(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return I(H(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return D(H(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return D(H(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){j(this,1,e,P,t)},setUint8:function(e,t){j(this,1,e,P,t)},setInt16:function(e,t){j(this,2,e,N,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){j(this,2,e,N,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){j(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){j(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){j(this,4,e,U,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){j(this,8,e,O,t,arguments.length>2?arguments[2]:void 0)}});g(M,C),g(R,S),e.exports={ArrayBuffer:M,DataView:R}},1048:function(e,t,r){"use strict";var o=r(7908),i=r(1400),n=r(7466),a=Math.min;e.exports=[].copyWithin||function(e,t){var r=o(this),s=n(r.length),l=i(e,s),c=i(t,s),d=arguments.length>2?arguments[2]:void 0,u=a((void 0===d?s:i(d,s))-c,s-l),h=1;for(c<l&&l<c+u&&(h=-1,c+=u-1,l+=u-1);u-- >0;)c in r?r[l]=r[c]:delete r[l],l+=h,c+=h;return r}},1285:function(e,t,r){"use strict";var o=r(7908),i=r(1400),n=r(7466);e.exports=function(e){for(var t=o(this),r=n(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,r),l=a>2?arguments[2]:void 0,c=void 0===l?r:i(l,r);c>s;)t[s++]=e;return t}},8457:function(e,t,r){"use strict";var o=r(9974),i=r(7908),n=r(3411),a=r(7659),s=r(7466),l=r(6135),c=r(1246);e.exports=function(e){var t,r,d,u,h,f,p=i(e),m="function"==typeof this?this:Array,v=arguments.length,y=v>1?arguments[1]:void 0,_=void 0!==y,g=c(p),b=0;if(_&&(y=o(y,v>2?arguments[2]:void 0,2)),null==g||m==Array&&a(g))for(r=new m(t=s(p.length));t>b;b++)f=_?y(p[b],b):p[b],l(r,b,f);else for(h=(u=g.call(p)).next,r=new m;!(d=h.call(u)).done;b++)f=_?n(u,y,[d.value,b],!0):d.value,l(r,b,f);return r.length=b,r}},1318:function(e,t,r){var o=r(5656),i=r(7466),n=r(1400),a=function(e){return function(t,r,a){var s,l=o(t),c=i(l.length),d=n(a,c);if(e&&r!=r){for(;c>d;)if((s=l[d++])!=s)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===r)return e||d||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},2092:function(e,t,r){var o=r(9974),i=r(8361),n=r(7908),a=r(7466),s=r(5417),l=[].push,c=function(e){var t=1==e,r=2==e,c=3==e,d=4==e,u=6==e,h=7==e,f=5==e||u;return function(p,m,v,y){for(var _,g,b=n(p),w=i(b),x=o(m,v,3),C=a(w.length),S=0,A=y||s,k=t?A(p,C):r||h?A(p,0):void 0;C>S;S++)if((f||S in w)&&(g=x(_=w[S],S,b),e))if(t)k[S]=g;else if(g)switch(e){case 3:return!0;case 5:return _;case 6:return S;case 2:l.call(k,_)}else switch(e){case 4:return!1;case 7:l.call(k,_)}return u?-1:c||d?d:k}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterOut:c(7)}},6583:function(e,t,r){"use strict";var o=r(5656),i=r(9958),n=r(7466),a=r(9341),s=Math.min,l=[].lastIndexOf,c=!!l&&1/[1].lastIndexOf(1,-0)<0,d=a("lastIndexOf"),u=c||!d;e.exports=u?function(e){if(c)return l.apply(this,arguments)||0;var t=o(this),r=n(t.length),a=r-1;for(arguments.length>1&&(a=s(a,i(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:l},9341:function(e,t,r){"use strict";var o=r(7293);e.exports=function(e,t){var r=[][e];return!!r&&o((function(){r.call(null,t||function(){throw 1},1)}))}},3671:function(e,t,r){var o=r(3099),i=r(7908),n=r(8361),a=r(7466),s=function(e){return function(t,r,s,l){o(r);var c=i(t),d=n(c),u=a(c.length),h=e?u-1:0,f=e?-1:1;if(s<2)for(;;){if(h in d){l=d[h],h+=f;break}if(h+=f,e?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=f)h in d&&(l=r(l,d[h],h,c));return l}};e.exports={left:s(!1),right:s(!0)}},5417:function(e,t,r){var o=r(111),i=r(3157),n=r(5112)("species");e.exports=function(e,t){var r;return i(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!i(r.prototype)?o(r)&&null===(r=r[n])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},3411:function(e,t,r){var o=r(9670),i=r(9212);e.exports=function(e,t,r,n){try{return n?t(o(r)[0],r[1]):t(r)}catch(t){throw i(e),t}}},7072:function(e,t,r){var o=r(5112)("iterator"),i=!1;try{var n=0,a={next:function(){return{done:!!n++}},return:function(){i=!0}};a[o]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var n={};n[o]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}},4326:function(e){var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},648:function(e,t,r){var o=r(1694),i=r(4326),n=r(5112)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=o?i:function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?r:a?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},9920:function(e,t,r){var o=r(6656),i=r(3887),n=r(1236),a=r(3070);e.exports=function(e,t){for(var r=i(t),s=a.f,l=n.f,c=0;c<r.length;c++){var d=r[c];o(e,d)||s(e,d,l(t,d))}}},8544:function(e,t,r){var o=r(7293);e.exports=!o((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4994:function(e,t,r){"use strict";var o=r(3383).IteratorPrototype,i=r(30),n=r(9114),a=r(8003),s=r(7497),l=function(){return this};e.exports=function(e,t,r){var c=t+" Iterator";return e.prototype=i(o,{next:n(1,r)}),a(e,c,!1,!0),s[c]=l,e}},8880:function(e,t,r){var o=r(9781),i=r(3070),n=r(9114);e.exports=o?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}},9114:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:function(e,t,r){"use strict";var o=r(7593),i=r(3070),n=r(9114);e.exports=function(e,t,r){var a=o(t);a in e?i.f(e,a,n(0,r)):e[a]=r}},654:function(e,t,r){"use strict";var o=r(2109),i=r(4994),n=r(9518),a=r(7674),s=r(8003),l=r(8880),c=r(1320),d=r(5112),u=r(1913),h=r(7497),f=r(3383),p=f.IteratorPrototype,m=f.BUGGY_SAFARI_ITERATORS,v=d("iterator"),y="keys",_="values",g="entries",b=function(){return this};e.exports=function(e,t,r,d,f,w,x){i(r,t,d);var C,S,A,k=function(e){if(e===f&&E)return E;if(!m&&e in T)return T[e];switch(e){case y:case _:case g:return function(){return new r(this,e)}}return function(){return new r(this)}},M=t+" Iterator",R=!1,T=e.prototype,L=T[v]||T["@@iterator"]||f&&T[f],E=!m&&L||k(f),z="Array"==t&&T.entries||L;if(z&&(C=n(z.call(new e)),p!==Object.prototype&&C.next&&(u||n(C)===p||(a?a(C,p):"function"!=typeof C[v]&&l(C,v,b)),s(C,M,!0,!0),u&&(h[M]=b))),f==_&&L&&L.name!==_&&(R=!0,E=function(){return L.call(this)}),u&&!x||T[v]===E||l(T,v,E),h[t]=E,f)if(S={values:k(_),keys:w?E:k(y),entries:k(g)},x)for(A in S)(m||R||!(A in T))&&c(T,A,S[A]);else o({target:t,proto:!0,forced:m||R},S);return S}},9781:function(e,t,r){var o=r(7293);e.exports=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:function(e,t,r){var o=r(7854),i=r(111),n=o.document,a=i(n)&&i(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},8324:function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},7871:function(e){e.exports="object"==typeof window},6833:function(e,t,r){var o=r(8113);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(o)},5268:function(e,t,r){var o=r(4326),i=r(7854);e.exports="process"==o(i.process)},1036:function(e,t,r){var o=r(8113);e.exports=/web0s(?!.*chrome)/i.test(o)},8113:function(e,t,r){var o=r(5005);e.exports=o("navigator","userAgent")||""},7392:function(e,t,r){var o,i,n=r(7854),a=r(8113),s=n.process,l=s&&s.versions,c=l&&l.v8;c?i=(o=c.split("."))[0]<4?1:o[0]+o[1]:a&&(!(o=a.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=a.match(/Chrome\/(\d+)/))&&(i=o[1]),e.exports=i&&+i},748:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(e,t,r){var o=r(7854),i=r(1236).f,n=r(8880),a=r(1320),s=r(3505),l=r(9920),c=r(4705);e.exports=function(e,t){var r,d,u,h,f,p=e.target,m=e.global,v=e.stat;if(r=m?o:v?o[p]||s(p,{}):(o[p]||{}).prototype)for(d in t){if(h=t[d],u=e.noTargetGet?(f=i(r,d))&&f.value:r[d],!c(m?d:p+(v?".":"#")+d,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&n(h,"sham",!0),a(r,d,h,e)}}},7293:function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},9974:function(e,t,r){var o=r(3099);e.exports=function(e,t,r){if(o(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,o){return e.call(t,r,o)};case 3:return function(r,o,i){return e.call(t,r,o,i)}}return function(){return e.apply(t,arguments)}}},5005:function(e,t,r){var o=r(857),i=r(7854),n=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?n(o[e])||n(i[e]):o[e]&&o[e][t]||i[e]&&i[e][t]}},1246:function(e,t,r){var o=r(648),i=r(7497),n=r(5112)("iterator");e.exports=function(e){if(null!=e)return e[n]||e["@@iterator"]||i[o(e)]}},7854:function(e,t,r){var o=function(e){return e&&e.Math==Math&&e};e.exports=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},6656:function(e,t,r){var o=r(7908),i={}.hasOwnProperty;e.exports=function(e,t){return i.call(o(e),t)}},3501:function(e){e.exports={}},842:function(e,t,r){var o=r(7854);e.exports=function(e,t){var r=o.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},490:function(e,t,r){var o=r(5005);e.exports=o("document","documentElement")},4664:function(e,t,r){var o=r(9781),i=r(7293),n=r(317);e.exports=!o&&!i((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},1179:function(e){var t=Math.abs,r=Math.pow,o=Math.floor,i=Math.log,n=Math.LN2;e.exports={pack:function(e,a,s){var l,c,d,u=new Array(s),h=8*s-a-1,f=(1<<h)-1,p=f>>1,m=23===a?r(2,-24)-r(2,-77):0,v=e<0||0===e&&1/e<0?1:0,y=0;for((e=t(e))!=e||e===1/0?(c=e!=e?1:0,l=f):(l=o(i(e)/n),e*(d=r(2,-l))<1&&(l--,d*=2),(e+=l+p>=1?m/d:m*r(2,1-p))*d>=2&&(l++,d/=2),l+p>=f?(c=0,l=f):l+p>=1?(c=(e*d-1)*r(2,a),l+=p):(c=e*r(2,p-1)*r(2,a),l=0));a>=8;u[y++]=255&c,c/=256,a-=8);for(l=l<<a|c,h+=a;h>0;u[y++]=255&l,l/=256,h-=8);return u[--y]|=128*v,u},unpack:function(e,t){var o,i=e.length,n=8*i-t-1,a=(1<<n)-1,s=a>>1,l=n-7,c=i-1,d=e[c--],u=127&d;for(d>>=7;l>0;u=256*u+e[c],c--,l-=8);for(o=u&(1<<-l)-1,u>>=-l,l+=t;l>0;o=256*o+e[c],c--,l-=8);if(0===u)u=1-s;else{if(u===a)return o?NaN:d?-1/0:1/0;o+=r(2,t),u-=s}return(d?-1:1)*o*r(2,u-t)}}},8361:function(e,t,r){var o=r(7293),i=r(4326),n="".split;e.exports=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?n.call(e,""):Object(e)}:Object},9587:function(e,t,r){var o=r(111),i=r(7674);e.exports=function(e,t,r){var n,a;return i&&"function"==typeof(n=t.constructor)&&n!==r&&o(a=n.prototype)&&a!==r.prototype&&i(e,a),e}},2788:function(e,t,r){var o=r(5465),i=Function.toString;"function"!=typeof o.inspectSource&&(o.inspectSource=function(e){return i.call(e)}),e.exports=o.inspectSource},9909:function(e,t,r){var o,i,n,a=r(8536),s=r(7854),l=r(111),c=r(8880),d=r(6656),u=r(5465),h=r(6200),f=r(3501),p="Object already initialized",m=s.WeakMap;if(a||u.state){var v=u.state||(u.state=new m),y=v.get,_=v.has,g=v.set;o=function(e,t){if(_.call(v,e))throw new TypeError(p);return t.facade=e,g.call(v,e,t),t},i=function(e){return y.call(v,e)||{}},n=function(e){return _.call(v,e)}}else{var b=h("state");f[b]=!0,o=function(e,t){if(d(e,b))throw new TypeError(p);return t.facade=e,c(e,b,t),t},i=function(e){return d(e,b)?e[b]:{}},n=function(e){return d(e,b)}}e.exports={set:o,get:i,has:n,enforce:function(e){return n(e)?i(e):o(e,{})},getterFor:function(e){return function(t){var r;if(!l(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},7659:function(e,t,r){var o=r(5112),i=r(7497),n=o("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[n]===e)}},3157:function(e,t,r){var o=r(4326);e.exports=Array.isArray||function(e){return"Array"==o(e)}},4705:function(e,t,r){var o=r(7293),i=/#|\.prototype\./,n=function(e,t){var r=s[a(e)];return r==c||r!=l&&("function"==typeof t?o(t):!!t)},a=n.normalize=function(e){return String(e).replace(i,".").toLowerCase()},s=n.data={},l=n.NATIVE="N",c=n.POLYFILL="P";e.exports=n},111:function(e){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},1913:function(e){e.exports=!1},408:function(e,t,r){var o=r(9670),i=r(7659),n=r(7466),a=r(9974),s=r(1246),l=r(9212),c=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var d,u,h,f,p,m,v,y=r&&r.that,_=!(!r||!r.AS_ENTRIES),g=!(!r||!r.IS_ITERATOR),b=!(!r||!r.INTERRUPTED),w=a(t,y,1+_+b),x=function(e){return d&&l(d),new c(!0,e)},C=function(e){return _?(o(e),b?w(e[0],e[1],x):w(e[0],e[1])):b?w(e,x):w(e)};if(g)d=e;else{if("function"!=typeof(u=s(e)))throw TypeError("Target is not iterable");if(i(u)){for(h=0,f=n(e.length);f>h;h++)if((p=C(e[h]))&&p instanceof c)return p;return new c(!1)}d=u.call(e)}for(m=d.next;!(v=m.call(d)).done;){try{p=C(v.value)}catch(e){throw l(d),e}if("object"==typeof p&&p&&p instanceof c)return p}return new c(!1)}},9212:function(e,t,r){var o=r(9670);e.exports=function(e){var t=e.return;if(void 0!==t)return o(t.call(e)).value}},3383:function(e,t,r){"use strict";var o,i,n,a=r(7293),s=r(9518),l=r(8880),c=r(6656),d=r(5112),u=r(1913),h=d("iterator"),f=!1;[].keys&&("next"in(n=[].keys())?(i=s(s(n)))!==Object.prototype&&(o=i):f=!0);var p=null==o||a((function(){var e={};return o[h].call(e)!==e}));p&&(o={}),u&&!p||c(o,h)||l(o,h,(function(){return this})),e.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:f}},7497:function(e){e.exports={}},5948:function(e,t,r){var o,i,n,a,s,l,c,d,u=r(7854),h=r(1236).f,f=r(261).set,p=r(6833),m=r(1036),v=r(5268),y=u.MutationObserver||u.WebKitMutationObserver,_=u.document,g=u.process,b=u.Promise,w=h(u,"queueMicrotask"),x=w&&w.value;x||(o=function(){var e,t;for(v&&(e=g.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():n=void 0,e}}n=void 0,e&&e.enter()},p||v||m||!y||!_?b&&b.resolve?((c=b.resolve(void 0)).constructor=b,d=c.then,a=function(){d.call(c,o)}):a=v?function(){g.nextTick(o)}:function(){f.call(u,o)}:(s=!0,l=_.createTextNode(""),new y(o).observe(l,{characterData:!0}),a=function(){l.data=s=!s})),e.exports=x||function(e){var t={fn:e,next:void 0};n&&(n.next=t),i||(i=t,a()),n=t}},3366:function(e,t,r){var o=r(7854);e.exports=o.Promise},133:function(e,t,r){var o=r(7392),i=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())||!Symbol.sham&&o&&o<41}))},8536:function(e,t,r){var o=r(7854),i=r(2788),n=o.WeakMap;e.exports="function"==typeof n&&/native code/.test(i(n))},8523:function(e,t,r){"use strict";var o=r(3099),i=function(e){var t,r;this.promise=new e((function(e,o){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=o})),this.resolve=o(t),this.reject=o(r)};e.exports.f=function(e){return new i(e)}},1574:function(e,t,r){"use strict";var o=r(9781),i=r(7293),n=r(1956),a=r(5181),s=r(5296),l=r(7908),c=r(8361),d=Object.assign,u=Object.defineProperty;e.exports=!d||i((function(){if(o&&1!==d({b:1},d(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!=d({},e)[r]||n(d({},t)).join("")!=i}))?function(e,t){for(var r=l(e),i=arguments.length,d=1,u=a.f,h=s.f;i>d;)for(var f,p=c(arguments[d++]),m=u?n(p).concat(u(p)):n(p),v=m.length,y=0;v>y;)f=m[y++],o&&!h.call(p,f)||(r[f]=p[f]);return r}:d},30:function(e,t,r){var o,i=r(9670),n=r(6048),a=r(748),s=r(3501),l=r(490),c=r(317),d=r(6200)("IE_PROTO"),u=function(){},h=function(e){return"<script>"+e+"<\/script>"},f=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=o?function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t}(o):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F);for(var r=a.length;r--;)delete f.prototype[a[r]];return f()};s[d]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(u.prototype=i(e),r=new u,u.prototype=null,r[d]=e):r=f(),void 0===t?r:n(r,t)}},6048:function(e,t,r){var o=r(9781),i=r(3070),n=r(9670),a=r(1956);e.exports=o?Object.defineProperties:function(e,t){n(e);for(var r,o=a(t),s=o.length,l=0;s>l;)i.f(e,r=o[l++],t[r]);return e}},3070:function(e,t,r){var o=r(9781),i=r(4664),n=r(9670),a=r(7593),s=Object.defineProperty;t.f=o?s:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:function(e,t,r){var o=r(9781),i=r(5296),n=r(9114),a=r(5656),s=r(7593),l=r(6656),c=r(4664),d=Object.getOwnPropertyDescriptor;t.f=o?d:function(e,t){if(e=a(e),t=s(t,!0),c)try{return d(e,t)}catch(e){}if(l(e,t))return n(!i.f.call(e,t),e[t])}},8006:function(e,t,r){var o=r(6324),i=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,i)}},5181:function(e,t){t.f=Object.getOwnPropertySymbols},9518:function(e,t,r){var o=r(6656),i=r(7908),n=r(6200),a=r(8544),s=n("IE_PROTO"),l=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),o(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},6324:function(e,t,r){var o=r(6656),i=r(5656),n=r(1318).indexOf,a=r(3501);e.exports=function(e,t){var r,s=i(e),l=0,c=[];for(r in s)!o(a,r)&&o(s,r)&&c.push(r);for(;t.length>l;)o(s,r=t[l++])&&(~n(c,r)||c.push(r));return c}},1956:function(e,t,r){var o=r(6324),i=r(748);e.exports=Object.keys||function(e){return o(e,i)}},5296:function(e,t){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);t.f=i?function(e){var t=o(this,e);return!!t&&t.enumerable}:r},7674:function(e,t,r){var o=r(9670),i=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return o(r),i(n),t?e.call(r,n):r.__proto__=n,r}}():void 0)},288:function(e,t,r){"use strict";var o=r(1694),i=r(648);e.exports=o?{}.toString:function(){return"[object "+i(this)+"]"}},3887:function(e,t,r){var o=r(5005),i=r(8006),n=r(5181),a=r(9670);e.exports=o("Reflect","ownKeys")||function(e){var t=i.f(a(e)),r=n.f;return r?t.concat(r(e)):t}},857:function(e,t,r){var o=r(7854);e.exports=o},2534:function(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},9478:function(e,t,r){var o=r(9670),i=r(111),n=r(8523);e.exports=function(e,t){if(o(e),i(t)&&t.constructor===e)return t;var r=n.f(e);return(0,r.resolve)(t),r.promise}},2248:function(e,t,r){var o=r(1320);e.exports=function(e,t,r){for(var i in t)o(e,i,t[i],r);return e}},1320:function(e,t,r){var o=r(7854),i=r(8880),n=r(6656),a=r(3505),s=r(2788),l=r(9909),c=l.get,d=l.enforce,u=String(String).split("String");(e.exports=function(e,t,r,s){var l,c=!!s&&!!s.unsafe,h=!!s&&!!s.enumerable,f=!!s&&!!s.noTargetGet;"function"==typeof r&&("string"!=typeof t||n(r,"name")||i(r,"name",t),(l=d(r)).source||(l.source=u.join("string"==typeof t?t:""))),e!==o?(c?!f&&e[t]&&(h=!0):delete e[t],h?e[t]=r:i(e,t,r)):h?e[t]=r:a(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},4488:function(e){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},3505:function(e,t,r){var o=r(7854),i=r(8880);e.exports=function(e,t){try{i(o,e,t)}catch(r){o[e]=t}return t}},6340:function(e,t,r){"use strict";var o=r(5005),i=r(3070),n=r(5112),a=r(9781),s=n("species");e.exports=function(e){var t=o(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},8003:function(e,t,r){var o=r(3070).f,i=r(6656),n=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,n)&&o(e,n,{configurable:!0,value:t})}},6200:function(e,t,r){var o=r(2309),i=r(9711),n=o("keys");e.exports=function(e){return n[e]||(n[e]=i(e))}},5465:function(e,t,r){var o=r(7854),i=r(3505),n="__core-js_shared__",a=o[n]||i(n,{});e.exports=a},2309:function(e,t,r){var o=r(1913),i=r(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.0",mode:o?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6707:function(e,t,r){var o=r(9670),i=r(3099),n=r(5112)("species");e.exports=function(e,t){var r,a=o(e).constructor;return void 0===a||null==(r=o(a)[n])?t:i(r)}},8710:function(e,t,r){var o=r(9958),i=r(4488),n=function(e){return function(t,r){var n,a,s=String(i(t)),l=o(r),c=s.length;return l<0||l>=c?e?"":void 0:(n=s.charCodeAt(l))<55296||n>56319||l+1===c||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):n:e?s.slice(l,l+2):a-56320+(n-55296<<10)+65536}};e.exports={codeAt:n(!1),charAt:n(!0)}},261:function(e,t,r){var o,i,n,a=r(7854),s=r(7293),l=r(9974),c=r(490),d=r(317),u=r(6833),h=r(5268),f=a.location,p=a.setImmediate,m=a.clearImmediate,v=a.process,y=a.MessageChannel,_=a.Dispatch,g=0,b={},w=function(e){if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},x=function(e){return function(){w(e)}},C=function(e){w(e.data)},S=function(e){a.postMessage(e+"",f.protocol+"//"+f.host)};p&&m||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return b[++g]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},o(g),g},m=function(e){delete b[e]},h?o=function(e){v.nextTick(x(e))}:_&&_.now?o=function(e){_.now(x(e))}:y&&!u?(n=(i=new y).port2,i.port1.onmessage=C,o=l(n.postMessage,n,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&f&&"file:"!==f.protocol&&!s(S)?(o=S,a.addEventListener("message",C,!1)):o="onreadystatechange"in d("script")?function(e){c.appendChild(d("script")).onreadystatechange=function(){c.removeChild(this),w(e)}}:function(e){setTimeout(x(e),0)}),e.exports={set:p,clear:m}},1400:function(e,t,r){var o=r(9958),i=Math.max,n=Math.min;e.exports=function(e,t){var r=o(e);return r<0?i(r+t,0):n(r,t)}},7067:function(e,t,r){var o=r(9958),i=r(7466);e.exports=function(e){if(void 0===e)return 0;var t=o(e),r=i(t);if(t!==r)throw RangeError("Wrong length or index");return r}},5656:function(e,t,r){var o=r(8361),i=r(4488);e.exports=function(e){return o(i(e))}},9958:function(e){var t=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:t)(e)}},7466:function(e,t,r){var o=r(9958),i=Math.min;e.exports=function(e){return e>0?i(o(e),9007199254740991):0}},7908:function(e,t,r){var o=r(4488);e.exports=function(e){return Object(o(e))}},4590:function(e,t,r){var o=r(3002);e.exports=function(e,t){var r=o(e);if(r%t)throw RangeError("Wrong offset");return r}},3002:function(e,t,r){var o=r(9958);e.exports=function(e){var t=o(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},7593:function(e,t,r){var o=r(111);e.exports=function(e,t){if(!o(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!o(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!o(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!o(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},1694:function(e,t,r){var o={};o[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(o)},9843:function(e,t,r){"use strict";var o=r(2109),i=r(7854),n=r(9781),a=r(3832),s=r(260),l=r(3331),c=r(5787),d=r(9114),u=r(8880),h=r(7466),f=r(7067),p=r(4590),m=r(7593),v=r(6656),y=r(648),_=r(111),g=r(30),b=r(7674),w=r(8006).f,x=r(7321),C=r(2092).forEach,S=r(6340),A=r(3070),k=r(1236),M=r(9909),R=r(9587),T=M.get,L=M.set,E=A.f,z=k.f,D=Math.round,P=i.RangeError,N=l.ArrayBuffer,F=l.DataView,I=s.NATIVE_ARRAY_BUFFER_VIEWS,U=s.TYPED_ARRAY_TAG,O=s.TypedArray,V=s.TypedArrayPrototype,H=s.aTypedArrayConstructor,j=s.isTypedArray,G="BYTES_PER_ELEMENT",B="Wrong length",Z=function(e,t){for(var r=0,o=t.length,i=new(H(e))(o);o>r;)i[r]=t[r++];return i},J=function(e,t){E(e,t,{get:function(){return T(this)[t]}})},q=function(e){var t;return e instanceof N||"ArrayBuffer"==(t=y(e))||"SharedArrayBuffer"==t},W=function(e,t){return j(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},K=function(e,t){return W(e,t=m(t,!0))?d(2,e[t]):z(e,t)},X=function(e,t,r){return!(W(e,t=m(t,!0))&&_(r)&&v(r,"value"))||v(r,"get")||v(r,"set")||r.configurable||v(r,"writable")&&!r.writable||v(r,"enumerable")&&!r.enumerable?E(e,t,r):(e[t]=r.value,e)};n?(I||(k.f=K,A.f=X,J(V,"buffer"),J(V,"byteOffset"),J(V,"byteLength"),J(V,"length")),o({target:"Object",stat:!0,forced:!I},{getOwnPropertyDescriptor:K,defineProperty:X}),e.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,s=e+(r?"Clamped":"")+"Array",l="get"+e,d="set"+e,m=i[s],v=m,y=v&&v.prototype,A={},k=function(e,t){E(e,t,{get:function(){return function(e,t){var r=T(e);return r.view[l](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,o){var i=T(e);r&&(o=(o=D(o))<0?0:o>255?255:255&o),i.view[d](t*n+i.byteOffset,o,!0)}(this,t,e)},enumerable:!0})};I?a&&(v=t((function(e,t,r,o){return c(e,v,s),R(_(t)?q(t)?void 0!==o?new m(t,p(r,n),o):void 0!==r?new m(t,p(r,n)):new m(t):j(t)?Z(v,t):x.call(v,t):new m(f(t)),e,v)})),b&&b(v,O),C(w(m),(function(e){e in v||u(v,e,m[e])})),v.prototype=y):(v=t((function(e,t,r,o){c(e,v,s);var i,a,l,d=0,u=0;if(_(t)){if(!q(t))return j(t)?Z(v,t):x.call(v,t);i=t,u=p(r,n);var m=t.byteLength;if(void 0===o){if(m%n)throw P(B);if((a=m-u)<0)throw P(B)}else if((a=h(o)*n)+u>m)throw P(B);l=a/n}else l=f(t),i=new N(a=l*n);for(L(e,{buffer:i,byteOffset:u,byteLength:a,length:l,view:new F(i)});d<l;)k(e,d++)})),b&&b(v,O),y=v.prototype=g(V)),y.constructor!==v&&u(y,"constructor",v),U&&u(y,U,s),A[s]=v,o({global:!0,forced:v!=m,sham:!I},A),G in v||u(v,G,n),G in y||u(y,G,n),S(s)}):e.exports=function(){}},3832:function(e,t,r){var o=r(7854),i=r(7293),n=r(7072),a=r(260).NATIVE_ARRAY_BUFFER_VIEWS,s=o.ArrayBuffer,l=o.Int8Array;e.exports=!a||!i((function(){l(1)}))||!i((function(){new l(-1)}))||!n((function(e){new l,new l(null),new l(1.5),new l(e)}),!0)||i((function(){return 1!==new l(new s(2),1,void 0).length}))},3074:function(e,t,r){var o=r(260).aTypedArrayConstructor,i=r(6707);e.exports=function(e,t){for(var r=i(e,e.constructor),n=0,a=t.length,s=new(o(r))(a);a>n;)s[n]=t[n++];return s}},7321:function(e,t,r){var o=r(7908),i=r(7466),n=r(1246),a=r(7659),s=r(9974),l=r(260).aTypedArrayConstructor;e.exports=function(e){var t,r,c,d,u,h,f=o(e),p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,y=n(f);if(null!=y&&!a(y))for(h=(u=y.call(f)).next,f=[];!(d=h.call(u)).done;)f.push(d.value);for(v&&p>2&&(m=s(m,arguments[2],2)),r=i(f.length),c=new(l(this))(r),t=0;r>t;t++)c[t]=v?m(f[t],t):f[t];return c}},9711:function(e){var t=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++t+r).toString(36)}},3307:function(e,t,r){var o=r(133);e.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},5112:function(e,t,r){var o=r(7854),i=r(2309),n=r(6656),a=r(9711),s=r(133),l=r(3307),c=i("wks"),d=o.Symbol,u=l?d:d&&d.withoutSetter||a;e.exports=function(e){return n(c,e)&&(s||"string"==typeof c[e])||(s&&n(d,e)?c[e]=d[e]:c[e]=u("Symbol."+e)),c[e]}},9170:function(e,t,r){"use strict";var o=r(2109),i=r(9518),n=r(7674),a=r(30),s=r(8880),l=r(9114),c=r(408),d=function(e,t){var r=this;if(!(r instanceof d))return new d(e,t);n&&(r=n(new Error(void 0),i(r))),void 0!==t&&s(r,"message",String(t));var o=[];return c(e,o.push,{that:o}),s(r,"errors",o),r};d.prototype=a(Error.prototype,{constructor:l(5,d),message:l(5,""),name:l(5,"AggregateError")}),o({global:!0},{AggregateError:d})},1038:function(e,t,r){var o=r(2109),i=r(8457);o({target:"Array",stat:!0,forced:!r(7072)((function(e){Array.from(e)}))},{from:i})},6992:function(e,t,r){"use strict";var o=r(5656),i=r(1223),n=r(7497),a=r(9909),s=r(654),l="Array Iterator",c=a.set,d=a.getterFor(l);e.exports=s(Array,"Array",(function(e,t){c(this,{type:l,target:o(e),index:0,kind:t})}),(function(){var e=d(this),t=e.target,r=e.kind,o=e.index++;return!t||o>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:o,done:!1}:"values"==r?{value:t[o],done:!1}:{value:[o,t[o]],done:!1}}),"values"),n.Arguments=n.Array,i("keys"),i("values"),i("entries")},9601:function(e,t,r){var o=r(2109),i=r(1574);o({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},1539:function(e,t,r){var o=r(1694),i=r(1320),n=r(288);o||i(Object.prototype,"toString",n,{unsafe:!0})},7922:function(e,t,r){"use strict";var o=r(2109),i=r(3099),n=r(8523),a=r(2534),s=r(408);o({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=n.f(t),o=r.resolve,l=r.reject,c=a((function(){var r=i(t.resolve),n=[],a=0,l=1;s(e,(function(e){var i=a++,s=!1;n.push(void 0),l++,r.call(t,e).then((function(e){s||(s=!0,n[i]={status:"fulfilled",value:e},--l||o(n))}),(function(e){s||(s=!0,n[i]={status:"rejected",reason:e},--l||o(n))}))})),--l||o(n)}));return c.error&&l(c.value),r.promise}})},4668:function(e,t,r){"use strict";var o=r(2109),i=r(3099),n=r(5005),a=r(8523),s=r(2534),l=r(408),c="No one promise resolved";o({target:"Promise",stat:!0},{any:function(e){var t=this,r=a.f(t),o=r.resolve,d=r.reject,u=s((function(){var r=i(t.resolve),a=[],s=0,u=1,h=!1;l(e,(function(e){var i=s++,l=!1;a.push(void 0),u++,r.call(t,e).then((function(e){l||h||(h=!0,o(e))}),(function(e){l||h||(l=!0,a[i]=e,--u||d(new(n("AggregateError"))(a,c)))}))})),--u||d(new(n("AggregateError"))(a,c))}));return u.error&&d(u.value),r.promise}})},7727:function(e,t,r){"use strict";var o=r(2109),i=r(1913),n=r(3366),a=r(7293),s=r(5005),l=r(6707),c=r(9478),d=r(1320);if(o({target:"Promise",proto:!0,real:!0,forced:!!n&&a((function(){n.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=l(this,s("Promise")),r="function"==typeof e;return this.then(r?function(r){return c(t,e()).then((function(){return r}))}:e,r?function(r){return c(t,e()).then((function(){throw r}))}:e)}}),!i&&"function"==typeof n){var u=s("Promise").prototype.finally;n.prototype.finally!==u&&d(n.prototype,"finally",u,{unsafe:!0})}},8674:function(e,t,r){"use strict";var o,i,n,a,s=r(2109),l=r(1913),c=r(7854),d=r(5005),u=r(3366),h=r(1320),f=r(2248),p=r(7674),m=r(8003),v=r(6340),y=r(111),_=r(3099),g=r(5787),b=r(2788),w=r(408),x=r(7072),C=r(6707),S=r(261).set,A=r(5948),k=r(9478),M=r(842),R=r(8523),T=r(2534),L=r(9909),E=r(4705),z=r(5112),D=r(7871),P=r(5268),N=r(7392),F=z("species"),I="Promise",U=L.get,O=L.set,V=L.getterFor(I),H=u&&u.prototype,j=u,G=H,B=c.TypeError,Z=c.document,J=c.process,q=R.f,W=q,K=!!(Z&&Z.createEvent&&c.dispatchEvent),X="function"==typeof PromiseRejectionEvent,Y="unhandledrejection",$=!1,Q=E(I,(function(){var e=b(j)!==String(j);if(!e&&66===N)return!0;if(l&&!G.finally)return!0;if(N>=51&&/native code/.test(j))return!1;var t=new j((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(t.constructor={})[F]=r,!($=t.then((function(){}))instanceof r)||!e&&D&&!X})),ee=Q||!x((function(e){j.all(e).catch((function(){}))})),te=function(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t},re=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;A((function(){for(var o=e.value,i=1==e.state,n=0;r.length>n;){var a,s,l,c=r[n++],d=i?c.ok:c.fail,u=c.resolve,h=c.reject,f=c.domain;try{d?(i||(2===e.rejection&&ae(e),e.rejection=1),!0===d?a=o:(f&&f.enter(),a=d(o),f&&(f.exit(),l=!0)),a===c.promise?h(B("Promise-chain cycle")):(s=te(a))?s.call(a,u,h):u(a)):h(o)}catch(e){f&&!l&&f.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ie(e)}))}},oe=function(e,t,r){var o,i;K?((o=Z.createEvent("Event")).promise=t,o.reason=r,o.initEvent(e,!1,!0),c.dispatchEvent(o)):o={promise:t,reason:r},!X&&(i=c["on"+e])?i(o):e===Y&&M("Unhandled promise rejection",r)},ie=function(e){S.call(c,(function(){var t,r=e.facade,o=e.value;if(ne(e)&&(t=T((function(){P?J.emit("unhandledRejection",o,r):oe(Y,r,o)})),e.rejection=P||ne(e)?2:1,t.error))throw t.value}))},ne=function(e){return 1!==e.rejection&&!e.parent},ae=function(e){S.call(c,(function(){var t=e.facade;P?J.emit("rejectionHandled",t):oe("rejectionhandled",t,e.value)}))},se=function(e,t,r){return function(o){e(t,o,r)}},le=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,re(e,!0))},ce=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw B("Promise can't be resolved itself");var o=te(t);o?A((function(){var r={done:!1};try{o.call(t,se(ce,r,e),se(le,r,e))}catch(t){le(r,t,e)}})):(e.value=t,e.state=1,re(e,!1))}catch(t){le({done:!1},t,e)}}};if(Q&&(G=(j=function(e){g(this,j,I),_(e),o.call(this);var t=U(this);try{e(se(ce,t),se(le,t))}catch(e){le(t,e)}}).prototype,(o=function(e){O(this,{type:I,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(G,{then:function(e,t){var r=V(this),o=q(C(this,j));return o.ok="function"!=typeof e||e,o.fail="function"==typeof t&&t,o.domain=P?J.domain:void 0,r.parent=!0,r.reactions.push(o),0!=r.state&&re(r,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new o,t=U(e);this.promise=e,this.resolve=se(ce,t),this.reject=se(le,t)},R.f=q=function(e){return e===j||e===n?new i(e):W(e)},!l&&"function"==typeof u&&H!==Object.prototype)){a=H.then,$||(h(H,"then",(function(e,t){var r=this;return new j((function(e,t){a.call(r,e,t)})).then(e,t)}),{unsafe:!0}),h(H,"catch",G.catch,{unsafe:!0}));try{delete H.constructor}catch(e){}p&&p(H,G)}s({global:!0,wrap:!0,forced:Q},{Promise:j}),m(j,I,!1,!0),v(I),n=d(I),s({target:I,stat:!0,forced:Q},{reject:function(e){var t=q(this);return t.reject.call(void 0,e),t.promise}}),s({target:I,stat:!0,forced:l||Q},{resolve:function(e){return k(l&&this===n?j:this,e)}}),s({target:I,stat:!0,forced:ee},{all:function(e){var t=this,r=q(t),o=r.resolve,i=r.reject,n=T((function(){var r=_(t.resolve),n=[],a=0,s=1;w(e,(function(e){var l=a++,c=!1;n.push(void 0),s++,r.call(t,e).then((function(e){c||(c=!0,n[l]=e,--s||o(n))}),i)})),--s||o(n)}));return n.error&&i(n.value),r.promise},race:function(e){var t=this,r=q(t),o=r.reject,i=T((function(){var i=_(t.resolve);w(e,(function(e){i.call(t,e).then(r.resolve,o)}))}));return i.error&&o(i.value),r.promise}})},8783:function(e,t,r){"use strict";var o=r(8710).charAt,i=r(9909),n=r(654),a="String Iterator",s=i.set,l=i.getterFor(a);n(String,"String",(function(e){s(this,{type:a,string:String(e),index:0})}),(function(){var e,t=l(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=o(r,i),t.index+=e.length,{value:e,done:!1})}))},2990:function(e,t,r){"use strict";var o=r(260),i=r(1048),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("copyWithin",(function(e,t){return i.call(n(this),e,t,arguments.length>2?arguments[2]:void 0)}))},8927:function(e,t,r){"use strict";var o=r(260),i=r(2092).every,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("every",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},3105:function(e,t,r){"use strict";var o=r(260),i=r(1285),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("fill",(function(e){return i.apply(n(this),arguments)}))},5035:function(e,t,r){"use strict";var o=r(260),i=r(2092).filter,n=r(3074),a=o.aTypedArray;(0,o.exportTypedArrayMethod)("filter",(function(e){var t=i(a(this),e,arguments.length>1?arguments[1]:void 0);return n(this,t)}))},7174:function(e,t,r){"use strict";var o=r(260),i=r(2092).findIndex,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("findIndex",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},4345:function(e,t,r){"use strict";var o=r(260),i=r(2092).find,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("find",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},4197:function(e,t,r){r(9843)("Float32",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},6495:function(e,t,r){r(9843)("Float64",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},2846:function(e,t,r){"use strict";var o=r(260),i=r(2092).forEach,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("forEach",(function(e){i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},8145:function(e,t,r){"use strict";var o=r(3832);(0,r(260).exportTypedArrayStaticMethod)("from",r(7321),o)},4731:function(e,t,r){"use strict";var o=r(260),i=r(1318).includes,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("includes",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},7209:function(e,t,r){"use strict";var o=r(260),i=r(1318).indexOf,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("indexOf",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},5109:function(e,t,r){r(9843)("Int16",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},5125:function(e,t,r){r(9843)("Int32",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},7145:function(e,t,r){r(9843)("Int8",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},6319:function(e,t,r){"use strict";var o=r(7854),i=r(260),n=r(6992),a=r(5112)("iterator"),s=o.Uint8Array,l=n.values,c=n.keys,d=n.entries,u=i.aTypedArray,h=i.exportTypedArrayMethod,f=s&&s.prototype[a],p=!!f&&("values"==f.name||null==f.name),m=function(){return l.call(u(this))};h("entries",(function(){return d.call(u(this))})),h("keys",(function(){return c.call(u(this))})),h("values",m,!p),h(a,m,!p)},8867:function(e,t,r){"use strict";var o=r(260),i=o.aTypedArray,n=o.exportTypedArrayMethod,a=[].join;n("join",(function(e){return a.apply(i(this),arguments)}))},7789:function(e,t,r){"use strict";var o=r(260),i=r(6583),n=o.aTypedArray;(0,o.exportTypedArrayMethod)("lastIndexOf",(function(e){return i.apply(n(this),arguments)}))},3739:function(e,t,r){"use strict";var o=r(260),i=r(2092).map,n=r(6707),a=o.aTypedArray,s=o.aTypedArrayConstructor;(0,o.exportTypedArrayMethod)("map",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(s(n(e,e.constructor)))(t)}))}))},5206:function(e,t,r){"use strict";var o=r(260),i=r(3832),n=o.aTypedArrayConstructor;(0,o.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,r=new(n(this))(t);t>e;)r[e]=arguments[e++];return r}),i)},4483:function(e,t,r){"use strict";var o=r(260),i=r(3671).right,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("reduceRight",(function(e){return i(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},9368:function(e,t,r){"use strict";var o=r(260),i=r(3671).left,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("reduce",(function(e){return i(n(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},2056:function(e,t,r){"use strict";var o=r(260),i=o.aTypedArray,n=o.exportTypedArrayMethod,a=Math.floor;n("reverse",(function(){for(var e,t=this,r=i(t).length,o=a(r/2),n=0;n<o;)e=t[n],t[n++]=t[--r],t[r]=e;return t}))},3462:function(e,t,r){"use strict";var o=r(260),i=r(7466),n=r(4590),a=r(7908),s=r(7293),l=o.aTypedArray;(0,o.exportTypedArrayMethod)("set",(function(e){l(this);var t=n(arguments.length>1?arguments[1]:void 0,1),r=this.length,o=a(e),s=i(o.length),c=0;if(s+t>r)throw RangeError("Wrong length");for(;c<s;)this[t+c]=o[c++]}),s((function(){new Int8Array(1).set({})})))},678:function(e,t,r){"use strict";var o=r(260),i=r(6707),n=r(7293),a=o.aTypedArray,s=o.aTypedArrayConstructor,l=o.exportTypedArrayMethod,c=[].slice;l("slice",(function(e,t){for(var r=c.call(a(this),e,t),o=i(this,this.constructor),n=0,l=r.length,d=new(s(o))(l);l>n;)d[n]=r[n++];return d}),n((function(){new Int8Array(1).slice()})))},7462:function(e,t,r){"use strict";var o=r(260),i=r(2092).some,n=o.aTypedArray;(0,o.exportTypedArrayMethod)("some",(function(e){return i(n(this),e,arguments.length>1?arguments[1]:void 0)}))},3824:function(e,t,r){"use strict";var o=r(260),i=o.aTypedArray,n=o.exportTypedArrayMethod,a=[].sort;n("sort",(function(e){return a.call(i(this),e)}))},5021:function(e,t,r){"use strict";var o=r(260),i=r(7466),n=r(1400),a=r(6707),s=o.aTypedArray;(0,o.exportTypedArrayMethod)("subarray",(function(e,t){var r=s(this),o=r.length,l=n(e,o);return new(a(r,r.constructor))(r.buffer,r.byteOffset+l*r.BYTES_PER_ELEMENT,i((void 0===t?o:n(t,o))-l))}))},2974:function(e,t,r){"use strict";var o=r(7854),i=r(260),n=r(7293),a=o.Int8Array,s=i.aTypedArray,l=i.exportTypedArrayMethod,c=[].toLocaleString,d=[].slice,u=!!a&&n((function(){c.call(new a(1))}));l("toLocaleString",(function(){return c.apply(u?d.call(s(this)):s(this),arguments)}),n((function(){return[1,2].toLocaleString()!=new a([1,2]).toLocaleString()}))||!n((function(){a.prototype.toLocaleString.call([1,2])})))},5016:function(e,t,r){"use strict";var o=r(260).exportTypedArrayMethod,i=r(7293),n=r(7854).Uint8Array,a=n&&n.prototype||{},s=[].toString,l=[].join;i((function(){s.call({})}))&&(s=function(){return l.call(this)});var c=a.toString!=s;o("toString",s,c)},8255:function(e,t,r){r(9843)("Uint16",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},9135:function(e,t,r){r(9843)("Uint32",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},2472:function(e,t,r){r(9843)("Uint8",(function(e){return function(t,r,o){return e(this,t,r,o)}}))},9743:function(e,t,r){r(9843)("Uint8",(function(e){return function(t,r,o){return e(this,t,r,o)}}),!0)},3948:function(e,t,r){var o=r(7854),i=r(8324),n=r(6992),a=r(8880),s=r(5112),l=s("iterator"),c=s("toStringTag"),d=n.values;for(var u in i){var h=o[u],f=h&&h.prototype;if(f){if(f[l]!==d)try{a(f,l,d)}catch(e){f[l]=d}if(f[c]||a(f,c,u),i[u])for(var p in n)if(f[p]!==n[p])try{a(f,p,n[p])}catch(e){f[p]=n[p]}}}},1811:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,".treb-embed-mouse-mask{position:fixed;top:0px;left:0px;right:0px;bottom:0px;background:transparent;z-index:1000;display:none;cursor:nwse-resize}.treb-embed-resize-rect{box-sizing:border-box;position:absolute;border:1px dotted #396;border-radius:2px;pointer-events:none}.treb-embed-resize-handle{box-sizing:border-box;position:absolute;height:16px;width:16px;min-height:16px;min-width:16px;border:8px solid #396;border-top-color:transparent;border-left-color:transparent;cursor:nwse-resize;bottom:1px;right:1px;z-index:999}",""]),t.Z=i},4439:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,".treb-chart{background:#fff}.treb-chart .series-1{color:#80b1d3}.treb-chart .series-2{color:#8dd3c7}.treb-chart .series-3{color:#bebada}.treb-chart .series-4{color:#fb8072}.treb-chart .series-5{color:#fdb462}.treb-chart .series-6{color:#b3de69}.treb-chart .series-7{color:#fccde5}.treb-chart .series-8{color:#d9d9d9}.treb-chart .series-9{color:#bc80bd}.treb-chart .series-10{color:#ccebc5}.treb-chart .series-11{color:#ffed6f}.treb-chart .series-12{color:#ffffb3}.treb-chart .chart-title{font-size:1.4em}.treb-chart .axis-group{font-size:.9em}.treb-chart text{fill:#000;stroke:none}.treb-chart .legend{font-size:1.05em}.treb-chart .legend rect{fill:currentColor}.treb-chart .chart-grid,.treb-chart .chart-ticks{stroke:#ddd}.treb-chart .label-target{stroke:none;fill:transparent}.treb-chart path.label-target{transition:fill .2s}.treb-chart path.label-target:hover{fill:rgba(0,0,0,.15)}.treb-chart .data-label{pointer-events:none;opacity:0;transition:opacity .2s ease-in-out}.treb-chart .data-label text{fill:#fff}.treb-chart .data-label path{fill:#000}.treb-chart .data-label .marker-highlight{fill:currentColor;stroke:none}.treb-chart .label-target:hover+.data-label{opacity:1}.treb-chart .chart-line{stroke:currentColor;fill:none;stroke-width:2}.treb-chart .chart-area .line{stroke:currentColor;stroke-width:2px;fill:none}.treb-chart .chart-area .fill{fill:currentColor;opacity:.5}.treb-chart .scatter-plot{stroke-width:3;fill:none;stroke:currentColor}.treb-chart .scatter-plot .fill{fill:currentColor;opacity:.5;stroke:none}.treb-chart .scatter-plot .marker{stroke-width:2.5px;fill:#fff;transition:stroke-width .15s ease-in}.treb-chart .scatter-plot .marker:hover{stroke-width:5px}.treb-chart .donut path{fill:currentColor}.treb-chart .donut path.callout{fill:none;stroke:#999;stroke-dasharray:2 2}.treb-chart .donut text.callout-label{font-size:1em}.treb-chart .chart-column{fill:currentColor;stroke:none}.treb-chart .mc-correlation{stroke:currentColor;stroke-width:1}",""]),t.Z=i},9609:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,".embedded-spreadsheet-container{box-sizing:border-box;position:absolute;left:0px;top:0px;bottom:0px;right:0px;transition:right .2s ease-in-out,top .2s ease-in-out}.default-spreadsheet-size{width:680px;height:400px}.sidebar-open .embedded-spreadsheet-container{right:40px}.sidebar-open .show-sidebar-button{opacity:0;pointer-events:none}.sidebar-open .embedded-spreadsheet-sidebar{opacity:1;pointer-events:initial}.sidebar-open .masked~.embedded-spreadsheet-sidebar{opacity:.6;pointer-events:none}.toolbar-container{position:absolute;top:0;left:0;opacity:0;pointer-events:none;transition:opacity .2s ease}.toolbar-open .embedded-spreadsheet-container{top:38px}.toolbar-open .embedded-spreadsheet-sidebar{top:38px}.toolbar-open .toolbar-container{opacity:1;pointer-events:initial}.toolbar-open .masked+.toolbar-container{pointer-events:none;opacity:.6}.sidebar-button{box-sizing:border-box;width:24px;height:24px;border:0;line-height:28px;display:flex;flex-direction:row;align-items:center;justify-content:center;border:0}.sidebar-button.smaller svg{width:12px;height:12px}.sidebar-button svg{width:24px;height:24px;transition:fill .1s;pointer-events:none;fill:#ccc}.sidebar-button:hover svg{fill:#666}.show-sidebar-button{position:absolute;border:1px solid #ccc;border-right-width:0px;z-index:5;bottom:50px;right:0px;border-top-left-radius:12px;border-bottom-left-radius:12px;background:#fff;transition:opacity .2s ease-in-out}.embedded-spreadsheet-sidebar{box-sizing:border-box;border:0;box-sizing:border-box;align-items:center;position:absolute;right:0px;top:0px;width:40px;opacity:0;bottom:0px;overflow:hidden;pointer-events:none;display:flex;flex-direction:column;transition:top .2s ease-in-out,opacity .2s ease-in-out}.embedded-spreadsheet-sidebar .sidebar-button{margin-top:10px;margin-bottom:4px}.embedded-spreadsheet-sidebar .sidebar-button:last-child{margin-bottom:50px}.embedded-spreadsheet-sidebar .sidebar-spacer{box-sizing:border-box;flex-grow:1}.treb-fullscreen-padding .embedded-spreadsheet-sidebar{width:50px}.treb-fullscreen-padding .embedded-spreadsheet-sidebar .sidebar-button{margin-bottom:6px}.treb-fullscreen-padding .embedded-spreadsheet-sidebar .sidebar-button:last-child{margin-bottom:50px}.treb-fullscreen-padding .toolbar-container{top:8px;left:6px}.treb-fullscreen-padding.sidebar-open .embedded-spreadsheet-container{right:50px}.treb-fullscreen-padding.toolbar-open .embedded-spreadsheet-container{top:45px}.treb-fullscreen-padding.toolbar-open .embedded-spreadsheet-sidebar{top:45px}",""]),t.Z=i},4875:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,'.treb-embed-dialog{line-height:1.6em;border:1px solid #ccc;border:1px solid #999;border-top-width:3px;border-top-color:#009dff;border-top-color:#9eafb9;border-top-color:#999;display:flex;flex-direction:row;align-items:center;position:relative;padding:1em;background:#fff;text-align:left;border-radius:3px}.treb-embed-dialog>*{display:none}.treb-embed-dialog>div{position:relative}.treb-embed-dialog>*:nth-child(2){flex-grow:1;display:block}.treb-embed-dialog>*:nth-child(2){padding:2px 12px;padding-right:20px}.treb-embed-dialog>.close-box{position:absolute;top:0;right:0px;padding:4px}.treb-embed-dialog>.close-box>svg{fill:#73828c;width:20px;height:20px;cursor:default}.treb-embed-dialog>.close-box>svg:hover,.treb-embed-dialog>.close-box>svg:active{fill:#049cfb}.treb-embed-dialog .smaller{font-size:.9em}.treb-embed-dialog a{text-decoration:none;color:inherit}.treb-embed-dialog a:hover,.treb-embed-dialog a:active{color:#049cfb}.treb-embed-dialog.dialog-type-success{border-top-width:3px;border-top-color:#44d926}.treb-embed-dialog.dialog-type-about{border-top-width:3px;border-top-color:#52880b}.treb-embed-dialog.dialog-type-error{border-top-width:3px;border-top-color:#f92f06}.treb-embed-dialog.dialog-type-info{border-top-width:3px;border-top-color:#009dff}.treb-embed-dialog .treb-embed-dialog-title{white-space:pre}.treb-embed-dialog .treb-embed-dialog-message{white-space:pre}.treb-embed-dialog .treb-embed-progress-container{position:relative;border:1px solid red;width:100%;height:6px;border:1px solid #ddd;margin:auto;margin-top:1em;margin-bottom:.5em}.treb-embed-dialog .treb-embed-progress-bar{position:relative;background:#52880b;top:0px;left:0px;height:100%}.treb-main,.treb-embed-mask{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;font-style:normal;font-weight:normal;color:#333;font-size:12pt;box-sizing:border-box}.treb-main *,.treb-embed-mask *{box-sizing:border-box}.masked>.treb-main{opacity:.6}.treb-main{position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:1;transition:opacity .2s ease}.treb-embed-mask{position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:1000;display:flex;justify-content:center;align-items:center;opacity:0;transition:opacity .2s;pointer-events:none}.treb-embed-mask.visible{pointer-events:auto;opacity:1}',""]),t.Z=i},7835:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,'.treb-toolbar{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;display:flex;flex-direction:row;position:relative;font-style:normal;font-weight:normal;color:#333;font-size:16px;box-sizing:border-box}.treb-toolbar *{box-sizing:border-box}.treb-toolbar .staging{display:none}.treb-toolbar .popup,.treb-toolbar .drop-menu{position:absolute;top:-100px;left:-100px;background:#fff;border-radius:3px;border:1px solid #d1d5db;z-index:999;box-shadow:0 2px 4px #0d131e1a;outline:none;margin:0;opacity:0;pointer-events:none;transition:opacity .125s}.treb-toolbar .popup.visible,.treb-toolbar .drop-menu.visible{opacity:1;pointer-events:initial}.treb-toolbar .popup.visible .comment-editor textarea,.treb-toolbar .drop-menu.visible .comment-editor textarea{resize:both}.treb-toolbar .drop-menu.scroll{max-height:18em;overflow-y:auto}.treb-toolbar .drop-menu{padding:.25em .25em}.treb-toolbar .drop-menu hr{border-top-width:0px;border-left-width:0px;border-right-width:0px;border-bottom-width:1px;border-bottom-color:#d1d5db;margin-bottom:.5em;margin-top:.5em}.treb-toolbar .drop-menu ul{margin:0;list-style-type:none;padding-left:0}.treb-toolbar .drop-menu ul li+li{margin-top:.125em}.treb-toolbar .drop-menu ul button{border-color:transparent}.treb-toolbar .drop-menu ul button.text{display:inline-flex;justify-content:flex-start;width:100%;white-space:nowrap;font-size:.875em;padding:0 1em}.treb-toolbar .comment-editor{display:flex;flex-direction:column;padding:.25em}.treb-toolbar .comment-editor textarea{font-family:inherit;color:inherit;font-size:.875em;flex-grow:1;min-height:14em;min-width:10em;outline:none;border:1px solid #d1d5db;border-radius:.125em;resize:none}.treb-toolbar .comment-editor .comment-buttons{display:flex;flex-direction:row;justify-content:flex-end;margin-top:.5em}.treb-toolbar .comment-editor .comment-buttons button{font-family:inherit;font-size:.875em;width:auto;padding:0 .5em;height:32px;min-height:0}.treb-toolbar .comment-editor .comment-buttons button+button{margin-left:.5em}.treb-toolbar .group.narrow{display:none}.treb-toolbar .group.wide{display:flex}.treb-toolbar>*:not(.narrow)+*:not(.narrow){margin-left:.5em}.treb-toolbar.narrow .group.wide{display:none}.treb-toolbar.narrow .group.narrow{display:flex}.treb-toolbar.narrow>*:not(.wide)+*:not(.wide){margin-left:.5em}.treb-toolbar .container,.treb-toolbar button{font-family:inherit;font-size:inherit;background:transparent;border:1px solid #d1d5db;border-radius:.125em;outline:none}.treb-toolbar button{color:inherit;width:32px;height:32px;min-width:32px;min-height:32px;display:flex;padding:0;align-items:center;justify-content:center}.treb-toolbar button.color-button{flex-direction:column;font-size:.9em}.treb-toolbar button.color-button .color-bar{width:1.2em;height:3px;margin-top:2px;background:currentColor;box-shadow:0px 0px 1px 1px rgba(0,0,0,.125)}.treb-toolbar button:hover{background:#f3f4f6}.treb-toolbar button.active,.treb-toolbar button:focus{background:#f3f4f6}.treb-toolbar button svg{fill:currentColor;width:1em;height:1em}.treb-toolbar button svg path.fill-none{fill:none}.treb-toolbar button svg.symbol{width:1.25em;height:1.25em}.treb-toolbar button svg.symbol path{stroke:currentColor;stroke-width:1px;fill:none}.treb-toolbar button .active-icon{display:none}.treb-toolbar button.active .active-icon{display:initial}.treb-toolbar button.active .inactive-icon{display:none}.treb-toolbar button>*{pointer-events:none}.treb-toolbar .color-chooser-main{padding:.25em}.treb-toolbar .new-color{margin-top:.5em;display:flex;flex-direction:row}.treb-toolbar .new-color>*+*{margin-left:.25em}.treb-toolbar .new-color input,.treb-toolbar .new-color button{border-radius:3px;border:1px solid #d1d5db}.treb-toolbar .new-color input{flex-grow:1;width:6em;font-family:inherit;outline:none;padding:2px 6px}.treb-toolbar .new-color button{min-height:28px;min-width:28px;height:28px;width:28px}.treb-toolbar .color-header{font-size:.8em;margin-bottom:.2em;padding-bottom:.2em;border-bottom:1px solid currentColor}.treb-toolbar .other-colors{margin-top:.5em}.treb-toolbar .color-list{display:flex;flex-direction:column}.treb-toolbar .color-list .color-list-row{display:flex;flex-direction:row}.treb-toolbar .color-list button.color-swatch{border:1px solid #d1d5db;width:1.1em;height:1.1em;min-height:1.1em;min-width:1.1em;margin:3px;padding:0}.treb-toolbar .color-list button.color-swatch.default-color{background:#fff;border:1px dashed #333}.treb-toolbar .container{position:relative;width:8em}.treb-toolbar .container>input{font-family:inherit;font-size:.85em;overflow:hidden;text-overflow:ellipsis;position:absolute;padding-left:.5em;padding-right:.5em;top:0px;left:0px;bottom:0px;right:0px;width:100%;height:100%;border:0px;outline:none}.treb-toolbar button.drop{width:auto;min-width:13px;position:relative}.treb-toolbar button.drop::after{content:"";position:absolute;border:4px solid transparent;border-top-color:currentColor;right:2px;top:12px}.treb-toolbar button.drop.icon{padding-left:6px;padding-right:14px}.treb-toolbar .group{display:flex;position:relative}.treb-toolbar .group>*:not(:last-child){border-top-right-radius:0px;border-bottom-right-radius:0px}.treb-toolbar .group>*+*:not(.drop-menu){border-left-width:0px;border-top-left-radius:0px;border-bottom-left-radius:0px}.treb-toolbar .split-button{display:flex;flex-direction:column;justify-content:stretch}.treb-toolbar .split-button button{padding:0px;height:16px;min-height:16px}.treb-toolbar .split-button button div{font-size:.625em}.treb-toolbar .split-button>*:not(:last-child){border-bottom-left-radius:0px;border-bottom-right-radius:0px}.treb-toolbar .split-button>*+*{border-top-width:0px;border-top-left-radius:0px;border-top-right-radius:0px}',""]),t.Z=i},9477:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,".treb-main .treb-grid.grid-layout{display:grid;grid-template-columns:100px auto;grid-template-rows:20px auto}.treb-main .treb-grid.grid-layout .tile-cover.grid-cover{grid-row-start:2;grid-row-end:3;grid-column-start:2;grid-column-end:3}.treb-main .treb-grid.grid-layout .tile-cover.column-header-cover{grid-row-start:1;grid-row-end:2;grid-column-start:2;grid-column-end:3;position:-webkit-sticky;position:sticky;top:0px}.treb-main .treb-grid.grid-layout .tile-cover.row-header-cover{grid-row-start:2;grid-row-end:3;grid-column-start:1;grid-column-end:2;position:-webkit-sticky;position:sticky;left:0px}.treb-main .treb-grid.grid-layout .grid-selection{grid-row-start:1;grid-row-end:2;grid-column-start:1;grid-column-end:2}.treb-main .treb-grid.grid-layout .corner{grid-row-start:1;grid-row-end:2;grid-column-start:1;grid-column-end:2;position:-webkit-sticky;position:sticky}.treb-main .treb-grid.grid-layout .left-header{grid-row-start:2;grid-row-end:3;grid-column-start:1;grid-column-end:2;position:-webkit-sticky;position:sticky;display:grid;grid-template-columns:auto;grid-template-rows:auto}.treb-main .treb-grid.grid-layout .top-header{grid-row-start:1;grid-row-end:2;grid-column-start:2;grid-column-end:3;position:-webkit-sticky;position:sticky;display:grid;grid-template-columns:auto;grid-template-rows:auto}.treb-main .treb-grid.grid-layout .contents{grid-row-start:2;grid-row-end:3;grid-column-start:2;grid-column-end:3;display:grid;grid-template-columns:auto;grid-template-rows:auto}",""]),t.Z=i},7646:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,'.treb-mouse-mask{position:fixed;top:0px;left:0px;right:0px;bottom:0px;background:transparent;z-index:9999;display:none}.treb-mouse-mask.column-resize{cursor:col-resize}.treb-mouse-mask.row-resize{cursor:row-resize}.treb-mouse-mask.nub-select{cursor:crosshair}.treb-mouse-mask.move{cursor:move}.treb-mouse-mask.nw-resize{cursor:nw-resize}.treb-note{position:fixed;padding:7px 10px;border-radius:2px;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2);z-index:39;line-height:normal;top:100px;left:100px;max-width:15em;min-width:15em;opacity:0;transition:opacity .2s;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue","sans-serif";border:1px solid #ddd;color:#333;background:#fff;font-size:10.5pt;white-space:pre-line}.treb-hover-title{position:fixed;padding:7px 10px;border-radius:2px;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2);z-index:39;line-height:normal;top:100px;left:100px;min-width:10em;opacity:0;transition:opacity .2s;font-family:"-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue","sans-serif";border:1px solid #ddd;color:#333;background:#fff;font-size:10.5pt;white-space:pre-line;pointer-events:none}.treb-tooltip{display:none;pointer-events:none;position:fixed;padding:2px 10px;border-radius:2px;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2);z-index:39;line-height:normal}.treb-tooltip.arrow-up::after{box-sizing:border-box;position:absolute;top:calc(-2 * $tooltip-arrow-size);left:calc(50% - $tooltip-arrow-size);width:calc(2 * $tooltip-arrow-size);height:calc(2 * $tooltip-arrow-size);overflow:hidden;content:" ";border:4px solid transparent;border-bottom-color:inherit}.treb-tooltip.arrow-left::after{box-sizing:border-box;position:absolute;left:calc(-2 * $tooltip-arrow-size);top:calc(50% - $tooltip-arrow-size);width:calc(2 * $tooltip-arrow-size);height:calc(2 * $tooltip-arrow-size);overflow:hidden;content:" ";border:4px solid transparent;border-right-color:inherit}.treb-dropdown-caret{display:none;position:absolute;width:20px;height:20px;background:#fff;border:1px solid #ccc;border-radius:2px;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2);z-index:39}.treb-dropdown-caret path{fill:none;stroke:#444;stroke-linecap:round;stroke-linejoin:round;stroke-width:2}.treb-dropdown-list{position:absolute;display:none;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2);z-index:39;background:#fff;font-size:10pt;text-align:left;max-height:10em;overflow-y:auto;outline:none}.treb-dropdown-list div{padding:2px;cursor:default}.treb-dropdown-list div.selected{background:#555;color:#fff}.treb-dropdown-caret.active{background:#eee}.treb-dropdown-caret.active+.treb-dropdown-list{display:block}.treb-error-highlight{transition:opacity .15s ease-in-out;background:rgba(255,0,0,.25);opacity:0;pointer-events:none;position:absolute;z-index:40}.treb-main .treb-autocomplete{box-sizing:border-box;position:fixed;top:-1000px;font-size:inherit;font-weight:400;line-height:normal;text-align:left;max-height:10em;overflow-y:auto;z-index:39}.treb-main .treb-autocomplete *{box-sizing:border-box}.treb-main .treb-autocomplete ul{font-size:inherit;font-weight:inherit;list-style-type:none;padding:0;margin:0}.treb-main .treb-autocomplete ul li{font-size:inherit;font-weight:inherit;padding:0;margin:0}.treb-main .treb-autocomplete ul li a{font-size:inherit;font-weight:inherit;display:inline-block;width:100%;padding:3px 6px;text-decoration:none;cursor:default;color:inherit}.treb-main .treb-autocomplete-tooltip{z-index:39;top:-1000px;position:fixed;white-space:pre}.treb-main .treb-formula-bar-container{display:block;order:1}.treb-main .treb-formula-bar-container .treb-formula-bar{display:flex;flex-direction:row;text-align:left;padding:6px 2px;max-width:100%;overflow-x:hidden}.treb-main .treb-formula-bar-container .treb-formula-bar .address-label{width:95px;min-width:95px;min-height:1.5em;height:1.75em;border:1px solid #ccc;border-radius:2px;display:flex;flex-direction:column;justify-content:center;padding-left:3px;margin-right:6px}.treb-main .treb-formula-bar-container .treb-formula-bar .address-label>div{outline:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.treb-main .treb-formula-bar-container .treb-formula-bar .expand-button{background:transparent;border:0;border-radius:2px;margin-left:2px;padding:1px;outline:none;height:1.75em}.treb-main .treb-formula-bar-container .treb-formula-bar .expand-button::after{content:" ";border:5px solid transparent;position:relative;display:inline-block;border-top-color:#999;padding:0;margin:0;top:-6px}.treb-main .treb-formula-bar-container .treb-formula-bar.expanded .expand-button::after{border-top-color:transparent;border-bottom-color:#999;top:-12px}.treb-main .treb-formula-bar-container .treb-formula-bar .editor-container{border:1px solid #ccc;border-radius:2px;flex-grow:1;height:1.75em;display:flex;min-width:0px;flex-direction:column;justify-content:center}.treb-main .treb-formula-bar-container .treb-formula-bar.expanded .editor-container{transition:height .1s ease-in-out;height:4.5em}.treb-main .treb-formula-bar-container .treb-formula-bar.expanded .editor-container .formula-editor{overflow-y:auto}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-editor{width:100%;margin:2px;outline:none;overflow-y:hidden;overflow-x:hidden;line-height:1.35;flex-grow:1;min-height:1em}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-button{border:1px solid #ccc;border-radius:2px;margin-left:6px;height:1.75em;overflow:hidden;white-space:nowrap}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-button .text-1{font-style:italic;padding-right:.1em}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-button .text-1:after{content:"f"}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-button .text-2{font-size:.7em}.treb-main .treb-formula-bar-container .treb-formula-bar .formula-button .text-2:after{content:"(x)"}.treb-main .treb-tab-bar-container{order:3}.treb-main .treb-tab-bar-container .treb-tab-bar{display:flex;flex-direction:row;z-index:1;max-width:100%}.treb-main .treb-tab-bar-container .tab,.treb-main .treb-tab-bar-container .add-tab{font-size:inherit;padding:.25em .75em;cursor:default;display:inline-block;display:inline-flex;border-bottom-left-radius:5px;border-bottom-right-radius:5px;border:1px solid #ccc;border-top-width:0px;z-index:1;margin-right:-2px}.treb-main .treb-tab-bar-container .treb-scale-control{font-size:inherit;padding:.25em .75em;padding:.25em 1em;display:flex;flex-direction:row;align-items:center}.treb-main .treb-tab-bar-container .treb-scale-control>div{pointer-events:none;min-width:3em;text-align:center}.treb-main .treb-tab-bar-container .treb-scale-control button{font-size:inherit;border-radius:2px;width:1em;height:1em;border:1px solid currentColor;background:transparent;color:inherit;margin:0 .25em;position:relative;padding:0;line-height:0}.treb-main .treb-tab-bar-container .treb-scale-control button svg path{stroke:currentColor;stroke-width:1px}.treb-main .treb-tab-bar-container .delete-tab{font-size:inherit;padding:.25em .75em;cursor:default;display:inline-flex;align-items:center;flex-direction:row;border-bottom-left-radius:5px;border-bottom-right-radius:5px;border-top-width:0px;z-index:1;margin-right:-2px}.treb-main .treb-tab-bar-container .delete-tab svg{width:1em;height:1em;opacity:.5;pointer-events:none;transition:opacity .125s ease-in-out}.treb-main .treb-tab-bar-container .delete-tab:hover svg{opacity:.75}.treb-main .treb-tab-bar-container .delete-tab path{stroke:currentColor;stroke-width:1.5px;stroke-linecap:round}.treb-main .treb-tab-bar-container .tab-bar-spacer{flex-grow:1}.treb-main .treb-tab-bar-container .tab{white-space:nowrap;overflow-x:hidden}.treb-main .treb-tab-bar-container .tab.selected{z-index:2}.treb-main .treb-grid .in-cell-editor-container{position:absolute;opacity:0;outline:none;overflow:hidden;background:orange}.treb-main .treb-grid .in-cell-editor{position:relative;width:100%;max-width:100%;height:100%;overflow:hidden;padding:2px 3px;white-space:nowrap;display:table-cell;vertical-align:bottom;border:1px solid red;z-index:24;outline:none}.treb-main .treb-grid .overlay-editor-container{padding:0;margin:0;position:absolute;opacity:0;outline:none;z-index:24}.treb-main .treb-grid .overlay-inset{display:table;border-collapse:collapse;border-spacing:0px;position:absolute;height:100%;min-width:100%;margin-bottom:-10px}.treb-main .treb-grid .overlay-inset.align-left{left:0px}.treb-main .treb-grid .overlay-inset.align-center{left:50%;transform:translateX(-50%)}.treb-main .treb-grid .overlay-inset.align-center .overlay-editor{text-align:center;padding-right:1px}.treb-main .treb-grid .overlay-inset.align-right{right:0px}.treb-main .treb-grid .overlay-inset.align-right .overlay-editor{text-align:right;padding-right:2.5px}.treb-main .treb-grid .overlay-editor{position:absolute;position:relative;padding:0px 4px;white-space:nowrap;vertical-align:bottom;display:table-cell;outline:none}.treb-theme-container{position:fixed;left:-1000px;top:0;width:200px;overflow:hidden}.treb-theme-container>*{position:relative}.treb-main .theme-color-1{color:#e7e6e6}.treb-main .theme-color-2{color:#44546a}.treb-main .theme-color-3{color:#4472c4}.treb-main .theme-color-4{color:#ed7d31}.treb-main .theme-color-5{color:#a5a5a5}.treb-main .theme-color-6{color:#ffc000}.treb-main .theme-color-7{color:#5b9bd5}.treb-main .theme-color-8{color:#70ad47}.treb-main .theme-color-9{color:#0563c1}.treb-main .theme-color-10{color:#954f72}.treb-main .note-marker{background:#6fab20}.treb-main .grid-headers{font-family:inherit;font-size:10pt;font-weight:normal;font-style:normal;background:#eeeef2;color:#666}.treb-main .grid-cells{font-size:14px;color:#333;background:#fff;border-color:#666;stroke:#ccccd4}.treb-main .frozen-selection.highlight-area{background:rgba(87,184,255,.25);border-left-color:#2176ae;border-bottom-color:#2176ae}.treb-main .treb-autocomplete-tooltip{font-size:14px;background:#fffbb5;border-radius:2px;color:inherit;padding:3px 8px;margin:4px 0px;line-height:normal}.treb-main .treb-autocomplete-tooltip .active-argument{font-weight:700}.treb-main .treb-autocomplete-tooltip .function-description{font-style:italic}.treb-main .treb-autocomplete{font-size:14px;background:#fff;border-radius:2px;border:1px solid #ccc;box-shadow:0px 1px 4px 2px rgba(109,109,109,.2)}.treb-main .treb-autocomplete li{color:#333}.treb-main .treb-autocomplete li a.selected{background:#396;color:#fff}.treb-main .header-overlay{stroke:none;color:#40c040}.treb-main .header-overlay .overlay{fill:#000;stroke:none;opacity:.05}.treb-main .header-overlay .highlight{fill:currentColor}.treb-main .in-cell-editor span.highlight-1,.treb-main .formula-editor span.highlight-1,.treb-main .overlay-editor span.highlight-1{color:#fa9b05}.treb-main .in-cell-editor span.highlight-2,.treb-main .formula-editor span.highlight-2,.treb-main .overlay-editor span.highlight-2{color:#0093ff}.treb-main .in-cell-editor span.highlight-3,.treb-main .formula-editor span.highlight-3,.treb-main .overlay-editor span.highlight-3{color:#b66d0d}.treb-main .in-cell-editor span.highlight-4,.treb-main .formula-editor span.highlight-4,.treb-main .overlay-editor span.highlight-4{color:#2176ae}.treb-main .in-cell-editor span.highlight-5,.treb-main .formula-editor span.highlight-5,.treb-main .overlay-editor span.highlight-5{color:#fe2f01}.treb-main .grid-selection .selection,.treb-main .frozen-selection .selection{stroke-width:2px}.treb-main .grid-selection .selection .outline,.treb-main .frozen-selection .selection .outline{stroke:currentColor;fill:none}.treb-main .grid-selection .selection .fill,.treb-main .frozen-selection .selection .fill{stroke:none;fill:currentColor;opacity:.1}.treb-main .grid-selection .alternate-selection,.treb-main .frozen-selection .alternate-selection{stroke-dasharray:3 2}.treb-main .grid-selection .alternate-selection:nth-of-type(1n),.treb-main .frozen-selection .alternate-selection:nth-of-type(1n){color:#fbb13c}.treb-main .grid-selection .alternate-selection:nth-of-type(2n),.treb-main .frozen-selection .alternate-selection:nth-of-type(2n){color:#57b8ff}.treb-main .grid-selection .alternate-selection:nth-of-type(3n),.treb-main .frozen-selection .alternate-selection:nth-of-type(3n){color:#b66d0d}.treb-main .grid-selection .alternate-selection:nth-of-type(4n),.treb-main .frozen-selection .alternate-selection:nth-of-type(4n){color:#2176ae}.treb-main .grid-selection .alternate-selection:nth-of-type(5n),.treb-main .frozen-selection .alternate-selection:nth-of-type(5n){color:#fe6847}.treb-main .grid-selection .primary-selection,.treb-main .frozen-selection .primary-selection{color:#40c040}.treb-main .grid-selection .primary-selection .nub,.treb-main .frozen-selection .primary-selection .nub{stroke:#fff;fill:currentColor;stroke-width:1px}.treb-main .treb-tooltip{font-size:11pt;background:rgba(0,0,0,.8);color:#fff;border-color:rgba(0,0,0,.8)}.treb-main .treb-tab-bar{font-size:14px}.treb-main .treb-tab-bar .tab,.treb-main .treb-tab-bar .add-tab{background:#eeeef2}.treb-main .treb-tab-bar .tab.selected,.treb-main .treb-tab-bar .add-tab.selected{background:#fff}.treb-main .treb-formula-bar .address-label,.treb-main .treb-formula-bar .editor-container{background:#fff}.treb-main .treb-formula-bar .address-label.locked,.treb-main .treb-formula-bar .editor-container.locked{background:#eef4fc;position:relative}.treb-main .treb-formula-bar .address-label.locked:after,.treb-main .treb-formula-bar .editor-container.locked:after{position:absolute;right:2px;top:2px;content:"";width:11px;height:11px;opacity:.4;background-image:url("data:image/svg+xml,%0A%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 512 512\'%3E%3Cpath d=\'M416 224H400V144C400 65 335 0 256 0S112 65 112 144V224H96C61 224 32 253 32 288V448C32 483 61 512 96 512H416C451 512 480 483 480 448V288C480 253 451 224 416 224ZM176 144C176 100 212 64 256 64S336 100 336 144V224H176V144Z\' fill=\'currentColor\'/%3E%3C/svg%3E")}.treb-ua-windows .grid-cells{font-size:12pt;font-family:"Calibri","-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue","sans-serif"}.treb-main{position:relative;display:flex;flex-direction:column;line-height:normal;text-align:left}.treb-main *{box-sizing:border-box}.treb-main .treb-layout-master{flex-grow:1;order:2;position:relative;-webkit-overflow-scrolling:touch;-webkit-tap-highlight-color:transparent;overflow:hidden;display:flex;position:relative}.treb-main .treb-grid{flex-grow:1;order:2;position:relative;overflow:scroll;-webkit-overflow-scrolling:touch;-webkit-tap-highlight-color:transparent;outline:none}.treb-main .treb-grid.safari::-webkit-scrollbar{-webkit-appearance:none;width:7px;height:7px}.treb-main .treb-grid.safari::-webkit-scrollbar-thumb{border-radius:4px;background-color:rgba(0,0,0,.25);-webkit-box-shadow:0 0 1px rgba(255,255,255,.5)}.treb-main .treb-grid canvas{border:0;margin:0;padding:0;background:transparent}.treb-main .treb-grid .nub-select{cursor:crosshair}.treb-main .treb-grid .link-pointer{cursor:pointer}.treb-main .treb-grid .mock-selection-node{background:red;position:fixed;left:-100px;top:-100px}.treb-main .treb-grid .tile-cover{background:transparent;position:relative;z-index:14}.treb-main .treb-grid .tile-cover.column-header-cover{z-index:22}.treb-main .treb-grid .tile-cover.column-header-cover.resize{cursor:col-resize}.treb-main .treb-grid .tile-cover.row-header-cover{z-index:22}.treb-main .treb-grid .tile-cover.row-header-cover.resize{cursor:row-resize}.treb-main .treb-grid .annotation-container,.treb-main .treb-grid .frozen-annotation-container{position:absolute;top:0px;left:0px;z-index:16;pointer-events:none}.treb-main .treb-grid .annotation-container .annotation,.treb-main .treb-grid .frozen-annotation-container .annotation{position:absolute;overflow:hidden;pointer-events:auto;background:rgba(255,255,255,.5);border:1px solid #999;z-index:1}.treb-main .treb-grid .annotation-container .annotation .annotation-content,.treb-main .treb-grid .frozen-annotation-container .annotation .annotation-content{position:absolute;top:0px;left:0px;height:100%;width:100%;font-family:inherit;font-size:inherit;z-index:1}.treb-main .treb-grid .annotation-container .annotation .annotation-move-target,.treb-main .treb-grid .frozen-annotation-container .annotation .annotation-move-target{position:absolute;z-index:2;cursor:move;top:0px;left:0px;height:10%;min-height:14px;width:100%}.treb-main .treb-grid .annotation-container .annotation .annotation-resize-target,.treb-main .treb-grid .frozen-annotation-container .annotation .annotation-resize-target{position:absolute;z-index:3;cursor:nwse-resize;bottom:0px;right:0px;width:10%;height:10%;min-height:14px;min-width:14px}.treb-main .treb-grid .annotation-container .annotation:focus,.treb-main .treb-grid .annotation-container .annotation.retain-focus,.treb-main .treb-grid .annotation-container .annotation.clone-focus,.treb-main .treb-grid .frozen-annotation-container .annotation:focus,.treb-main .treb-grid .frozen-annotation-container .annotation.retain-focus,.treb-main .treb-grid .frozen-annotation-container .annotation.clone-focus{box-shadow:0px 0px 0px 3px rgba(14,165,233,.33)}.treb-main .treb-grid .annotation-container .move-buffer,.treb-main .treb-grid .frozen-annotation-container .move-buffer{position:absolute;border:1px solid red;height:10%;top:0px;width:100%;left:0px;cursor:move}.treb-main .treb-grid .grid-selection{background:transparent;position:absolute;z-index:10;-moz-transform:scale(1)}.treb-main .treb-grid .frozen-selection{transition:background .33s;position:absolute;z-index:12;overflow:hidden;-moz-transform:scale(1);pointer-events:none}.treb-main .treb-grid .frozen-selection.frozen-selection-rows{border-bottom:1px solid transparent}.treb-main .treb-grid .frozen-selection.frozen-selection-columns{border-right:1px solid transparent}.treb-main .treb-grid .frozen-annotation-container{position:absolute;top:0px;left:0px;overflow:hidden;width:100%;height:100%}.treb-main .treb-grid .corner{top:0px;left:0px;z-index:20}.treb-main .treb-grid .corner canvas{position:absolute;top:0px;left:0px;pointer-events:none}.treb-main .treb-grid .left-header{left:0px;z-index:18;pointer-events:none}.treb-main .treb-grid .top-header{top:0px;z-index:18;pointer-events:none}.treb-main .treb-grid .contents{height:2000px;width:2000px}',""]),t.Z=i},4340:function(e,t,r){"use strict";var o=r(3645),i=r.n(o)()((function(e){return e[1]}));i.push([e.id,'.treb-main .treb-grid.legacy-layout{overflow:hidden}.treb-main .treb-grid.legacy-layout .scroller{position:absolute;width:100%;height:100%;min-width:100%;min-height:100%;z-index:26;overflow:scroll}.treb-main .treb-grid.legacy-layout .scroller.col-resize{cursor:col-resize}.treb-main .treb-grid.legacy-layout .scroller.row-resize{cursor:row-resize}.treb-main .treb-grid.legacy-layout .row-header-tile,.treb-main .treb-grid.legacy-layout .column-header-tile,.treb-main .treb-grid.legacy-layout .grid-tile,.treb-main .treb-grid.legacy-layout .frozen-row-tile,.treb-main .treb-grid.legacy-layout .frozen-column-tile{position:absolute}.treb-main .treb-grid.legacy-layout .tile-cover{position:absolute}.treb-main .treb-grid.legacy-layout .corner{position:absolute;top:0px;left:0px}.treb-main .treb-grid.legacy-layout .corner:after{content:"";position:absolute;border:6px solid #ff4500;border-bottom-color:transparent;border-right-color:transparent}.treb-main .treb-grid.legacy-layout .left-header{position:absolute;top:24px;left:0px}.treb-main .treb-grid.legacy-layout .top-header{position:absolute;top:0px;left:100px}.treb-main .treb-grid.legacy-layout .contents{position:absolute;top:24px;left:100px}',""]),t.Z=i},3645:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=e(t);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var n=0;n<this.length;n++){var a=this[n][0];null!=a&&(i[a]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);o&&i[l[0]]||(r&&(l[2]?l[2]="".concat(r," and ").concat(l[2]):l[2]=r),t.push(l))}},t}},3162:function(e,t,r){var o,i;void 0===(i="function"==typeof(o=function(){"use strict";function t(e,t,r){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){s(o.response,t,r)},o.onerror=function(){console.error("could not download file")},o.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,a=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(e,r,a){var s=n.URL||n.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):o(l.href)?t(e,r,a):i(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,n){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,n),r);else if(o(e))t(e,r,n);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((function(){i(a)}))}}:function(e,r,o,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,r,o);var s="application/octet-stream"===e.type,l=/constructor/i.test(n.HTMLElement)||n.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||a)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},d.readAsDataURL(e)}else{var u=n.URL||n.webkitURL,h=u.createObjectURL(e);i?i.location=h:location.href=h,i=null,setTimeout((function(){u.revokeObjectURL(h)}),4e4)}});n.saveAs=s.saveAs=s,e.exports=s})?o.apply(t,[]):o)||(e.exports=i)},4691:function(e,t){!function(e){"use strict";var t=new(function(){function e(e){void 0===e&&(e=0),this.m_w=0,this.m_z=0,this.Seed(e)}return e.prototype.Seed=function(e){void 0===e&&(e=0),e?(this.m_w=Math.round(2863311530&e)||1,this.m_z=Math.round(1431655765&e)||1):(this.m_w=Math.round(1e5*Math.random()),this.m_z=Math.round((new Date).getTime()))},e.prototype.Next=function(){return this.m_z=36969*(65535&this.m_z)+(this.m_z>>16)&4294967295,this.m_w=18e3*(65535&this.m_w)+(this.m_w>>16)&4294967295,.5+((this.m_z<<16)+this.m_w&4294967295)/4294967296},e.prototype.GetState=function(){return[this.m_w,this.m_z]},e}()),r=function(){function e(){}return e.Sort=function(e,t){this.QuickSort(e,t,0,e.length)},e.Partition=function(e,t,r,o){for(var i=e[o-1],n=r,a=r;a<o-1;a+=1)e[a]<=i&&(this.Swap(e,t,a,n),n+=1);return this.Swap(e,t,n,o-1),n},e.Swap=function(e,t,r,o){var i=e[r];e[r]=e[o],e[o]=i,i=t[r],t[r]=t[o],t[o]=i},e.QuickSort=function(e,t,r,o){if(r<o){var i=this.Partition(e,t,r,o);this.QuickSort(e,t,r,i),this.QuickSort(e,t,i+1,o)}},e}(),o=function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=function(){function e(){}return e.Sort=function(e){return this.QuickSort(e,0,e.length-1),e},e.Swap=function(e,t,r){var o=e[t];e[t]=e[r],e[r]=o},e.Partition=function(e,t,r){for(var o=e[Math.floor((r+t)/2)];t<=r;){for(;e[t]<o;)t++;for(;e[r]>o;)r--;t<=r&&(this.Swap(e,t,r),t++,r--)}return t},e.QuickSort=function(e,t,r){var o;return e.length>1&&(t<(o=this.Partition(e,t,r))-1&&this.QuickSort(e,t,o-1),o<r&&this.QuickSort(e,o,r)),e},e}(),n=function(){function e(){}return e.Correlation=function(e,t){for(var r=0,o=0,i=0,n=0,a=0,s=0,l=0;l<e.length;l++)o+=e[l]*t[l],i+=e[l],n+=t[l],a+=e[l]*e[l],s+=t[l]*t[l];return(r=e.length*o-i*n)&&(r/=Math.sqrt((e.length*a-i*i)*(e.length*s-n*n))),r},e.TickRange=function(e,t,r){var o=e/(t-1),i=Math.ceil(this.Log10(o)-1),n=Math.pow(10,i);return Math.ceil(o/n)*n},e.Log10=function(e){return Math.log(e)/Math.LN10},e.Log2=function(e){return Math.log(e)/Math.LN2},e.Percentiles=function(e,t){for(var r=i.Sort(e.slice(0)),o=r.length,n=new Array(101),a=0;a<100;a++)n[a]=r[Math.round(o*a/100)];return n[100]=r[o-1],n},e.Percentile=function(e,t){var r=i.Sort(e.slice(0)),o=r.length;return r[Math.max(0,Math.min(o-1,Math.round(o*t)))]},e.Interval=function(e){var t=0;if(!e.data||!e.data.length)return 0;if(void 0===e.min){if(void 0===e.max)return 1;for(var r=0,o=e.data;r<o.length;r++)(l=o[r])<=e.max&&t++}else if(void 0===e.max)for(var i=0,n=e.data;i<n.length;i++)(l=n[i])>=e.min&&t++;else for(var a=0,s=e.data;a<s.length;a++){var l;(l=s[a])>=e.min&&l<=e.max&&t++}return t/e.data.length},e.R2=function(e,t){for(var r=0,o=0,i=0,n=0,a=0,s=0,l=0,c=0,d=0;d<e.length;d++)n+=(o=t[d])*(i=e[d]),a+=o,s+=i,l+=o*o,c+=i*i;return(r=e.length*n-a*s)&&(r/=Math.sqrt((e.length*l-a*a)*(e.length*c-s*s))),r*r},e.ToSD=function(e,t){if(void 0===t&&(t=2),t=t||2,0===e)return e;var r=Math.pow(10,Math.floor(this.Log10(e))+1-t);return Math.round(e/r)*r},e.Statistics=function(e){for(var t=this.Range(e),r=e.length,n=0,a=0,s=0,l=0,c=i.Sort(e.slice(0)),d=c[Math.round(r/2)],u=0;u<r;u++)n+=e[u];var h=n/=r;for(u=0;u<r;u++){var f=e[u]-n;a+=f*f,l+=f*f*f,s+=f*f*f*f}var p=r,m=a/r,v=Math.sqrt(a/r),y=l/((r-1)*Math.pow(v,3)),_=s/((r-1)*Math.pow(v,4)),g=Math.sqrt(a/r)/Math.sqrt(r),b={};for(u=5;u<100;u+=5)b[u]=c[Math.round(r*u/100)];b[0]=c[0],b[100]=c[r-1];var w=this.Interval({data:e,max:0});return o(o({},t),{median:d,mean:h,N:p,variance:m,stdev:v,skewness:y,kurtosis:_,stderr:g,percentiles:b,zero:w})},e.Truncate=function(e,t,r){var o=i.Sort(e.slice(0));return o.slice(Math.round(o.length*t/100),Math.round(o.length*r/100))},e.Histogram=function(e,t){void 0===t&&(t="sturges");for(var r=!0,o=0;r&&o<e.length;o++)r=r&&e[o]===Math.round(e[o]);var i=this.Range(e);if("string"==typeof t||!t)if("fd"===t){var n=this.FD(e);t=0===n||0===i.range?1:Math.round(i.range/n+1)}else t=this.Sturges(e);var a=[],s=[];if(r&&t>i.range){for(t=i.range+1,o=0;o<t;o++)a[o]=0,s[o]=i.min+o;for(var l=0,c=e;l<c.length;l++)a[(v=c[l])-i.min]++}else{var d=this.TickRange(i.range,t),u=this.FirstBin(i.max,i.min,t,d),h=Math.ceil(this.Log10(d)-1);for(o=0;o<t;o++)a[o]=0,s[o]=(u+o*d).toFixed(Math.max(0,-h));for(var f=u-d,p=0,m=e;p<m.length;p++){var v=m[p];a[Math.floor((v-f)/d)]++}}return{bins:a,labels:s}},e.Sturges=function(e){return Math.ceil(this.Log2(e.length)+1)},e.IQR=function(e){var t=this.Quantiles(e,[.25,.75]);return t[1]-t[0]},e.Quantiles=function(e,t){void 0===t&&(t=[0,.25,.5,.75,1]);var r=i.Sort(e.slice(0));return t.map((function(e){return r[Math.floor((r.length-1)*e)]}))},e.FD=function(e){return 2*this.IQR(e)*Math.pow(e.length,-1/3)},e.FirstBin=function(e,t,r,o){var i=(Math.floor(t/o)+1)*o,n=Math.floor((i+(r-1)*o-e)/o);return n>=2?i-n/2*o:i},e.Range=function(e){for(var t=e.length,r=t>0?e[0]:0,o=t>0?e[0]:0,i=1;i<t;i++)e[i]>o&&(o=e[i]),e[i]<r&&(r=e[i]);return{min:r,max:o,range:o-r}},e.EPSILON_DOUBLE=2220446049250313e-31,e.QUIET_NAN=Number.NaN,e.s_undefined="undefined",e.s_object="object",e.s_number="number",e}(),a=function(){function e(){this.rows=0,this.columns=0,this.data=[]}return e.Zero=function(t,r){return void 0===r&&(r=t),(new e).Reset(t,r)},e.Identity=function(e){for(var t=this.Zero(e,e),r=0;r<e;r++)t.data[r][r]=1;return t},e.Clone=function(t){var r=new e;r.rows=t.rows,r.columns=t.columns;for(var o=0,i=t.data;o<i.length;o++){var n=i[o];r.data.push(new Float64Array(n))}return r},e.FromArray=function(e,t){void 0===t&&(t=!1);var r=e[0].length,o=e.length;if(t){for(var i=this.Zero(r,o),n=0;n<o;n++)for(var a=0;a<r;a++)i.data[n][a]=e[n][a];return i}for(i=this.Zero(o,r),n=0;n<o;n++)for(a=0;a<r;a++)i.data[a][n]=e[n][a]||0;return i},e.prototype.Reset=function(e,t){this.data=new Array(t);for(var r=0;r<t;r++)this.data[r]=new Float64Array(e);return this.rows=e,this.columns=t,this},e.prototype.CopyTo=function(e){e.rows=this.rows,e.columns=this.columns,e.data=new Array(this.columns);for(var t=0,r=this.data;t<r.length;t++){var o=r[t];e.data.push(new Float64Array(o))}return e},e.prototype.GetColumn=function(e){return this.data[e]},e.prototype.SetColumn=function(e,t){this.data[e]=new Float64Array(t)},e.prototype.Transpose=function(){for(var t=e.Zero(this.columns,this.rows),r=0;r<this.columns;r++)for(var o=0;o<this.rows;o++)t.data[r][o]=this.data[o][r];return t},e.prototype.Symmetrize=function(t){void 0===t&&(t=!1);var r=this.Transpose(),o=e.Clone(this);if(t)for(n=1;n<this.columns;n++)for(i=0;i<n;i++)o.data[i][n]=r.data[i][n];else for(var i=1;i<this.rows;i++)for(var n=0;n<i;n++)o.data[i][n]=r.data[i][n];return o},e.prototype.Cholesky=function(t){if(void 0===t&&(t=!1),this.rows!==this.columns)throw new Error("matrix not square");for(var r=this.rows,o=e.Zero(r),i=0;i<r;i++){for(var n=0,a=0;a<i;a++){for(var s=0,l=0;l<a;l++)s+=o.data[a][l]*o.data[i][l];if(o.data[i][a]=s=(this.data[i][a]-s)/o.data[a][a],n+=s*s,this.data[a][i]!==this.data[i][a])throw new Error("matrix not symmetrical")}if((n=this.data[i][i]-n)<=0)throw new Error("matrix not pos-def ("+n+")");for(o.data[i][i]=n>0?Math.sqrt(n):0,a=i+1;a<r;a++)o.data[i][a]=0}return t?o.Transpose():o},e.prototype.Multiply=function(t){for(var r=0,o=0,i=e.Zero(this.rows,t.columns),n=0;n<this.rows;n++)for(var a=0;a<t.columns;a++){for(o=r=0;r<this.columns;r++)o+=this.data[r][n]*t.data[a][r];i.data[a][n]=o}return i},e.prototype.Inverse=function(){if(this.rows!==this.columns)throw new Error("invalid matrix");for(var t=e.Clone(this),r=0,o=t.rows,i=1;i<o;i++)t.data[i][0]/=t.data[0][0];for(i=1;i<o;i++){for(var n=i;n<o;n++){r=0;for(var a=0;a<i;a++)r+=t.data[a][n]*t.data[i][a];t.data[i][n]-=r}if(i!==o-1)for(n=i+1;n<o;n++){for(r=0,a=0;a<i;a++)r+=t.data[a][i]*t.data[n][a];t.data[n][i]=(t.data[n][i]-r)/t.data[i][i]}}for(i=0;i<o;i++)for(n=i;n<o;n++){var s=1;if(i!==n)for(s=0,a=i;a<n;a++)s-=t.data[a][n]*t.data[i][a];t.data[i][n]=s/t.data[n][n]}for(i=0;i<o;i++)for(n=i;n<o;n++)if(i!==n){for(r=0,a=i;a<n;a++)r+=t.data[n][a]*(i===a?1:t.data[a][i]);t.data[n][i]=-r}for(i=0;i<o;i++)for(n=0;n<o;n++){for(r=0,a=i>n?i:n;a<o;a++)r+=(n===a?1:t.data[a][n])*t.data[i][a];t.data[i][n]=r}return t},e.prototype.SortColumns=function(t){void 0===t&&(t=!1);for(var r=e.Clone(this),o=t?function(e,t){return t-e}:function(e,t){return e-t},i=0,n=r.data;i<n.length;i++)n[i].sort(o);return r},e.prototype.Rank=function(t){void 0===t&&(t=!1);for(var o=e.Clone(this),i=new Int32Array(this.rows),n=0;n<this.rows;n++)i[n]=n;for(var a=0;a<this.columns;a++){var s=new Int32Array(i);for(r.Sort(o.data[a],s),t&&s.reverse(),n=0;n<this.rows;n++)o.data[a][s[n]]=n}return o},e.prototype.Rank2=function(t,o){void 0===t&&(t=!1);for(var i=e.Zero(this.rows,this.columns),n=new Int32Array(this.rows),a=0;a<this.rows;a++)n[a]=a;for(var s=0;s<this.columns;s++){var l=new Int32Array(n);for(r.Sort(this.data[s],l),t&&l.reverse(),a=0;a<this.rows;a++)i.data[s][l[a]]=o.data[s][a]}return i},e.prototype.Correl=function(){for(var t=e.Zero(this.columns,this.columns),r=0;r<this.columns;r++){t.data[r][r]=1;for(var o=0;o<r;o++)t.data[o][r]=n.Correlation(this.data[r],this.data[o])}return t.Symmetrize()},e.prototype.IsSymmetric=function(){if(this.rows!==this.columns)return!1;for(var e=0;e<this.columns;e++)for(var t=0;t<this.rows;t++)if(this.data[e][t]!==this.data[t][e])return!1;return!0},e.prototype.toString=function(e){var t="";e=e||2;for(var r=0;r<this.rows;r++){for(var o=0;o<this.columns;o++){var i=this.data[o][r];i>=0&&(t+=" "),t+=i.toFixed(e),t+=" "}t+="\n"}return t},e}();Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length,r=0;r<t;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;e+=arguments[r]*arguments[r]}return Math.sqrt(e)});var s=function(){function e(){}return e.Guid=function(){for(var e="",t=0;t<8;t++)e+=Math.round(256*Math.random()).toString(16);return e},e.Log10=function(e){return Math.log(e)/Math.LN10},e.ToSD=function(e,t){if(void 0===t&&(t=2),t=t||2,0===e)return e;var r=e<0?-1:1;e*=r;var o=Math.pow(10,Math.floor(this.Log10(e))+1-t);return Math.round(e/o)*o*r},e.ToSDCeil=function(e,t){if(void 0===t&&(t=2),t=t||2,0===e)return e;var r=e<0?-1:1;e*=r;var o=Math.pow(10,Math.floor(this.Log10(e))+1-t);return Math.ceil(e/o)*o*r},e.SuggestDecimals=function(e){if("number"!=typeof e){for(var t=e[0],r=e[0],o=0,i=e;o<i.length;o++){var n=i[o];t=Math.min(t,n),r=Math.max(r,n)}e=r-t}var a=Math.ceil(this.Log10(e));return console.log(a),a<=0?1-a:1},e.YearFraction=function(e){var t=new Date(e.getTime());return t.setMonth(11,31),(t.getTime()-e.getTime())/this.MILLIS_YEAR},e.DEFAULT_NUMBER_FORMAT="(0,0.00)",e.DEFAULT_PCT_FORMAT="0.00",e.DEFAULT_CURRENCY_FORMAT="(0,0)",e.MILLIS_YEAR=315576e5,e}(),l=function(){function e(e){this.order=0,this.realvalues=[],this.ivalues=[],this.vectors=[];var t=e.length;this.order=t,this.vectors=[];for(var r=!0,o=0;r&&o<t;o++){if(e[o].length!==t)throw new Error("not square");for(var i=0;i<t;i++)e[o][i]!==e[i][o]&&(r=!1)}if(r){for(o=0;o<t;o++)Array.isArray(e[o])?this.vectors.push(e[o].slice(0)):this.vectors.push(Array.from(e[o]));this.tred2(),this.tql2()}else{var n=[],a=[];for(o=0;o<t;o++){for(Array.isArray(e[o])?n.push(e[o].slice(0)):n.push(Array.from(e[o])),this.vectors.push([]),i=0;i<t;i++)this.vectors[o][i]=0;a.push(0)}this.orthes(n,a),this.hqr2(n,a)}}return e.prototype.GetDiagonal=function(){for(var e=[],t=0;t<this.order;t++){e.push([]);for(var r=0;r<this.order;r++)e[t][r]=0;e[t][t]=this.realvalues[t],this.ivalues[t]>0?e[t][t+1]=this.ivalues[t]:this.ivalues[t]<0&&(e[t][t-1]=this.ivalues[t])}return e},e.prototype.tred2=function(){for(var e=0,t=0,r=0,o=0,i=0,n=this.order,a=this.vectors,s=this.realvalues,l=this.ivalues,c=0;c<n;c++)s[c]=a[n-1][c];for(var d=n-1;d>0;d--){r=0,o=0;for(var u=0;u<d;u++)r+=Math.abs(s[u]);if(0===r)for(l[d]=s[d-1],c=0;c<d;c++)s[c]=a[d-1][c],a[d][c]=0,a[c][d]=0;else{for(u=0;u<d;u++)s[u]/=r,o+=s[u]*s[u];for(e=s[d-1],t=Math.sqrt(o),e>0&&(t=-t),l[d]=r*t,o-=e*t,s[d-1]=e-t,c=0;c<d;c++)l[c]=0;for(c=0;c<d;c++){e=s[c],a[c][d]=e;var h=l[c]+a[c][c]*e;for(u=c+1;u<=d-1;u++)h+=a[u][c]*s[u],l[u]+=a[u][c]*e;l[c]=h}for(e=0,c=0;c<d;c++)l[c]/=o,e+=l[c]*s[c];for(i=e/(o+o),c=0;c<d;c++)l[c]-=i*s[c];for(c=0;c<d;c++){for(e=s[c],t=l[c],u=c;u<=d-1;u++)a[u][c]-=e*l[u]+t*s[u];s[c]=a[d-1][c],a[d][c]=0}}s[d]=o}for(d=0;d<n-1;d++){if(a[n-1][d]=a[d][d],a[d][d]=1,0!==(o=s[d+1])){for(u=0;u<=d;u++)s[u]=a[u][d+1]/o;for(c=0;c<=d;c++){for(t=0,u=0;u<=d;u++)t+=a[u][d+1]*a[u][c];for(u=0;u<=d;u++)a[u][c]-=t*s[u]}}for(u=0;u<=d;u++)a[u][d+1]=0}for(c=0;c<n;c++)s[c]=a[n-1][c],a[n-1][c]=0;a[n-1][n-1]=1,l[0]=0},e.prototype.tql2=function(){var e,t,r,o,i,n,a,s,l,c,d,u,h,f,p,m,v,y,_,g=this.order,b=this.vectors,w=this.realvalues,x=this.ivalues;for(e=1;e<g;e++)x[e-1]=x[e];for(x[g-1]=0,a=0,s=0,l=Math.pow(2,-52),t=0;t<g;t++){for(s=Math.max(s,Math.abs(w[t])+Math.abs(x[t])),n=t;n<g&&!(Math.abs(x[n])<=l*s);)n++;if(n>t)do{for(c=w[t],o=(w[t+1]-c)/(2*x[t]),d=Math.hypot(o,1),o<0&&(d=-d),w[t]=x[t]/(o+d),w[t+1]=x[t]*(o+d),u=w[t+1],h=c-w[t],e=t+2;e<g;e++)w[e]-=h;for(a+=h,o=w[n],p=f=1,m=f,v=x[t+1],y=0,_=0,e=n-1;e>=t;e--)for(m=p,p=f,_=y,c=f*x[e],h=f*o,d=Math.hypot(o,x[e]),x[e+1]=y*d,y=x[e]/d,o=(f=o/d)*w[e]-y*c,w[e+1]=h+y*(f*c+y*w[e]),r=0;r<g;r++)h=b[r][e+1],b[r][e+1]=y*b[r][e]+f*h,b[r][e]=f*b[r][e]-y*h;o=-y*_*m*v*x[t]/u,x[t]=y*o,w[t]=f*o}while(Math.abs(x[t])>l*s);w[t]=w[t]+a,x[t]=0}for(e=0;e<g-1;e++){for(r=e,o=w[e],i=e+1;i<g;i++)w[i]<o&&(r=i,o=w[i]);if(r!==e)for(w[r]=w[e],w[e]=o,i=0;i<g;i++)o=b[i][e],b[i][e]=b[i][r],b[i][r]=o}},e.prototype.orthes=function(e,t){var r,o,i,n,a,s,l,c=this.order,d=this.vectors,u=(this.realvalues,this.ivalues,c-1);for(s=1;s<=u-1;s++){for(l=0,n=s;n<=u;n++)l+=Math.abs(e[n][s-1]);if(0!==l){for(i=0,n=u;n>=s;n--)t[n]=e[n][s-1]/l,i+=t[n]*t[n];for(o=Math.sqrt(i),t[s]>0&&(o=-o),i-=t[s]*o,t[s]=t[s]-o,a=s;a<c;a++){for(r=0,n=u;n>=s;n--)r+=t[n]*e[n][a];for(r/=i,n=s;n<=u;n++)e[n][a]-=r*t[n]}for(n=0;n<=u;n++){for(r=0,a=u;a>=s;a--)r+=t[a]*e[n][a];for(r/=i,a=s;a<=u;a++)e[n][a]-=r*t[a]}t[s]=l*t[s],e[s][s-1]=l*o}}for(n=0;n<c;n++)for(a=0;a<c;a++)d[n][a]=n===a?1:0;for(s=u-1;s>=1;s--)if(0!==e[s][s-1]){for(n=s+1;n<=u;n++)t[n]=e[n][s-1];for(a=s;a<=u;a++){for(o=0,n=s;n<=u;n++)o+=t[n]*d[n][a];for(o=o/t[s]/e[s][s-1],n=s;n<=u;n++)d[n][a]+=o*t[n]}}},e.prototype.cdiv=function(e,t,r,o){var i=0,n=0;return Math.abs(r)>Math.abs(o)?{r:(e+(i=o/r)*t)/(n=r+i*o),i:(t-i*e)/n}:{r:((i=r/o)*e+t)/(n=o+i*r),i:(i*t-e)/n}},e.prototype.hqr2=function(e,t){var r,o,i,n,a,s,l,c,d,u,h,f=this.order,p=this.vectors,m=this.realvalues,v=this.ivalues,y=f,_=y-1,g=y-1,b=Math.pow(2,-52),w=0,x=0,C=0,S=0,A=0,k=0,M=0;for(s=0;s<y;s++)for((s<0||s>g)&&(m[s]=e[s][s],v[s]=0),l=Math.max(s-1,0);l<y;l++)M+=Math.abs(e[s][l]);for(d=0;_>=0;){for(u=_;u>0&&(0===(A=Math.abs(e[u-1][u-1])+Math.abs(e[u][u]))&&(A=M),!(Math.abs(e[u][u-1])<b*A));)u--;if(u===_)e[_][_]=e[_][_]+w,m[_]=e[_][_],v[_]=0,_--,d=0;else if(u===_-1){if(o=e[_][_-1]*e[_-1][_],C=(x=(e[_-1][_-1]-e[_][_])/2)*x+o,k=Math.sqrt(Math.abs(C)),e[_][_]=e[_][_]+w,e[_-1][_-1]=e[_-1][_-1]+w,i=e[_][_],C>=0){for(k=x>=0?x+k:x-k,m[_-1]=i+k,m[_]=m[_-1],0!==k&&(m[_]=i-o/k),v[_-1]=0,v[_]=0,x=(i=e[_][_-1])/(A=Math.abs(i)+Math.abs(k)),C=k/A,x/=S=Math.sqrt(x*x+C*C),C/=S,l=_-1;l<y;l++)k=e[_-1][l],e[_-1][l]=C*k+x*e[_][l],e[_][l]=C*e[_][l]-x*k;for(s=0;s<=_;s++)k=e[s][_-1],e[s][_-1]=C*k+x*e[s][_],e[s][_]=C*e[s][_]-x*k;for(s=0;s<=g;s++)k=p[s][_-1],p[s][_-1]=C*k+x*p[s][_],p[s][_]=C*p[s][_]-x*k}else m[_-1]=i+x,m[_]=i+x,v[_-1]=k,v[_]=-k;_-=2,d=0}else{if(i=e[_][_],n=0,o=0,u<_&&(n=e[_-1][_-1],o=e[_][_-1]*e[_-1][_]),10===d){for(w+=i,s=0;s<=_;s++)e[s][s]-=i;i=n=.75*(A=Math.abs(e[_][_-1])+Math.abs(e[_-1][_-2])),o=-.4375*A*A}if(30===d&&(A=(A=(n-i)/2)*A+o)>0){for(A=Math.sqrt(A),n<i&&(A=-A),A=i-o/((n-i)/2+A),s=0;s<=_;s++)e[s][s]-=A;w+=A,i=n=o=.964}for(d+=1,h=_-2;h>=u&&(x=((S=i-(k=e[h][h]))*(A=n-k)-o)/e[h+1][h]+e[h][h+1],C=e[h+1][h+1]-k-S-A,S=e[h+2][h+1],x/=A=Math.abs(x)+Math.abs(C)+Math.abs(S),C/=A,S/=A,h!==u)&&!(Math.abs(e[h][h-1])*(Math.abs(C)+Math.abs(S))<b*(Math.abs(x)*(Math.abs(e[h-1][h-1])+Math.abs(k)+Math.abs(e[h+1][h+1]))));)h--;for(s=h+2;s<=_;s++)e[s][s-2]=0,s>h+2&&(e[s][s-3]=0);for(c=h;c<=_-1;c++){var R=c!==_-1;if(c!==h&&(x=e[c][c-1],C=e[c+1][c-1],S=R?e[c+2][c-1]:0,0!==(i=Math.abs(x)+Math.abs(C)+Math.abs(S))&&(x/=i,C/=i,S/=i)),0===i)break;if(A=Math.sqrt(x*x+C*C+S*S),x<0&&(A=-A),0!==A){for(c!==h?e[c][c-1]=-A*i:u!==h&&(e[c][c-1]=-e[c][c-1]),i=(x+=A)/A,n=C/A,k=S/A,C/=x,S/=x,l=c;l<y;l++)x=e[c][l]+C*e[c+1][l],R&&(x+=S*e[c+2][l],e[c+2][l]=e[c+2][l]-x*k),e[c][l]=e[c][l]-x*i,e[c+1][l]=e[c+1][l]-x*n;for(s=0;s<=Math.min(_,c+3);s++)x=i*e[s][c]+n*e[s][c+1],R&&(x+=k*e[s][c+2],e[s][c+2]=e[s][c+2]-x*S),e[s][c]=e[s][c]-x,e[s][c+1]=e[s][c+1]-x*C;for(s=0;s<=g;s++)x=i*p[s][c]+n*p[s][c+1],R&&(x+=k*p[s][c+2],p[s][c+2]=p[s][c+2]-x*S),p[s][c]=p[s][c]-x,p[s][c+1]=p[s][c+1]-x*C}}}}if(0!==M){for(_=y-1;_>=0;_--)if(x=m[_],0===(C=v[_]))for(u=_,e[_][_]=1,s=_-1;s>=0;s--){for(o=e[s][s]-x,S=0,l=u;l<=_;l++)S+=e[s][l]*e[l][_];if(v[s]<0)k=o,A=S;else if(u=s,0===v[s]?e[s][_]=0!==o?-S/o:-S/(b*M):(i=e[s][s+1],n=e[s+1][s],r=(i*A-k*S)/(C=(m[s]-x)*(m[s]-x)+v[s]*v[s]),e[s][_]=r,Math.abs(i)>Math.abs(k)?e[s+1][_]=(-S-o*r)/i:e[s+1][_]=(-A-n*r)/k),b*(r=Math.abs(e[s][_]))*r>1)for(l=s;l<=_;l++)e[l][_]=e[l][_]/r}else if(C<0)for(u=_-1,Math.abs(e[_][_-1])>Math.abs(e[_-1][_])?(e[_-1][_-1]=C/e[_][_-1],e[_-1][_]=-(e[_][_]-x)/e[_][_-1]):(a=this.cdiv(0,-e[_-1][_],e[_-1][_-1]-x,C),e[_-1][_-1]=a.r,e[_-1][_]=a.i),e[_][_-1]=0,e[_][_]=1,s=_-2;s>=0;s--){var T=void 0,L=void 0,E=void 0,z=void 0;for(T=0,L=0,l=u;l<=_;l++)T+=e[s][l]*e[l][_-1],L+=e[s][l]*e[l][_];if(o=e[s][s]-x,v[s]<0)k=o,S=T,A=L;else if(u=s,0===v[s]?(a=this.cdiv(-T,-L,o,C),e[s][_-1]=a.r,e[s][_]=a.i):(i=e[s][s+1],n=e[s+1][s],E=(m[s]-x)*(m[s]-x)+v[s]*v[s]-C*C,z=2*(m[s]-x)*C,0===E&&0===z&&(E=b*M*(Math.abs(o)+Math.abs(C)+Math.abs(i)+Math.abs(n)+Math.abs(k))),a=this.cdiv(i*S-k*T+C*L,i*A-k*L-C*T,E,z),e[s][_-1]=a.r,e[s][_]=a.i,Math.abs(i)>Math.abs(k)+Math.abs(C)?(e[s+1][_-1]=(-T-o*e[s][_-1]+C*e[s][_])/i,e[s+1][_]=(-L-o*e[s][_]-C*e[s][_-1])/i):(a=this.cdiv(-S-n*e[s][_-1],-A-n*e[s][_],k,C),e[s+1][_-1]=a.r,e[s+1][_]=a.i)),b*(r=Math.max(Math.abs(e[s][_-1]),Math.abs(e[s][_])))*r>1)for(l=s;l<=_;l++)e[l][_-1]=e[l][_-1]/r,e[l][_]=e[l][_]/r}for(s=0;s<y;s++)if(s<0||s>g)for(l=s;l<y;l++)p[s][l]=e[s][l];for(l=y-1;l>=0;l--)for(s=0;s<=g;s++){for(k=0,c=0;c<=Math.min(l,g);c++)k+=p[s][c]*e[c][l];p[s][l]=k}}},e}(),c=Math.pow(2,-52),d=function(){function e(){this.rows=0,this.columns=0,this._data=[]}return e.FromArray=function(e){for(var t=e[0].length,r=e.length,o=this.Zero(r,t),i=0;i<r;i++)for(var n=0;n<t;n++)o._data[i][n]=e[i][n]||0;return o},e.Zero=function(t,r){return void 0===r&&(r=t),(new e).Reset(t,r)},e.Identity=function(e){for(var t=this.Zero(e),r=0;r<e;r++)t._data[r][r]=1;return t},e.Clone=function(e){for(var t=this.Zero(e.rows,e.columns),r=0;r<e.rows;r++)t._data[r]=new Float64Array(e._data[r]);return t},e.prototype.Reset=function(e,t){void 0===t&&(t=e),this._data=new Array(e);for(var r=0;r<e;r++)this._data[r]=new Float64Array(t);return this.rows=e,this.columns=t,this},e.prototype.CopyTo=function(e){e.rows=this.rows,e.columns=this.columns,e._data=[];for(var t=0;t<this.rows;t++)e._data[t]=new Float64Array(this._data[t]);return e},e.prototype.Row=function(e,t){return void 0!==t&&(this._data[e]=new Float64Array(t)),Array.from(this._data[e])},e.prototype.Column=function(e,t){if(void 0!==t)for(var r=0;r<this.rows;r++)this._data[r][e]=arguments[1][r];var o=new Array(this.rows);for(r=0;r<this.rows;r++)o[r]=this._data[r][e];return o},e.prototype.Transpose=function(){for(var t=e.Zero(this.columns,this.rows),r=0;r<this.rows;r++)for(var o=0;o<this.columns;o++)t._data[o][r]=this._data[r][o];return t},e.prototype.ToArray=function(e){void 0===e&&(e=!1);var t=[];if(e)for(var r=0;r<this.columns;r++)t.push(this.Column(r));else for(var o=0;o<this.rows;o++)t.push(this.Row(o));return t},e.prototype.EigenSystem=function(){return new l(this._data)},e.prototype.IsPosDef=function(){return new l(this._data).realvalues.every((function(e){return e>0}))},e.prototype.MakePosDef=function(t){void 0===t&&(t=c);var r,o,i=new l(this._data),n=i.realvalues.length,a=e.Zero(n),s=e.Zero(n),d=0,u=e.Zero(n);for(i.vectors.forEach((function(e,t){return u.Row(t,e)})),r=0;r<n;r++){for(o=0;o<n;o++)a._data[r][o]=t;i.realvalues[r]>t&&(a._data[r][r]=i.realvalues[r])}for(r=0;r<n;r++){for(d=0,o=0;o<n;o++)s._data[r][o]=0,d+=i.vectors[r][o]*i.vectors[r][o]*a._data[o][o];s._data[r][r]=Math.sqrt(1/d)}for(r=0;r<n;r++)a._data[r][r]=Math.sqrt(a._data[r][r]);for(var h=s.Multiply(u.Multiply(a)),f=h.Multiply(h.Transpose()).Symmetrize(),p=0;p<f.rows;p++)f._data[p][p]=1;return f},e.prototype.Symmetrize=function(t){void 0===t&&(t=!1);var r,o,i=this.Transpose(),n=e.Clone(this);if(t)for(r=1;r<this.rows;r++)for(o=0;o<r;o++)n._data[r][o]=i._data[r][o];else for(o=1;o<this.columns;o++)for(r=0;r<o;r++)n._data[r][o]=i._data[r][o];return n},e.prototype.Cholesky=function(t){if(void 0===t&&(t=!1),this.rows!==this.columns)throw new Error("matrix not square");var r,o,i,n,a,s=this.rows,l=e.Zero(s);for(n=0;n<s;n++){for(o=0,a=0;a<n;a++){for(r=0,i=0;i<a;i++)r+=l._data[i][a]*l._data[i][n];if(l._data[a][n]=r=(this._data[a][n]-r)/l._data[a][a],o+=r*r,this._data[a][n]!=this._data[n][a])throw new Error("matrix not symmetrical")}if((o=this._data[n][n]-o)<=0)throw new Error("matrix not pos-def");for(l._data[n][n]=o>0?Math.sqrt(o):0,a=n+1;a<s;a++)l._data[a][n]=0}return t?l.Transpose():l},e.prototype.Multiply=function(t){var r,o,i,n,a=e.Zero(this.rows,t.columns);for(r=0;r<this.rows;r++)for(o=0;o<t.columns;o++){for(n=i=0;i<this.columns;i++)n+=this._data[r][i]*t._data[i][o];a._data[r][o]=n}return a},e.prototype.Inverse=function(){if(this.rows!==this.columns)throw new Error("invalid matrix");var t,r,o,i,n=e.Clone(this),a=n.rows;for(r=1;r<a;r++)n._data[0][r]/=n._data[0][0];for(r=1;r<a;r++){for(o=r;o<a;o++){for(t=0,i=0;i<r;i++)t+=n._data[o][i]*n._data[i][r];n._data[o][r]-=t}if(r!=a-1)for(o=r+1;o<a;o++){for(t=0,i=0;i<r;i++)t+=n._data[r][i]*n._data[i][o];n._data[r][o]=(n._data[r][o]-t)/n._data[r][r]}}for(r=0;r<a;r++)for(o=r;o<a;o++){var s=1;if(r!=o)for(s=0,i=r;i<o;i++)s-=n._data[o][i]*n._data[i][r];n._data[o][r]=s/n._data[o][o]}for(r=0;r<a;r++)for(o=r;o<a;o++)if(r!=o){for(t=0,i=r;i<o;i++)t+=n._data[i][o]*(r==i?1:n._data[r][i]);n._data[r][o]=-t}for(r=0;r<a;r++)for(o=0;o<a;o++){for(t=0,i=r>o?r:o;i<a;i++)t+=(o==i?1:n._data[o][i])*n._data[i][r];n._data[o][r]=t}return n},e.prototype.SortColumns=function(t){void 0===t&&(t=!1);for(var r=e.Clone(this),o=t?function(e,t){return t-e}:function(e,t){return e-t},i=0;i<this.columns;i++)r.Column(i,this.Column(i).sort(o));return r},e.prototype.Rank=function(t){void 0===t&&(t=!1);for(var o,i=e.Clone(this),n=new Array(this.rows),a=new Array(this.rows),s=0;s<this.columns;s++){for(o=0;o<this.rows;o++)a[o]=o,n[o]=this._data[o][s];for(r.Sort(n,a),t&&a.reverse(),o=0;o<this.rows;o++)i._data[a[o]][s]=o}return i},e.prototype.Correl=function(){for(var t=new Array(this.columns),r=0;r<this.columns;r++)t[r]=this.Column(r);for(var o=e.Zero(this.columns),i=0;i<this.columns;i++){o._data[i][i]=1;for(var a=0;a<i;a++)o._data[i][a]=n.Correlation(t[i],t[a])}return o.Symmetrize()},e.prototype.IsSymmetric=function(){if(this.rows!=this.columns)return!1;for(var e=0;e<this.rows;e++)for(var t=0;t<this.columns;t++)if(this._data[e][t]!==this._data[t][e])return!1;return!0},e}();Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length,r=0;r<t;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;e+=arguments[r]*arguments[r]}return Math.sqrt(e)});for(var u=function(){function e(){}return e.Normal=function(e,t){var r=this;void 0===t&&(t={});var i=o({mean:0,sd:1,lhs:!1,ordered:!1},t);return(i.lhs?this.LHSField(e,i.ordered):this.UniformField(e,i.ordered)).map((function(e){return r.InverseNormal2(e)*i.sd+i.mean}))},e.ReverseInverseNormal2=function(e,t){var r=this;void 0===t&&(t=40);for(var o=[0,Math.min(1,Math.max(0,.5+.125*e)),1],i=o.map((function(e){return r.InverseNormal2(e)})),n=0;n<t;n++){if(Math.abs(i[1]-e)<=1e-6)return o[1];i[1]<e?(o=[o[1],(o[1]+o[2])/2,o[2]],i=[i[1],this.InverseNormal2(o[1]),i[2]]):(o=[o[0],(o[0]+o[1])/2,o[1]],i=[i[0],this.InverseNormal2(o[1]),i[1]])}return o[1]},e.TruncatedNormal=function(e,t){var r=this;void 0===t&&(t={});var i=o({mean:0,sd:1,lhs:!1,ordered:!1},t),n=i.lhs?this.LHSField(e,i.ordered):this.UniformField(e,i.ordered),a=0,s=1;"number"==typeof i.min&&(a=this.ReverseInverseNormal2((i.min-i.mean)/i.sd,i.max_iterations)),"number"==typeof i.max&&(s=this.ReverseInverseNormal2((i.max-i.mean)/i.sd,i.max_iterations));var l=s-a;return(n=n.map((function(e){return e*l+a}))).map((function(e){return r.InverseNormal2(e)*i.sd+i.mean}))},e.LogNormal=function(e,t){void 0===t&&(t={});for(var r=o({mean:1,sd:1,lhs:!1,ordered:!1},t),i=r.lhs?this.LHSFieldDouble(e,r.ordered):this.UniformField(e,r.ordered),n=0;n<i.length;n++)i[n]=Math.exp(this.InverseNormal2(i[n])*r.sd+r.mean);return i},e.LogNormalReturn=function(e,t){void 0===t&&(t={});var r=o({mean:1,sd:1,lhs:!1,ordered:!1},t),i=r.lhs?this.LHSFieldDouble(e,r.ordered):this.UniformField(e,r.ordered);r.mean+=1;for(var n=r.mean*r.mean,a=r.sd*r.sd,s=Math.log(n/Math.sqrt(n+a)),l=Math.sqrt(Math.log((n+a)/n)),c=0;c<e;c++)i[c]=Math.exp(this.InverseNormal2(i[c])*l+s)-1;return i},e.Triangular=function(e,t){var r=this;void 0===t&&(t={});var i=o({a:0,b:1,c:.5,lhs:!1,ordered:!1,field:null},t);return(i.field||(i.lhs?this.LHSField(e,i.ordered):this.UniformField(e,i.ordered))).map((function(e){return r.InverseTriangular(e,i.a,i.b,i.c)}))},e.PERT=function(e,t){void 0===t&&(t={});var r=o({field:null,lhs:!1,a:0,b:1,c:.5,lambda:4,ordered:!1},t),i=r.field||(r.lhs?this.LHSField(e,r.ordered):this.UniformField(e,r.ordered));return this.InversePERTField(i,r.a,r.b,r.c,r.lambda)},e.Uniform=function(e,t){void 0===t&&(t={});for(var r=o({lhs:!1,min:0,max:1,ordered:!1},t),i=r.lhs?this.LHSFieldDouble(e,r.ordered):this.UniformField(e,r.ordered),n=r.max-r.min,a=0;a<i.length;a++)i[a]=i[a]*n+r.min;return i},e.Bernoulli=function(e,t){void 0===t&&(t={});var r=o({lhs:!1,p:.5},t);return this.Uniform(e,{lhs:r.lhs,min:0,max:1}).map((function(e){return e<=r.p}))},e.Beta=function(e,t){var r=this;void 0===t&&(t={});var i=o({lhs:!1,a:0,b:1,ordered:!1},t);return(i.lhs?this.LHSField(e,i.ordered):this.UniformField(e,i.ordered)).map((function(e){return r.InverseBeta(e,i.a,i.b)}))},e.Discretize=function(e,t){var r=e.slice(0);t=t||Math.round;for(var o=0;o<r.length;o++)r[o]=t(r[o]);return r},e.Constant=function(e,t){for(var r=new Array(e),o=0;o<e;o++)r[o]=t;return r},e.Fixed=function(e,t){void 0===t&&(t={}),t=o({value:0},t);for(var r=new Array(e),i=0;i<e;i++)r[i]=t.value;return r},e.Conditional=function(e,t,r,o,i,n){void 0===i&&(i=0);for(var a=n||this.Bernoulli(e,{lhs:!0,p:t}),s=r(Math.ceil(e*t),o),l=new Array(e),c=0,d=0;c<e;c++)l[c]=a[c]?s[d++]:i;return l},e.Correlate=function(e,t,r){void 0===r&&(r=!1);var o,i=t.length,n=t[0].length,a=d.Zero(n,i);for(o=0;o<i;o++)a.Column(o,this.VDWField(n));var s=a.Multiply(e.Cholesky(!0).Multiply(a.Correl().Cholesky(!0).Inverse()).Transpose()).Rank();return r?t.map((function(e,t){var r=new Array(e.length),i=s.Column(t);for(o=0;o<i.length;o++)r[o]=e[i[o]];return r})):t.map((function(e,t){var r=e.slice(0).sort((function(e,t){return e-t})),i=new Array(e.length),n=s.Column(t);for(o=0;o<n.length;o++)i[o]=r[n[o]];return i}))},e.CorrelateCDM=function(e,t,r){void 0===r&&(r=!1);var o,i=t.length,n=t[0].length,s=a.Zero(n,i);for(o=0;o<i;o++)s.SetColumn(o,this.VDWField(n));var l=new a;if(l.rows=n,l.columns=i,l.data=t.map((function(e){return new Float64Array(e)})),!r)throw new Error("E_NOTIMPL: correlateCDM !ordered");return s.Multiply(e.Cholesky(!0).Multiply(s.Correl().Cholesky(!0).Inverse()).Transpose()).Rank2(!1,l).data},e.P80Pert=function(e,t,r,o){var i=this.PERTParameters(e,t,r,o),n=(i.max-i.min)/(this.InverseBeta(.9,i.v,i.w)-this.InverseBeta(.1,i.v,i.w)),a=i.min-this.InverseBeta(.1,i.v,i.w)*n,s=i.max+(1-this.InverseBeta(.9,i.v,i.w))*n;return{a:a/i.scale,b:s/i.scale,c:r}},e.P80Triangular=function(e,t,r){var o,i=(r-e)/(t-e),n=i<.5;n&&(i=1-i);var a=2.1266864*i-.1596122-2.1742909*i*i+1.1087738*i*i*i;n&&(a=1-a);var s=(t-e)/(.6890868-.4434898*i+.35757*i*i);return{a:o=r-a*s,b:o+s,c:r}},e.BetaDensity=function(e,t,r){if("number"!=typeof e){for(var o=new Array(e.length),i=0;i<e.length;i++)e[i]<=0||e[i]>=1?o[i]=0:o[i]=Math.exp((t-1)*Math.log(e[i])+(r-1)*Math.log(1-e[i])-this.LnGamma(t)-this.LnGamma(r)+this.LnGamma(t+r));return o}return e<=0||e>=1?0:Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-this.LnGamma(t)-this.LnGamma(r)+this.LnGamma(t+r))},e.PERTDensity=function(e,t,r,o,i){void 0===i&&(i=4);var n,a,s=(t+r+i*o)/(i+2);return a=(n=o===s?i/2+1:(s-t)*(2*o-t-r)/((o-s)*(r-t)))*(r-s)/(s-t),this.BetaDensity(e,n,a)},e.NormalDensity=function(e){if("number"!=typeof e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=.398942280401433*Math.exp(-e[r]*e[r]/2);return t}return.398942280401433*Math.exp(-e*e/2)},e.Shuffle=function(e){var r,o,i;for(o=e.length-1;o>=0;o--)r=Math.floor(t.Next()*(o+1)),i=e[o],e[o]=e[r],e[r]=i;return e},e.VDWField=function(e){if(this.vdw_cache.length!==e){this.vdw_cache=new Float64Array(e);for(var t=0;t<e;t++)this.vdw_cache[t]=this.InverseNormal2((t+1)/(e+1))}var r=new Float64Array(this.vdw_cache);return this.Shuffle(r)},e.LHSFieldDouble=function(e,r){void 0===r&&(r=!1);for(var o=1/e,i=new Float64Array(e),n=0;n<e;n++)i[n]=t.Next()*o+n*o;return r||this.Shuffle(i),i},e.LHSField=function(e,r){void 0===r&&(r=!1);for(var o=1/e,i=new Array(e),n=0;n<e;n++)i[n]=t.Next()*o+n*o;return r||this.Shuffle(i),i},e.UniformField=function(e,r){void 0===r&&(r=!1);for(var o=new Array(e),i=0;i<e;i++)o[i]=t.Next();return r&&o.sort((function(e,t){return e-t})),o},e.InverseTriangular=function(e,t,r,o){return t===r?t:e<=(o-t)/(r-t)?t+Math.sqrt((r-t)*(o-t)*e):r-Math.sqrt((r-t)*(r-o)*(1-e))},e.InverseNormal=function(e){return.5===e?0:(t=e<1&&e>.5?1-e:e,o=(r=Math.sqrt(Math.log(1/Math.pow(t,2))))-(2.515517+.802853*r+.010328*Math.pow(r,2))/(1+1.432788*r+.189269*Math.pow(r,2)+.001308*Math.pow(r,3)),e>.5?o:-o);var t,r,o},e.InverseNormal2=function(e){var t,r,o=e-.5;return Math.abs(o)<=.425?o*(((((((2509.0809287301227*(r=.180625-o*o)+33430.57558358813)*r+67265.7709270087)*r+45921.95393154987)*r+13731.69376550946)*r+1971.5909503065513)*r+133.14166789178438)*r+3.3871328727963665)/(((((((5226.495278852854*r+28729.085735721943)*r+39307.89580009271)*r+21213.794301586597)*r+5394.196021424751)*r+687.1870074920579)*r+42.31333070160091)*r+1):(r=o<0?e:1-e)<=0?0:(t=(r=Math.sqrt(-Math.log(r)))<=5?(((((((.0007745450142783414*(r-=1.6)+.022723844989269184)*r+.2417807251774506)*r+1.2704582524523684)*r+3.6478483247632045)*r+5.769497221460691)*r+4.630337846156546)*r+1.4234371107496835)/(((((((1.0507500716444169e-9*r+.0005475938084995345)*r+.015198666563616457)*r+.14810397642748008)*r+.6897673349851)*r+1.6763848301838038)*r+2.053191626637759)*r+1):(((((((2.0103343992922881e-7*(r-=5)+27115555687434876e-21)*r+.0012426609473880784)*r+.026532189526576124)*r+.29656057182850487)*r+1.7848265399172913)*r+5.463784911164114)*r+6.657904643501103)/(((((((20442631033899397e-31*r+1.421511758316446e-7)*r+18463183175100548e-21)*r+.0007868691311456133)*r+.014875361290850615)*r+.1369298809227358)*r+.599832206555888)*r+1),o<0?-t:t)},e.Log1p=function(e){var t=1+e;return Math.log(t)-(t-1-e)/t},e.BetaContFrac=function(t,r,o,i){var n,a=2*Number.MIN_VALUE,s=0,l=1,c=1-(t+r)*o/(t+1);for(Math.abs(c)<a&&(c=e.QUIET_NAN),n=c=1/c;s<512;){var d,u=s+1,h=u*(r-u)*o/((t-1+2*u)*(t+2*u));if(c=1+h*c,l=1+h/l,Math.abs(c)<a&&(c=e.QUIET_NAN),Math.abs(l)<a&&(l=e.QUIET_NAN),n*=(c=1/c)*l,c=1+(h=-(t+u)*(t+r+u)*o/((t+2*u)*(t+2*u+1)))*c,l=1+h/l,Math.abs(c)<a&&(c=e.QUIET_NAN),Math.abs(l)<a&&(l=e.QUIET_NAN),n*=d=(c=1/c)*l,Math.abs(d-1)<2*e.EPSILON_DOUBLE)break;if(n*Math.abs(d-1)<i)break;++s}return s>=512?e.QUIET_NAN:n},e.BetaCDF=function(t,r,o){if(t<=0)return 0;if(t>=1)return 1;if(0===t)return 0;if(1===t)return 1;var i,n=-(this.LnGamma(r)+this.LnGamma(o)-this.LnGamma(r+o))+r*Math.log(t)+o*this.Log1p(-t),a=Math.exp(n);return t<(r+1)/(r+o+2)?(i=Math.abs(0/(1*a/r))*e.EPSILON_DOUBLE,a*this.BetaContFrac(r,o,t,i)/r*1+0):(i=Math.abs(1/(1*a/o))*e.EPSILON_DOUBLE,1*(1-a*this.BetaContFrac(o,r,1-t,i)/o)+0)},e.LnGamma=function(e){var t=e-1,r=t+5.5;r-=(t+.5)*Math.log(r);var o=1;return o+=76.18009173/(t+=1),o+=-86.50532033/(t+=1),o+=24.01409822/(t+=1),o+=-1.231739516/(t+=1),o+=.00120858003/(t+=1),o+=-536382e-11/(t+=1),-r+Math.log(2.50662827465*o)},e.BetaPDF=function(e,t,r){return e<0||e>1?0:Math.exp(this.LnGamma(t+r)-this.LnGamma(t)-this.LnGamma(r))*Math.pow(e,t-1)*Math.pow(1-e,r-1)},e.InverseBeta=function(e,t,r){var o,i,n,a,s,l,c,d,u=0;if(e<0||e>1||t<0||r<0)return 0;if(0===e)return 0;if(1===e)return 1;if(e>.5){var h=1-e;return h>.5?this.InverseBeta(1-h,t,r):1-this.InverseBeta(h,r,t)}if(i=t/(t+r),e<.1){var f=(Math.log(t)+this.LnGamma(t)+this.LnGamma(r)-this.LnGamma(t+r)+Math.log(e))/t;f<=0?(o=Math.exp(f),o*=Math.pow(1-o,-(r-1)/t)):o=i,o>i&&(o=i)}else o=i;do{if(a=e-this.BetaCDF(o,t,r),s=this.BetaPDF(o,t,r),0===a||u++>64)return o;d=-((t-1)/o-(r-1)/(1-o))*(n=a/Math.max(2*Math.abs(a/o),s))*n/2,l=c=n,Math.abs(d)<Math.abs(c)?l+=d:l*=2*Math.abs(c/d),o+l>0&&o+l<1?o+=l:o=Math.sqrt(o)*Math.sqrt(i)}while(Math.abs(c)>1e-10*o);return o},e.InversePERTField=function(e,t,r,o,i){var n=this;if(r<=t)return e.map((function(){return t}));try{var a=this.PERTParameters(t,r,o,i);return e.map((function(e){return(n.InverseBeta(e,a.v,a.w)*(a.max-a.min)+a.min)/a.scale}))}catch(o){return t===r?e.map((function(e){return t})):e.map((function(e){return 0}))}},e.PERTParameters=function(e,t,r,o){if(void 0===o&&(o=4),e>=t||o<0||r<e||r>t)throw new Error("Invalid parameters");for(var i,n,a=1;Math.abs(e)<1&&Math.abs(t)<1;)a*=10,e*=10,t*=10,r*=10;return i=(e+t+o*r)/(o+2),{v:n=(0===r?Math.abs(i-r):Math.abs((i-r)/r))<=1e-12?o/2+1:(i-e)*(2*r-e-t)/((r-i)*(t-e)),w:n*(t-i)/(i-e),min:e,max:t,scale:a}},e.InversePERT=function(e,t,r,o,i){void 0===i&&(i=4);var n=this.PERTParameters(t,r,o,i);return(this.InverseBeta(e,n.v,n.w)*(n.max-n.min)+n.min)/n.scale},e.EPSILON_DOUBLE=2220446049250313e-31,e.QUIET_NAN=Number.NaN,e.M_LN_SQRT_2PI=.9189385332046728,e.M_1_SQRT_2PI=.3989422804014327,e.vdw_cache=new Float64Array(0),e}(),h=new Array(256),f=0;f<256;++f)h[f]=(f+256).toString(16).substr(1);var p=function(){function e(){this.buffer=[],this.buffer=[];for(var e=0;e<16;e++)this.buffer[e]=Math.floor(256*t.Next())}return e.prototype.toString=function(){var e=0;return h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]+"-"+h[this.buffer[e++]]+h[this.buffer[e++]]+"-"+h[this.buffer[e++]]+h[this.buffer[e++]]+"-"+h[this.buffer[e++]]+h[this.buffer[e++]]+"-"+h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]+h[this.buffer[e++]]},e}();e.CDMatrix=a,e.Eigensystem=l,e.MC=u,e.Matrix=d,e.QSort=i,e.QSort2=r,e.Random=t,e.Stats=n,e.UUID=p,e.Util=s,Object.defineProperty(e,"__esModule",{value:!0})}(t)},7485:function(e,t,r){"use strict";r.r(t);var o=r(3379),i=r.n(o),n=r(4439);i()(n.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),t.default=n.Z.locals||{}},3379:function(e,t,r){"use strict";var o,i=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),n=[];function a(e){for(var t=-1,r=0;r<n.length;r++)if(n[r].identifier===e){t=r;break}return t}function s(e,t){for(var r={},o=[],i=0;i<e.length;i++){var s=e[i],l=t.base?s[0]+t.base:s[0],c=r[l]||0,d="".concat(l," ").concat(c);r[l]=c+1;var u=a(d),h={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(n[u].references++,n[u].updater(h)):n.push({identifier:d,updater:m(h,t),references:1}),o.push(d)}return o}function l(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var n=r.nc;n&&(o.nonce=n)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var a=i(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,r,o){var i=r?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var n=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(n,a[t]):e.appendChild(n)}}function h(e,t,r){var o=r.css,i=r.media,n=r.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var f=null,p=0;function m(e,t){var r,o,i;if(t.singleton){var n=p++;r=f||(f=l(t)),o=u.bind(null,r,n,!1),i=u.bind(null,r,n,!0)}else r=l(t),o=h.bind(null,r,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var r=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<r.length;o++){var i=a(r[o]);n[i].references--}for(var l=s(e,t),c=0;c<r.length;c++){var d=a(r[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}r=l}}}}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={id:o,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]])}return r}function n(e,t,r,o){return new(r||(r=Promise))((function(i,n){function a(e){try{l(o.next(e))}catch(e){n(e)}}function s(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))}function a(e,t){var r,o,i,n,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,o=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){a.label=n[1];break}if(6===n[0]&&a.label<i[1]){a.label=i[1],i=n;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(n);break}i[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,i,n=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=n.next()).done;)a.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return a}function c(e,t){for(var r=0,o=t.length,i=e.length;r<o;r++,i++)e[i]=t[r];return e}function d(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.create,Object.create;var u,h=function(e){return"object"==typeof e&&void 0!==e.row&&void 0!==e.column},f=function(){function e(e,t,r){void 0===t&&(t=e),void 0===r&&(r=!1),this.end_=this.PatchNull(t),this.start_=this.PatchNull(e),r&&this.Normalize()}return e.FromColumn=function(t){return new e({row:1/0,column:t})},e.FromRow=function(t){return new e({row:t,column:1/0})},e.ColumnToLabel=function(e){for(var t=String.fromCharCode(65+e%26);e>25;)e=Math.floor(e/26)-1,t=String.fromCharCode(65+e%26)+t;return t},e.CellAddressToLabel=function(e,t){return void 0===t&&(t=!1),(t?(e.sheet_id||0)+"!":"")+(e.absolute_column?"$":"")+this.ColumnToLabel(e.column)+(e.absolute_row?"$":"")+(e.row+1)},e.Join=function(t){for(var r,o,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=new e(t.start,t.end);try{for(var l=s(i),c=l.next();!c.done;c=l.next()){var d=c.value;d&&(a.ConsumeAddress(d.start),a.ConsumeAddress(d.end))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return a},e.Bleed=function(t,r){return void 0===r&&(r=1),new e({row:Math.max(0,t.start.row-r),column:Math.max(0,t.start.column-r)},{row:t.end.row+r,column:t.end.column+r})},Object.defineProperty(e.prototype,"start",{get:function(){return o({},this.start_)},set:function(e){this.start_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return o({},this.end_)},set:function(e){this.end_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this.start_.row===1/0||this.end_.row===1/0?1/0:this.end_.row-this.start_.row+1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this.start_.column===1/0||this.end_.column===1/0?1/0:this.end_.column-this.start_.column+1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.rows*this.columns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entire_sheet",{get:function(){return this.entire_row&&this.entire_column},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entire_column",{get:function(){return this.start_.row===1/0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entire_row",{get:function(){return this.start_.column===1/0},enumerable:!1,configurable:!0}),e.prototype.PatchNull=function(e){var t=o({},e);return null===t.row&&(t.row=1/0),null===t.column&&(t.column=1/0),t},e.prototype.SetSheetID=function(e){this.start_.sheet_id=e},e.prototype.Normalize=function(){var e=o({},this.start_),t=o({},this.end_);e.row===1/0||t.row===1/0?e.row=t.row=1/0:e.row>t.row&&(e.row=this.end_.row,e.absolute_row=this.end_.absolute_row,t.row=this.start_.row,t.absolute_row=this.start_.absolute_row),e.column===1/0||t.column===1/0?e.column=t.column=1/0:e.column>t.column&&(e.column=this.end_.column,e.absolute_column=this.end_.absolute_column,t.column=this.start_.column,t.absolute_column=this.start_.absolute_column),this.start_=e,this.end_=t},e.prototype.TopLeft=function(){var e={row:0,column:0};return this.entire_row||(e.column=this.start.column),this.entire_column||(e.row=this.start.row),e},e.prototype.BottomRight=function(){var e={row:0,column:0};return this.entire_row||(e.column=this.end.column),this.entire_column||(e.row=this.end.row),e},e.prototype.ContainsRow=function(e){return this.entire_column||e>=this.start_.row&&e<=this.end_.row},e.prototype.ContainsColumn=function(e){return this.entire_row||e>=this.start_.column&&e<=this.end_.column},e.prototype.Contains=function(e){return(this.entire_column||e.row>=this.start_.row&&e.row<=this.end_.row)&&(this.entire_row||e.column>=this.start_.column&&e.column<=this.end_.column)},e.prototype.ContainsArea=function(e){return this.start.column<=e.start.column&&this.end.column>=e.end.column&&this.start.row<=e.start.row&&this.end.row>=e.end.row},e.prototype.Intersects=function(e){return!(e.start.column>this.end.column||this.start.column>e.end.column||e.start.row>this.end.row||this.start.row>e.end.row)},e.prototype.Equals=function(e){return e.start_.row===this.start_.row&&e.start_.column===this.start_.column&&e.end_.row===this.end_.row&&e.end_.column===this.end_.column},e.prototype.Clone=function(){return new e(this.start,this.end)},e.prototype.Array=function(){if(this.entire_column||this.entire_row)throw new Error("can't convert infinite area to array");for(var e=new Array(this.rows*this.columns),t=this.start_.sheet_id,r=0,o=this.start_.row;o<=this.end_.row;o++)for(var i=this.start_.column;i<=this.end_.column;i++)e[r++]={row:o,column:i,sheet_id:t};return e},Object.defineProperty(e.prototype,"left",{get:function(){var t=new e(this.start_,this.end_);return t.end_.column=t.start_.column,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){var t=new e(this.start_,this.end_);return t.start_.column=t.end_.column,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){var t=new e(this.start_,this.end_);return t.end_.row=t.start_.row,t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){var t=new e(this.start_,this.end_);return t.start_.row=t.end_.row,t},enumerable:!1,configurable:!0}),e.prototype.Shift=function(e,t){return this.start_.row+=e,this.start_.column+=t,this.end_.row+=e,this.end_.column+=t,this},e.prototype.ConsumeAddress=function(e){this.entire_row||(e.column<this.start_.column&&(this.start_.column=e.column),e.column>this.end_.column&&(this.end_.column=e.column)),this.entire_column||(e.row<this.start_.row&&(this.start_.row=e.row),e.row>this.end_.row&&(this.end_.row=e.row))},e.prototype.ConsumeArea=function(e){this.ConsumeAddress(e.start),this.ConsumeAddress(e.end)},e.prototype.Resize=function(e,t){return this.end_.row=this.start_.row+e-1,this.end_.column=this.start_.column+t-1,this},e.prototype.Iterate=function(e){if(this.entire_column||this.entire_row)console.warn("don't iterate infinite area");else for(var t=this.start_.column;t<=this.end_.column;t++)for(var r=this.start_.row;r<=this.end_.row;r++)e({column:t,row:r,sheet_id:this.start_.sheet_id})},Object.defineProperty(e.prototype,"spreadsheet_label",{get:function(){var t;return this.entire_sheet?"":this.entire_column?(t=e.ColumnToLabel(this.start_.column),t+=":"+e.ColumnToLabel(this.end_.column)):this.entire_row?(t=String(this.start_.row+1),t+=":"+(this.end_.row+1)):(t=e.CellAddressToLabel(this.start_),this.columns>1||this.rows>1?t+":"+e.CellAddressToLabel(this.end_):t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{start:o({},this.start_),end:o({},this.end_)}},e}(),p=function(e){return"object"==typeof e&&!!e&&"number"==typeof e.real&&"number"==typeof e.imaginary};!function(e){e[e[void 0]=0]="undefined",e[e.formula=1]="formula",e[e.string=2]="string",e[e.number=3]="number",e[e.boolean=4]="boolean",e[e.object=5]="object",e[e.error=6]="error",e[e.complex=7]="complex"}(u||(u={}));var m,v=function(e){switch(typeof e){case"undefined":return u.undefined;case"number":return u.number;case"boolean":return u.boolean;case"object":return null===e?u.undefined:p(e)?u.complex:u.object;case"string":return"="===e[0]?u.formula:u.string;default:return u.error}};!function(e){e[e.List=0]="List",e[e.Date=1]="Date",e[e.Range=2]="Range",e[e.Number=3]="Number",e[e.Boolean=4]="Boolean"}(m||(m={}));var y=function(){function e(e,t){this.type=u.undefined,this.render_dirty=!0,void 0!==e&&this.Set(e,t)}return e.StringToColumn=function(e){var t=0;e=e.toUpperCase();for(var r=0;r<e.length;r++)t*=26,t+=e.charCodeAt(r)-64;return t-1},e.prototype.ValueIsNumber=function(){return this.type===u.number},e.prototype.ValueIsFormula=function(){return this.type===u.formula},e.prototype.ValueIsBoolean=function(){return this.type===u.boolean},e.prototype.ValueIsComplex=function(){return this.type===u.complex},e.prototype.FlushStyle=function(){this.formatted=this.rendered_type=this.style=void 0,this.render_dirty=!0},e.prototype.FlushArray=function(){this.area=void 0},e.prototype.FlushCache=function(){this.calculated=this.calculated_type=this.formatted=this.rendered_type=this.render_function=this.click_function=void 0,this.render_dirty=!0},e.prototype.Reset=function(){this.type=u.undefined,this.value=this.note=this.hyperlink=this.formatted=this.rendered_type=this.style=this.calculated=this.calculated_type=this.area=this.renderer_data=this.render_function=this.click_function=void 0,this.render_dirty=!0},e.prototype.Set=function(e,t){void 0===t&&(t=v(e)),this.value=e,this.type=t,this.formatted=this.rendered_type=this.style=this.calculated=this.calculated_type=this.render_function=this.click_function=this.area=void 0,this.render_dirty=!0},e.prototype.SetCalculatedValue=function(e,t){void 0===t&&(t=v(e)),this.calculated!==e&&(this.calculated=e,this.calculated_type=t,this.formatted=this.rendered_type=void 0,this.render_dirty=!0)},e.prototype.SetCalculatedValueOrError=function(e,t){void 0===t&&("object"==typeof e&&e.error?(t=u.error,e=e.error):t=v(e)),this.calculated!==e&&(this.calculated=e,this.calculated_type=t,this.formatted=this.rendered_type=void 0,this.render_dirty=!0)},e.prototype.GetValue=function(){return this.calculated_type?this.calculated:"string"==typeof this.value&&"'"===this.value[0]?this.value.slice(1):this.value},e.prototype.GetValue4=function(){return this.calculated_type?{type:this.calculated_type,value:this.calculated}:this.type===u.formula?{type:u.number,value:0}:{type:this.type,value:"string"==typeof this.value&&"'"===this.value[0]?this.value.slice(1):this.value}},e.prototype.SetNote=function(e){this.note=e,this.render_dirty=!0},e.prototype.SetCalculationError=function(e){void 0===e&&(e="ERR"),this.SetCalculatedValue(e,u.error)},e.prototype.SetArray=function(e){this.type=u.undefined,this.value=this.formatted=this.rendered_type=this.style=this.hyperlink=this.calculated=this.calculated_type=void 0,this.area=e,this.render_dirty=!0},e.prototype.SetArrayHead=function(e,t){this.type=v(t),this.value=t,this.formatted=this.rendered_type=this.style=this.calculated=this.calculated_type=void 0,this.area=e,this.render_dirty=!0},e}(),_=function(e){return e.type===u.formula},g=function(e){return e.type===u.object},b=function(){return{type:u.undefined,value:void 0}},w=function(e,t){return void 0===t&&(t=v(e)),{value:e,type:t}},x=function(e){return e.imaginary?{type:u.complex,value:e}:{type:u.number,value:e.real}},C=function(e){return!e.cells},S=function(e){return!!e[0]&&C(e[0])},A=function(e){return!!e[0]&&void 0!==e[0].row},k=function(){function e(){this.data=[],this.rows_=0,this.columns_=0}return Object.defineProperty(e.prototype,"rows",{get:function(){return this.rows_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this.columns_},enumerable:!1,configurable:!0}),e.prototype.EnsureRow=function(e){this.rows_=Math.max(e+1,this.rows_)},e.prototype.EnsureColumn=function(e){this.columns_=Math.max(e+1,this.columns_)},e.prototype.InsertColumns=function(e,t){void 0===e&&(e=0),void 0===t&&(t=1),this.data=this.data.map((function(r){if(r.length>=e){var o=r.slice(0,e),i=e+t;return r.slice(e).forEach((function(e){return o[i++]=e})),o}return r})),this.columns_+=t},e.prototype.DeleteColumns=function(e,t){void 0===t&&(t=1),this.data.forEach((function(r){return r.splice(e,t)})),this.columns_-=t},e.prototype.DeleteRows=function(e,t){void 0===t&&(t=1),this.data.splice(e,t),this.rows_-=t},e.prototype.InsertRows=function(e,t){void 0===e&&(e=0),void 0===t&&(t=1);for(var r=[e,0,[]],o=1;o<t;o++)r.push([]);Array.prototype.splice.apply(this.data,r),this.rows_+=t},e.prototype.GetCell=function(e,t){var r=e.row,o=e.column;if(!this.data[r]){if(!t)return;this.data[r]=[],this.rows_=Math.max(this.rows_,r+1)}return this.data[r][o]||t&&(this.data[r][o]=new y,this.columns_=Math.max(this.columns_,o+1)),this.data[r][o]},e.prototype.EnsureCell=function(e){var t=e.row,r=e.column,o=this.data[t];o||(this.data[t]=o=[],this.rows_=Math.max(this.rows_,t+1));var i=o[r];return i||(i=o[r]=new y,this.columns_=Math.max(this.columns_,r+1)),i},e.prototype.FromArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=!1),this.data=[];var r=0,o=0;if(t){o=e.length;for(var i=0;i<o;i++){var n=e[i];r=Math.max(r,n.length);for(var a=0;a<n.length;a++)this.data[a]||(this.data[a]=[]),this.data[a][i]=new y(n[a])}}else for(r=e.length,a=0;a<r;a++){var s=[];for(n=e[a],o=Math.max(o,n.length),i=0;i<n.length;i++)s[i]=new y(n[i]);this.data[a]=s}this.rows_=r,this.columns_=o},e.prototype.FromJSON=function(e,t){var r,i,n,a,l,c,d,u,h,p;if(void 0===e&&(e=[]),this.data=[],!S(e)){var m=[];if(A(e))try{for(var v=s(e),_=v.next();!_.done;_=v.next()){var g=_.value;try{for(var b=(n=void 0,s(g.cells)),w=b.next();!w.done;w=b.next()){var x=w.value;m.push(o(o({},x),{row:g.row}))}}catch(e){n={error:e}}finally{try{w&&!w.done&&(a=b.return)&&a.call(b)}finally{if(n)throw n.error}}}}catch(e){r={error:e}}finally{try{_&&!_.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}else try{for(var C=s(e),k=C.next();!k.done;k=C.next()){g=k.value;try{for(var M=(d=void 0,s(g.cells)),R=M.next();!R.done;R=M.next())x=R.value,m.push(o(o({},x),{column:g.column}))}catch(e){d={error:e}}finally{try{R&&!R.done&&(u=M.return)&&u.call(M)}finally{if(d)throw d.error}}}}catch(e){l={error:e}}finally{try{k&&!k.done&&(c=C.return)&&c.call(C)}finally{if(l)throw l.error}}e=m}try{for(var T=s(e),L=T.next();!L.done;L=T.next()){var E=L.value;if(this.data[E.row]||(this.data[E.row]=[]),x=new y(E.value),void 0!==E.calculated&&x.SetCalculatedValue(E.calculated,E.calculated_type),t&&void 0!==E.style_ref&&(x.style=t[E.style_ref]),void 0!==E.note&&(x.note=E.note),void 0!==E.hyperlink&&(x.hyperlink=E.hyperlink),this.data[E.row][E.column]&&this.data[E.row][E.column].area&&(x.area=this.data[E.row][E.column].area),this.data[E.row][E.column]=x,E.area)for(var z=new f(E.area.start,E.area.end),D=z.start.row;D<=z.end.row;D++)for(var P=z.start.column;P<=z.end.column;P++)this.data[D]||(this.data[D]=[]),this.data[D][P]||(this.data[D][P]=new y),this.data[D][P].area=z;if(E.merge_area){var N=new f(E.merge_area.start,E.merge_area.end);for(D=N.start.row;D<=N.end.row;D++)for(P=N.start.column;P<=N.end.column;P++)this.data[D]||(this.data[D]=[]),this.data[D][P]||(this.data[D][P]=new y),this.data[D][P].merge_area=N}E.validation&&(x.validation=E.validation)}}catch(e){h={error:e}}finally{try{L&&!L.done&&(p=T.return)&&p.call(T)}finally{if(h)throw h.error}}this.rows_=this.data.length,this.columns_=this.data.reduce((function(e,t){return Math.max(e,t.length)}),0)},e.prototype.toJSON=function(e){var t,r,o,n,a,l,c,d;void 0===e&&(e={});var h,f=0,p=0,m=this.data.length-1;e.subset&&(f=e.subset.start.column,p=e.subset.start.row,m=e.subset.end.row);for(var v=[],y=-1,_=-1,g={},b={},w=p;w<=m;w++)if(this.data[w]){var x=this.data[w];h=x.length-1,e.subset&&(h=e.subset.end.column);for(var C=f;C<=h;C++){var S=x[C],A=S&&S.merge_area&&S.merge_area.start.row===w&&S.merge_area.start.column===C,k=S&&S.area&&S.area.start.row===w&&S.area.start.column===C,M=!S||S.type===u.string&&!S.value;if(S&&(!M||e.preserve_empty_strings)&&(A||S.type||S.calculated_type&&e.expand_arrays||S.calculated_type&&e.calculated_value||S.validation||e.decorated_cells&&S.style&&(S.style.fill||S.style.border_bottom||S.style.border_top||S.style.border_left||S.style.border_right))){var R={row:w,column:C,value:S.value};S.note&&(R.note=S.note),S.hyperlink&&(R.hyperlink=S.hyperlink),e.preserve_type&&(R.type=S.type),e.sheet_id&&(R.sheet_id=e.sheet_id),e.calculated_value&&void 0!==S.calculated&&(R.calculated=S.calculated,(e.preserve_type||S.calculated_type===u.error)&&(R.calculated_type=S.calculated_type)),S.area&&k&&(R.area=S.area.toJSON()),S.merge_area&&(R.merge_area=S.merge_area.toJSON()),S.validation&&(R.validation=S.validation),e.cell_style_refs&&e.cell_style_refs[C]&&e.cell_style_refs[C][w]&&(R.style_ref=e.cell_style_refs[C][w],e.cell_style_refs[C][w]=0),g[w]=w,b[C]=C,y=Math.max(w,y),_=Math.max(C,_),v.push(R)}}}if(e.nested){var T=Object.keys(g),L=Object.keys(b);if(T.length<=L.length&&T.length){var E={},z=[];try{for(var D=s(v),P=D.next();!P.done;P=D.next()){w=(H=P.value).row;var N=i(H,["row"]);E[H.row]||(E[H.row]=[]),E[H.row].push(N)}}catch(e){t={error:e}}finally{try{P&&!P.done&&(r=D.return)&&r.call(D)}finally{if(t)throw t.error}}try{for(var F=s(T),I=F.next();!I.done;I=F.next()){var U=I.value;w=Number(U),z.push({row:w,cells:E[w]})}}catch(e){o={error:e}}finally{try{I&&!I.done&&(n=F.return)&&n.call(F)}finally{if(o)throw o.error}}return{data:z,rows:y,columns:_+1}}if(L.length){E={},z=[];try{for(var O=s(v),V=O.next();!V.done;V=O.next()){var H;C=(H=V.value).column,N=i(H,["column"]),E[H.column]||(E[H.column]=[]),E[H.column].push(N)}}catch(e){a={error:e}}finally{try{V&&!V.done&&(l=O.return)&&l.call(O)}finally{if(a)throw a.error}}try{for(var j=s(L),G=j.next();!G.done;G=j.next())U=G.value,C=Number(U),z.push({column:C,cells:E[C]})}catch(e){c={error:e}}finally{try{G&&!G.done&&(d=j.return)&&d.call(j)}finally{if(c)throw c.error}}return{data:z,rows:y,columns:_+1}}}return{data:v,rows:y+1,columns:_+1}},e.prototype.GetAll=function(e){return void 0===e&&(e=!1),this.GetRange({row:0,column:0},{row:this.rows_-1,column:this.columns_-1},e)},e.prototype.Normalize2=function(e,t){return e.column===1/0&&(e=o(o({},e),{column:0})),e.row===1/0&&(e=o(o({},e),{row:0})),t.column===1/0&&(t=o(o({},t),{column:this.columns_-1})),t.row===1/0&&(t=o(o({},t),{row:this.rows_-1})),{from:e,to:t}},e.prototype.Normalize1=function(e){return e.column===1/0&&(e=o(o({},e),{column:0})),e.row===1/0&&(e=o(o({},e),{row:0})),e},e.prototype.RawValue=function(e,t){var r,o,i;if(void 0===t&&(t=e),e=(r=this.Normalize2(e,t)).from,t=r.to,e.row===t.row&&e.column===t.column)return this.data[e.row]&&this.data[e.row][e.column]?this.data[e.row][e.column].value:void 0;var n=[],a=this.data.slice(e.row,t.row+1),l=e.column,c=t.column+1;try{for(var d=s(a),u=d.next();!u.done;u=d.next()){for(var h=u.value,f=[],p=l,m=0;p<c;p++,m++){var v=h[p];f.push(v?v.value:void 0)}n.push(f)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}return n},e.prototype.GetRange=function(e,t,r){var o;if(void 0===r&&(r=!1),t?(e=(o=this.Normalize2(e,t)).from,t=o.to):e=this.Normalize1(e),!t||e===t||e.column===t.column&&e.row===t.row)return this.data[e.row]&&this.data[e.row][e.column]?this.data[e.row][e.column].GetValue():void 0;var i=[];if(r)for(var n=e.column;n<=t.column;n++){for(var a=[],s=e.row;s<=t.row;s++)this.data[s]&&this.data[s][n]?a.push(this.data[s][n].GetValue()):a.push(void 0);i.push(a)}else for(s=e.row;s<=t.row;s++){var l=[];for(n=e.column;n<=t.column;n++)this.data[s]&&this.data[s][n]?l.push(this.data[s][n].GetValue()):l.push(void 0);i.push(l)}return i},e.prototype.GetRange4=function(e,t,r){var o;if(void 0===t&&(t=e),void 0===r&&(r=!1),e=(o=this.Normalize2(e,t)).from,t=o.to,e.row===t.row&&e.column===t.column)return this.data[e.row]&&this.data[e.row][e.column]?this.data[e.row][e.column].GetValue4():{value:void 0,type:u.undefined};var i=[];if(r)for(var n=e.column;n<=t.column;n++){for(var a=[],s=e.row;s<=t.row;s++)this.data[s]&&this.data[s][n]?a.push(this.data[s][n].GetValue4()):a.push(b());i.push(a)}else for(s=e.row;s<=t.row;s++){var l=[];for(n=e.column;n<=t.column;n++)this.data[s]&&this.data[s][n]?l.push(this.data[s][n].GetValue4()):l.push(b());i.push(l)}return i},e.prototype.Apply=function(e,t,r){if(void 0===r&&(r=!1),h(e)&&(e=new f(e)),e.entire_column||e.entire_row)throw new Error("don't iterate infinite cells");var o=e.start,i=e.end;if(r)for(var n=o.row;n<=i.row;n++){this.data[n]||(this.data[n]=[]);for(var a=this.data[n],s=o.column;s<=i.column;s++)a[s]||(a[s]=new y),t(a[s],s,n)}else for(n=o.row;n<=i.row;n++)if(this.data[n])for(a=this.data[n],s=o.column;s<=i.column;s++)a[s]&&t(a[s],s,n)},e.prototype.SetArea=function(e,t){if(ArrayBuffer.isView(t))throw new Error("ABIV");if(Array.isArray(t))for(var r=e.start.row,o=0;r<=e.end.row;r++,o++){this.data[r]||(this.data[r]=[]);var i=this.data[r];if(t[o])for(var n=e.start.column,a=0;n<=e.end.column;n++,a++)i[n]||(i[n]=new y),i[n].Set(t[o][a])}else{var s=v(t);for(r=e.start.row;r<=e.end.row;r++)for(this.data[r]||(this.data[r]=[]),i=this.data[r],n=e.start.column;n<=e.end.column;n++)i[n]||(i[n]=new y),i[n].Set(t,s)}this.rows_=Math.max(this.rows_,e.end.row+1),this.columns_=Math.max(this.columns_,e.end.column+1)},e.prototype.IterateAll=function(e){var t,r,o,i;try{for(var n=s(this.data),a=n.next();!a.done;a=n.next()){var l=a.value;if(l)try{for(var c=(o=void 0,s(l)),d=c.next();!d.done;d=c.next()){var u=d.value;u&&e(u)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.FlushCellStyles=function(){var e,t,r,o;try{for(var i=s(this.data),n=i.next();!n.done;n=i.next()){var a=n.value;if(a)try{for(var l=(r=void 0,s(a)),c=l.next();!c.done;c=l.next()){var d=c.value;d&&d.FlushStyle()}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.FlushCachedValues=function(){var e,t,r,o;try{for(var i=s(this.data),n=i.next();!n.done;n=i.next()){var a=n.value;if(a)try{for(var l=(r=void 0,s(a)),c=l.next();!c.done;c=l.next()){var d=c.value;d&&d.FlushCache()}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e}(),M=function(){function e(){}return e.UpdateLocale=function(e){var t;if(e)this.locale=e;else if("undefined"!=typeof self){var r=null===(t=null===self||void 0===self?void 0:self.document)||void 0===t?void 0:t.location;if(r&&r.search&&/locale=([^?&]+?)(?:\?|$|&)/.test(r.search)){var o=r.search.match(/locale=(.*?)(?:\?|$|&)/);o&&(this.locale=o[1]),console.info("override locale",this.locale)}else"undefined"!=typeof navigator&&(navigator.languages&&navigator.languages[0]?this.locale=navigator.languages[0]:this.locale=navigator.language)}var i=new Intl.NumberFormat(this.locale,{minimumFractionDigits:1}).format(3.3).replace(/\d/g,"");this.decimal_separator=","===i?",":".",","===this.decimal_separator&&(this.argument_separator=";",this.grouping_separator=" ");var n=new Date(2e3,0,2,12,0,0,0);this.UpdateDateComponent(0,0,n),n=new Date(2e3,1,7,12,0,0,0),this.UpdateDateComponent(1,1,n),n=new Date(2e3,2,7,12,0,0,0),this.UpdateDateComponent(2,2,n),n=new Date(2e3,3,5,12,0,0,0),this.UpdateDateComponent(3,3,n),n=new Date(2e3,4,4,12,0,0,0),this.UpdateDateComponent(4,4,n),n=new Date(2e3,5,2,12,0,0,0),this.UpdateDateComponent(5,5,n),n=new Date(2e3,6,1,12,0,0,0),this.UpdateDateComponent(6,6,n),n=new Date(2e3,7,1,12,0,0,0),this.UpdateDateComponent(7,-1,n),n=new Date(2e3,8,1,12,0,0,0),this.UpdateDateComponent(8,-1,n),n=new Date(2e3,9,1,12,0,0,0),this.UpdateDateComponent(9,-1,n),n=new Date(2e3,10,1,12,0,0,0),this.UpdateDateComponent(10,-1,n),n=new Date(2e3,11,1,12,0,0,0),this.UpdateDateComponent(11,-1,n)},e.UpdateDateComponent=function(e,t,r){t>=0&&(this.date_components.short_days[t]=r.toLocaleString(this.locale,{weekday:"short"}),this.date_components.long_days[t]=r.toLocaleString(this.locale,{weekday:"long"})),e>=0&&(this.date_components.short_months[e]=r.toLocaleString(this.locale,{month:"short"}),this.date_components.long_months[e]=r.toLocaleString(this.locale,{month:"long"}))},e.locale="en-us",e.decimal_separator=".",e.argument_separator=",",e.grouping_separator=",",e.date_components={short_days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],long_days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],short_months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long_months:["January","February","March","April","May","June","July","August","September","October","November","December"]},e}();M.UpdateLocale();var R,T,L=function(){function e(e,t,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),this.left=e,this.top=t,this.width=r,this.height=o}return Object.defineProperty(e.prototype,"right",{get:function(){return this.left+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:!1,configurable:!0}),e.Create=function(t){return new e(t.left||0,t.top||0,t.width||0,t.height||0)},e.IsRectangle=function(e){var t,r,o,i;return"object"==typeof e&&"number"==typeof(null===(t=e)||void 0===t?void 0:t.left)&&"number"==typeof(null===(r=e)||void 0===r?void 0:r.top)&&"number"==typeof(null===(o=e)||void 0===o?void 0:o.width)&&"number"==typeof(null===(i=e)||void 0===i?void 0:i.height)},e.prototype.Shift=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=0),new e(this.left+t,this.top+r,this.width,this.height)},e.prototype.Scale=function(t,r){return void 0===t&&(t=1),void 0===r&&(r=t),new e(this.left*t,this.top*r,this.width*t,this.height*r)},e.prototype.Expand=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=0),new e(this.left,this.top,this.width+t,this.height+r)},e.prototype.Combine=function(t){return new e(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right)-Math.min(this.left,t.left),Math.max(this.bottom,t.bottom)-Math.min(this.top,t.top))},e.prototype.CheckEdges=function(e,t,r){void 0===r&&(r=16);var o=0;return e-this.left<r&&(o|=1),this.right-e<r&&(o|=2),t-this.top<r&&(o|=4),this.bottom-t<r&&(o|=8),o},e.prototype.Contains=function(e,t,r){return void 0===r&&(r=0),e>=this.left-r&&e<=this.left+this.width+r&&t>=this.top-r&&t<=this.top+this.height+r},e.prototype.ContextFill=function(e){e.fillRect(this.left,this.top,this.width,this.height)},e.prototype.ContextStroke=function(e){e.strokeRect(this.left,this.top,this.width,this.height)},e.prototype.Clamp=function(e,t){return{x:e=Math.min(Math.max(e,this.left),this.right),y:t=Math.min(Math.max(t,this.top),this.bottom)}},e.prototype.ApplyStyle=function(e){e.style.top=this.top+"px",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.height=this.height+"px"},e.prototype.toJSON=function(){return{top:this.top,left:this.left,width:this.width,height:this.height}},e}();!function(e){var t,r,i=JSON.stringify({});!function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right"}(t=e.HorizontalAlign||(e.HorizontalAlign={})),function(e){e[e.None=0]="None",e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Middle=3]="Middle"}(r=e.VerticalAlign||(e.VerticalAlign={})),e.DefaultProperties={horizontal_align:t.None,vertical_align:r.None,number_format:"General",nan:"NaN",font_size_value:10,font_size_unit:"pt",font_face:"calibri",font_bold:!1,font_italic:!1,font_underline:!1,font_strike:!1,text:{theme:1},border_top:0,border_left:0,border_right:0,border_bottom:0},e.Merge=function(e,t,r){void 0===r&&(r=!0);var i=o(r?o({},e):{},t);return JSON.parse(JSON.stringify(i))},e.Composite=function(e){return JSON.parse(JSON.stringify(e.reduce((function(e,t){return o(o({},e),t)}),{})))},e.Empty=function(e){return JSON.stringify(e)===i},e.ValidColor=function(e){return!(!e||e.none||!e.text&&!e.theme&&0!==e.theme)},e.Font=function(e,t){void 0===t&&(t=1);var r=[];return e.font_weight?r.push(e.font_weight.toString()):e.font_bold&&r.push("bold"),e.font_italic&&r.push("italic"),r.push(((e.font_size_value||0)*t).toFixed(2)+(e.font_size_unit||"pt")),r.push(e.font_face||""),r.join(" ")}}(R||(R={})),function(e){e[e.default=0]="default",e[e.hidden=1]="hidden",e[e.padded=2]="padded",e[e.date_component=3]="date_component",e[e.date_component_minutes=4]="date_component_minutes",e[e.literal=5]="literal",e[e.formatting=6]="formatting"}(T||(T={}));var E,z,D=new(function(){function e(){}return e.prototype.Darken=function(e,t,r,o,i){void 0===i&&(i=!1);var n=this.RGBToHSL(e,t,r),a=n.h,s=n.s,l=n.l;return l-=i?l*o/100:o/100,l=Math.max(0,Math.min(1,l)),this.HSLToRGB(a,s,l)},e.prototype.Lighten=function(e,t,r,o,i){void 0===i&&(i=!1);var n=this.RGBToHSL(e,t,r),a=n.h,s=n.s,l=n.l;return l+=i?l*o/100:o/100,l=Math.max(0,Math.min(1,l)),this.HSLToRGB(a,s,l)},e.prototype.RGBToHSL=function(e,t,r){e/=255,t/=255,r/=255;var o=Math.max(e,t,r),i=Math.min(e,t,r),n=0,a=0,s=(o+i)/2;if(o===i)n=a=0;else{var l=o-i;switch(a=s>.5?l/(2-o-i):l/(o+i),o){case e:n=(t-r)/l+(t<r?6:0);break;case t:n=(r-e)/l+2;break;case r:n=(e-t)/l+4}n/=6}return{h:360*n,s:a,l:s}},e.prototype.HSLToRGB=function(e,t,r){var o,i,n;if(0===t)o=i=n=r;else{e/=360;var a=r<.5?r*(1+t):r+t-r*t,s=2*r-a;o=this.HueToRGB(s,a,e+1/3),i=this.HueToRGB(s,a,e),n=this.HueToRGB(s,a,e-1/3)}return{r:Math.round(255*o),g:Math.round(255*i),b:Math.round(255*n)}},e.prototype.HueToRGB=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},e}()),P={grid_color:"red",note_marker_color:"#d2c500"},N=function(e,t){return F(e,t,0)},F=function(e,t,r){return(null==t?void 0:t.text)?"none"===t.text?"":t.text:(null==t?void 0:t.theme)||0===(null==t?void 0:t.theme)?t.tint?function(e,t,r){e.tint_cache||(e.tint_cache=[]),e.tint_cache[t]||(e.tint_cache[t]={});var o=e.tint_cache[t][r];if(!o){var i,n=e.theme_colors_rgb?e.theme_colors_rgb[t]:[0,0,0];o="rgb("+(i=r>0?D.Lighten(n[0],n[1],n[2],100*r,!0):D.Darken(n[0],n[1],n[2],100*-r,!0)).r+","+i.g+","+i.b+")",e.tint_cache[t][r]=o}return o}(e,t.theme,t.tint):e.theme_colors?e.theme_colors[t.theme]:"":(r||0===r)&&e.theme_colors?e.theme_colors[r]:""},I=function(e){var t=function(e){var t=10,r="pt",o=e.match(/^([\d.]+)(\D.*)$/);return o&&(t=Number(o[1]),r=o[2]),{value:t,unit:r}}(e.fontSize||""),r=t.value,o=t.unit,i={fill:{text:e.backgroundColor},text:{text:e.color},font_size_unit:o,font_size_value:r,font_face:e.fontFamily};/italic/i.test(e.font)&&(i.font_italic=!0);var n=Number(e.fontWeight);return!isNaN(n)&&n&&(i.font_weight=n),i};!function(e){e.Comma=",",e.Semicolon=";"}(E||(E={})),function(e){e.Period=".",e.Comma=","}(z||(z={}));var U,O=/[\s-+=<>!()]/,V=/['*\\]/,H=48,j={"==":6,"!=":6,"<>":6,"=":6,"<":7,">":7,"<=":7,">=":7,"+":9,"-":9,"&":9,"*":10,"/":10,"^":11,":":13},G=Object.keys(j).sort((function(e,t){return t.length-e.length})),B={"-":100,"+":100},Z=function(){function e(){this.argument_separator=E.Comma,this.decimal_mark=z.Period,this.argument_separator_char=44,this.decimal_mark_char=46,this.imaginary_char=105,this.imaginary_number="i",this.id_counter=0,this.expression="",this.data=[],this.index=0,this.length=0,this.valid=!0,this.dependencies={addresses:{},ranges:{}},this.address_refcount={},this.full_reference_list=[]}return e.prototype.Walk=function(e,t){var r=this;switch(e.type){case"address":case"missing":case"literal":case"complex":case"identifier":case"operator":return void t(e);case"range":return void(t(e)&&(this.Walk(e.start,t),this.Walk(e.end,t)));case"binary":return void(t(e)&&(this.Walk(e.left,t),this.Walk(e.right,t)));case"unary":return void(t(e)&&this.Walk(e.operand,t));case"group":return void(t(e)&&e.elements.forEach((function(e){return r.Walk(e,t)})));case"call":t(e)&&e.args.forEach((function(e){return r.Walk(e,t)}))}},e.prototype.Transpose=function(e){for(var t=e.length,r=[],o=0,i=0;i<t;i++)Array.isArray(e[i])&&(o=Math.max(o,e[i].length));for(i=0;i<o;i++){r[i]=[];for(var n=0;n<t;n++)r[i][n]=e[n][i]}return r},e.prototype.Render=function(e,t,r,o,i,n){var a=this;void 0===t&&(t={rows:0,columns:0}),void 0===r&&(r="(missing)");var s=this.argument_separator+" ";i===E.Comma?s=", ":i===E.Semicolon&&(s="; "),this.imaginary_number;var l=o===z.Comma?",":".",c=this.decimal_mark===z.Comma?/,/:/\./;switch(e.type){case"address":return this.AddressLabel(e,t);case"range":return this.AddressLabel(e.start,t)+":"+this.AddressLabel(e.end,t);case"missing":return r;case"array":return"{"+this.Transpose(e.values).map((function(e){return e.map((function(e){return"string"==typeof e?'"'+e+'"':e})).join(", ")})).join("; ")+"}";case"binary":return this.Render(e.left,t,r,o,i)+" "+e.operator+" "+this.Render(e.right,t,r,o,i);case"unary":return e.operator+this.Render(e.operand,t,r,o,i);case"complex":if(e.real){var d=Math.abs(e.imaginary);return(e.real||0)+(e.imaginary<0?" - ":" + ")+(1===d?"":d)+"i"}return-1===e.imaginary?"-i":1===e.imaginary?"i":e.imaginary+"i";case"literal":if("string"==typeof e.value)return'"'+e.value.replace(/"/g,'""')+'"';if(o&&"number"==typeof e.value){if(e.text){var u=e.text;return o===z.Comma&&this.decimal_mark===z.Period&&(u=u.replace(/,/g,"")),u.replace(c,l)}return e.value.toString().replace(/\./,l)}return e.text?e.text:e.value.toString();case"identifier":return e.name;case"operator":return"["+e.operator+"]";case"group":return e.explicit?"("+e.elements.map((function(e){return a.Render(e,t,r,o,i)})).join(s)+")":e.elements.map((function(e){return a.Render(e,t,r,o,i)})).join(s);case"call":return e.name+"("+e.args.map((function(e){return a.Render(e,t,r,o,i)})).join(s)+")"}return"??"},e.prototype.Parse=function(e){var t,r;switch("="===(e=e.trim())[0]&&(e=e.substr(1).trim()),this.expression=e,this.data=[],this.length=e.length,this.index=0,this.valid=!0,this.error_position=void 0,this.error=void 0,this.dependencies.addresses={},this.dependencies.ranges={},this.address_refcount={},this.full_reference_list=[],this.id_counter=0,this.argument_separator){case E.Semicolon:this.argument_separator_char=59;break;default:this.argument_separator_char=44}switch(this.decimal_mark){case z.Comma:this.decimal_mark_char=44;break;default:this.decimal_mark_char=46}for(var o=0;o<this.length;o++)this.data[o]=e.charCodeAt(o);var i=this.ParseGeneric(),n={};try{for(var a=s(Object.keys(this.dependencies.addresses)),l=a.next();!l.done;l=a.next()){var c=l.value;this.address_refcount[c]&&(n[c]=this.dependencies.addresses[c])}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return this.dependencies.addresses=n,{expression:i||void 0,valid:this.valid,error:this.error,error_position:this.error_position,dependencies:this.dependencies,separator:this.argument_separator,decimal_mark:this.decimal_mark,full_reference_list:this.full_reference_list.slice(0)}},e.prototype.ColumnLabel=function(e){if(e===1/0)return"";for(var t=String.fromCharCode(65+e%26);e>25;)e=Math.floor(e/26)-1,t=String.fromCharCode(65+e%26)+t;return t},e.prototype.AddressLabel=function(e,t){var r=e.column;e.absolute_column||e.column===1/0||(r+=t.columns);var o=e.row;if(e.absolute_row||e.row===1/0||(o+=t.rows),o<0||r<0||o===1/0&&r===1/0)return"#REF";var i="";return e.sheet&&(i=(O.test(e.sheet)?"'"+e.sheet+"'":e.sheet)+"!"),o===1/0?i+(e.absolute_column?"$":"")+this.ColumnLabel(r):r===1/0?i+(e.absolute_row?"$":"")+(o+1):i+(e.absolute_column?"$":"")+this.ColumnLabel(r)+(e.absolute_row?"$":"")+(o+1)},e.prototype.ParseGeneric=function(e){var t=this;void 0===e&&(e=[0]);for(var r=[],o=function(){var t=i.ParseNext(0===r.length);if("number"==typeof t){if(e.some((function(e){return t===e})))return"break";if(40===t){i.index++;var o=i.ParseGeneric([41]);i.index++,o&&r.push({type:"group",id:i.id_counter++,elements:[o],explicit:!0})}else{var n=i.ConsumeOperator();n?r.push(n):(i.error="unexpected character [1]: "+String.fromCharCode(t)+", "+t,i.valid=!1,i.index++)}}else r.push(t)},i=this;this.index<this.length&&"break"!==o(););return r.length&&(r=(r=this.BinaryToRange2(r)).map((function(e){return"identifier"===e.type&&e.name===t.imaginary_number?{type:"complex",real:0,imaginary:1,position:e.position,text:e.name,id:t.id_counter++}:e}))),0===r.length?null:1===r.length?r[0]:this.BinaryToComplex(this.ArrangeUnits(r))},e.prototype.UnitToAddress=function(e){if("literal"===e.type){if("number"==typeof e.value&&e.value>0&&!/\./.test(e.text||""))return{type:"address",position:e.position,label:e.value.toString(),row:e.value-1,id:this.id_counter++,column:1/0}}else{var t=void 0,r=e.name,o=r.split("!");if(o.length>1&&(t=o.slice(0,o.length-1).join("!"),r=r.substr(t.length+1),"'"===t[0])){if(!(t.length>1&&"'"===t[t.length-1]))return;t=t.substr(1,t.length-2)}var i="$"===r[0];r=(i?r.substr(1):r).toUpperCase();var n=Number(r);if(isNaN(n)){if(/[A-Z]{1,3}/.test(r)){for(var a=-1,s=0;s<r.length;s++)a=26*(1+a)+(r[s].charCodeAt(0)-65);return{type:"address",position:e.position,absolute_column:i,label:e.name,column:a,id:this.id_counter++,row:1/0,sheet:t}}}else if(n>0&&n!==1/0&&!/\./.test(r))return{type:"address",position:e.position,absolute_row:i,label:e.name,row:n-1,id:this.id_counter++,column:1/0,sheet:t}}},e.prototype.BinaryToRange2=function(e){for(var t,r=[],i=function(i){var a=e[i],s=e[i+1],l=e[i+2],c=void 0,d="",u=void 0;if(a&&s&&l&&"operator"===s.type&&":"===s.operator)if("address"===a.type&&"address"===l.type){var h=a.position+a.label.length,f=l.position;d=(c={type:"range",id:n.id_counter++,position:a.position,start:a,end:l,label:a.label+n.expression.substring(h,f)+l.label}).start.label+":"+c.end.label,n.address_refcount[c.start.label]--,n.address_refcount[c.end.label]--;var p=[a.position,l.position];n.full_reference_list=n.full_reference_list.filter((function(e){return e.position!==p[0]&&e.position!==p[1]}))}else if(!("literal"!==a.type&&"identifier"!==a.type||"literal"!==l.type&&"identifier"!==l.type)){var m=n.UnitToAddress(a);if(!m&&"literal"===a.type&&"number"==typeof a.value&&a.value<0){var v=o(o({},a),{text:(a.text||"").replace(/^-/,""),position:a.position+1,value:-a.value});(m=n.UnitToAddress(v))&&(u={type:"operator",operator:"-",position:a.position,id:n.id_counter++})}var y=n.UnitToAddress(l);m&&y&&(m.column===1/0&&y.column===1/0||m.row===1/0&&y.row===1/0)&&(d=m.label+":"+y.label,c={type:"range",id:n.id_counter++,position:m.position,start:m,end:y,label:d})}c?(u&&r.push(u),r.push(c),n.dependencies.ranges[d]=c,n.full_reference_list.push(c),i+=2):r.push(a),t=i},n=this,a=0;a<e.length;a++)i(a),a=t;return r},e.prototype.BinaryToComplex=function(e){var t;if("binary"===e.type){if(!("+"!==e.operator&&"-"!==e.operator||"literal"!==e.left.type||"number"!=typeof e.left.value||"complex"!==e.right.type||e.right.composited)){var r;r=this.expression.substring(e.left.position,e.right.position+((null===(t=e.right.text)||void 0===t?void 0:t.length)||0));var i=e.right.imaginary;return"-"===e.operator&&(i=-i),{type:"complex",position:e.left.position,text:r,id:this.id_counter++,imaginary:i,real:e.left.value,composited:!0}}e.left=this.BinaryToComplex(e.left),e.right=this.BinaryToComplex(e.right)}else if("unary"===e.type&&("-"===e.operator||"+"===e.operator)&&"complex"===e.operand.type&&e.operand.text===this.imaginary_number)return o(o({},e.operand),{position:e.position,text:this.expression.substring(e.position,e.operand.position+(e.operand.text||"").length),imaginary:e.operand.imaginary*("-"===e.operator?-1:1)});return e},e.prototype.BinaryToRangeX=function(e){if("binary"===e.type){if(":"===e.operator){var t=void 0,r="";if("address"===e.left.type&&"address"===e.right.type){var o=e.left.position+e.left.label.length,i=e.right.position;r=(t={type:"range",id:this.id_counter++,position:e.left.position,start:e.left,end:e.right,label:e.left.label+this.expression.substring(o,i)+e.right.label}).start.label+":"+t.end.label,this.address_refcount[t.start.label]--,this.address_refcount[t.end.label]--;var n=[e.left.position,e.right.position];this.full_reference_list=this.full_reference_list.filter((function(e){return e.position!==n[0]&&e.position!==n[1]}))}else if(!("literal"!==e.left.type&&"identifier"!==e.left.type||"literal"!==e.right.type&&"identifier"!==e.right.type)){var a=this.UnitToAddress(e.left),s=this.UnitToAddress(e.right);a&&s&&(a.column===1/0&&s.column===1/0||a.row===1/0&&s.row===1/0)&&(r=a.label+":"+s.label,t={type:"range",id:this.id_counter++,position:e.left.position,start:a,end:s,label:r})}if(t)return this.dependencies.ranges[r]=t,this.full_reference_list.push(t),t;this.error="unexpected character: :",this.valid=!1}e.left=this.BinaryToRangeX(e.left),e.right=this.BinaryToRangeX(e.right)}return e},e.prototype.ArrangeUnits=function(e){if(0===e.length)return{type:"missing",id:this.id_counter++};if(1===e.length)return e[0];for(var t=[],r=0;r<e.length;r++){var o=e[r];if("operator"===o.type){if(0!==t.length&&"operator"!==t[t.length-1].type){t.push(o);continue}if(!B[o.operator])return this.error="unexpected character [2]: "+o.operator,this.error_position=o.position,this.valid=!1,{type:"group",id:this.id_counter++,elements:e,explicit:!1};var i=this.BinaryToComplex(this.ArrangeUnits(e.slice(r+1)));if(!this.valid)return{type:"group",id:this.id_counter++,elements:e,explicit:!1};"binary"===i.type?(i.left={type:"unary",id:this.id_counter++,operator:o.operator,operand:i.left,position:o.position},o=i):o={type:"unary",id:this.id_counter++,operator:o.operator,operand:i,position:o.position},r=e.length}if(t.length<2)t.push(o);else{if("operator"!==t[t.length-1].type)return this.error="multiple expressions",this.error_position=o.position,this.valid=!1,{type:"group",id:this.id_counter++,elements:e,explicit:!1};var n=t[t.length-2],a=t[t.length-1],s=a.operator,l={type:"binary",id:this.id_counter++,left:n,operator:s,position:a.position,right:o};"binary"===n.type&&j[s]>j[n.operator]&&(l.left=n.left,l.operator=n.operator,l.position=n.position,l.right={type:"binary",id:this.id_counter++,left:n.right,right:o,operator:s,position:a.position}),t.splice(-2,2,l)}}return t[0]},e.prototype.ParseNext=function(e){void 0===e&&(e=!0),this.ConsumeWhiteSpace();var t=this.data[this.index];if(34===t)return{type:"literal",id:this.id_counter++,position:this.index,value:this.ConsumeString()};if(t>=H&&t<=57||t===this.decimal_mark_char)return this.ConsumeNumber();if(123===t)return this.ConsumeArray();if(!e||45!==t&&43!==t){if(t>=65&&t<=90||t>=97&&t<=122||95===t||39===t||36===t||t>=192&&t<=312)return this.ConsumeToken(t)}else{var r=this.data[this.index+1];if(r>=H&&r<=57||r===this.decimal_mark_char)return this.ConsumeNumber()}return t},e.prototype.ConsumeArray=function(){var e={type:"array",id:this.id_counter++,values:[],position:this.index};this.index++;for(var t=0,r=0;this.index<this.length;){var o=this.ParseNext(),i=this.index;if("number"==typeof o)switch(this.index++,o){case 59:r++,t=0;break;case 44:t++;break;case 125:return e;default:this.valid&&(this.error="invalid character in array literal",this.error_position=i,this.valid=!1)}else switch(o.type){case"literal":e.values[t]||(e.values[t]=[]),e.values[t][r]=o.value;break;default:this.valid&&(this.error="invalid value in array literal",this.error_position=i,this.valid=!1)}}return e},e.prototype.ConsumeOperator=function(){var e,t;try{for(var r=s(G),o=r.next();!o.done;o=r.next()){var i=o.value;if(this.expression.substr(this.index,i.length)===i){var n=this.index;return this.index+=i.length,{type:"operator",id:this.id_counter++,operator:i,position:n}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return null},e.prototype.ConsumeArguments=function(){this.index++;for(var e=0,t=[];this.index<this.length;){var r=this.ParseGeneric([this.argument_separator_char,41]);null!==r&&t.push(r);var o=this.data[this.index];if(o===this.argument_separator_char){this.index++,e++;for(var i=t.length;i<e;i++)t.push({type:"missing",id:this.id_counter++})}else if(41===o)return this.index++,t}return t},e.prototype.ConsumeToken=function(e){var t=[e],r=this.index,o=39===e;for(++this.index;this.index<this.length;this.index++){var i=this.data[this.index];if(!(i>=65&&i<=90||i>=97&&i<=122||i>=192&&i<=312||95===i||36===i||46===i||33===i||o||i>=H&&i<=57))break;t.push(i),39===i&&(o=!1)}var n=t.map((function(e){return String.fromCharCode(e)})).join("");if(o)return this.error="unbalanced single quote",this.error_position=r,this.valid=!1,{type:"identifier",id:this.id_counter++,name:n,position:r};if("true"===n.toLowerCase())return{type:"literal",id:this.id_counter++,value:!0,position:r};if("false"===n.toLowerCase())return{type:"literal",id:this.id_counter++,value:!1,position:r};if(this.ConsumeWhiteSpace(),40===this.data[this.index]){var a=this.ConsumeArguments();return{type:"call",id:this.id_counter++,name:n,args:a,position:r}}var s=this.ConsumeAddress(n,r);if(s)return s;var l={type:"identifier",id:this.id_counter++,name:n,position:r};return this.full_reference_list.push(l),l},e.prototype.ConsumeAddress=function(e,t){var r,o=t,i=e.length,n=e.split("!");n.length>1&&(t+=(r=n.slice(0,n.length-1).join("!")).length+1);var a=this.ConsumeAddressColumn(t);if(!a)return null;t=a.position;var s=this.ConsumeAddressRow(t);if(!s)return null;t=s.position;var l=r?r+e.substr(r.length,t-o).toUpperCase():e.substr(0,t-o).toUpperCase();r&&"'"===r[0]&&(r=r.substr(1,r.length-2));var c={type:"address",id:this.id_counter++,label:l,row:s.row,column:a.column,absolute_row:s.absolute,absolute_column:a.absolute,position:o,sheet:r};return i!==t-o?null:(this.dependencies.addresses[c.label]=c,this.address_refcount[c.label]=(this.address_refcount[c.label]||0)+1,this.full_reference_list.push(c),c)},e.prototype.ConsumeAddressRow=function(e){var t=36===this.data[e];t&&e++;for(var r=e,o=0;;e++){var i=this.data[e];if(!(i>=H&&i<=57))break;o*=10,o+=i-H}return r!==e&&{absolute:t,row:o-1,position:e}},e.prototype.ConsumeAddressColumn=function(e){var t=-1,r=0,o=36===this.data[e];for(o&&e++;;e++,r++){if(r>=4)return!1;var i=this.data[e];if(i>=65&&i<=90)t=26*(1+t)+(i-65);else{if(!(i>=97&&i<=122))break;t=26*(1+t)+(i-97)}}return!(t<0)&&{absolute:o,column:t,position:e}},e.prototype.ConsumeNumber=function(){for(var e=this.index,t=0,r=!1,o=!1,i=0,n=0,a=0,s="integer",l=0,c=!1,d=this.index;this.index<this.length;this.index++,l++){var u=this.data[this.index];if(u===this.decimal_mark_char){if("integer"!==s)break;s="fraction"}else{if(37===u){i/=100,a/=100,this.index++;break}if(43===u||45===u){if(0!==l)break;45===u&&(o=!0)}else if(69===u||101===u){if("integer"!==s&&"fraction"!==s)break;s="exponent",this.index<this.length-1&&(43===this.data[this.index+1]?this.index++:45===this.data[this.index+1]&&(this.index++,r=!0))}else if(u===this.imaginary_char){if("integer"===s||"fraction"===s){this.index++,c=!0;break}}else{if(!(u>=H&&u<=57))break;switch(s){case"integer":i=10*i+(u-H);break;case"fraction":a=10*a+(u-H),n++;break;case"exponent":t=10*t+(u-H)}}}}var h=i+a/Math.pow(10,n);return"exponent"===s&&(h*=Math.pow(10,(r?-1:1)*t)),c?{type:"complex",id:this.id_counter++,position:e,imaginary:o?-h:h,real:0,text:this.expression.substring(d,this.index)||""}:{type:"literal",id:this.id_counter++,position:e,value:o?-h:h,text:this.expression.substring(d,this.index)||""}},e.prototype.ConsumeString=function(){this.index++;for(var e=[];this.index<this.length;this.index++){var t=this.data[this.index];if(34===t&&(this.index++,this.index>=this.length||34!==this.data[this.index]))break;e.push(t)}return e.map((function(e){return String.fromCharCode(e)})).join("")},e.prototype.ConsumeWhiteSpace=function(){for(;this.index<this.length;){var e=this.data[this.index];if(32!==e&&9!==e&&10!==e&&13!==e&&160!==e)return;this.index++}},e}();function J(e){return e?Promise.resolve().then(e):Promise.resolve()}!function(e){e[e.default=0]="default",e[e.quoted=1]="quoted"}(U||(U={}));var q,W,K=1e3,X=function(){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t="undefined"),this.verbose=e,this.log_id=t,this.queue=[],this.dispatched=!1,this.subscribers=[],this.pass_through=[]}return e.prototype.Publish=function(e){var t,r=this;this.verbose&&console.info("es publish ("+this.log_id+")",e),this.pass_through.forEach((function(t){return t.Publish(e)})),Array.isArray(e)?(t=this.queue).push.apply(t,c([],l(e))):this.queue.push(e),this.dispatched||(this.dispatched=!0,J().then((function(){var e,t,o,i,n=r.queue.slice(0);r.dispatched=!1,r.queue=[];try{for(var a=s(n),l=a.next();!l.done;l=a.next()){var c=l.value;try{for(var d=(o=void 0,s(r.subscribers)),u=d.next();!u.done;u=d.next())u.value.subscriber(c)}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}})))},e.prototype.Subscribe=function(e){var t=K++;return this.subscribers.push({subscriber:e,token:t}),t},e.prototype.Cancel=function(e){this.subscribers=this.subscribers.filter((function(t){return t.token!==e}))},e.prototype.CancelAll=function(){this.subscribers=[],this.pass_through=[]},e.prototype.PassThrough=function(e){this.pass_through.push(e)},e}(),Y=function(){function e(t,r,o,i){void 0===i&&(i=t),e.Create({container:t,node:r,resize_callback:o,layout_reference:i})}return e.Create=function(t){var r,o,i=document.createElement("div");if(i.classList.add("treb-embed-resize-handle"),(t.layout_reference||t.container).appendChild(i),!e.resize_mask){var n=document.querySelector(".treb-embed-mouse-mask");n||((n=document.createElement("div")).classList.add("treb-embed-mouse-mask"),document.body.appendChild(n)),e.resize_mask=n}if(!e.resize_rect){var a=document.querySelector(".treb-embed-resize-rect");a||((a=document.createElement("div")).classList.add("treb-embed-resize-rect"),e.resize_mask.appendChild(a)),e.resize_rect=a}var s={width:0,height:0},l={x:0,y:0},c={x:0,y:0},d=function(){if(e.resize_mask.removeEventListener("mousemove",o),e.resize_mask.removeEventListener("mouseup",r),e.resize_mask.style.display="none",c.x||c.y){var i=t.container.getBoundingClientRect(),n=i.width+c.x,a=i.height+c.y;t.container.style.width=n+"px",t.container.style.height=a+"px",t.resize_callback&&t.resize_callback()}};o=function(t){t.buttons?(c.x!==t.clientX-l.x&&(c.x=t.clientX-l.x,e.resize_rect.style.width=s.width+c.x+4+"px"),c.y!==t.clientY-l.y&&(c.y=t.clientY-l.y,e.resize_rect.style.height=s.height+c.y+4+"px")):d()},r=function(){d()},i.addEventListener("mousedown",(function(i){i.stopPropagation(),i.preventDefault();var n=t.node.getBoundingClientRect();s={width:n.width,height:n.height},e.resize_rect&&(e.resize_rect.style.top=n.top-2+"px",e.resize_rect.style.left=n.left-2+"px",e.resize_rect.style.width=n.width+4+"px",e.resize_rect.style.height=n.height+4+"px"),l={x:i.clientX,y:i.clientY},c={x:0,y:0},e.resize_mask.style.display="block",e.resize_mask.addEventListener("mousemove",o),e.resize_mask.addEventListener("mouseup",r)}))},e}(),$=function(){function e(){}return e.MeasureColorARGB=function(e){for(var t=this.MeasureColor(e),r="FF",o=0;o<3;o++){var i=t[o].toString(16);0===i.length?r+="00":1===i.length?r+="0"+i:r+=i}return r.toUpperCase()},e.MeasureColor=function(e){var t=this.color_cache[e];if(t)return t;this.color_measurement_canvas||(this.color_measurement_canvas=document.createElement("canvas"),this.color_measurement_canvas.width=1,this.color_measurement_canvas.height=1);var r=this.color_measurement_canvas.getContext("2d");return r?(r.fillStyle="#fff",r.fillRect(0,0,1,1),r.fillStyle=e,r.fillRect(0,0,1,1),t=r.getImageData(0,0,1,1).data,this.color_cache[e]=t,t):new Uint8ClampedArray(3)},e.EnsureMeasurementNode=function(){if(!this.text_measurement_node){var e=document.querySelector(".treb-chart-measurement-node");e?this.text_measurement_node=e:(this.text_measurement_node=document.createElement("div"),this.text_measurement_node.classList.add("treb-chart-measurement-node"),this.text_measurement_node.style.margin="0px",this.text_measurement_node.style.padding="0px",this.text_measurement_node.style.whiteSpace="nowrap",this.text_measurement_node.style.position="fixed",this.text_measurement_node.style.border="0px",this.text_measurement_node.style.border="1px solid red",this.text_measurement_node.style.boxSizing="content-box",this.text_measurement_node.style.top=this.text_measurement_node.style.left="-1000px",document.body.appendChild(this.text_measurement_node))}},e.FontLoaded=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=400);var o=(t?"italic":"")+" "+r+" 20pt "+e,i=this.MeasureText(o+", sans-serif","check font"),n=this.MeasureText(o+", serif","check font"),a=this.MeasureText(o+", monospace","check font");return i.width===n.width&&n.width===a.width},e.MeasureText=function(e,t,r){void 0===r&&(r=0),this.EnsureMeasurementNode(),this.text_measurement_node.style.font=e,/\n/.test(t)?(t=t.replace(/\n/g,"<BR/>"),this.text_measurement_node.innerHTML=t):this.text_measurement_node.textContent=t,this.text_measurement_node.style.lineHeight="1em",this.text_measurement_node.style.transform=r?"rotate("+r+"deg)":"";var o=this.text_measurement_node.getBoundingClientRect();return{width:o.width,height:o.height}},e.color_cache={},e}(),Q=function(e,t){var r=e.cloneNode(!1),o=getComputedStyle(e),i=function(e,t,r){var o={};return Array.prototype.forEach.call(t,(function(e){t[e]!==r[e]&&(o[e]=t[e])})),(Object.keys(o).map((function(e){return e+": "+o[e]})).join("; ")+"; "+(e.getAttribute("style")||"")).trim().replace(/"/g,"'")}(e,o,t);return r.removeAttribute("class"),r.setAttribute("style",i),Array.prototype.forEach.call(e.childNodes,(function(t){switch(t.nodeType){case Node.ELEMENT_NODE:r.appendChild(Q(t,o));break;case Node.TEXT_NODE:e.textContent&&r.appendChild(document.createTextNode(e.textContent));break;case Node.COMMENT_NODE:break;default:console.warn("unhandled node type in serialize",t)}})),r},ee=function(e,t,r,o){var i,n;if(void 0===r&&(r=6.5),void 0===o&&(o=!1),t===e)t++,e&&e--;else{var a=Math.round(1e5*t)/1e5;Math.abs(a-t)/(t-e)<1e-5&&(t=a)}var l=t-e,c=Math.log(l)/Math.log(10),d=Math.floor(Math.abs(c))*(c<0?-1:1)-1,u=-1,h=0;try{for(var f=s([.1,.25,.5,1,2.5,5,10,25,50,100]),p=f.next();!p.done;p=f.next()){var m=p.value*Math.pow(10,d),v=Math.floor(e/m)*m,y=(Math.ceil(t/m)*m-v)/m,_=Math.abs(y-r);(u<0||_<h)&&(!o||y<=r)&&(h=_,u=m)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}return e=Math.floor(e/u)*u,t=Math.ceil(t/u)*u,{scale:d,step:u,count:r=Math.round((t-e)/u),min:e,max:t}},te=function(e,t,r){[].forEach.call(e.children,(function(e){e.id&&(r[e.id]=e,e.id=t+"-"+e.id),e.children&&e.children.length&&te(e,t,r)}))},re=function(e,t){var r,o,i=Math.random().toString(36).substring(2,15),n=document.createElement("div");n.innerHTML=e;var a={};if(te(n,i,a),"string"==typeof t&&(t=document.querySelector(t)),t){var l=[].map.call(n.childNodes,(function(e){return e}));try{for(var c=s(l),d=c.next();!d.done;d=c.next()){var u=d.value;t.appendChild(u)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}}return a},oe=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=[],i=0;i<e.length;i++)o.push(e[i]),t[i]&&o.push(t[i].toString());return o.join("")},ie=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return re(oe.apply(void 0,c([e],l(t))))},ne=function(){this.date_format=!1,this.string_format=!1,this.fraction_format=!1,this.twelve_hour=!1,this.fraction_denominator=0,this.fraction_integer=!0,this.fraction_align=0,this.fraction_denominator_digits=0,this.integer_min_digits=0,this.decimal_min_digits=0,this.decimal_max_digits=0,this.grouping=!1,this.has_number_format=!1,this.prefix=[{text:""}],this.suffix=[{text:""}],this.scaling=0,this.percent=!1,this.exponential=!1,this.has_asterisk=!1};!function(e){e[e.Integer=0]="Integer",e[e.Decimal=1]="Decimal"}(W||(W={}));var ae,se=function(){function e(){}return e.Parse=function(e){if(this.pattern=e,this.characters=e.split("").map((function(e){return e.charCodeAt(0)})),this.char_index=0,this.current_section=new ne,this.sections=[this.current_section],this.ParseDatePattern())return this.sections;for(this.char_index=0,this.current_section=new ne,this.sections=[this.current_section];this.char_index<this.characters.length;)this.ConsumeChar();return this.sections},e.ConsumeString=function(){var e="";for(this.preserve_formatting_characters&&(e+=this.pattern[this.char_index]),++this.char_index;this.char_index<this.characters.length;this.char_index++)switch(this.characters[this.char_index]){case 92:this.preserve_formatting_characters&&(e+=this.pattern[this.char_index]),this.char_index+1<this.characters.length&&(e+=this.pattern[++this.char_index]);break;case 34:return this.preserve_formatting_characters&&(e+=this.pattern[this.char_index]),this.char_index++,e;default:e+=this.pattern[this.char_index]}throw new Error("unterminated string")},e.ConsumeFormatting=function(){var e="";for(++this.char_index;this.char_index<this.characters.length;this.char_index++)switch(this.characters[this.char_index]){case 92:throw new Error("invalid escape character in formatting block");case 93:return this.char_index++,e;default:e+=this.pattern[this.char_index]}throw new Error("unterminated format")},e.ScanFractionFormat=function(){var e=this.pattern.substr(this.char_index).match(/^([#?]+ +){0,1}([#?]+)\/([#?0-9]+)(?:$|[^#?0-9])/);if(!e)return!1;var t=(e[1]||"").length+e[2].length+e[3].length+1;this.current_section.fraction_format=!0,this.current_section.fraction_integer=!!e[1];var r=Number(e[3]);return isNaN(r)||(this.current_section.fraction_denominator=r),this.current_section.decimal_max_digits=this.current_section.fraction_denominator_digits=e[3].length,this.char_index+=t,this.current_section.has_number_format=!0,!0},e.ConsumeNumberFormat=function(){var e=W.Integer;for(this.char_index;this.char_index<this.characters.length;this.char_index++)switch(this.characters[this.char_index]){case this.group_separator:for(var t=!1,r=this.char_index+1;!t&&r<this.characters.length;r++){var o=this.characters[r];if(o===this.decimal_mark||35===o||48===o)t=!0;else if(44!==o)break}if(t){if(e===W.Decimal)throw new Error("invalid grouping in decimal part");this.current_section.grouping=!0}else this.current_section.scaling=1e3*(this.current_section.scaling||1);break;case this.decimal_mark:if(e===W.Decimal)throw new Error("too many decimal marks");e=W.Decimal;break;case 35:e===W.Decimal?this.current_section.decimal_max_digits++:this.current_section.integer_min_digits&&this.current_section.integer_min_digits++;break;case 48:e===W.Decimal?(this.current_section.decimal_max_digits++,this.current_section.decimal_min_digits=this.current_section.decimal_max_digits):this.current_section.integer_min_digits++;break;default:return}},e.AppendCharAsText=function(e){void 0===e&&(e=!0),this.current_section.has_number_format?this.current_section.suffix[this.current_section.suffix.length-1].text+=this.pattern[this.char_index]:this.current_section.prefix[this.current_section.prefix.length-1].text+=this.pattern[this.char_index],e&&this.char_index++},e.AppendString=function(e){this.current_section.has_number_format?this.current_section.suffix[this.current_section.suffix.length-1].text+=e:this.current_section.prefix[this.current_section.prefix.length-1].text+=e},e.AppendTextPart=function(e){this.current_section.has_number_format?(this.current_section.suffix.push(e),this.current_section.suffix.push({text:""})):(this.current_section.prefix.push(e),this.current_section.prefix.push({text:""}))},e.ConsumeChar=function(){var e=this.characters[this.char_index];if(63!==e&&35!==e||this.current_section.has_number_format||this.current_section.string_format||!this.ScanFractionFormat())switch(e){case 59:this.char_index++,this.current_section=new ne,3===this.sections.length&&(this.current_section.string_format=!0),this.sections.push(this.current_section);break;case 64:this.char_index++,this.AppendTextPart({text:"@",flag:T.literal}),this.current_section.string_format=!0;break;case 48:case 35:case 46:case 44:this.current_section.has_number_format||this.current_section.string_format?this.AppendCharAsText():(this.ConsumeNumberFormat(),this.current_section.has_number_format=!0);break;case 91:this.AppendTextPart({text:this.ConsumeFormatting(),flag:T.formatting});break;case 34:this.AppendString(this.ConsumeString());break;case 63:this.preserve_formatting_characters?this.AppendCharAsText():(this.AppendTextPart({text:"0",flag:T.hidden}),this.char_index++);break;case 95:if(this.preserve_formatting_characters)this.AppendCharAsText();else{if(++this.char_index>=this.characters.length)throw new Error("invalid pad character at end");this.AppendTextPart({text:this.pattern[this.char_index++],flag:T.hidden})}break;case 42:if(this.current_section.has_asterisk)throw new Error("we don't support multiple asterisks");if(this.preserve_formatting_characters)this.AppendCharAsText();else{if(++this.char_index>=this.characters.length)throw new Error("invalid pad character at end");this.AppendTextPart({text:this.pattern[this.char_index++],flag:T.padded}),this.current_section.has_asterisk=!0}break;case 101:case 69:this.current_section.percent||this.current_section.exponential||this.current_section.string_format?this.AppendCharAsText():(this.current_section.exponential=!0,this.char_index++);break;case 37:this.current_section.exponential||this.current_section.string_format||(this.current_section.percent=!0),this.AppendCharAsText();break;case 92:if(this.preserve_formatting_characters&&this.AppendCharAsText(!1),++this.char_index>=this.characters.length)throw new Error("invalid escape character at end");this.AppendCharAsText();break;default:this.AppendCharAsText()}},e.ParseDatePattern=function(){var e,t,r,o,i=this;for(this.date_pattern=!0;this.date_pattern&&this.char_index<this.pattern.length;)this.DatePatternConsumeChar();if(this.date_pattern){this.date_pattern=!1;try{for(var n=s(this.sections),a=n.next();!a.done;a=n.next()){var l=a.value;try{for(var c=(r=void 0,s(l.prefix)),d=c.next();!d.done;d=c.next()){var u=d.value;u.flag&&u.flag&(T.date_component|T.date_component_minutes)&&(this.date_pattern=!0)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}return this.date_pattern&&(this.sections[0].date_format=!0,this.sections[0].prefix.forEach((function(e,t){if(e.flag===T.date_component&&("mm"===e.text||"m"===e.text)){if(t)for(var r=t-1;r;r--)if((o=i.sections[0].prefix[r]).flag===T.date_component){/h/i.test(o.text)&&(e.flag=T.date_component_minutes,e.text=e.text.toLowerCase());break}if(t<i.sections[0].prefix.length-1)for(r=t+1;r<i.sections[0].prefix.length;r++){var o;if((o=i.sections[0].prefix[r]).flag===T.date_component){/s/i.test(o.text)&&(e.flag=T.date_component_minutes,e.text=e.text.toLowerCase());break}}}}))),this.date_pattern},e.ConsumeDatePart=function(){for(var e=this.pattern[this.char_index++],t=e.toLowerCase(),r={text:e,flag:T.date_component};this.pattern[this.char_index]&&this.pattern[this.char_index].toLowerCase()===t;)r.text+=this.pattern[this.char_index++];if("s"===t&&"."===this.pattern[this.char_index])for(r.text+=this.pattern[this.char_index++];"0"===this.pattern[this.char_index];)r.text+=this.pattern[this.char_index++];return r},e.ConsumeAMPM=function(){var e=this.pattern.substr(this.char_index,5);return"am/pm"===e||"AM/PM"===e?(this.char_index+=5,this.sections[0].twelve_hour=!0,{text:e,flag:T.date_component}):"a/p"===(e=this.pattern.substr(this.char_index,3))||"A/P"===e?(this.char_index+=3,this.sections[0].twelve_hour=!0,{text:e,flag:T.date_component}):void 0},e.DatePatternConsumeChar=function(){switch(this.characters[this.char_index]){case 59:this.char_index=this.characters.length;break;case 48:case 35:case 101:case 69:case 37:case 64:this.date_pattern=!1;break;case 72:case 104:case 77:case 109:case 83:case 115:case 68:case 100:case 89:case 121:this.AppendTextPart(this.ConsumeDatePart());break;case 65:case 97:var e=this.ConsumeAMPM();e?this.AppendTextPart(e):this.AppendCharAsText();break;case 34:this.AppendString(this.ConsumeString());break;case 63:this.preserve_formatting_characters?this.AppendCharAsText():(this.AppendTextPart({text:"0",flag:T.hidden}),this.char_index++);break;case 95:if(this.preserve_formatting_characters)this.AppendCharAsText();else{if(++this.char_index>=this.characters.length)throw new Error("invalid pad character at end");this.AppendTextPart({text:this.pattern[this.char_index++],flag:T.hidden})}break;case 42:if(this.current_section.has_asterisk)throw new Error("we don't support multiple asterisks");if(this.preserve_formatting_characters)this.AppendCharAsText();else{if(++this.char_index>=this.characters.length)throw new Error("invalid pad character at end");this.AppendTextPart({text:this.pattern[this.char_index++],flag:T.padded}),this.current_section.has_asterisk=!0}break;case 92:if(this.preserve_formatting_characters&&this.AppendCharAsText(!1),++this.char_index>=this.characters.length)throw new Error("invalid escape character at end");this.AppendCharAsText();break;default:this.AppendCharAsText()}},e.date_pattern=!1,e.pattern="",e.char_index=0,e.characters=[],e.sections=[],e.current_section=new ne,e.preserve_formatting_characters=!1,e.decimal_mark=46,e.group_separator=44,e}(),le=function(e){return e>=60&&e--,new Date(864e5*e-22090752e5)},ce=function(e,t){if(void 0===t&&(t=!0),t){var r=new Date(e),o=new Date;o.setUTCMilliseconds(r.getUTCMilliseconds()),o.setUTCSeconds(r.getUTCSeconds()),o.setUTCMinutes(r.getUTCMinutes()),o.setUTCHours(r.getHours()),o.setUTCDate(r.getDate()),o.setUTCMonth(r.getMonth()),o.setUTCFullYear(r.getFullYear()),e=o.getTime()}return(e=(e+22090752e5)/864e5)>=60&&e++,e},de=function(){function e(e){var t,r;if(this._pattern="",this.decimal_zero_regexp=[],this.cloned=[],this.magic_decimal=!1,this._pattern=e,this.sections=se.Parse(e),this.sections.length||(this.sections=[]),this.sections[0]||(this.sections[0]=new ne),this.sections[1]||(this.sections[1]=o({},this.sections[0]),this.sections[1].prefix=JSON.parse(JSON.stringify(this.sections[1].prefix)),this.sections[1].suffix=JSON.parse(JSON.stringify(this.sections[1].suffix)),this.sections[1].prefix.push({text:"-"}),this.cloned[1]=!0),this.sections[2]||(this.sections[2]=o({},this.sections[0]),this.cloned[2]=!0),!this.sections[3])try{for(var i=s(this.sections[0].prefix),n=i.next();!n.done;n=i.next())if(n.value.flag===T.literal){this.sections[3]=o({},this.sections[0]),this.sections[3].string_format=!0,this.cloned[3]=!0;break}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}this.decimal_zero_regexp=this.sections.map((function(e){if(e.decimal_max_digits>e.decimal_min_digits)return new RegExp("0{1,"+(e.decimal_max_digits-e.decimal_min_digits)+"}(?:$|e)")}))}return e.FormatPartsAsText=function(e,t){void 0===t&&(t=0);var r=-1,o=e.map((function(e,t){switch(e.flag){case T.padded:return r=t,e.text;case T.hidden:return e.text.replace(/./g," ");case T.formatting:return"";default:return e.text}}));if(r>=0&&t){for(var i=o.reduce((function(e,t,o){return o===r?e:e+t.length}),0),n="",a=0;a<t-i;a++)n+=o[r];o[r]=n}return o.join("")},Object.defineProperty(e.prototype,"pattern",{get:function(){return this._pattern},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"date_format",{get:function(){return this.sections[0]&&this.sections[0].date_format},enumerable:!1,configurable:!0}),e.prototype.IncreaseDecimal=function(){this.sections.forEach((function(e){e.decimal_min_digits++,e.decimal_max_digits=e.decimal_min_digits}))},e.prototype.DecreaseDecimal=function(){this.sections.forEach((function(e){e.decimal_min_digits=Math.max(0,e.decimal_min_digits-1),e.decimal_max_digits=e.decimal_min_digits}))},e.prototype.AddGrouping=function(){this.sections.forEach((function(e){e.grouping=!0}))},e.prototype.RemoveGrouping=function(){this.sections.forEach((function(e){e.grouping=!1}))},e.prototype.ToggleGrouping=function(){var e=!this.sections[0].grouping;this.sections.forEach((function(t){t.grouping=e}))},e.prototype.toString=function(){var e=this;return this.sections[0].date_format?this._pattern:this.sections.filter((function(t,r){return!e.cloned[r]})).map((function(e){var t="",r=0;if(e.fraction_format){e.fraction_integer&&(t+="? ");for(var o="",i=0;i<e.fraction_denominator_digits;i++)o+="#";t+=o,t+="/",e.fraction_denominator?t+=e.fraction_denominator:t+=o}else if(e.has_number_format){for(r=0;r<e.integer_min_digits;r++)t+="0";if(e.grouping&&(t.length<4&&(t=("####"+t).slice(-4)),t=t.replace(/[\d#]{1,3}(?=([\d#]{3})+(?![\d#]))/g,"$&,")),e.decimal_max_digits||e.decimal_min_digits){for(t+=".",r=0;r<e.decimal_min_digits;r++)t+="0";for(;r<e.decimal_max_digits;r++)t+="#"}if(e.scaling){var n=Math.log10(e.scaling)/3;for(r=0;r<n;r++)t+=","}e.exponential&&(t+="e")}return e.prefix.map((function(e){return e.flag===T.hidden?"0"===e.text?"?":"_"+e.text:e.flag===T.padded?"*"+e.text:e.flag===T.formatting?"["+e.text+"]":e.text})).join("")+t+e.suffix.map((function(e){return e.flag===T.hidden?"0"===e.text?"?":"_"+e.text:e.flag===T.padded?"*"+e.text:e.text})).join("")})).join(";")},e.prototype.FormatComplex=function(t){var r=!!t.imaginary;r&&(r=this.FormatParts(t.imaginary).some((function(e){return/[1-9]/.test(e.text)})));var o=!!t.real;o&&(o=this.FormatParts(t.real).some((function(e){return/[1-9]/.test(e.text)})));var i=[];return o||!o&&!r?(i.push.apply(i,c([],l(this.FormatParts(t.real)))),r&&(Math.abs(t.imaginary),i.push({text:t.imaginary<0?" "+e.minus_character+" ":" + "}),i.push.apply(i,c(c([],l(this.FormatParts(Math.abs(t.imaginary)))),[{text:e.imaginary_character}])))):r&&i.push.apply(i,c(c([],l(this.FormatParts(t.imaginary))),[{text:e.imaginary_character}])),i},e.prototype.FormatParts=function(e){var t,r;if("number"!=typeof e&&!this.sections[3])return[{text:e.toString()}];var i=this.BaseFormat(e),n=i.parts,a=i.section,d=[];if(a.date_format||a.string_format)try{for(var u=s(n),h=u.next();!h.done;h=u.next()){var f=h.value;"string"==typeof f?d.push({text:f}):d.push(f)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}else this.magic_decimal&&""===n[1]&&n.splice(1,1),d=c(c(c([],l(a.prefix.map((function(e){return o({},e)})))),[{text:a.has_number_format?n.join(M.decimal_separator):""}]),l(a.suffix.map((function(e){return o({},e)}))));for(var p=1;p<d.length;p++)d[p].flag===d[p-1].flag&&(d[p].text=d[p-1].text+d[p].text,d[p-1].text="");return d.filter((function(e){return e.text}))},e.prototype.Format=function(t,r){return void 0===r&&(r=0),e.FormatPartsAsText(this.FormatParts(t),r)},e.prototype.ZeroPad=function(e,t){for(;e.length<t;)e="0"+e;return e},e.prototype.DateFormat=function(e){var t=this,r=le(e),i=this.sections[0],n=r.getUTCHours();return i.twelve_hour&&(n>12&&(n-=12),0===n&&(n=12)),{parts:i.prefix.map((function(e){if(e.flag===T.date_component_minutes)return"mm"===e.text?{text:t.ZeroPad(r.getUTCMinutes().toString(),2)}:{text:t.ZeroPad(r.getUTCMinutes().toString(),1)};if(e.flag===T.date_component){switch(e.text.toLowerCase()){case"am/pm":case"a/p":var i=e.text.split("/");return{text:r.getUTCHours()>12?i[1]:i[0]};case"mmmmm":return{text:M.date_components.long_months[r.getUTCMonth()][0]};case"mmmm":return"MMMM"===e.text?{text:M.date_components.long_months[r.getUTCMonth()].toUpperCase()}:{text:M.date_components.long_months[r.getUTCMonth()]};case"mmm":return"MMM"===e.text?{text:M.date_components.short_months[r.getUTCMonth()].toUpperCase()}:{text:M.date_components.short_months[r.getUTCMonth()]};case"mm":return{text:t.ZeroPad((r.getUTCMonth()+1).toString(),2)};case"m":return{text:t.ZeroPad((r.getUTCMonth()+1).toString(),1)};case"ddddd":case"dddd":return"DDDDD"===e.text||"DDDD"===e.text?{text:M.date_components.long_days[r.getUTCDay()].toUpperCase()}:{text:M.date_components.long_days[r.getUTCDay()]};case"ddd":return"DDD"===e.text?{text:M.date_components.short_days[r.getUTCDay()].toUpperCase()}:{text:M.date_components.short_days[r.getUTCDay()]};case"dd":return{text:t.ZeroPad(r.getUTCDate().toString(),2)};case"d":return{text:t.ZeroPad(r.getUTCDate().toString(),1)};case"yyyy":case"yyy":return{text:r.getUTCFullYear().toString()};case"yy":case"y":return{text:t.ZeroPad((r.getUTCFullYear()%100).toString(),2)};case"hh":return{text:t.ZeroPad(n.toString(),2)};case"h":return{text:t.ZeroPad(n.toString(),1)};case"ss":return{text:t.ZeroPad(r.getUTCSeconds().toString(),2)};case"s":return{text:t.ZeroPad(r.getUTCSeconds().toString(),1)}}var a=e.text.match(/^(s+)\.(0+)$/);if(a)return{text:t.ZeroPad(r.getUTCSeconds().toString(),a[1].length)+M.decimal_separator+(r.getUTCMilliseconds()/1e3).toFixed(a[2].length).substr(2)}}return o({},e)})),section:i}},e.prototype.StringFormat=function(e,t){var r,i,n=[];try{for(var a=s(t.prefix),l=a.next();!l.done;l=a.next()){var c=l.value;c.flag===T.literal?n.push({text:e}):n.push(o({},c))}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return{parts:n,section:t}},e.prototype.Round2=function(e,t){var r=Math.pow(10,t);return Math.round(r*e)/r},e.prototype.FormatFraction=function(t,r){r.percent&&(t*=100);var o={denominator:1,numerator:Math.round(t),error:Math.abs(Math.round(t)-t)};if(r.fraction_denominator)o.denominator=r.fraction_denominator,o.numerator=Math.round(t*o.denominator);else if(o.error)for(var i=e.fraction_limits[r.fraction_denominator_digits-1]||e.fraction_limits[0],n=2;n<=i;n++){var a=Math.round(t*n),s=Math.abs(a/n-t);if(s<o.error&&(o={numerator:a,denominator:n,error:s},!s))break}var l=[];if(r.fraction_integer){var c=Math.floor(o.numerator/o.denominator);o.numerator%=o.denominator,!c&&o.numerator||(l.push(c.toString()),o.numerator&&l.push(" "))}else o.numerator||l.push("0");return o.numerator&&(l.push(o.numerator.toString()),l.push("/"),l.push(o.denominator.toString())),l.join("")},e.prototype.BaseFormat=function(t){if(this.sections[0].date_format)return this.DateFormat(Number(t));if("number"!=typeof t)return this.StringFormat(t.toString(),this.sections[3]);var r=this.sections[0],o=this.decimal_zero_regexp[0];t<0&&(r=this.sections[1]);var i=r.percent?r.decimal_max_digits+2:r.decimal_max_digits,n=Math.pow(10,-i)/2,a=Math.abs(t);if(a<n&&(r=this.sections[2],o=this.decimal_zero_regexp[2]),r.scaling&&(a/=r.scaling)<n&&(r=this.sections[2],o=this.decimal_zero_regexp[2]),r.string_format)return this.StringFormat(t.toString(),r);var s="";if(r.fraction_format)return{parts:[this.FormatFraction(a,r)],section:r};r.exponential?s=a.toExponential(r.decimal_max_digits):(r.percent&&(a*=100),s=this.Round2(a,r.decimal_max_digits).toFixed(r.decimal_max_digits)),o&&(s=s.replace(o,""));for(var l=s.split(".");l[0].length<r.integer_min_digits;)l[0]=("0000000000000000"+l[0]).slice(-r.integer_min_digits);return 0===r.integer_min_digits&&"0"===l[0]&&(l[0]=""),r.grouping&&(l[0]=l[0].replace(e.grouping_regexp,"$&"+M.grouping_separator)),{parts:l,section:r}},e.grouping_regexp=/\d{1,3}(?=(\d{3})+(?!\d))/g,e.fraction_limits=[9,99,999,9999],e.imaginary_character="𝑖",e.minus_character="-",e}(),ue=function(){function e(){}return e.Get=function(e,t){if(void 0===t&&(t=!1),t&&"General"===e)return this.complex_general;var r=this.symbolc_name_map[e.toLowerCase()],o=this.cache[r||e];return o||(o=new de(e),this.cache[e]=o),o},e.Equals=function(e,t){if(e===t)return!0;var r=this.Get(e),o=this.Get(t);return r.pattern===o.pattern},e.Translate=function(e){var t=this.symbolc_name_map[e.toLowerCase()];return t?this.cache[t].toString():e},e.SymbolicName=function(e){var t,r;try{for(var o=s(Object.keys(this.base_formats)),i=o.next();!i.done;i=o.next()){var n=i.value;if(e===this.base_formats[n])return n}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return null},e.InitCache=function(){var e,t,r,o;try{for(var i=s(Object.keys(this.base_formats)),n=i.next();!n.done;n=i.next()){var a=n.value;this.cache[a]=new de(this.base_formats[a]),this.symbolc_name_map[a.toLowerCase()]=a}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.cache.General.magic_decimal=!0,this.complex_general=new de("0.###"),this.complex_general.magic_decimal=!0;try{for(var l=s(Object.keys(this.aliases)),c=l.next();!c.done;c=l.next())a=c.value,this.cache[a]=this.cache[this.aliases[a]],this.symbolc_name_map[a.toLowerCase()]=a}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}},e.cache={},e.symbolc_name_map={},e.base_formats={Accounting:"_(#,##0.00_);(#,##0.00);-???",Number:"0.00",Integer:"0",Percent:"0.00%",General:"0.######",Fraction:"# ?/?",Dollar:"$* _(#,##0.00_);$* (#,##0.00);$* -???",Exponential:"0.000e","Short Date":"mm/dd/yy","Long Date":"dddd, mmm d yyyy",Timestamp:"mm-dd-yy hh:mm:ss"},e.aliases={Scientific:"Exponential",Percentage:"Percent",Currency:"Dollar"},e}();ue.InitCache(),function(e){e[e.None=0]="None",e[e.Nan=1]="Nan",e[e.Exponential=2]="Exponential",e[e.Percent=4]="Percent",e[e.Currency=8]="Currency",e[e.Grouping=16]="Grouping",e[e.Parens=32]="Parens",e[e.Date=64]="Date",e[e.Time=128]="Time"}(ae||(ae={}));var he,fe=(new Date).getUTCFullYear(),pe=new(function(){function e(){}return e.prototype.TestDate=function(e){var t,r,o,i,n,a,c=Date.parse(e);if(isNaN(c))return!1;var d=new Date(c),u=e.replace(/[\d\-\\/,.\s]+/g," ").toLocaleLowerCase().split(/\s+/).map((function(e){return e.trim()})).filter((function(e){return!!e}));if(!u.length)return c;if(!this.compare_month){this.compare_month={};for(var h=0;h<12;h++)this.compare_month[M.date_components.long_months[h].toLocaleLowerCase().replace(/\./,"")]=h,this.compare_month[M.date_components.short_months[h].toLocaleLowerCase().replace(/\./,"")]=h}if(!this.compare_day)for(this.compare_day={},h=0;h<7;h++)this.compare_day[M.date_components.long_days[h].toLocaleLowerCase().replace(/\./,"")]=h,this.compare_day[M.date_components.short_days[h].toLocaleLowerCase().replace(/\./,"")]=h;var f=!1,p=!1;try{for(var m=s(u),v=m.next();!v.done;v=m.next()){var y=v.value,_=!1;try{for(var g=(o=void 0,s(Object.entries(this.compare_month))),b=g.next();!b.done;b=g.next()){var w=l(b.value,2),x=w[0],C=w[1];if(y===x){if(f)return!1;if(d.getUTCMonth()!==C)return!1;_=!0,f=!0}}}catch(e){o={error:e}}finally{try{b&&!b.done&&(i=g.return)&&i.call(g)}finally{if(o)throw o.error}}if(!_)try{for(var S=(n=void 0,s(Object.entries(this.compare_day))),A=S.next();!A.done;A=S.next()){var k=l(A.value,2),R=k[0];if(C=k[1],y===R){if(p)return!1;if(d.getUTCDay()!==C)return!1;_=!0,p=!0}}}catch(e){n={error:e}}finally{try{A&&!A.done&&(a=S.return)&&a.call(S)}finally{if(n)throw n.error}}if(!_)return!1}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}return!(p&&!f)&&c},e.prototype.TryParse=function(e){void 0===e&&(e="");var t=ae.None;if("'"===e[0])return{value:e,type:u.string};if(""===e)return{value:e,type:u.string};if("NaN"===e)return{value:NaN,type:u.number,hints:ae.Nan};var r=e.trim(),o=r.match(/^[$](.*?)$/);o&&(r=o[1],t|=ae.Currency);var i=r.match(/^\((.*?)\)$/);i&&(r=i[1],t|=ae.Parens);var n=r.match(/^(.*?)%\s*$/);n&&(r=n[1],t|=ae.Percent),"."===M.decimal_separator?/,/.test(r)&&(r=r.replace(/,/g,""),t|=ae.Grouping):r=(r=(r=r.replace(/(\d)\s+/g,"$1")).replace(/\./g,"")).replace(/,/,".");var a=Number(r);if(null===a||isNaN(a)){var s=e.toLowerCase();if("false"===s)return{value:!1,type:u.boolean};if("true"===s)return{value:!0,type:u.boolean};var l=this.TestDate(e);if(!1!==l&&!isNaN(l)){var c=new Date(l),d=c.getUTCFullYear();if(d>=fe-200&&d<=fe+200)return t=ae.Date,(c.getHours()||c.getMinutes()||c.getSeconds())&&(t|=ae.Time),{value:ce(l),type:u.number,hints:t}}return{value:e,type:u.string}}if(i&&(a=-a),n){var h=a<0?-1:1,f=(h*a).toString().split(".");f[0]=("00"+f[0]).replace(/(\d\d)$/,".$1"),a=Number(f.join(""))*h}return/e/.test(e)&&(t|=ae.Exponential),{value:a,type:u.number,hints:t}},e}()),me="http://www.w3.org/2000/svg",ve=function(){function e(e,t,r){void 0===r&&(r={x:0,y:0}),this.theme=t,this.offset=r,this.g=document.createElementNS(me,"g"),this.g.setAttribute("transform","translate("+r.x+", "+r.y+")"),this.outline=document.createElementNS(me,"rect"),this.outline.setAttribute("class","outline"),e?(this.g.setAttribute("class","selection primary-selection"),this.fill=document.createElementNS(me,"path"),this.fill.setAttribute("class","fill"),this.nub=document.createElementNS(me,"rect"),this.nub.setAttribute("class","nub"),this.g.appendChild(this.fill),this.g.appendChild(this.outline),this.g.appendChild(this.nub)):(this.g.setAttribute("class","selection alternate-selection"),this.fill=document.createElementNS(me,"rect"),this.fill.setAttribute("class","fill"),this.g.appendChild(this.fill),this.g.appendChild(this.outline))}return e.prototype.Offset=function(e){this.g.setAttribute("transform","translate("+e.x+", "+e.y+")")},e.prototype.Show=function(e){void 0===e&&(e=!0),this.g.style.display=e?"block":"none"},e.prototype.SetOutline=function(e,t){void 0===t&&(t=!1),this.outline.setAttribute("x",(e.left-1).toString()),this.outline.setAttribute("y",(e.top-1).toString()),this.outline.setAttribute("width",(e.width+1).toString()),this.outline.setAttribute("height",(e.height+1).toString()),t&&this.fill&&(this.fill.setAttribute("x",e.left.toString()),this.fill.setAttribute("y",e.top.toString()),this.fill.setAttribute("width",e.width.toString()),this.fill.setAttribute("height",e.height.toString()))},e.prototype.SetFill=function(e,t){if(this.fill){var r=[];r.push("M"+e.left+" "+e.top),r.push("L"+e.left+" "+e.bottom),r.push("L"+e.right+" "+e.bottom),r.push("L"+e.right+" "+e.top),r.push("Z"),r.push("M"+t.left+" "+t.top),r.push("L"+t.right+" "+t.top),r.push("L"+t.right+" "+t.bottom),r.push("L"+t.left+" "+t.bottom),r.push("Z"),this.fill.setAttribute("d",r.join(" "))}},e.prototype.SetNub=function(e){this.nub&&(this.nub.setAttribute("x",(e.left+e.width-4).toString()),this.nub.setAttribute("y",(e.top+e.height-4).toString()),this.nub.setAttribute("width","7"),this.nub.setAttribute("height","7"))},e}(),ye="http://www.w3.org/2000/svg";!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(he||(he={}));var _e=function(){function e(e,t,r){this.theme=e,this.container=t,this.orientation=r,this.g=document.createElementNS(ye,"g"),this.g.setAttribute("class","header-overlay"),this.overlay=document.createElementNS(ye,"rect"),this.overlay.setAttribute("class","overlay"),this.highlight=document.createElementNS(ye,"rect"),this.highlight.setAttribute("class","highlight"),this.g.style.display="none",this.g.appendChild(this.highlight),this.g.appendChild(this.overlay),t.appendChild(this.g)}return e.prototype.Remove=function(){this.container.removeChild(this.g)},e.prototype.Hide=function(){this.g.style.display="none"},e.prototype.Show=function(e,t,r,o){this.overlay.setAttribute("x",e.toString()),this.overlay.setAttribute("y",t.toString()),this.overlay.setAttribute("width",r.toString()),this.overlay.setAttribute("height",o.toString()),this.orientation===he.Horizontal?(this.highlight.setAttribute("x",e.toString()),this.highlight.setAttribute("y",(t+o-2).toString()),this.highlight.setAttribute("width",r.toString()),this.highlight.setAttribute("height","2")):(this.highlight.setAttribute("x",(e+r-2).toString()),this.highlight.setAttribute("y",t.toString()),this.highlight.setAttribute("width","2"),this.highlight.setAttribute("height",o.toString())),this.g.style.display="block"},e}(),ge=function(){function e(e,t,r,o,i){this.theme=e,this.layout=t,this.model=r,this.primary_selection=o,this.additional_selections=i,this.nub_rectangle=new L(-1,-1,0,0),this.grid_selections=[],this.row_header_selections=[],this.column_header_selections=[],this.corner_selections=[],this.cached_additional_selections=""}return e.prototype.Initialize=function(){this.row_overlay=new _e(this.theme,this.layout.row_header_selection,he.Horizontal),this.column_overlay=new _e(this.theme,this.layout.column_header_selection,he.Vertical),this.corner_row_overlay=new _e(this.theme,this.layout.corner_selection,he.Horizontal),this.corner_column_overlay=new _e(this.theme,this.layout.corner_selection,he.Vertical)},e.prototype.RenderSelections=function(e,t){var r,i;void 0===e&&(e=!0),void 0===t&&(t=!0);var n=this.primary_selection.empty;e||(this.primary_selection.empty=!0);var a=[this.primary_selection].concat(this.additional_selections);this.RenderSelectionGroup(a,this.layout.grid_selection,void 0,void 0,this.grid_selections,void 0,t);var l=new L(-1,-1,0,0);if(!this.primary_selection.empty){var c=this.model.active_sheet.RealArea(this.primary_selection.area);l=this.layout.CellAddressToRectangle(c.start).Combine(this.layout.CellAddressToRectangle(c.end))}if(!this.primary_selection.empty&&this.layout.header_offset.y>2?(this.row_overlay.Show(l.left,0,l.width,this.layout.header_offset.y),this.corner_row_overlay.Show(l.left+this.layout.header_offset.x,0,l.width,this.layout.header_offset.y)):(this.row_overlay.Hide(),this.corner_row_overlay.Hide()),!this.primary_selection.empty&&this.layout.header_offset.x>2?(this.column_overlay.Show(0,l.top,this.layout.header_offset.x,l.height),this.corner_column_overlay.Show(0,l.top+this.layout.header_offset.y,this.layout.header_offset.x,l.height)):(this.column_overlay.Hide(),this.corner_column_overlay.Hide()),this.model.active_sheet.freeze.columns||this.model.active_sheet.freeze.rows){var d=[],u=[];if(this.primary_selection.empty)d.push(!1),u.push(!1);else{var h=this.primary_selection.area.start;d.push(h.row<=this.model.active_sheet.freeze.rows||h.row===1/0),u.push(h.column<=this.model.active_sheet.freeze.columns||h.column===1/0)}try{for(var f=s(this.additional_selections),p=f.next();!p.done;p=f.next())c=p.value.area,d.push(c.start.row<=this.model.active_sheet.freeze.rows||c.start.row===1/0),u.push(c.start.column<=this.model.active_sheet.freeze.columns||c.start.column===1/0)}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}this.model.active_sheet.freeze.rows&&this.RenderSelectionGroup(a,this.layout.row_header_selection,d,void 0,this.row_header_selections,{x:0,y:this.layout.header_offset.y}),this.model.active_sheet.freeze.columns&&this.RenderSelectionGroup(a,this.layout.column_header_selection,u,void 0,this.column_header_selections,{x:this.layout.header_offset.x,y:0}),this.model.active_sheet.freeze.rows&&this.model.active_sheet.freeze.columns&&this.RenderSelectionGroup(a,this.layout.corner_selection,u,d,this.corner_selections,o({},this.layout.header_offset)),this.primary_selection.empty=n}else this.primary_selection.empty=n},e.prototype.RenderSelectionGroup=function(e,t,r,o,i,n,a){void 0===a&&(a=!0);for(var s=0;s<e.length;s++)if(e[s].area.start.sheet_id&&e[s].area.start.sheet_id!==this.model.active_sheet.id||e[s].empty||r&&!r[s]||o&&!o[s])i[s]&&i[s].Show(!1);else if(a||!e[s].rendered){var l=this.EnsureGridSelectionBlock(t,i,s,n);this.RenderSVGSelection(e[s],l,s)}for(s=e.length;s<i.length;s++)i[s]&&i[s].Show(!1)},e.prototype.EnsureGridSelectionBlock=function(e,t,r,o){var i=t[r];if(!i)if(i=new ve(!r,this.theme),t[r]=i,r){var n=e.querySelector(".alternate-selections");n||((n=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("class","alternate-selections"),e.appendChild(n)),null==n||n.appendChild(i.g)}else e.appendChild(i.g);return o&&i.Offset(o),i},e.prototype.ClampEnd=function(e){return{row:Math.min(e.row,this.model.active_sheet.rows-1),column:Math.min(e.column,this.model.active_sheet.columns-1)}},e.prototype.RenderSVGSelection=function(e,t,r){void 0===r&&(r=0);var o=this.model.active_sheet.RealArea(e.area,!0),i=this.layout.CellAddressToRectangle(o.start);if(o.count>1?i=i.Combine(this.layout.CellAddressToRectangle(o.end)):r&&(n=this.model.active_sheet.CellData(e.target)).merge_area&&(i=(i=this.layout.CellAddressToRectangle(n.merge_area.start)).Combine(this.layout.CellAddressToRectangle(n.merge_area.end))),r||(this.nub_rectangle=new L(i.left+i.width-6,i.top+i.height-6,11,11)),0===i.top&&this.layout.header_offset.y<=1&&(i.top=1,i.height-=1),0===i.left&&this.layout.header_offset.x<=1&&(i.left=1,i.width-=1),i.height<=0||i.height<=0)t.Show(!1);else{if(t.SetOutline(i,!!r),r)e.rendered=!0;else{var n,a=this.layout.CellAddressToRectangle(e.target);(n=this.model.active_sheet.CellData(e.target)).merge_area&&(a=(a=this.layout.CellAddressToRectangle(n.merge_area.start)).Combine(this.layout.CellAddressToRectangle(n.merge_area.end))),t.SetFill(a,i),t.SetNub(i)}t.Show()}},e}();function be(e,t,r,o){var i,n,a;void 0===t&&(t=[]),"string"==typeof t&&(t=[t]);var l=function(e){e.stopPropagation(),e.preventDefault(),a(),o&&o(e)},c=function(e){if(e.stopPropagation(),e.preventDefault(),!e.buttons)return a(),void(o&&o(e));r&&r(e)};a=function(){var r,o;e.style.display="none",e.removeEventListener("mousemove",c),e.removeEventListener("mouseup",l);try{for(var i=s(t),n=i.next();!n.done;n=i.next()){var a=n.value;e.classList.remove(a)}}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}};try{for(var d=s(t),u=d.next();!u.done;u=d.next()){var h=u.value;e.classList.add(h)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}e.style.display="block",r&&e.addEventListener("mousemove",c),o&&e.addEventListener("mouseup",l)}var we,xe=function(e){function r(t,r,o,i,n){var a=e.call(this)||this;return a.layout=t,a.model=r,a.options=o,a.theme=i,a.grid_container=n,a.scale=1,a.dragging=!1,a.double_click_data={},a._visible=!1,a.scale=a.options.initial_scale||1,a.Init(n),a}return t(r,e),Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},enumerable:!1,configurable:!0}),r.prototype.IsDoubleClick=function(e,t){var r=this;return void 0===t&&(t=300),this.double_click_data.index===e?(clearTimeout(this.double_click_data.timeout),this.double_click_data.index=void 0,this.double_click_data.timeout=void 0,!0):(this.double_click_data.timeout&&clearTimeout(this.double_click_data.timeout),this.double_click_data.index=e,this.double_click_data.timeout=setTimeout((function(){r.double_click_data.index=void 0,r.double_click_data.timeout=void 0}),t),!1)},r.prototype.Hide=function(){this.Show(!1)},r.prototype.Show=function(e){var t,r;void 0===e&&(e=!0),this.container&&(this._visible=e,e?(this.grid_container.classList.add("treb-tab-bar-layout"),null===(t=this.grid_container.parentElement)||void 0===t||t.classList.add("has-tab-bar"),this.container.style.display="flex"):(this.grid_container.classList.remove("treb-tab-bar-layout"),null===(r=this.grid_container.parentElement)||void 0===r||r.classList.remove("has-tab-bar"),this.container.style.display="none"))},r.prototype.SetActive=function(e,t){t?e.classList.add("selected"):e.classList.remove("selected")},r.prototype.UpdateScale=function(e){this.scale_label&&(this.scale=e,this.scale_label.textContent=Math.round(1e3*e)/10+"%")},r.prototype.Update=function(){var e,t,r,o,i,n=this;if(!this.dragging&&this.node){if("auto"===this.options.tab_bar){if(this.model.sheets.reduce((function(e,t){return t.visible?e+1:e}),0)<=1)return void this.Show(!1);this.Show(!0)}this.grid_container.classList.add("treb-tab-bar-layout"),null===(i=this.grid_container.parentElement)||void 0===i||i.classList.add("has-tab-bar");var a=this.node,c=!1,d=Array.prototype.map.call(a.children,(function(e){return e}));try{for(var u=s(d),h=u.next();!h.done;h=u.next()){var f=h.value;f.dataset.preserve?c=!0:a.removeChild(f)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}if(!c){var p=document.createElement("div");if(p.classList.add("tab-bar-spacer"),p.style.order="9998",p.dataset.preserve="true",a.appendChild(p),(p=document.createElement("div")).classList.add("tab-bar-end"),p.style.order="9999",p.dataset.preserve="true",this.options.scale_control){var m=document.createElement("div");m.classList.add("treb-scale-control");var v=document.createElement("button");v.innerHTML="<svg viewBox='0 0 16 16'><path d='M4,8 h8'/></svg>",v.title="Decrease scale",v.addEventListener("click",(function(){return n.Publish({type:"scale",action:"decrease"})})),m.appendChild(v),this.scale_label=document.createElement("div"),m.appendChild(this.scale_label),this.UpdateScale(this.scale),(v=document.createElement("button")).innerHTML="<svg viewBox='0 0 16 16'><path d='M4,8 h8 M8,4 v8'/></svg>",v.title="Increase scale",v.addEventListener("click",(function(){return n.Publish({type:"scale",action:"increase"})})),m.appendChild(v),p.appendChild(m)}a.appendChild(p)}if(this.options.delete_tab){var y=document.createElement("div");y.classList.add("delete-tab"),y.innerHTML="<svg viewbox='0 0 16 16'><path d='M4,4 L12,12 M12,4 L4,12'/></svg>",y.style.order=(-1).toString(),y.title="Delete current sheet",y.addEventListener("click",(function(){n.Publish({type:"delete-sheet"})})),a.appendChild(y)}var _=[],g=function(e){if(!e.visible)return"continue";var t=_.length,r=document.createElement("div");r.classList.add("tab"),r.style.order=(2*t).toString(),b.SetActive(r,e===b.model.active_sheet);var o=function(o){var i,a;if(o.stopPropagation(),o.preventDefault(),!n.IsDoubleClick(t)){n.Publish({type:"activate-sheet",sheet:e});var c=_.map((function(e){return e.getBoundingClientRect()})),d=2*t-1,u=c[0].left,h=c[c.length-1].right,f=c[0].top,p=c[0].bottom,m=2*(c.length-1)+1;try{for(var v=(i=void 0,s(_)),y=v.next();!y.done;y=v.next()){var g=y.value;n.SetActive(g,g===r)}}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}n.dragging=!0,be(n.layout.mask,[],(function(e){var o=l([e.clientX,e.clientY],2),i=o[0],n=o[1];if(n>f&&n<p){var a=d;if(i<u)a=-1;else if(i>h)a=m;else for(var s=0;s<c.length;s++){var v=c[s];if(i>=v.left&&i<=v.right){s!==t&&(a=i>=v.left+v.width/2?2*s+1:2*s-1);break}}a!==d&&(d=a,r.style.order=d.toString(),c=_.map((function(e){return e.getBoundingClientRect()})))}}),(function(){var e=t,r=(d+1)/2;n.dragging=!1;for(var o=0;o<n.model.sheets.length;o++)n.model.sheets[o].visible||(e>=o&&e++,r>=o&&r++);e===r||0===e&&r<=0||e===_.length-1&&r>=_.length-1||n.Publish({type:"reorder-sheet",index:e,move_before:r})}))}},i=function(){r.removeEventListener("mousedown",o),r.removeEventListener("dblclick",i),r.contentEditable="true";var t=window.getSelection();if(t){t.removeAllRanges();var a=document.createRange();a.selectNodeContents(r),t.addRange(a)}r.addEventListener("keydown",(function(t){switch(t.key){case"Enter":n.Publish({type:"rename-sheet",name:r.innerText.trim(),sheet:e});break;case"Escape":r.innerText=e.name,n.Publish({type:"cancel"});break;default:return}t.stopPropagation(),t.preventDefault()})),r.addEventListener("focusout",(function(){var t=r.innerText.trim();n.Publish({type:"rename-sheet",name:t,sheet:e})})),r.focus()};r.textContent=e.name,r.addEventListener("dblclick",i),r.addEventListener("mousedown",o),a.appendChild(r),_.push(r)},b=this;try{for(var w=s(this.model.sheets),x=w.next();!x.done;x=w.next())g(x.value)}catch(e){r={error:e}}finally{try{x&&!x.done&&(o=w.return)&&o.call(w)}finally{if(r)throw r.error}}if(this.options.add_tab){var C=document.createElement("a");C.classList.add("add-tab"),C.style.order=(2*this.model.sheets.length).toString(),C.innerText="+",C.title="Add sheet",C.addEventListener("click",(function(){n.Publish({type:"add-sheet"})})),a.appendChild(C)}}},r.prototype.Init=function(e){this.container=document.createElement("div"),this.container.classList.add("treb-tab-bar-container"),e.appendChild(this.container),this.node=document.createElement("div"),this.node.classList.add("treb-tab-bar"),this.container.appendChild(this.node)},r}(X),Ce=100,Se=function(){function e(e){var t,r;void 0===e&&(e={}),this.key_=Ce++,this.data={},this.type="",this.temp={},this.inflated=!1,this.resizable=!0,this.movable=!0,this.removable=!0,this.selectable=!0,this.move_with_cells=!0,this.resize_with_cells=!0,this.formula="";try{for(var o=s(Object.keys(this)),i=o.next();!i.done;i=o.next()){var n=i.value;"layout"!==n&&e[n]&&(this[n]=e[n])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}e.layout&&(this.layout=JSON.parse(JSON.stringify(e.layout))),e.rect&&(this.rect=L.Create(e.rect))}return Object.defineProperty(e.prototype,"key",{get:function(){return this.key_},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e={};return this.data&&(e.data=this.data),this.formula&&(e.formula=this.formula),this.type&&(e.type=this.type),this.resizable||(e.resizable=this.resizable),this.movable||(e.movable=this.movable),this.removable||(e.removable=this.removable),this.selectable||(e.selectable=this.selectable),this.move_with_cells||(e.move_with_cells=this.move_with_cells),this.resize_with_cells||(e.resize_with_cells=this.resize_with_cells),this.layout&&(e.layout=this.layout),this.extent&&(e.extent=this.extent),e},e}(),Ae=function(){function e(t){this.annotations=[],this.freeze={rows:0,columns:0},this.visible=!0,this.default_column_width=100,this.default_row_height=25,this.cells=new k,this.selection={target:{row:0,column:0},area:new f({row:0,column:0}),empty:!0},this.scroll_offset={x:0,y:0},this.name=e.default_sheet_name,this.row_height_=[],this.column_width_=[],this.row_headers=[],this.column_headers=[],this.row_header_width=100,this.column_header_height=25,this.style_map=[],this.style_json_map=[],this.sheet_style={},this.row_styles={},this.column_styles={},this.row_pattern=[],this.cell_style=[],this.default_style_properties=t,this.default_column_width=100,this.row_header_width=60,this.UpdateDefaultRowHeight(),this.id_=e.base_id++}return e.Reset=function(){this.base_id=100},e.Blank=function(t,r,o,i){void 0===o&&(o=30),void 0===i&&(i=20);var n=new e(t);return r&&(n.name=r),o=Math.max(o,1),i=Math.max(i,1),n.cells.EnsureCell({row:o-1,column:i-1}),n},e.FromJSON=function(t,r,i){var n,a,l,c,d,u,h,f,p,m,v,y,_,g,b,w,x,C,k,M,R;R="string"==typeof t?JSON.parse(t):t;var T=function(e,t){Object.keys(t).forEach((function(r){var o=Number(r)||0;e[o]=t[r]}))};i||(i=new e(r)),R.default_column_width&&(i.default_column_width=R.default_column_width),R.default_row_height&&(i.default_row_height=R.default_row_height),R.id&&(i.id=R.id),R.name&&(i.name=R.name);var L=function(e){var t=e;t.text_color&&("none"!==t.text_color&&(t.text={text:t.text_color}),t.text_color=void 0),t.background&&("none"!==t.background&&(t.fill={text:t.background}),t.background=void 0),t.border_top_color&&("none"!==t.border_top_color&&(t.border_top_fill={text:t.border_top_color}),t.border_top_color=void 0),t.border_left_color&&("none"!==t.border_left_color&&(t.border_left_fill={text:t.border_left_color}),t.border_left_color=void 0),t.border_bottom_color&&("none"!==t.border_bottom_color&&(t.border_bottom_fill={text:t.border_bottom_color}),t.border_bottom_color=void 0),t.border_right_color&&("none"!==t.border_right_color&&(t.border_right_fill={text:t.border_right_color}),t.border_right_color=void 0)},E=R.cell_style_refs;try{for(var z=s(E),D=z.next();!D.done;D=z.next())L($=D.value)}catch(e){n={error:e}}finally{try{D&&!D.done&&(a=z.return)&&a.call(z)}finally{if(n)throw n.error}}if(i.cell_style=[],E&&(R.cell_styles||[]).forEach((function(e){"number"==typeof e.ref&&(e.style=JSON.parse(JSON.stringify(E[e.ref])))})),i.cells.FromJSON(R.data),R.rows&&i.cells.EnsureRow(R.rows-1),R.columns&&i.cells.EnsureColumn(R.columns-1),R.data)if(S(R.data))try{for(var P=s(R.data),N=P.next();!N.done;N=P.next())($=N.value).style_ref&&(i.cell_style[$.column]||(i.cell_style[$.column]=[]),i.cell_style[$.column][$.row]=JSON.parse(JSON.stringify(E[$.style_ref])))}catch(e){l={error:e}}finally{try{N&&!N.done&&(c=P.return)&&c.call(P)}finally{if(l)throw l.error}}else if(A(R.data))try{for(var F=s(R.data),I=F.next();!I.done;I=F.next()){var U=(B=I.value).row;try{for(var O=(h=void 0,s(B.cells)),V=O.next();!V.done;V=O.next()){var H=($=V.value).column;$.style_ref&&(i.cell_style[H]||(i.cell_style[H]=[]),i.cell_style[H][U]=JSON.parse(JSON.stringify(E[$.style_ref])))}}catch(e){h={error:e}}finally{try{V&&!V.done&&(f=O.return)&&f.call(O)}finally{if(h)throw h.error}}}}catch(e){d={error:e}}finally{try{I&&!I.done&&(u=F.return)&&u.call(F)}finally{if(d)throw d.error}}else try{for(var j=s(R.data),G=j.next();!G.done;G=j.next()){var B;H=(B=G.value).column;try{for(var Z=(v=void 0,s(B.cells)),J=Z.next();!J.done;J=Z.next())U=($=J.value).row,$.style_ref&&(i.cell_style[H]||(i.cell_style[H]=[]),i.cell_style[H][U]=JSON.parse(JSON.stringify(E[$.style_ref])))}catch(e){v={error:e}}finally{try{J&&!J.done&&(y=Z.return)&&y.call(Z)}finally{if(v)throw v.error}}}}catch(e){p={error:e}}finally{try{G&&!G.done&&(m=j.return)&&m.call(j)}finally{if(p)throw p.error}}i.freeze.rows=0,i.freeze.columns=0,R.freeze&&(i.freeze.rows=R.freeze.rows||0,i.freeze.columns=R.freeze.columns||0),i.scroll_offset=R.scroll?o({},R.scroll):{x:0,y:0};try{for(var q=s(R.cell_styles||[]),W=q.next();!W.done;W=q.next()){var K=W.value;K.style&&(i.cell_style[K.column]||(i.cell_style[K.column]=[]),i.cell_style[K.column][K.row]=K.style)}}catch(e){_={error:e}}finally{try{W&&!W.done&&(g=q.return)&&g.call(q)}finally{if(_)throw _.error}}i.sheet_style=R.sheet_style||{},i.row_styles=R.row_style,i.column_styles=R.column_style,i.row_pattern=R.row_pattern||[],L(i.sheet_style||{});try{for(var X=s(i.row_pattern),Y=X.next();!Y.done;Y=X.next()){var $;L($=Y.value)}}catch(e){b={error:e}}finally{try{Y&&!Y.done&&(w=X.return)&&w.call(X)}finally{if(b)throw b.error}}try{for(var Q=s(Object.keys(i.column_styles)),ee=Q.next();!ee.done;ee=Q.next()){var te=ee.value;L(i.column_styles[te])}}catch(e){x={error:e}}finally{try{ee&&!ee.done&&(C=Q.return)&&C.call(Q)}finally{if(x)throw x.error}}try{for(var re=s(Object.keys(i.row_styles)),oe=re.next();!oe.done;oe=re.next())te=oe.value,L(i.row_styles[te])}catch(e){k={error:e}}finally{try{oe&&!oe.done&&(M=re.return)&&M.call(re)}finally{if(k)throw k.error}}return i.row_height_=[],T(i.row_height_,R.row_height||{}),i.row_height_.length&&i.cells.EnsureRow(i.row_height_.length-1),i.column_width_=[],T(i.column_width_,R.column_width||{}),i.column_width_.length&&i.cells.EnsureColumn(i.column_width_.length-1),i.annotations=(R.annotations||[]).map((function(e){return new Se(e)})),R.selection&&(i.selection=JSON.parse(JSON.stringify(R.selection))),i.visible=!0,void 0!==R.visible&&(i.visible=!!R.visible),i},Object.defineProperty(e.prototype,"header_offset",{get:function(){return{x:this.row_header_width,y:this.column_header_height}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this.cells.rows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this.cells.columns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.id_},set:function(t){this.id_=t,this.id>=e.base_id&&(e.base_id=this.id+1)},enumerable:!1,configurable:!0}),e.prototype.MergeCells=function(e){e=e.Clone(),this.cells.Apply(e,(function(t,r,o){t.merge_area=e,t.render_dirty=!0,r===e.start.column&&o===e.start.row||t.Reset()}),!0)},e.prototype.UnmergeCells=function(e){var t=!0;this.cells.Apply(e,(function(r){t=t&&!!r.merge_area&&e.Equals(r.merge_area)}),!1),t?this.cells.Apply(e,(function(e){e.merge_area=void 0,e.render_dirty=!0}),!1):console.warn("area mismatch")},e.prototype.StyleFontSize=function(e,t){void 0===t&&(t={});var r=e.font_size_value||0,o=0;switch(e.font_size_unit){case"px":r*=.75;break;case"em":o=e.font_size_value||1;break;case"%":o=(e.font_size_value||100)/100}return o&&(r=o*(t.font_size_value||10),"px"===t.font_size_unit&&(r*=.75)),r||10},e.prototype.UpdateDefaultRowHeight=function(){var e=R.Composite([this.default_style_properties,this.sheet_style]);if("undefined"!=typeof window){var t=$.MeasureText(R.Font(e),"M"),r=Math.round(1.4*t.height);this.default_row_height<r&&(this.default_row_height=r)}},e.prototype.SetRowHeaders=function(e){this.row_headers=e.map((function(e){return void 0===e?"":e.toString()})),this.row_headers&&this.cells.EnsureRow(this.row_headers.length-1)},e.prototype.SetColumnHeaders=function(e){this.column_headers=e.map((function(e){return void 0===e?"":e.toString()})),e&&this.cells.EnsureColumn(e.length-1)},e.prototype.RowHeader=function(e){return this.row_headers?this.row_headers.length>e?this.row_headers[e]:"":e+1},e.prototype.ColumnHeader=function(e){var t="";if(this.column_headers)return this.column_headers.length>e?this.column_headers[e]:"";for(;;){var r=e%26;if(t=String.fromCharCode(65+r)+t,!(e=Math.floor(e/26)))break;e--}return t},e.prototype.GetRowHeight=function(e){var t=this.row_height_[e];return void 0===t?this.default_row_height:t},e.prototype.SetRowHeight=function(e,t){return this.row_height_[e]=t,this.cells.EnsureRow(e),t},e.prototype.GetColumnWidth=function(e){var t=this.column_width_[e];return void 0===t?this.default_column_width:t},e.prototype.SetColumnWidth=function(e,t){return this.column_width_[e]=t,this.cells.EnsureColumn(e),t},e.prototype.Delta=function(e,t){var r,o,i={},n=c(c([],l(Object.keys(e))),l(Object.keys(t)));try{for(var a=s(n),d=a.next();!d.done;d=a.next()){var u=d.value,h=e[u],f=t[u];"object"==typeof h&&"object"==typeof f?JSON.stringify(h)!==JSON.stringify(f)&&(i[u]=f):h!==f&&(i[u]=f)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return i},e.prototype.UpdateCellStyle=function(e,t,r){void 0===r&&(r=!0);var o=e.row,i=e.column;this.cell_style[i]||(this.cell_style[i]=[]);var n=this.CompositeStyleForCell(e,!1,!1),a=R.Composite([this.default_style_properties,n,R.Merge(this.cell_style[i][o]||{},t,r)]),s=this.Delta(n,a);this.cell_style[i][o]=s,this.CellData(e).FlushStyle()},e.prototype.Invalidate=function(e){this.cells.Apply(this.RealArea(e),(function(e){return e.render_dirty=!0}))},e.prototype.UpdateAreaStyle=function(e,t,r){var o=this;if(void 0===t&&(t={}),void 0===r&&(r=!0),e)if(e.entire_sheet)this.UpdateSheetStyle(t,r);else if(e.entire_column)for(var i=e.start.column;i<=e.end.column;i++)this.UpdateColumnStyle(i,t,r);else if(e.entire_row)for(var n=e.start.row;n<=e.end.row;n++)this.UpdateRowStyle(n,t,r);else e.Array().forEach((function(e){return o.UpdateCellStyle(e,t,r)}))},e.prototype.HasCellStyle=function(e){return!!(this.cell_style[e.column]&&this.cell_style[e.column][e.row]||this.row_styles[e.row]||this.column_styles[e.column]||this.row_pattern.length)},e.prototype.NextVisibleColumn=function(e){for(++e;0===this.column_width_[e];e++);return e},e.prototype.PreviousVisibleColumn=function(e){for(--e;e>=0&&0===this.column_width_[e];e--);return e},e.prototype.NextVisibleRow=function(e){for(++e;0===this.row_height_[e];e++);return e},e.prototype.PreviousVisibleRow=function(e){for(--e;e>=0&&0===this.row_height_[e];e--);return e},e.prototype.SurroundingStyle=function(e){for(var t=[{},{},{},{},{},{},{},{},{},{}],r=e.column+1,o=e.column-1,i=e.row+1,n=e.row-1;0===this.column_width_[r];r++);for(;0===this.row_height_[i];i++);for(;o>=0&&0===this.column_width_[o];o--);for(;n>=0&&0===this.row_height_[n];n--);return o>=0&&n>=0&&(t[7]=this.CellStyleData({row:n,column:o})||{}),o>=0&&(t[4]=this.CellStyleData({row:e.row,column:o})||{},t[1]=this.CellStyleData({row:i,column:o})||{}),n>=0&&(t[8]=this.CellStyleData({row:n,column:e.column})||{},t[9]=this.CellStyleData({row:n,column:r})||{}),t[6]=this.CellStyleData({row:e.row,column:r})||{},t[2]=this.CellStyleData({row:i,column:e.column})||{},t[3]=this.CellStyleData({row:i,column:r})||{},t},e.prototype.CellStyleData=function(e){var t=this.cells.GetCell(e);if(t){if(!t.style){var r=this.GetStyleIndex(this.CompositeStyleForCell(e));t.style=this.style_map[r]}return t.style}},e.prototype.GetCopyStyle=function(e){return this.CompositeStyleForCell(e,!0,!1)},e.prototype.CellData=function(e){var t,r,o=this.cells.EnsureCell(e);if(o.rendered_type)return o;if(o.calculated_type?(r=o.calculated,t=o.calculated_type):(r=o.value,t=o.type),!o.style){var i=this.GetStyleIndex(this.CompositeStyleForCell(e));o.style=this.style_map[i]}if(t&&null!=r)if(t===u.number)isNaN(r)?o.formatted=void 0===o.style.nan?"NaN":o.style.nan:o.formatted=this.FormatNumber(r,o.style.number_format),o.rendered_type=u.number;else if(t===u.error)o.formatted="#"+(r||"ERR?"),o.rendered_type=u.error;else if(t===u.boolean)o.formatted=r.toString().toUpperCase(),o.rendered_type=u.boolean;else if(t===u.formula&&void 0===o.calculated)o.formatted="",o.rendered_type=u.string;else if(t===u.complex){var n=r;if(isNaN(n.real)||isNaN(n.imaginary))o.formatted=void 0===o.style.nan?"NaN":o.style.nan;else{var a=ue.Get(o.style.number_format||"",!0);o.formatted=a.FormatComplex(n)}o.rendered_type=u.complex}else o.formatted=this.FormatNumber(r,o.style.number_format),o.rendered_type=u.string;else o.formatted="",o.rendered_type=u.string;return o},e.prototype.FormatNumber=function(e,t){void 0===t&&(t="");var r=ue.Get(t).FormatParts(e);return r.length?1!==r.length||r[0].flag?r:r[0].text||"":""},e.prototype.SetHeaderSize=function(e,t){void 0===e&&(e=60),void 0===t&&(t=this.default_row_height),this.row_header_width=e,this.column_header_height=t},e.prototype.AutoSizeRow=function(e,t){void 0===t&&(t={});for(var r=this.default_row_height,o=0;o<this.cells.columns;o++){var i=this.CellData({row:e,column:o}),n=i.style,a=i.formatted||"";if("string"!=typeof a&&(a=a.map((function(e){return e.text})).join("")),n&&a&&a.length){var s=a.split(/\n/),l=this.StyleFontSize(n,t);r=Math.max(r,((l||10)+9)*s.length)}}this.SetRowHeight(e,r)},e.prototype.AutoSizeColumn=function(t,r){void 0===r&&(r=!0),e.measurement_canvas||(e.measurement_canvas=document.createElement("canvas"));var o=e.measurement_canvas.getContext("2d");if(o){var i=12;r||(i=this.GetColumnWidth(t));for(var n=0;n<this.cells.rows;n++){var a=this.CellData({row:n,column:t}),s=a.formatted||"";"string"!=typeof s&&(s=s.map((function(e){return e.text})).join("")),s&&s.length&&(o.font=R.Font(a.style||{}),i=Math.max(i,Math.ceil(o.measureText(s).width)+8))}this.SetColumnWidth(t,i)}},e.prototype.GetStyle=function(e){return this.style_map[e]},e.prototype.InsertRows=function(e,t){var r,o,i,n,a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),e)for(var l=0;l<this.cells.columns;l++){var c=this.cells.GetCell({row:e-1,column:l},!1);if(c&&c.area){var d=this.cells.GetCell({row:e,column:l},!1);if(d&&d.area&&d.area.Equals(c.area))return!1}}t<0?this.cells.DeleteRows(e,-t):this.cells.InsertRows(e,t);for(var u={},h={},p=e;p<this.cells.rows;p++)for(l=0;l<this.cells.columns;l++){var m=this.cells.GetCell({row:p,column:l},!1);m&&(m.area&&!h[m.area.spreadsheet_label]&&(h[m.area.spreadsheet_label]=m.area),m.merge_area&&!u[m.merge_area.spreadsheet_label]&&(u[m.merge_area.spreadsheet_label]=m.merge_area))}var v=function(e){var r=h[e],o=new f({row:r.start.row+t,column:r.start.column},{row:r.end.row+t,column:r.end.column});o.Iterate((function(e){a.cells.GetCell(e,!0).area=o}))};try{for(var y=s(Object.keys(h)),_=y.next();!_.done;_=y.next())v(_.value)}catch(e){r={error:e}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}var g=function(r){var o=u[r],i={row:o.start.row,column:o.start.column};o.start.row>=e&&(i.row+=t);var n=new f(i,{row:o.end.row+t,column:o.end.column});n.Iterate((function(e){a.cells.GetCell(e,!0).merge_area=n}))};try{for(var b=s(Object.keys(u)),w=b.next();!w.done;w=b.next())g(w.value)}catch(e){i={error:e}}finally{try{w&&!w.done&&(n=b.return)&&n.call(b)}finally{if(i)throw i.error}}var x=Object.keys(this.row_styles),C={};x.forEach((function(r){var o=Number(r);o<e?C[o]=a.row_styles[o]:t<0&&o<e-t||(C[o+t]=a.row_styles[o])})),this.row_styles=C;var S=[];if(t<0)S=[e,-t];else{S=[e,0];for(var A=0;A<t;A++)S.push(void 0)}return this.cell_style.forEach((function(t){t&&t.length>=e&&t.splice.apply(t,S)})),this.row_height_.splice.apply(this.row_height_,S),this.FlushCellStyles(),!0},e.prototype.InsertColumns=function(e,t){var r,o,i,n,a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),e)for(var l=0;l<this.cells.rows;l++){var c=this.cells.GetCell({row:l,column:e-1},!1);if(c&&c.area){var d=this.cells.GetCell({row:l,column:e},!1);if(d&&d.area&&d.area.Equals(c.area))return!1}}t<0?this.cells.DeleteColumns(e,-t):this.cells.InsertColumns(e,t);for(var u={},h={},p=e;p<this.cells.columns;p++)for(l=0;l<this.cells.rows;l++){var m=this.cells.GetCell({row:l,column:p},!1);m&&(m.area&&!h[m.area.spreadsheet_label]&&(h[m.area.spreadsheet_label]=m.area),m.merge_area&&!u[m.merge_area.spreadsheet_label]&&(u[m.merge_area.spreadsheet_label]=m.merge_area))}var v=function(e){var r=h[e],o=new f({row:r.start.row,column:r.start.column+t},{row:r.end.row,column:r.end.column+t});o.Iterate((function(e){a.cells.GetCell(e,!0).area=o}))};try{for(var y=s(Object.keys(h)),_=y.next();!_.done;_=y.next())v(_.value)}catch(e){r={error:e}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}var g=function(r){var o=u[r],i={row:o.start.row,column:o.start.column};o.start.column>=e&&(i.column+=t);var n=new f(i,{row:o.end.row,column:o.end.column+t});n.Iterate((function(e){a.cells.GetCell(e,!0).merge_area=n}))};try{for(var b=s(Object.keys(u)),w=b.next();!w.done;w=b.next())g(w.value)}catch(e){i={error:e}}finally{try{w&&!w.done&&(n=b.return)&&n.call(b)}finally{if(i)throw i.error}}var x=Object.keys(this.column_styles),C={};x.forEach((function(r){var o=Number(r);o<e?C[o]=a.column_styles[o]:t<0&&o<e-t||(C[o+t]=a.column_styles[o])})),this.column_styles=C;var S=[];if(t<0)S=[e,-t];else{S=[e,0];for(var A=0;A<t;A++)S.push(void 0)}return this.cell_style.splice.apply(this.cell_style,S),this.column_width_.splice.apply(this.column_width_,S),this.FlushCellStyles(),!0},e.prototype.ClearArea=function(e){e=this.RealArea(e),this.cells.Apply(e,(function(e){return e.Reset()}))},e.prototype.SetAreaValues2=function(e,t){e=this.RealArea(e),this.cells.SetArea(e,t)},e.prototype.SetArrayValue=function(e,t){e=this.RealArea(e),this.cells.Apply(e,(function(t){return t.SetArray(e)}),!0),this.cells.GetCell(e.start,!0).SetArrayHead(e,t)},e.prototype.SetCellValue=function(e,t){this.cells.GetCell(e,!0).Set(t)},e.prototype.RealArea=function(e,t){void 0===t&&(t=!1);var r=e.start,o=e.end;return e.entire_row&&(r.column=0,r.absolute_column=!1,o.column=this.cells.columns-1,o.absolute_column=!1),e.entire_column&&(r.row=0,r.absolute_row=!1,o.row=this.cells.rows-1,o.absolute_row=!1),t&&(o.row>=this.rows&&(o.row=this.rows-1,o.absolute_row=!1),o.column>=this.columns&&(o.column=this.columns-1,o.absolute_column=!1)),new f(r,o)},e.prototype.FormattedCellValue=function(e){var t=this.CellData(e);if(t)return"string"==typeof t.formatted?t.formatted:t.formatted?t.formatted.map((function(e){switch(e.flag){case 1:case 2:return" ";default:return e.text}})).join(""):t.value},e.prototype.GetFormattedRange=function(e,t){if(void 0===t&&(t=e),e.row===t.row&&e.column===t.column)return this.FormattedCellValue(e);for(var r=[],o=e.row;o<=t.row;o++){for(var i=[],n=e.column;n<=t.column;n++)i.push(this.FormattedCellValue({row:o,column:n}));r.push(i)}return r},e.prototype.NumberFormatsAndColors=function(e,t){var r,o,i,n,a,l,c=function(r){var o,i,n,a,s,l;r.number_format&&(t[r.number_format]=1),(null===(o=r.text)||void 0===o?void 0:o.text)&&"none"!==r.text.text&&(e[r.text.text]=1),(null===(i=r.fill)||void 0===i?void 0:i.text)&&(e[r.fill.text]=1),(null===(n=r.border_top_fill)||void 0===n?void 0:n.text)&&(e[r.border_top_fill.text]=1),(null===(a=r.border_left_fill)||void 0===a?void 0:a.text)&&(e[r.border_left_fill.text]=1),(null===(s=r.border_right_fill)||void 0===s?void 0:s.text)&&(e[r.border_right_fill.text]=1),(null===(l=r.border_bottom_fill)||void 0===l?void 0:l.text)&&(e[r.border_bottom_fill.text]=1)};for(var d in c(this.sheet_style),this.row_styles)c(this.row_styles[d]);for(var d in this.column_styles)c(this.column_styles[d]);try{for(var u=s(this.row_pattern),h=u.next();!h.done;h=u.next())c(_=h.value)}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}try{for(var f=s(this.cell_style),p=f.next();!p.done;p=f.next()){var m=p.value;if(m)try{for(var v=(a=void 0,s(m)),y=v.next();!y.done;y=v.next()){var _;(_=y.value)&&c(_)}}catch(e){a={error:e}}finally{try{y&&!y.done&&(l=v.return)&&l.call(v)}finally{if(a)throw a.error}}}}catch(e){i={error:e}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}},e.prototype.toJSON=function(e){var t,r,i,n,a,l,c,d,u,h,f;void 0===e&&(e={});for(var p=function(e,t){for(var r={},o=0;o<e.length;o++)void 0!==e[o]&&e[o]!==t&&(r[o]=e[o]);if(Object.keys(r).length)return r},m=[{}],v={},y=[],_=JSON.stringify({}),g=0;g<this.cell_style.length;g++)if(Y=this.cell_style[g]){y[g]=[];for(var b=0;b<Y.length;b++)if(Y[b]){var w=JSON.stringify(Y[b]);if(w!==_){var x=v[w];"number"!=typeof x&&(v[w]=x=m.length,m.push(Y[b])),y[g][b]=x}}}m=JSON.parse(JSON.stringify(m));var C=JSON.parse(JSON.stringify(this.sheet_style)),S=JSON.parse(JSON.stringify(this.row_styles)),A=JSON.parse(JSON.stringify(this.column_styles)),k=JSON.parse(JSON.stringify(this.row_pattern)),M=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var r=o(o({},t),e);return r.text?(r.text=$.MeasureColorARGB(r.text),r):"number"==typeof r.theme?r:void 0};if(e.export_colors){var T=[];try{for(var L=s([S,A,m,[C],k]),E=L.next();!E.done;E=L.next()){var z=E.value;if(Array.isArray(z))try{for(var D=(i=void 0,s(z)),P=D.next();!P.done;P=D.next()){var N=P.value;T.push(N)}}catch(e){i={error:e}}finally{try{P&&!P.done&&(n=D.return)&&n.call(D)}finally{if(i)throw i.error}}else try{for(var F=(a=void 0,s(Object.keys(z))),I=F.next();!I.done;I=F.next()){var U=I.value;T.push(z[U])}}catch(e){a={error:e}}finally{try{I&&!I.done&&(l=F.return)&&l.call(F)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{E&&!E.done&&(r=L.return)&&r.call(L)}finally{if(t)throw t.error}}try{for(var O=s(T),V=O.next();!V.done;V=O.next()){var H=V.value;H.border_top_fill=M(H.border_top_fill,R.DefaultProperties.border_top_fill),H.border_left_fill=M(H.border_left_fill,R.DefaultProperties.border_top_fill),H.border_right_fill=M(H.border_right_fill,R.DefaultProperties.border_top_fill),H.border_bottom_fill=M(H.border_bottom_fill,R.DefaultProperties.border_top_fill),(null===(f=H.fill)||void 0===f?void 0:f.text)&&(H.fill.text=$.MeasureColorARGB(H.fill.text)),H.text&&H.text.text&&"none"!==H.text.text&&(H.text.text=$.MeasureColorARGB(H.text.text))}}catch(e){c={error:e}}finally{try{V&&!V.done&&(d=O.return)&&d.call(O)}finally{if(c)throw c.error}}}var j={calculated_value:!!e.rendered_values,preserve_type:!!e.preserve_type,expand_arrays:!!e.expand_arrays,decorated_cells:!!e.decorated_cells,nested:!0,cell_style_refs:y},G=this.cells.toJSON(j),B=G.data,Z=G.rows,J=G.columns;e.shrink?(Z+=2,J+=1):(Z=this.rows,J=this.columns);try{for(var q=s(this.annotations),W=q.next();!W.done;W=q.next()){var K=W.value;K.extent||this.CalculateAnnotationExtent(K),K.extent&&(Z=Math.max(Z,K.extent.row+1),J=Math.max(J,K.extent.column+1))}}catch(e){u={error:e}}finally{try{W&&!W.done&&(h=q.return)&&h.call(q)}finally{if(u)throw u.error}}var X=[];for(g=0;g<y.length;g++){var Y;if(Y=y[g])for(b=0;b<Y.length;b++)Y[b]&&X.push({row:b,column:g,ref:Y[b]})}var Q={id:this.id,name:this.name,data:B,sheet_style:C,rows:Z,columns:J,cell_styles:X,cell_style_refs:m,row_style:S,column_style:A,row_pattern:k.length?k:void 0,default_row_height:this.default_row_height,default_column_width:this.default_column_width,row_height:p(this.row_height_,this.default_row_height),column_width:p(this.column_width_,this.default_column_width),selection:JSON.parse(JSON.stringify(this.selection)),annotations:JSON.parse(JSON.stringify(this.annotations))};return this.visible||(Q.visible=this.visible),(this.scroll_offset.x||this.scroll_offset.y)&&(Q.scroll=this.scroll_offset),(this.freeze.rows||this.freeze.columns)&&(Q.freeze=this.freeze),Q},e.prototype.FlushCellStyles=function(){this.style_map=[],this.style_json_map=[],this.cells.FlushCellStyles()},e.prototype.ImportData=function(e){var t,r,o,i,n=e.styles,a=e.sheet_style;a&&this.UpdateAreaStyle(new f({row:1/0,column:1/0},{row:1/0,column:1/0}),n[a]);var l=e.column_styles;if(l)for(var c=0;c<l.length;c++)l[c]&&this.UpdateAreaStyle(new f({row:1/0,column:c},{row:1/0,column:c}),n[l[c]]);this.cells.FromJSON(e.cells),e.name&&(this.name=e.name||"");var d=this.cell_style;try{for(var u=s(e.cells),h=u.next();!h.done;h=u.next()){var p=h.value;p.style_ref&&(d[p.column]||(d[p.column]=[]),d[p.column][p.row]=n[p.style_ref])}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}for(c=0;c<e.column_widths.length;c++)void 0!==e.column_widths[c]&&this.SetColumnWidth(c,e.column_widths[c]);for(c=0;c<e.row_heights.length;c++)void 0!==e.row_heights[c]&&this.SetRowHeight(c,e.row_heights[c]);try{for(var m=s(e.annotations||[]),v=m.next();!v.done;v=m.next()){var y=v.value;this.annotations.push(new Se(y))}}catch(e){o={error:e}}finally{try{v&&!v.done&&(i=m.return)&&i.call(m)}finally{if(o)throw o.error}}e.hidden&&(this.visible=!1)},e.prototype.CalculateAnnotationExtent=function(e){var t,r;if(e.layout)e.extent=o({},e.layout.br.address);else{e.extent={row:0,column:0};var i=null===(t=e.rect)||void 0===t?void 0:t.right;if(i&&this.default_column_width)for(var n=0;i>=0&&n<1e3;n++)if((i-=this.GetColumnWidth(n))<0){e.extent.column=n;break}var a=null===(r=e.rect)||void 0===r?void 0:r.bottom;if(a&&this.default_row_height)for(n=0;a>=0&&n<1e3;n++)if((a-=this.GetRowHeight(n))<0){e.extent.row=n;break}}},e.prototype.UpdateSheetStyle=function(e,t){var r,o,i,n,a,l,c,d,u=this;void 0===t&&(t=!0),this.sheet_style=R.Merge(this.sheet_style,e,t);var h=Object.keys(e);try{for(var f=s(this.cell_style),p=f.next();!p.done;p=f.next()){var m=p.value;if(m){var v=function(e){e&&h.forEach((function(t){return delete e[t]}))};try{for(var y=(i=void 0,s(m)),_=y.next();!_.done;_=y.next())v(_.value)}catch(e){i={error:e}}finally{try{_&&!_.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}var g=function(e){h.forEach((function(t){return delete u.row_styles[e][t]}))};try{for(var b=s(Object.keys(this.row_styles)),w=b.next();!w.done;w=b.next())g(w.value)}catch(e){a={error:e}}finally{try{w&&!w.done&&(l=b.return)&&l.call(b)}finally{if(a)throw a.error}}var x=function(e){h.forEach((function(t){return delete u.column_styles[e][t]}))};try{for(var C=s(Object.keys(this.column_styles)),S=C.next();!S.done;S=C.next())x(S.value)}catch(e){c={error:e}}finally{try{S&&!S.done&&(d=C.return)&&d.call(C)}finally{if(c)throw c.error}}this.FlushCellStyles()},e.prototype.UpdateRowStyle=function(e,t,r){var o,i,n,a;void 0===r&&(r=!0),this.row_styles[e]=R.Merge(this.row_styles[e]||{},t,r);var l=Object.keys(t),c=function(t){t&&t[e]&&l.forEach((function(r){return delete t[e][r]}))};try{for(var d=s(this.cell_style),u=d.next();!u.done;u=d.next())c(u.value)}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}for(var h=0;h<this.cells.columns;h++)if(this.column_styles[h]){var p=this.column_styles[h],m=this.cell_style[h]&&this.cell_style[h][e]||{};try{for(var v=(n=void 0,s(l)),y=v.next();!y.done;y=v.next()){var _=y.value;void 0!==p[_]&&(m[_]=t[_])}}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}Object.keys(m).length&&(this.cell_style[h]||(this.cell_style[h]=[]),this.cell_style[h][e]=JSON.parse(JSON.stringify(m)))}this.cells.Apply(this.RealArea(f.FromRow(e)),(function(e){return e.FlushStyle()}))},e.prototype.FlattenStyles=function(){this.CompositeStyleForCell},e.prototype.UpdateColumnStyle=function(e,t,r){var o,i;void 0===r&&(r=!0),this.column_styles[e]=R.Merge(this.column_styles[e]||{},t,r);var n=Object.keys(t);if(this.cell_style[e]){var a=function(e){e&&n.forEach((function(t){return delete e[t]}))};try{for(var l=s(this.cell_style[e]),c=l.next();!c.done;c=l.next())a(c.value)}catch(e){o={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}}this.cells.Apply(this.RealArea(f.FromColumn(e)),(function(e){return e.FlushStyle()}))},e.prototype.CompositeStyleForCell=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var o=e.row,i=e.column,n=[this.default_style_properties,this.sheet_style];return r&&this.row_pattern.length&&n.push(this.row_pattern[o%this.row_pattern.length]),this.row_styles[o]&&n.push(this.row_styles[o]),this.column_styles[i]&&n.push(this.column_styles[i]),t&&this.cell_style[i]&&this.cell_style[i][o]&&n.push(this.cell_style[i][o]),R.Composite(n)},e.prototype.GetStyleIndex=function(e){for(var t=JSON.stringify(e),r=0;r<this.style_json_map.length;r++)if(t===this.style_json_map[r])return r;var o=this.style_map.length;return this.style_map.push(JSON.parse(t)),this.style_json_map.push(t),o},e.base_id=100,e.default_sheet_name="Sheet1",e}(),ke=function(){function e(){}return e.CreateDiv=function(e,t,r){return void 0===e&&(e=""),this.Create("div",e,t,r)},e.Create=function(e,t,r,o){void 0===e&&(e=""),void 0===t&&(t="");var i=document.createElement(e);return t&&i.setAttribute("class",t),o&&i.setAttribute(o,""),r&&r.appendChild(i),i},e}(),Me="http://www.w3.org/2000/svg",Re=function(){function e(e){var t=this;this.model=e,this.grid_tiles=[],this.column_header_tiles=[],this.row_header_tiles=[],this.frozen_row_tiles=[],this.frozen_column_tiles=[],this.header_size={width:0,height:0},this.last_column=0,this.total_height=0,this.total_width=0,this.default_row_height=0,this.default_column_width=0,this.header_offset={x:0,y:0},this.dpr=Math.max(1,self.devicePixelRatio||1),this.scale=1,this.trident="undefined"!=typeof navigator&&navigator.userAgent&&/trident/i.test(navigator.userAgent),this.default_tile_size={width:1200,height:800},this.dropdown_caret_visible=!1,this.row_cache=[],this.column_cache=[],this.initialized=!1,this.mask=ke.CreateDiv("treb-mouse-mask"),this.tooltip=ke.CreateDiv("treb-tooltip"),this.dropdown_caret=document.createElementNS(Me,"svg"),this.dropdown_caret.setAttribute("class","treb-dropdown-caret"),this.dropdown_caret.setAttribute("viewBox","0 0 24 24"),this.dropdown_caret.tabIndex=-1;var r=document.createElementNS(Me,"path");r.setAttribute("d","M5,7 L12,17 L19,7"),this.dropdown_caret.appendChild(r),this.dropdown_caret.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),t.grid_cover.classList.remove("nub-select");var r=t.dropdown_caret.getAttribute("class")||"";/active/i.test(r)?t.dropdown_caret.setAttribute("class","treb-dropdown-caret"):(t.dropdown_caret.setAttribute("class","treb-dropdown-caret active"),t.dropdown_list.focus())})),this.dropdown_list=ke.CreateDiv("treb-dropdown-list"),this.dropdown_list.setAttribute("tabindex","-1"),this.dropdown_list.addEventListener("keydown",(function(e){var r,o=0;switch(e.key){case"ArrowDown":o=1;break;case"ArrowUp":o=-1;break;case"Escape":case"Enter":break;default:return void console.info(e.key)}if(e.stopPropagation(),e.preventDefault(),"Escape"===e.key||"Enter"===e.key)null===(r=t.container)||void 0===r||r.focus(),t.dropdown_caret.setAttribute("class","treb-dropdown-caret"),"Enter"===e.key&&t.dropdown_callback&&t.dropdown_selected&&t.dropdown_callback.call(0,t.dropdown_selected.dropdown_value);else if(o&&t.dropdown_selected)if(o>0&&t.dropdown_selected.nextSibling){t.dropdown_selected.nextSibling.classList.add("selected"),t.dropdown_selected.classList.remove("selected"),t.dropdown_selected=t.dropdown_selected.nextSibling;var i=t.dropdown_selected.offsetTop+t.dropdown_selected.offsetHeight;i>t.dropdown_list.offsetHeight+t.dropdown_list.scrollTop&&(t.dropdown_list.scrollTop=i-t.dropdown_list.offsetHeight)}else o<0&&t.dropdown_selected.previousSibling&&(t.dropdown_selected.previousSibling.classList.add("selected"),t.dropdown_selected.classList.remove("selected"),t.dropdown_selected=t.dropdown_selected.previousSibling,t.dropdown_selected.offsetTop<t.dropdown_list.scrollTop&&(t.dropdown_list.scrollTop=t.dropdown_selected.offsetTop))})),this.dropdown_list.addEventListener("mousedown",(function(e){var r,o=e.target;e.target!==t.dropdown_list&&(e.stopPropagation(),e.preventDefault(),null===(r=t.container)||void 0===r||r.focus(),t.dropdown_caret.setAttribute("class","treb-dropdown-caret"),t.dropdown_callback&&t.dropdown_callback.call(0,o.dropdown_value))})),this.dropdown_list.addEventListener("mousemove",(function(e){var r=e.target;r!==t.dropdown_selected&&(t.grid_cover.classList.remove("nub-select"),t.dropdown_selected&&t.dropdown_selected.classList.remove("selected"),r.classList.add("selected"),t.dropdown_selected=r)})),this.mock_selection=ke.CreateDiv("mock-selection-node"),this.mock_selection.innerHTML="&nbsp;",this.note_node=ke.CreateDiv("treb-note"),this.title_node=ke.CreateDiv("treb-hover-title"),this.HideNote()}return Object.defineProperty(e.prototype,"scroll_offset",{get:function(){return this.scroll_reference_node?{x:this.scroll_reference_node.scrollLeft,y:this.scroll_reference_node.scrollTop}:{x:0,y:0}},set:function(e){this.scroll_reference_node&&(this.scroll_reference_node.scrollLeft=e.x,this.scroll_reference_node.scrollTop=e.y)},enumerable:!1,configurable:!0}),e.prototype.ColumnWidth=function(e){return Math.round(this.model.active_sheet.GetColumnWidth(e)*this.scale)},e.prototype.RowHeight=function(e){return Math.round(this.model.active_sheet.GetRowHeight(e)*this.scale)},e.prototype.SetRowHeight=function(e,t){this.model.active_sheet.SetRowHeight(e,Math.round(t/this.scale))},e.prototype.SetColumnWidth=function(e,t){this.model.active_sheet.SetColumnWidth(e,Math.round(t/this.scale))},e.prototype.ShowSelections=function(e){void 0===e&&(e=!0),this.grid_selection.style.display=e?"block":"none"},e.prototype.HideTitle=function(){this.title_node.style.opacity="0"},e.prototype.ShowTitle=function(e,t,r){if(this.title_node.textContent=e,this.title_node.parentElement){this.title_node.getBoundingClientRect();var o=this.title_node.parentElement.getBoundingClientRect(),i=this.OffsetCellAddressToRectangle(t).Shift(this.header_size.width,this.header_size.height);this.title_node.style.left=o.left+i.left-this.scroll_reference_node.scrollLeft+0+"px",this.title_node.style.top=o.top+i.bottom-this.scroll_reference_node.scrollTop+8+"px",this.title_node.style.opacity="1"}},e.prototype.HideNote=function(){this.note_node.style.opacity="0",this.note_node.style.pointerEvents="none"},e.prototype.ShowNote=function(e,t,r){if(this.note_node.textContent=e,this.note_node.parentElement){var o=this.note_node.getBoundingClientRect(),i=this.note_node.parentElement.getBoundingClientRect(),n=this.OffsetCellAddressToRectangle(t).Shift(this.header_size.width,this.header_size.height);this.note_node.style.left=i.left+n.right-this.scroll_reference_node.scrollLeft+8+"px",this.note_node.style.top=i.top+n.top-this.scroll_reference_node.scrollTop-o.height/5-2+"px",this.note_node.style.opacity="1",this.note_node.style.pointerEvents="auto"}},e.prototype.AnnotationLayoutOrder=function(e,t){for(var r,o=-1,i=0;i<this.model.active_sheet.annotations.length;i++)if(this.model.active_sheet.annotations[i]===e){o=i;break}if(o<0)return!1;var n=Math.min(Math.max(0,o+t),this.model.active_sheet.annotations.length-1);if(n===o)return!1;for(this.model.active_sheet.annotations.splice(o,1),this.model.active_sheet.annotations.splice(n,0,e),i=0;i<this.model.active_sheet.annotations.length;i++){var a=this.model.active_sheet.annotations[i].key,s=null===(r=this.container)||void 0===r?void 0:r.querySelectorAll('.annotation[data-key="'+a+'"]');if(s)for(var l=0;l<(null==s?void 0:s.length);l++)s[l].style.zIndex=(i+1).toString()}return!0},e.prototype.PointToAnnotationCorner=function(e){var t=this.PointToAddress_Grid(e,void 0,!1),r=this.CellAddressToRectangle(t);return{address:t,offset:{x:(e.x-r.left)/r.width,y:(e.y-r.top)/r.height}}},e.prototype.RectToAnnotationLayout=function(e){return{tl:this.PointToAnnotationCorner({x:(e.left||0)+1,y:(e.top||0)+1}),br:this.PointToAnnotationCorner({x:e.right||e.left||100,y:e.bottom||e.top||100})}},e.prototype.AddressToAnnotationLayout=function(e,t){var r={tl:this.CellAddressToRectangle(e),br:this.CellAddressToRectangle(t)};return{tl:this.PointToAnnotationCorner({x:r.tl.left||0,y:r.tl.top||0}),br:this.PointToAnnotationCorner({x:r.br.right||r.tl.left||100,y:r.br.bottom||r.tl.left||100})}},e.prototype.AnnotationLayoutToRect=function(e){var t=this.CellAddressToRectangle(e.tl.address),r=this.CellAddressToRectangle(e.br.address),o=t.left+t.width*e.tl.offset.x-1,i=t.top+t.height*e.tl.offset.y-1;return new L(o,i,r.left+r.width*e.br.offset.x-o,r.top+r.height*e.br.offset.y-i)},e.prototype.UpdateAnnotation=function(e){var t,r;Array.isArray(e)||(e=[e]);try{for(var o=s(e),i=o.next();!i.done;i=o.next()){var n=i.value;if(n.node){if(n.node.dataset.scale=this.scale.toString(),n.node.style.fontSize=10*this.scale+"pt",n.rect&&!n.layout&&(n.scaled_rect=n.rect.Scale(this.scale),n.layout=this.RectToAnnotationLayout(n.scaled_rect)),n.layout){var a=this.AnnotationLayoutToRect(n.layout);a.ApplyStyle(n.node),n.scaled_rect=a}n.node.dataset.key=n.key.toString(),(this.model.active_sheet.freeze.rows||this.model.active_sheet.freeze.columns)&&this.CloneFrozenAnnotation(n)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.GetFrozenAnnotations=function(e){return[this.row_header_annotations,this.column_header_annotations,this.corner_annotations].map((function(t){return t.querySelector('.annotation[data-key="'+e.key+'"]')})).filter((function(e){return null!==e}))},e.prototype.CloneFrozenAnnotations=function(){var e,t;try{for(var r=s(this.model.active_sheet.annotations),o=r.next();!o.done;o=r.next()){var i=o.value;i.node&&i.key&&this.CloneFrozenAnnotation(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.ClearFrozenAnnotations=function(){var e,t,r;try{for(var o=s([this.row_header_annotations,this.column_header_annotations,this.corner_annotations]),i=o.next();!i.done;i=o.next())for(var n=i.value.querySelectorAll(".annotation"),a=0;a<n.length;a++)null===(r=n[a].parentElement)||void 0===r||r.removeChild(n[a])}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.RemoveFrozenAnnotation=function(e){var t,r,o;try{for(var i=s([this.row_header_annotations,this.column_header_annotations,this.corner_annotations]),n=i.next();!n.done;n=i.next()){var a=n.value.querySelector('.annotation[data-key="'+e.key+'"]');a&&(null===(o=a.parentElement)||void 0===o||o.removeChild(a))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.CloneFrozenAnnotation=function(e){var t,r,o,i,n=this,a=function(t){var r=t.querySelector('.annotation[data-key="'+e.key+'"]');if(r&&(null===(o=r.parentElement)||void 0===o||o.removeChild(r)),r=null===(i=e.node)||void 0===i?void 0:i.cloneNode(!0)){var a=r.querySelector(".annotation-move-target"),s=r.querySelector(".annotation-resize-target");r.addEventListener("mousedown",(function(t){var r=e.node;requestAnimationFrame((function(){null==r||r.focus()})),n.AnnotationMouseDown(e,e.node,t,a,s)})),t.appendChild(r)}};try{for(var l=s([this.row_header_annotations,this.column_header_annotations,this.corner_annotations]),c=l.next();!c.done;c=l.next())a(c.value)}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}},e.prototype.RemoveAnnotation=function(e){var t;e.node&&(null===(t=e.node.parentElement)||void 0===t||t.removeChild(e.node)),this.RemoveFrozenAnnotation(e)},e.prototype.RemoveAnnotationNodes=function(){var e,t,r=Array.prototype.map.call(this.annotation_container.children,(function(e){return e}));try{for(var o=s(r),i=o.next();!i.done;i=o.next()){var n=i.value;this.annotation_container.removeChild(n)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}(this.model.active_sheet.freeze.rows||this.model.active_sheet.freeze.columns)&&this.ClearFrozenAnnotations()},e.prototype.AddAnnotation=function(e){if(!e.node)throw new Error("annotation node missing");this.annotation_container.appendChild(e.node),this.UpdateAnnotation(e)},e.prototype.AnnotationMouseDown=function(e,t,r,o,i){var n=this,a=e.scaled_rect;return a?new Promise((function(d){var u,h={left:a.left,top:a.top,width:a.width,height:a.height},f=n.scroll_reference_node,p=f.getBoundingClientRect(),m=t.getBoundingClientRect();if(r.target!==o)if(r.target!==i)d();else{r.stopPropagation(),r.preventDefault(),t.focus();var v=0;(null===(u=e.data)||void 0===u?void 0:u.original_size)&&e.data.original_size.width&&e.data.original_size.height&&(v=e.data.original_size.width/e.data.original_size.height);var y=t.getBoundingClientRect(),_={x:y.left+r.offsetX-a.width+i.offsetLeft,y:y.top+r.offsetY-a.height+i.offsetTop};be(n.mask,"nw-resize",(function(r){var o,i,d=c([t],l(n.GetFrozenAnnotations(e)));if(a.height=r.offsetY-_.y,a.width=r.offsetX-_.x,r.shiftKey&&r.ctrlKey)v&&(Math.abs(a.width-h.width)<Math.abs(a.height-h.height)?a.width=v*a.height:a.height=a.width/v);else if(r.shiftKey)Math.abs(a.height-h.height)>Math.abs(a.width-h.width)?a.width=h.width:a.height=h.height;else if(r.ctrlKey){var u=n.ClampToGrid({x:a.right,y:a.bottom});a.width=u.x-a.left+1,a.height=u.y-a.top+1}try{for(var f=s(d),p=f.next();!p.done;p=f.next()){var m=p.value;m.style.height=a.height+"px",m.style.width=a.width+"px"}}catch(e){o={error:e}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(o)throw o.error}}}),(function(){e.extent=void 0,e.layout=n.RectToAnnotationLayout(a),d({type:"annotation",annotation:e,event:"resize"})}))}else{r.stopPropagation(),r.preventDefault(),t.focus();var g={x:m.left+r.offsetX-a.left,y:m.top+r.offsetY-a.top},b=c([t],l(n.GetFrozenAnnotations(e))),w=n.CellAddressToRectangle({row:0,column:0}).Combine(n.CellAddressToRectangle({row:n.model.active_sheet.rows-1,column:n.model.active_sheet.columns-1})).Expand(-1,-1);be(n.mask,"move",(function(e){var t,r;if(e.offsetY-p.top<n.header_offset.y){var o=Math.min(25,f.scrollTop);f.scrollTop-=o,g.y+=o}else e.offsetY-p.top>=p.height&&f.scrollTop+p.height<w.height&&(o=25,f.scrollTop+=o,g.y-=o);if(e.offsetX-p.left<n.header_offset.x?(o=Math.min(25,f.scrollLeft),f.scrollLeft-=o,g.x+=o):e.offsetX-p.left>=p.width&&f.scrollLeft+p.width<w.width&&(o=25,f.scrollLeft+=o,g.x-=o),a.top=e.offsetY-g.y,a.left=e.offsetX-g.x,e.shiftKey&&(Math.abs(a.left-h.left)<=Math.abs(a.top-h.top)?a.left=h.left:a.top=h.top),e.ctrlKey){var i=n.ClampToGrid({x:a.left,y:a.top});a.left=i.x,a.top=i.y}try{for(var l=s(b),c=l.next();!c.done;c=l.next()){var d=c.value;d.style.top=a.top+"px",d.style.left=a.left+"px"}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}),(function(){e.extent=void 0,e.layout=n.RectToAnnotationLayout(a),d({type:"annotation",annotation:e,event:"move"})}))}})):(console.info("missing scaled rect!"),Promise.reject())},e.prototype.Initialize=function(e,t,r,o){void 0===o&&(o=!0),this.mask.parentElement||e.appendChild(this.mask),this.tooltip.parentElement||e.appendChild(this.tooltip),this.dropdown_caret.parentElement||e.appendChild(this.dropdown_caret),this.dropdown_list.parentElement||e.appendChild(this.dropdown_list),this.note_node.parentElement||e.appendChild(this.note_node),this.title_node.parentElement||e.appendChild(this.title_node),this.InitializeInternal(e,t),!o&&this.scroll_reference_node&&(this.scroll_reference_node.style.overflow="hidden"),this.dropdown_callback=r,this.initialized=!0},e.prototype.MockSelection=function(){if(this.container&&!this.trident){var e=window.getSelection();if(e){var t=document.createRange();t.selectNodeContents(this.mock_selection),e.removeAllRanges(),e.addRange(t)}}},e.prototype.CreateTile=function(e,t,r,o,i,n,a,s){void 0===s&&(s=!0);var l=document.createElement("canvas");return l.setAttribute("class",e),l.logical_size=t,l.width=t.width*this.dpr,l.height=t.height*this.dpr,l.style.width=t.width+"px",l.style.height=t.height+"px",l.tile_position=r,l.first_cell=o,this.UpdateTileGridPosition(l),l.last_cell={row:o.row+i.rows-1,column:o.column+i.columns-1},l.pixel_start=n,l.pixel_end={x:n.x+t.width,y:n.y+t.height},l.dirty=!!s,l.needs_full_repaint=!0,a.appendChild(l),l},e.prototype.ApplyTheme=function(e){var t,r,o,i,n,a;this.row_header.style.backgroundColor=this.column_header.style.backgroundColor=this.corner.style.backgroundColor=(null===(n=e.headers)||void 0===n?void 0:n.fill)?N(e,e.headers.fill):"",this.corner.style.borderColor=e.grid_color||"";try{for(var l=s(this.grid_tiles),c=l.next();!c.done;c=l.next()){var d=c.value;try{for(var u=(o=void 0,s(d)),h=u.next();!h.done;h=u.next())h.value.style.backgroundColor=N(e,null===(a=e.grid_cell)||void 0===a?void 0:a.fill)||"#fff"}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}this.dropdown_list.style.font=R.Font(e.grid_cell||{})},e.prototype.UpdateTotalSize=function(){this.total_height=0;for(var e=this.model.active_sheet.rows,t=0;t<e;t++)this.total_height+=this.RowHeight(t);this.total_width=0;var r=this.model.active_sheet.columns;for(t=0;t<r;t++)this.total_width+=this.ColumnWidth(t)},e.prototype.UpdateContentsSize=function(){var e=this.row_header_tiles.reduce((function(e,t){return e+t.logical_size.height}),0),t=this.column_header_tiles.reduce((function(e,t){return e+t.logical_size.width}),0);this.column_header.style.width=this.contents.style.width=t+"px",this.row_header.style.height=this.contents.style.height=e+"px"},e.prototype.HideTooltip=function(){this.tooltip.style.display="none",this.tooltip_state=void 0,this.tooltip.classList.remove("arrow-up"),this.tooltip.classList.remove("arrow-left")},e.prototype.ShowTooltip=function(e){void 0===e&&(e={}),e.up?(this.tooltip.classList.add("arrow-up"),this.tooltip_state="up"):e.left&&(this.tooltip.classList.add("arrow-left"),this.tooltip_state="left"),this.tooltip.style.display="block",this.UpdateTooltip(e)},e.prototype.ShowDropdownCaret=function(e,t,r){var o,i,n=this.OffsetCellAddressToRectangle(e.start);e.count>1&&(n=n.Combine(this.OffsetCellAddressToRectangle(e.end))),n=n.Shift(this.header_size.width,this.header_size.height);var a=Math.round(this.scale*Math.max(8,Math.min(20,n.height)));this.dropdown_caret.style.height=a+"px",this.dropdown_caret.style.width=a+"px",this.dropdown_caret.style.left=n.right+1+"px",this.dropdown_caret.style.top=n.bottom-a+"px",this.dropdown_list.style.top=n.bottom+2+"px",this.dropdown_list.style.left=n.left+2+"px",this.dropdown_list.style.minWidth=n.width+"px",this.dropdown_list.textContent="";try{for(var l=s(t),c=l.next();!c.done;c=l.next()){var d=c.value,u=ke.CreateDiv(void 0,this.dropdown_list);r===d&&(this.dropdown_selected=u,u.classList.add("selected")),u.dropdown_value=d,u.textContent=(null==d?void 0:d.toString())||""}}catch(e){o={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}this.dropdown_caret.setAttribute("class","treb-dropdown-caret"),this.dropdown_caret.style.display="block",this.dropdown_caret_visible=!0},e.prototype.HideDropdownCaret=function(){this.dropdown_caret_visible&&(this.dropdown_caret.setAttribute("class","treb-dropdown-caret"),this.dropdown_caret_visible=!1,this.dropdown_caret.style.display="none")},e.prototype.GetScrollOffset=function(){return{x:this.scroll_reference_node.scrollLeft+this.header_offset.x,y:this.scroll_reference_node.scrollTop+this.header_offset.y}},e.prototype.ScrollTo=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var o=this.CellAddressToRectangle(e);r&&(this.scroll_reference_node.scrollTop=o.top),t&&(this.scroll_reference_node.scrollLeft=o.left)},e.prototype.ScrollIntoView=function(e){var t=this.CellAddressToRectangle(e),r=this.scroll_reference_node.clientWidth-this.row_header.offsetWidth,o=this.scroll_reference_node.clientHeight-this.column_header.offsetHeight,i={x:0,y:0},n={x:!1,y:!1},a=new L(this.scroll_reference_node.scrollLeft,this.scroll_reference_node.scrollTop,r,o);(this.model.active_sheet.freeze.rows||this.model.active_sheet.freeze.columns)&&(this.model.active_sheet.freeze.rows&&e.row>=this.model.active_sheet.freeze.rows?i.y=this.frozen_row_tiles[0].logical_size.height:this.model.active_sheet.freeze.rows&&(n.y=!0),this.model.active_sheet.freeze.columns&&e.column>=this.model.active_sheet.freeze.columns?i.x=this.frozen_column_tiles[0].logical_size.width:this.model.active_sheet.freeze.columns&&(n.x=!0)),e.row!==1/0&&(t.top<a.top+i.y&&!n.y?this.scroll_reference_node.scrollTop=t.top-i.y:t.bottom>a.bottom&&(this.scroll_reference_node.scrollTop=t.bottom-o)),e.column!==1/0&&(t.left<a.left+i.x&&!n.x?this.scroll_reference_node.scrollLeft=t.left-i.x:t.right>a.right&&(this.scroll_reference_node.scrollLeft=t.right-r))},e.prototype.UpdateTooltip=function(e){if(void 0===e&&(e={}),void 0!==e.text&&(this.tooltip.textContent=e.text),void 0!==e.x){var t=e.x||0;"up"===this.tooltip_state&&(t-=this.tooltip.offsetWidth/2),this.tooltip.style.left=Math.round(t)+"px"}if(void 0!==e.y){var r=e.y||0;"left"===this.tooltip_state&&(r-=this.tooltip.offsetHeight/2),this.tooltip.style.top=Math.round(r)+"px"}},e.prototype.CoordinateToRowHeader=function(e){var t,r,o={column:1/0,row:0};if(this.model.active_sheet.freeze.rows&&this.frozen_row_tiles[0].pixel_end.y>=e-this.scroll_reference_node.scrollTop){var i=0;e-=this.scroll_reference_node.scrollTop;for(var n=0;n<this.model.active_sheet.freeze.rows;n++)if((i+=this.RowHeight(n))>=e)return o.row=n,o}try{for(var a=s(this.row_header_tiles),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.pixel_end.y>=e){var d=e-c.pixel_start.y;for(i=0,o.row=c.first_cell.row;o.row<=c.last_cell.row;o.row++,d-=i)if((i=this.RowHeight(o.row))>d)return o;return o}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return o},e.prototype.CoordinateToColumnHeader=function(e){var t,r,o={row:1/0,column:0};if(this.model.active_sheet.freeze.columns&&this.frozen_column_tiles[0].pixel_end.x>=e-this.scroll_reference_node.scrollLeft){var i=0;e-=this.scroll_reference_node.scrollLeft;for(var n=0;n<this.model.active_sheet.freeze.columns;n++)if((i+=this.ColumnWidth(n))>=e)return o.column=n,o}try{for(var a=s(this.column_header_tiles),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.pixel_end.x>=e){var d=e-c.pixel_start.x;for(i=0,o.column=c.first_cell.column;o.column<=c.last_cell.column;o.column++,d-=i)if((i=this.ColumnWidth(o.column))>d)return o;return o}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return o},e.prototype.PointToAddress_Grid=function(e,t,r){var o,i,n,a;if(void 0===t&&(t=!1),void 0===r&&(r=!0),r){if(this.model.active_sheet.freeze.rows){var l=this.frozen_row_tiles[0].logical_size.height;e.y-this.scroll_reference_node.scrollTop<l&&(e.y-=this.scroll_reference_node.scrollTop)}if(this.model.active_sheet.freeze.columns){var c=this.frozen_column_tiles[0].logical_size.width;e.x-this.scroll_reference_node.scrollLeft<c&&(e.x-=this.scroll_reference_node.scrollLeft)}}var d={row:0,column:0};try{for(var u=s(this.grid_tiles),h=u.next();!h.done;h=u.next()){var f=h.value;if(f[0].pixel_start.x<=e.x&&f[0].pixel_end.x>=e.x){try{for(var p=(n=void 0,s(f)),m=p.next();!m.done;m=p.next()){var v=m.value;if(v.pixel_start.y<=e.y&&v.pixel_end.y>=e.y){var y=e.x-v.pixel_start.x,_=e.y-v.pixel_start.y,g=0,b=0;for(d.row=v.first_cell.row,d.column=v.first_cell.column;d.column<=v.last_cell.column;d.column++,y-=g)if((g=this.ColumnWidth(d.column))>y){for(;d.row<=v.last_cell.row;d.row++,_-=b)if((b=this.RowHeight(d.row))>_)return d;return d}}}}catch(e){n={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return d}}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return d},e.prototype.AdjacentTile=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=0),!t&&!r)return e;var o=e.tile_position,i=e.tile_position.row+t,n=e.tile_position.column+r;return i<0||n<0?void 0:this.grid_tiles[o.column]&&this.grid_tiles[o.column][o.row]===e&&this.grid_tiles[n]?this.grid_tiles[n][i]:o.column||this.frozen_column_tiles[o.row]!==e?o.row||this.frozen_row_tiles[o.column]!==e?void 0:this.frozen_row_tiles[n]:this.frozen_column_tiles[i]},e.prototype.UpdateTiles=function(){var e,t,r,o;if(!this.container)throw new Error("invalid container");this.grid_tiles.forEach((function(e){e.forEach((function(e){e.parentElement&&e.parentElement.removeChild(e)}))}));try{for(var i=s([this.column_header_tiles,this.row_header_tiles,this.frozen_row_tiles,this.frozen_column_tiles]),n=i.next();!n.done;n=i.next()){var a=n.value;try{for(var l=(r=void 0,s(a)),c=l.next();!c.done;c=l.next()){var d=c.value;d.parentElement&&d.parentElement.removeChild(d)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.frozen_row_tiles=[],this.frozen_column_tiles=[],this.row_header_tiles=[],this.column_header_tiles=[],this.grid_tiles=[];var u=this.model.active_sheet;this.default_row_height=Math.round(u.default_row_height*this.scale),this.default_column_width=Math.round(u.default_column_width*this.scale),this.header_offset={x:Math.round(u.header_offset.x*this.scale),y:Math.round(u.header_offset.y*this.scale)},this.UpdateContainingGrid();var h=this.model.active_sheet.rows,f=this.model.active_sheet.columns;h||(h=100),f||(f=40);for(var p=0,m=0,v=0;v<h;v++)p+=this.RowHeight(v);for(v=0;v<f;v++)m+=this.ColumnWidth(v);if(!m||!p)throw"unexpected missing total size";if(p||(p=this.default_row_height*h),m||(m=this.default_column_width*f),this.container.offsetWidth>m){var y=Math.ceil((this.container.offsetWidth-m)/this.default_column_width);m+=y*this.default_column_width,f+=y}if(this.last_column=f,this.container.offsetHeight>p){var _=Math.ceil((this.container.offsetHeight-p)/this.default_row_height);p+=_*this.default_row_height,h+=_}this.column_header.style.width=this.contents.style.width=m+"px",this.row_header.style.height=this.contents.style.height=p+"px";for(var g=[],b=[],w=0,x=0,C=0;C<f;C++){var S=this.ColumnWidth(C);w&&w+S>this.default_tile_size.width&&(g.push(w),b.push(x),x=C,w=0),w+=S}g.push(w),b.push(x);for(var A=[],k=[],M=0,R=0,T=0;T<h;T++){var L=this.RowHeight(T);M&&M+L>this.default_tile_size.height&&(A.push(M),k.push(R),M=0,R=T),M+=L}A.push(M),k.push(R);var E=g.length,z=A.length,D=0,P=0,N=0,F=0;for(v=0;v<this.model.active_sheet.freeze.rows;v++)N+=this.RowHeight(v);for(v=0;v<this.model.active_sheet.freeze.columns;v++)F+=this.ColumnWidth(v);for(C=0;C<E;C++){var I=[];D=0;var U=C===E-1?f-b[C]:b[C+1]-b[C];for(this.column_header_tiles.push(this.CreateTile("column-header-tile",{height:this.header_offset.y,width:g[C]},{row:0,column:C},{row:0,column:b[C]},{rows:0,columns:U},{x:P,y:0},this.column_header)),this.model.active_sheet.freeze.rows&&this.frozen_row_tiles.push(this.CreateTile("frozen-row-tile",{height:N,width:g[C]},{row:1,column:C},{row:0,column:b[C]},{rows:0,columns:U},{x:P,y:0},this.column_header)),T=0;T<z;T++){var O=T===z-1?h-k[T]:k[T+1]-k[T];C||(this.row_header_tiles.push(this.CreateTile("row-header-tile",{height:A[T],width:this.header_offset.x},{row:T,column:0},{row:k[T],column:0},{rows:O,columns:1},{x:0,y:D},this.row_header)),this.model.active_sheet.freeze.columns&&this.frozen_column_tiles.push(this.CreateTile("frozen-column-tile",{height:A[T],width:F},{row:T,column:1},{row:k[T],column:0},{rows:O,columns:1},{x:0,y:D},this.row_header))),I.push(this.CreateTile("grid-tile",{height:A[T],width:g[C]},{row:T,column:C},{row:k[T],column:b[C]},{rows:O,columns:U},{x:P,y:D},this.contents)),D+=A[T]}this.grid_tiles.push(I),P+=g[C]}this.total_height=p,this.total_width=m,this.ClearLayoutCaches(),this.UpdateGridTemplates(!0,!0)},e.prototype.ClearLayoutCaches=function(){this.row_cache=[],this.column_cache=[]},e.prototype.TileIndexForColumn=function(e){var t,r;try{for(var o=s(this.column_header_tiles),i=o.next();!i.done;i=o.next()){var n=i.value;if(n.first_cell.column<=e&&n.last_cell.column>=e)return n.tile_position.column}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return-1},e.prototype.TileIndexForRow=function(e){var t,r;try{for(var o=s(this.row_header_tiles),i=o.next();!i.done;i=o.next()){var n=i.value;if(n.first_cell.row<=e&&n.last_cell.row>=e)return n.tile_position.row}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return-1},e.prototype.DirtyHeaders=function(e){var t,r,o,i;if(e){try{for(var n=s(this.column_header_tiles),a=n.next();!a.done;a=n.next())if(!(u=a.value).dirty){var l=new f({row:e.start.row,column:u.first_cell.column},{row:e.start.row,column:u.last_cell.column});(e.entire_row||l.Intersects(e))&&(u.dirty=!0)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}try{for(var c=s(this.row_header_tiles),d=c.next();!d.done;d=c.next()){var u;(u=d.value).dirty||(l=new f({column:e.start.column,row:u.first_cell.row},{column:e.start.column,row:u.last_cell.row}),(e.entire_column||l.Intersects(e))&&(u.dirty=!0))}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}},e.prototype.DirtyAll=function(){var e,t,r,o;try{for(var i=s(this.grid_tiles),n=i.next();!n.done;n=i.next()){var a=n.value;try{for(var l=(r=void 0,s(a)),c=l.next();!c.done;c=l.next())c.value.dirty=!0}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.DirtyArea=function(e){if(this.initialized){var t={row:0,column:0},r={row:this.grid_tiles[0].length-1,column:this.grid_tiles.length-1};e.start.column!==1/0&&(t.column=r.column=this.TileIndexForColumn(e.start.column),e.end.column!==e.start.column&&(r.column=this.TileIndexForColumn(e.end.column))),e.start.row!==1/0&&(t.row=r.row=this.TileIndexForRow(e.start.row),e.end.row!==e.start.row&&(r.row=this.TileIndexForRow(e.end.row)));for(var o=t.column;o<=r.column;o++)for(var i=t.row;i<=r.row;i++)this.grid_tiles[o][i].dirty=!0}},e.prototype.VisibleTiles=function(){var e,t,r,o,i,n,a=[{row:0,column:0},{row:0,column:0}];if(!this.container||!this.grid_tiles.length||!this.grid_tiles[0].length)return new f(a[0],a[1]);var l=this.scroll_reference_node.scrollLeft,c=l+this.scroll_reference_node.offsetWidth,d=this.scroll_reference_node.scrollTop,u=d+this.scroll_reference_node.offsetHeight;try{for(var h=s(this.grid_tiles),p=h.next();!p.done;p=h.next()){var m=p.value,v=m[0];if(v.pixel_start.x<=l&&v.pixel_end.x>=l)try{for(var y=(r=void 0,s(m)),_=y.next();!_.done;_=y.next())if((v=_.value).pixel_start.y<=d&&v.pixel_end.y>=d){a[0]=v.tile_position;break}}catch(e){r={error:e}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}if(m===this.grid_tiles[this.grid_tiles.length-1]||v.pixel_start.x<=c&&v.pixel_end.x>=c)try{for(var g=(i=void 0,s(m)),b=g.next();!b.done;b=g.next())if((v=b.value)===m[m.length-1]||v.pixel_start.y<=u&&v.pixel_end.y>=u)return a[1]=v.tile_position,new f(a[0],a[1])}catch(e){i={error:e}}finally{try{b&&!b.done&&(n=g.return)&&n.call(g)}finally{if(i)throw i.error}}}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=h.return)&&t.call(h)}finally{if(e)throw e.error}}return new f(a[0],a[1])},e.prototype.UpdateTileHeights=function(e,t){var r,o,i,n,a,l;void 0===e&&(e=!0),void 0===t&&(t=-1);for(var c=0,d=0;d<this.row_header_tiles.length;d++)if(t>(w=this.row_header_tiles[d]).last_cell.row)c+=w.logical_size.height;else{for(var u=0,h=w.first_cell.row;h<=w.last_cell.row;h++)u+=this.RowHeight(h);var f=w.logical_size.height===u;if(w.pixel_start.y=c,c+=u,w.pixel_end.y=c,!f){if(w.logical_size.height=u,w.style.height=u+"px",w.height=this.dpr*u,this.model.active_sheet.freeze.columns){var p=this.frozen_column_tiles[d];p.logical_size.height=u,p.style.height=u+"px",p.height=this.dpr*u}e&&(w.dirty=!0,w.needs_full_repaint=!0)}try{for(var m=(r=void 0,s(this.grid_tiles)),v=m.next();!v.done;v=m.next()){var y=v.value[d];y.pixel_start.y=w.pixel_start.y,y.pixel_end.y=w.pixel_end.y,f||(y.logical_size.height=u,y.style.height=u+"px",y.height=this.dpr*u,e&&(y.dirty=!0,y.needs_full_repaint=!0))}}catch(e){r={error:e}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}}if(this.model.active_sheet.freeze.rows){var _=0;for(d=0;d<this.model.active_sheet.freeze.rows;d++)_+=this.RowHeight(d);try{for(var g=s(this.frozen_row_tiles),b=g.next();!b.done;b=g.next()){var w;(w=b.value).style.height=_+"px",w.height=_*this.dpr}}catch(e){i={error:e}}finally{try{b&&!b.done&&(n=g.return)&&n.call(g)}finally{if(i)throw i.error}}_+=this.header_offset.y,this.corner_canvas.style.height=_+"px",this.corner_canvas.height=_*this.dpr;try{for(var x=s(this.grid_tiles),C=x.next();!C.done;C=x.next())C.value[0].dirty=!0}catch(e){a={error:e}}finally{try{C&&!C.done&&(l=x.return)&&l.call(x)}finally{if(a)throw a.error}}}this.UpdateGridTemplates(!1,!0),this.row_header.style.height=this.contents.style.height=c+"px",this.ClearLayoutCaches()},e.prototype.UpdateTileWidths=function(e,t){var r,o,i,n,a,l;void 0===e&&(e=!0),void 0===t&&(t=-1);for(var c=0,d=0;d<this.column_header_tiles.length;d++){var u=this.column_header_tiles[d],h=this.grid_tiles[d];if(t>u.last_cell.column)c+=u.logical_size.width;else{for(var f=0,p=u.first_cell.column;p<=u.last_cell.column;p++)f+=this.ColumnWidth(p);var m=u.logical_size.width===f;if(u.pixel_start.x=c,c+=f,u.pixel_end.x=c,!m){if(u.logical_size.width=f,u.style.width=f+"px",u.width=this.dpr*f,this.model.active_sheet.freeze.rows){var v=this.frozen_row_tiles[d];v.logical_size.width=f,v.style.width=f+"px",v.width=this.dpr*f}e&&(u.dirty=!0,u.needs_full_repaint=!0)}try{for(var y=(r=void 0,s(h)),_=y.next();!_.done;_=y.next()){var g=_.value;g.pixel_start.x=u.pixel_start.x,g.pixel_end.x=u.pixel_end.x,m||(g.logical_size.width=f,g.style.width=f+"px",g.width=this.dpr*f,e&&(g.dirty=!0,g.needs_full_repaint=!0))}}catch(e){r={error:e}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}}}if(this.model.active_sheet.freeze.columns){var b=0;for(d=0;d<this.model.active_sheet.freeze.columns;d++)b+=this.ColumnWidth(d);try{for(var w=s(this.frozen_column_tiles),x=w.next();!x.done;x=w.next())(u=x.value).style.width=b+"px",u.width=b*this.dpr}catch(e){i={error:e}}finally{try{x&&!x.done&&(n=w.return)&&n.call(w)}finally{if(i)throw i.error}}b+=this.header_offset.x,this.corner_canvas.style.width=b+"px",this.corner_canvas.width=b*this.dpr;try{for(var C=s(this.grid_tiles[0]),S=C.next();!S.done;S=C.next())(u=S.value).dirty=!0}catch(e){a={error:e}}finally{try{S&&!S.done&&(l=C.return)&&l.call(C)}finally{if(a)throw a.error}}}this.UpdateGridTemplates(!0,!1),this.column_header.style.width=this.contents.style.width=c+"px",this.ClearLayoutCaches()},e.prototype.ClampToGrid=function(e){var t=this.PointToAddress_Grid(e),r=this.OffsetCellAddressToRectangle(t);return e.x>r.left+r.width/2?e.x=r.left+r.width-1:e.x=r.left-1,e.y>r.top+r.height/2?e.y=r.top+r.height-1:e.y=r.top-1,e},e.prototype.OffsetCellAddressToRectangle=function(e){var t=this.CellAddressToRectangle(e);return e.column>=0&&e.column<this.model.active_sheet.freeze.columns&&(t=t.Shift(this.scroll_reference_node.scrollLeft,0)),e.row>=0&&e.row<this.model.active_sheet.freeze.rows&&(t=t.Shift(0,this.scroll_reference_node.scrollTop)),t},e.prototype.CellAddressToRectangle=function(e){var t=e.row===1/0||e.row<0?0:e.row,r=e.column===1/0||e.column<0?0:e.column;if(this.column_cache.length<=r+1){this.column_cache.length||(this.column_cache[0]=0);for(var o=this.column_cache.length-1;o<=r;o++)this.column_cache[o+1]=this.column_cache[o]+this.ColumnWidth(o)}if(this.row_cache.length<=t+1)for(this.row_cache.length||(this.row_cache[0]=0),o=this.row_cache.length-1;o<=t;o++)this.row_cache[o+1]=this.row_cache[o]+this.RowHeight(o);var i=this.column_cache[r],n=this.row_cache[t];return new L(i,n,this.column_cache[r+1]-i,this.row_cache[t+1]-n)},e.prototype.ResizeTileWidth=function(e,t,r){var o,i,n,a;void 0===r&&(r=!0);var l=this.column_header_tiles[e],c=t-l.logical_size.width;l.logical_size.width=t,l.style.width=t+"px",l.width=this.dpr*t,l.pixel_end.x+=c,r&&(l.dirty=!0,l.needs_full_repaint=!0);for(var d=e+1;d<this.column_header_tiles.length;d++){this.column_header_tiles[d].pixel_start.x+=c,this.column_header_tiles[d].pixel_end.x+=c;try{for(var u=(o=void 0,s(this.grid_tiles[d])),h=u.next();!h.done;h=u.next()){var f=h.value;f.pixel_start.x+=c,f.pixel_end.x+=c}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}var p=this.grid_tiles[e];try{for(var m=s(p),v=m.next();!v.done;v=m.next())(l=v.value).logical_size.width=t,l.style.width=t+"px",l.width=this.dpr*t,l.pixel_end.x+=c,r&&(l.dirty=!0,l.needs_full_repaint=!0)}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}this.UpdateTotalSize(),this.UpdateGridTemplates(!0,!1),this.UpdateContentsSize()},e.prototype.ResizeTileHeight=function(e,t,r){var o,i;void 0===r&&(r=!0);var n=this.row_header_tiles[e],a=t-n.logical_size.height;n.logical_size.height=t,n.style.height=t+"px",n.height=this.dpr*t,n.pixel_end.y+=a,r&&(n.dirty=!0,n.needs_full_repaint=!0);for(var l=e+1;l<this.row_header_tiles.length;l++)(n=this.row_header_tiles[l]).pixel_start.y+=a,n.pixel_end.y+=a;try{for(var c=s(this.grid_tiles),d=c.next();!d.done;d=c.next()){var u=d.value;(n=u[e]).logical_size.height=t,n.style.height=t+"px",n.height=this.dpr*t,n.pixel_end.y+=a,r&&(n.dirty=!0,n.needs_full_repaint=!0);for(var h=e+1;h<u.length;h++)u[h].pixel_start.y+=a,u[h].pixel_end.y+=a}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}this.UpdateTotalSize(),this.UpdateGridTemplates(!1,!0),this.UpdateContentsSize()},e}(),Te="http://www.w3.org/2000/svg",Le=function(e){function r(t){var r=e.call(this,t)||this;return r.column_header=ke.CreateDiv("top-header"),r.row_header=ke.CreateDiv("left-header"),r.corner=ke.CreateDiv("corner"),r.corner_canvas=document.createElement("canvas"),r.corner.appendChild(r.corner_canvas),r.contents=ke.CreateDiv("contents"),r.grid_selection=document.createElementNS(Te,"svg"),r.grid_selection.classList.add("grid-selection"),r.contents.appendChild(r.grid_selection),r.row_header_selection=document.createElementNS(Te,"svg"),r.row_header_selection.classList.add("frozen-selection"),r.row_header_selection.classList.add("frozen-selection-rows"),r.column_header.appendChild(r.row_header_selection),r.row_header_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-rows",r.column_header),r.column_header_selection=document.createElementNS(Te,"svg"),r.column_header_selection.classList.add("frozen-selection"),r.column_header_selection.classList.add("frozen-selection-columns"),r.row_header.appendChild(r.column_header_selection),r.column_header_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-columns",r.row_header),r.corner_selection=document.createElementNS(Te,"svg"),r.corner_selection.classList.add("frozen-selection"),r.corner.appendChild(r.corner_selection),r.corner_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-corner",r.corner),r.annotation_container=ke.CreateDiv("annotation-container"),r.grid_cover=ke.CreateDiv("tile-cover grid-cover"),r.column_header_cover=ke.CreateDiv("tile-cover column-header-cover"),r.row_header_cover=ke.CreateDiv("tile-cover row-header-cover"),r}return t(r,e),r.prototype.InitializeInternal=function(e,t){this.container=e,this.container.classList.add("grid-layout"),this.scroll_reference_node=this.container,e.appendChild(this.column_header),e.appendChild(this.row_header),e.appendChild(this.corner),e.appendChild(this.contents),e.appendChild(this.annotation_container),e.appendChild(this.grid_cover),e.appendChild(this.column_header_cover),e.appendChild(this.row_header_cover),e.appendChild(this.mock_selection),this.container.addEventListener("scroll",(function(){return t()}))},r.prototype.ResizeCursor=function(e){switch(e){case"row":this.row_header_cover.classList.add("resize");break;case"column":this.column_header_cover.classList.add("resize");break;default:this.row_header_cover.classList.remove("resize"),this.column_header_cover.classList.remove("resize")}},r.prototype.UpdateTileGridPosition=function(e){e.style.gridColumn=e.tile_position.column+1+" / "+(e.tile_position.column+2),e.style.gridRow=e.tile_position.row+1+" / "+(e.tile_position.row+2)},r.prototype.UpdateContainingGrid=function(){if(!this.container)throw new Error("missing container");this.header_size.width=this.header_offset.x,this.header_size.height=this.header_offset.y;var e=this.header_offset.x,t=this.header_offset.y;if(this.model.active_sheet.freeze.columns)for(var r=0;r<this.model.active_sheet.freeze.columns;r++)e+=this.ColumnWidth(r);if(this.model.active_sheet.freeze.rows)for(r=0;r<this.model.active_sheet.freeze.rows;r++)t+=this.RowHeight(r);this.container.style.gridTemplateColumns=this.header_offset.x+"px auto",this.container.style.gridTemplateRows=this.header_offset.y+"px auto",this.corner_canvas.setAttribute("width",""+this.dpr*e),this.corner_canvas.setAttribute("height",""+this.dpr*t),this.column_header.style.height=t+"px",this.corner_canvas.style.width=e+"px",this.corner_canvas.style.height=t+"px"},r.prototype.UpdateGridTemplates=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var r=0,o=0;this.column_header.style.gridTemplateColumns=this.contents.style.gridTemplateColumns=this.column_header_tiles.map((function(e){return r+=e.logical_size.width,e.logical_size.width+"px"})).join(" "),this.column_header.style.gridTemplateRows=this.header_offset.y+"px auto",this.row_header.style.gridTemplateRows=this.contents.style.gridTemplateRows=this.row_header_tiles.map((function(e){return o+=e.logical_size.height,e.logical_size.height+"px"})).join(" ");var i=this.header_offset.y;if(this.model.active_sheet.freeze.rows)for(var n=0;n<this.model.active_sheet.freeze.rows;n++)i+=this.RowHeight(n);this.column_header.style.height=i+"px",this.row_header_selection.style.display="block",this.row_header_selection.style.width=r+"px",this.corner_selection.style.height=this.row_header_selection.style.height=i+"px",this.corner_selection.style.top=this.row_header_selection.style.top="0px",this.row_header_selection.style.left="0px";var a=this.header_offset.x;if(this.model.active_sheet.freeze.columns)for(n=0;n<this.model.active_sheet.freeze.columns;n++)a+=this.ColumnWidth(n);this.column_header_selection.style.display="block",this.corner_selection.style.width=this.column_header_selection.style.width=a+"px",this.column_header_selection.style.height=o+"px",this.column_header_selection.style.top="0px",this.corner_selection.style.left=this.column_header_selection.style.left="0px";var s=this.model.active_sheet.header_offset.x*this.scale,l=this.model.active_sheet.header_offset.y*this.scale,c=this.model.active_sheet.freeze;c.rows&&c.columns?(this.row_header_annotations.style.display="block",this.column_header_annotations.style.display="block",this.corner_annotations.style.display="block"):c.rows?(this.row_header_annotations.style.display="block",this.column_header_annotations.style.display="none",this.corner_annotations.style.display="none"):c.columns?(this.row_header_annotations.style.display="none",this.column_header_annotations.style.display="block",this.corner_annotations.style.display="none"):(this.row_header_annotations.style.display="none",this.column_header_annotations.style.display="none",this.corner_annotations.style.display="none"),this.row_header_annotations.style.width=r+"px",this.corner_annotations.style.height=this.row_header_annotations.style.height=i-l+"px",this.corner_annotations.style.top=this.row_header_annotations.style.top=l+"px",this.column_header_annotations.style.width=this.corner_annotations.style.width=a-s+"px",this.column_header_annotations.style.height=o+"px",this.corner_annotations.style.left=this.column_header_annotations.style.left=s+"px",this.corner_selection.style.display="block",this.grid_selection.style.width=r+"px",this.grid_selection.style.height=o+"px",this.grid_selection.style.top=this.header_offset.y+"px",this.grid_selection.style.left=this.header_offset.x+"px",this.annotation_container.style.width=r+"px",this.annotation_container.style.height=o+"px",this.annotation_container.style.top=this.header_offset.y+"px",this.annotation_container.style.left=this.header_offset.x+"px"},r}(Re),Ee="http://www.w3.org/2000/svg",ze=function(e){function r(t){var r=e.call(this,t)||this;return r.scroller=ke.CreateDiv("scroller"),r.buffer=ke.CreateDiv("buffer"),r.column_header=ke.CreateDiv("top-header"),r.row_header=ke.CreateDiv("left-header"),r.corner=ke.CreateDiv("corner"),r.corner_canvas=document.createElement("canvas"),r.corner.appendChild(r.corner_canvas),r.contents=ke.CreateDiv("contents"),r.grid_selection=document.createElementNS(Ee,"svg"),r.grid_selection.setAttribute("class","grid-selection"),r.contents.appendChild(r.grid_selection),r.row_header_selection=document.createElementNS(Ee,"svg"),r.row_header_selection.setAttribute("class","frozen-selection"),r.column_header.appendChild(r.row_header_selection),r.row_header_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-rows",r.column_header),r.column_header_selection=document.createElementNS(Ee,"svg"),r.column_header_selection.setAttribute("class","frozen-selection"),r.row_header.appendChild(r.column_header_selection),r.column_header_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-columns",r.row_header),r.corner_selection=document.createElementNS(Ee,"svg"),r.corner_selection.setAttribute("class","frozen-selection"),r.corner.appendChild(r.corner_selection),r.corner_annotations=ke.CreateDiv("frozen-annotation-container frozen-annotation-container-corner",r.corner),r.annotation_container=ke.CreateDiv("annotation-container"),r.grid_cover=ke.CreateDiv("tile-cover grid-cover"),r.column_header_cover=ke.CreateDiv("tile-cover column-header-cover"),r.row_header_cover=ke.CreateDiv("tile-cover row-header-cover"),r}return t(r,e),r.prototype.InitializeInternal=function(e,t){var r=this;this.container=e,this.container.classList.add("legacy-layout"),this.container.appendChild(this.scroller),this.scroller.appendChild(this.buffer),this.scroll_reference_node=this.scroller,e.appendChild(this.column_header),e.appendChild(this.row_header),e.appendChild(this.corner),e.appendChild(this.contents),e.appendChild(this.mock_selection),e.appendChild(this.grid_cover),this.grid_cover.appendChild(this.annotation_container),e.appendChild(this.column_header_cover),e.appendChild(this.row_header_cover),this.row_header_cover.style.left="0px",this.column_header_cover.style.top="0px",this.scroller.addEventListener("scroll",(function(e){e.stopPropagation(),e.preventDefault();var o=r.header_offset.x-r.scroller.scrollLeft,i=r.header_offset.y-r.scroller.scrollTop;r.column_header_cover.style.left=r.column_header.style.left=o+"px",r.row_header.style.top=r.row_header.style.top=i+"px",r.contents.style.left=o+"px",r.contents.style.top=i+"px",r.row_header_cover.style.top=r.grid_cover.style.top=r.header_offset.y-r.scroller.scrollTop+"px",r.column_header_cover.style.left=r.grid_cover.style.left=r.header_offset.x-r.scroller.scrollLeft+"px",t()})),this.container.addEventListener("scroll",(function(e){e.stopPropagation(),e.preventDefault(),r.container&&(r.container.scrollLeft=r.container.scrollTop=0)}));var o=function(e){var t,o,i=r.scroller.getBoundingClientRect(),n=e.clientX-i.left,a=e.clientY-i.top;if(!(n>=r.scroller.clientWidth||a>=r.scroller.clientHeight)){var l=r.CreateMouseEvent(e.type,e);if(e.stopPropagation(),e.preventDefault(),n<r.header_offset.x)a<r.header_offset.y||r.row_header_cover.dispatchEvent(l);else if(a<r.header_offset.y)r.column_header_cover.dispatchEvent(l);else{var c=n-r.header_offset.x+r.scroll_reference_node.scrollLeft,d=a-r.header_offset.y+r.scroll_reference_node.scrollTop;try{for(var u=s(r.model.active_sheet.annotations),h=u.next();!h.done;h=u.next()){var f=h.value;if(f.scaled_rect&&f.node&&f.scaled_rect.Contains(c,d))return"mousedown"===e.type&&document.activeElement!==f.node&&(f.node.focus(),r.container&&(r.container.scrollTop=r.container.scrollLeft=0)),void f.node.dispatchEvent(l)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(t)throw t.error}}r.grid_cover.dispatchEvent(l)}}};this.scroller.addEventListener("mousemove",(function(e){return o(e)})),this.scroller.addEventListener("mousedown",(function(e){return o(e)}))},r.prototype.ResizeCursor=function(e){switch(e){case"row":this.scroller.classList.add("row-resize");break;case"column":this.scroller.classList.add("col-resize");break;default:this.scroller.classList.remove("row-resize"),this.scroller.classList.remove("col-resize")}},r.prototype.CreateMouseEvent=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r={});var o=document.createEvent("MouseEvent"),i=t;return o.initMouseEvent(e,!1,!0,window,i.detail||0,i.screenX||0,i.screenY||0,i.clientX||0,i.clientY||0,i.ctrlKey||!1,i.altKey||!1,i.shiftKey||!1,i.metaKey||!1,i.button||0,i.relatedTarget||null),o},r.prototype.UpdateTileGridPosition=function(e){var t=0,r=0;if(/frozen-column-tile/.test(e.className))t=this.header_offset.x;else for(var o=0;o<e.tile_position.column;o++)(i=this.column_header_tiles[o])&&(t+=i.logical_size.width);if(/frozen-row-tile/.test(e.className))r=this.header_offset.y;else for(o=0;o<e.tile_position.row;o++){var i;(i=this.row_header_tiles[o])&&(r+=i.logical_size.height)}e.style.left=t+"px",e.style.top=r+"px"},r.prototype.UpdateContainingGrid=function(){if(!this.container)throw new Error("missing container");this.header_size.width=this.header_offset.x,this.header_size.height=this.header_offset.y;var e=this.header_offset.x,t=this.header_offset.y;if(this.model.active_sheet.freeze.columns)for(var r=0;r<this.model.active_sheet.freeze.columns;r++)e+=this.ColumnWidth(r);if(this.model.active_sheet.freeze.rows)for(r=0;r<this.model.active_sheet.freeze.rows;r++)t+=this.RowHeight(r);this.column_header.style.left=this.header_offset.x+this.scroller.scrollLeft+"px",this.row_header.style.top=this.header_offset.y+this.scroller.scrollTop+"px",this.contents.style.left=this.header_offset.x+this.scroller.scrollLeft+"px",this.contents.style.top=this.header_offset.y+this.scroller.scrollTop+"px",this.corner_canvas.setAttribute("width",""+this.dpr*e),this.corner_canvas.setAttribute("height",""+this.dpr*t),this.corner_canvas.style.width=e+"px",this.corner_canvas.style.height=t+"px"},r.prototype.UpdateGridTemplates=function(e,t){var r,o,i,n;if(void 0===e&&(e=!0),void 0===t&&(t=!0),this.grid_selection.style.top="0px",this.grid_selection.style.left="0px",e){for(var a=0,l=0;l<this.column_header_tiles.length;l++){var c=this.grid_tiles[l],d=this.column_header_tiles[l].logical_size.width;try{for(var u=(r=void 0,s(c)),h=u.next();!h.done;h=u.next())(y=h.value).style.left=a+"px",y.style.width=d+"px"}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}this.column_header_tiles[l].style.left=a+"px",this.column_header_tiles[l].style.width=d+"px",a+=d}this.column_header_cover.style.height=this.header_offset.y+"px",this.column_header_cover.style.left=this.grid_cover.style.left=this.header_offset.x+this.scroller.scrollLeft+"px",this.grid_cover.style.width=this.grid_selection.style.width=this.column_header_cover.style.width=this.buffer.style.width=a+"px"}if(t){var f=0;for(l=0;l<this.row_header_tiles.length;l++){var p=this.row_header_tiles[l].logical_size.height;try{for(var m=(i=void 0,s(this.grid_tiles)),v=m.next();!v.done;v=m.next()){var y;(y=(c=v.value)[l])&&(y.style.top=f+"px",y.style.height=p+"px")}}catch(e){i={error:e}}finally{try{v&&!v.done&&(n=m.return)&&n.call(m)}finally{if(i)throw i.error}}this.row_header_tiles[l].style.top=f+"px",this.row_header_tiles[l].style.height=p+"px",f+=p}this.row_header_cover.style.width=this.header_offset.x+"px",this.row_header_cover.style.top=this.grid_cover.style.top=this.header_offset.y+this.scroller.scrollTop+"px",this.grid_cover.style.height=this.grid_selection.style.height=this.row_header_cover.style.height=this.buffer.style.height=f+"px"}var _=this.header_offset.y;for(l=0;l<this.model.active_sheet.freeze.rows;l++)_+=this.RowHeight(l);this.row_header_selection.style.display="block",this.row_header_selection.style.width=this.grid_selection.style.width,this.corner_selection.style.height=this.row_header_selection.style.height=_+"px",this.corner_selection.style.top=this.row_header_selection.style.top="0px",this.row_header_selection.style.left="0px";var g=this.header_offset.x;for(l=0;l<this.model.active_sheet.freeze.columns;l++)g+=this.ColumnWidth(l);this.column_header_selection.style.display="block",this.corner_selection.style.width=this.column_header_selection.style.width=g+"px",this.column_header_selection.style.height=this.grid_selection.style.height,this.column_header_selection.style.top="0px",this.corner_selection.style.left=this.column_header_selection.style.left="0px",this.corner_selection.style.display="block";var b=this.model.active_sheet.header_offset.x*this.scale,w=this.model.active_sheet.header_offset.y*this.scale,x=this.model.active_sheet.freeze;x.rows&&x.columns?(this.row_header_annotations.style.display="block",this.column_header_annotations.style.display="block",this.corner_annotations.style.display="block"):x.rows?(this.row_header_annotations.style.display="block",this.column_header_annotations.style.display="none",this.corner_annotations.style.display="none"):x.columns?(this.row_header_annotations.style.display="none",this.column_header_annotations.style.display="block",this.corner_annotations.style.display="none"):(this.row_header_annotations.style.display="none",this.column_header_annotations.style.display="none",this.corner_annotations.style.display="none"),this.row_header_annotations.style.width=this.grid_selection.style.width,this.corner_annotations.style.height=this.row_header_annotations.style.height=_-w+"px",this.corner_annotations.style.top=this.row_header_annotations.style.top=w+"px",this.column_header_annotations.style.width=this.corner_annotations.style.width=g-b+"px",this.column_header_annotations.style.height=this.grid_selection.style.height,this.corner_annotations.style.left=this.column_header_annotations.style.left=b+"px"},r}(Re),De="undefined"==typeof navigator?{is_edge:!1,is_ipad:!1,is_android:!1,is_firefox:!1,is_safari:!1,is_mac:!1,is_chrome:!1,trident:!1,is_windows:!1,is_modern:!0,is_node:!0,is_mobile:!1}:new function(){this.is_edge=/Edge/.test(navigator.appVersion),this.is_ipad=/iPad|iPhone/.test(navigator.userAgent),this.is_android=/android|samsung/i.test(navigator.userAgent),this.is_mobile=this.is_ipad||this.is_android,this.is_firefox=/firefox/i.test(navigator.userAgent),this.is_safari=/safari/i.test(navigator.userAgent),this.is_mac=/macintosh/i.test(navigator.userAgent),this.is_chrome=/Chrome/i.test(navigator.userAgent),this.trident="undefined"!=typeof navigator&&navigator.userAgent&&/trident/i.test(navigator.userAgent),this.is_windows=/win64|win32|windows\s+nt/i.test(navigator.userAgent),this.is_modern=!this.is_edge&&!(this.is_firefox&&this.is_android)&&/webkit|firefox/i.test(navigator.userAgent)},Pe=r(3379),Ne=r.n(Pe),Fe=r(4340),Ie=(Ne()(Fe.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),Fe.Z.locals,r(9477));Ne()(Ie.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),Ie.Z.locals,function(e){e[e.Function=0]="Function",e[e.Token=1]="Token"}(we||(we={}));var Ue,Oe,Ve=function(){function e(){this.function_names=[],this.function_map={},this.argument_separator=M.argument_separator.charCodeAt(0)}return e.prototype.RemoveFunctions=function(e){var t,r,o=this;Array.isArray(e)||(e=[e]);var i=Object.keys(this.function_map).map((function(e){return o.function_map[e]})),n=function(e){i=i.filter((function(t){return t.name!==e.name}))};try{for(var a=s(e),l=a.next();!l.done;l=a.next())n(l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}this.SetFunctions(i)},e.prototype.AddFunctions=function(e){var t,r=this;Array.isArray(e)||(e=[e]);var o=(t=Object.keys(this.function_map).map((function(e){return r.function_map[e]}))).concat.apply(t,c([],l(e)));this.SetFunctions(o)},e.prototype.SetFunctions=function(e){var t=this;this.function_map={},this.function_names=e.map((function(e){return t.function_map[e.name.toLowerCase()]=e,e.name})).sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}))},e.prototype.NormalizeIdentifier=function(e){var t=this.function_map[e.toLowerCase()];return t?t.name:void 0},e.prototype.Exec=function(e){var t,r=this;if("="!==e.text[0])return{};var o={};if(e.cursor===e.text.length&&(t=e.text.match(/(?:^|[^A-Za-z_\d])([A-Za-z_][\w\d_.]*)\s*$/))){var i=t[1],n=new RegExp("^"+i.replace(".","\\."),"i");o={completions:this.function_names.filter((function(e){return n.test(e)})).map((function(e){return r.function_map[e.toLowerCase()]})),token:i,position:e.cursor-i.length}}var a=this.ParseTooltip(e.text.substr(0,e.cursor));if(a.function){var s=this.function_map[a.function.toLowerCase()];s&&(o.tooltip='<span class="notranslate">'+s.name+"</span>",o.arguments="("+(s.arguments||[]).map((function(e,t){var r=e.name||"argument";return t===a.argument?'<span class="active-argument">'+r+"</span>":r})).join(M.argument_separator+" ")+")",o.description=s.description?'<span class="function-description">'+s.description+"</span>":"",o.function_position=a.position||0)}return o},e.prototype.ParseTooltip=function(e){var t,r,o,i=[],n=0,a="",l=!1,c=0;try{for(var d=s(e),u=d.next();!u.done;u=d.next()){var h=u.value,f=h.charCodeAt(0);if(l)34===f&&(l=!1);else switch(f){case 40:i.push({buffer:a.trim(),argument:n,position:c-a.length}),a="",n=0;break;case this.argument_separator:n++;break;case 41:n=(null===(o=i.pop())||void 0===o?void 0:o.argument)||0;break;case 34:a="",l=!0;break;default:f>=97&&f<=122||f>=65&&f<=90||f>=48&&f<=57||95===f||46===f?a+=h:a=""}c++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}var p=i.pop();return{function:(null==p?void 0:p.buffer)||void 0,position:(null==p?void 0:p.position)||0,argument:n}},e}(),He=function(e){function r(t,r,o,i){var n=e.call(this)||this;return n.parser=t,n.theme=r,n.model=o,n.autocomplete=i,n.selecting_=!1,n.trident="undefined"!=typeof navigator&&navigator.userAgent&&/trident/i.test(navigator.userAgent),n.last_parse_string="",n.dependency_list=[],n.reference_index_map=[],n.last_reconstructed_text="",n.enable_reconstruct=!0,n.selection_={target:{row:0,column:0},area:new f({row:0,column:0})},n.measurement_node=document.createElement("div"),n}return t(r,e),Object.defineProperty(r.prototype,"selecting",{get:function(){return this.selecting_},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selection",{get:function(){return this.selection_},set:function(e){if(e){var t=e.target||e.area.start;this.selection_={target:{row:t.row,column:t.column},area:new f(e.area.start,e.area.end)}}else{var r={row:0,column:0};this.selection_={target:r,area:new f(r)}}},enumerable:!1,configurable:!0}),r.prototype.UpdateTheme=function(e){},r.prototype.InsertReference=function(e,t){if(this.editor_node){var r;if(!this.editor_insert_node&&(r=window.getSelection())){var o=r.getRangeAt(0);this.editor_insert_node=document.createElement("span"),o.insertNode(this.editor_insert_node),r.collapseToEnd()}this.editor_insert_node&&(this.editor_insert_node.innerText=e,e.length&&(r=window.getSelection())&&((o=document.createRange()).selectNodeContents(this.editor_insert_node),r.removeAllRanges(),r.addRange(o),r.collapseToEnd()));var i=this.ListDependencies();this.Publish({type:"update",text:this.editor_node.textContent||void 0,dependencies:i})}},r.prototype.Autocomplete=function(e,t){if(this.container_node){var r;r=(null==t?void 0:t.nodeType)===Node.ELEMENT_NODE?t.getBoundingClientRect():this.container_node.getBoundingClientRect();var o=new L(Math.round(r.left),Math.round(r.top),r.width,r.height);this.autocomplete.Show(this.AcceptAutocomplete.bind(this),e,o)}},r.prototype.FlushReference=function(){this.editor_insert_node=void 0},r.prototype.SubstringToCaret=function(e){var t=window.getSelection();if(!t)throw new Error("error getting selection");if(0===t.rangeCount)return console.warn("range count is 0"),"";var r=t.getRangeAt(0),o=r.cloneRange();return o.selectNodeContents(e),o.setEnd(r.endContainer,r.endOffset),this.measurement_node.textContent="",this.measurement_node.appendChild(o.cloneContents()),this.measurement_node.textContent},r.prototype.UpdateSelectState=function(e){var t=this;void 0===e&&(e=!1);var o=!1,i=!1;if(this.editor_node){var n=this.editor_node.textContent||"";if("="===n.trim()[0]){i=!0;var a=this.SubstringToCaret(this.editor_node).trim();if(a.length){var s=a[a.length-1];r.FormulaChars.some((function(e){return s===e}))&&(o=!0);var l=this.autocomplete_matcher;l&&J().then((function(){var e=l.Exec({text:n,cursor:a.length}),r=t.NodeAtIndex(e.completions?e.position||0:e.function_position||0);t.Autocomplete(e,r)}))}}o!==this.selecting_?(this.selecting_=o,o||this.Reconstruct(),!e&&o||this.Publish({type:"end-selection"})):o&&e&&this.Publish({type:"end-selection"});var c=i?this.ListDependencies():void 0;this.Publish({type:"update",text:n,dependencies:c})}},r.prototype.NodeAtIndex=function(e){for(var t,r,o=(null===(t=this.editor_node)||void 0===t?void 0:t.childNodes)||[],i=0;i<o.length;i++){var n=(null===(r=o[i].textContent)||void 0===r?void 0:r.length)||0;if(n>e)return o[i];e-=n}},r.prototype.Reconstruct=function(){var e=this;if(this.enable_reconstruct&&this.editor_node&&(this.ParseDependencies(),this.reference_list)){var t=this.editor_node.textContent||"";if("="===t.trim()[0]&&(this.editor_node.spellcheck=!1,!this.selecting&&t.trim()!==this.last_reconstructed_text.trim())){this.last_reconstructed_text=t;var r,o,i=this.SubstringToCaret(this.editor_node).length,n=document.createDocumentFragment(),a=0,s="";if(this.last_parse_result){var l=0,c="",d=0,u=function(t,o,s){var l=document.createTextNode(o);if("text"===s)n.appendChild(l);else{var c=document.createElement("span");c.appendChild(l),c.dataset.position=t.toString(),c.dataset.type=s,("address"===s||"range"===s||"identifier"===s&&e.model.named_ranges.Get(o))&&c.classList.add("highlight-"+(e.reference_index_map[d++]%5+1)),n.appendChild(c)}return i>=t&&i<t+o.length&&(r=l,a=i-t),l};this.last_parse_result.expression&&this.parser.Walk(this.last_parse_result.expression,(function(e){switch(e.type){case"address":case"range":case"call":case"identifier":e.position!==l-1&&u(l,t.substring(l,e.position+1),"text"),c="call"===e.type||"identifier"===e.type?e.name:e.label,u(e.position+1,c,e.type),l=e.position+c.length+1}return"range"!==e.type})),s=t.substring(l)||"",o=u(l,s,"text")}if(!r)if(t.length===i){var h=document.createElement("span");n.appendChild(h),r=h,a=0}else r=o,a=Math.max(0,s.length-(t.length-i));if(this.editor_node.textContent="",this.editor_node.appendChild(n),r){var f=document.createRange(),p=window.getSelection();p&&(f.setStart(r,a),f.setEnd(r,a),f.collapse(!0),p.removeAllRanges(),p.addRange(f))}}}},r.prototype.ParseDependencies=function(){var e,t,r,i,n,a,l=this;if(this.editor_node){var c=this.editor_node.textContent||"";if(c!==this.last_parse_string||!this.reference_list){var d={};try{for(var u=s(this.model.sheets),h=u.next();!h.done;h=u.next()){var p=h.value;d[p.name.toLowerCase()]=p.id}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}if(this.dependency_list=[],this.reference_index_map=[],c){var m=this.parser.Parse(c);if(this.last_parse_string=c,this.last_parse_result=m,this.reference_list=[],m.full_reference_list)try{for(var v=s(m.full_reference_list),y=v.next();!y.done;y=v.next()){var _=y.value;if("address"===_.type||"range"===_.type){var g="address"===_.type?_:_.start;g.sheet_id||(g.sheet?g.sheet_id=d[g.sheet.toLowerCase()]||0:g.sheet_id=this.model.active_sheet.id),this.reference_list.push(_)}else{var b=this.model.named_ranges.Get(_.name);b&&(1===b.count?this.reference_list.push(o(o({type:"address"},b.start),{label:_.name,position:_.position,id:_.id})):this.reference_list.push({type:"range",start:o({type:"address",position:_.position,id:_.id,label:_.name},b.start),end:o({type:"address",position:_.position,label:_.name,id:_.id},b.end),label:_.name,position:_.position,id:_.id}))}}}catch(e){r={error:e}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}if(this.reference_list){this.reference_list.sort((function(e,t){return e.position-t.position}));var w=function(e){var t,r=(t="address"===e.type?new f({row:e.row,column:e.column,sheet_id:e.sheet_id}):new f({row:e.start.row,column:e.start.column,sheet_id:e.start.sheet_id},{row:e.end.row,column:e.end.column})).spreadsheet_label;x.dependency_list.some((function(e,o){return e.spreadsheet_label===r&&e.start.sheet_id===t.start.sheet_id&&(l.reference_index_map.push(o),!0)}))||(x.reference_index_map.push(x.dependency_list.length),x.dependency_list.push(t))},x=this;try{for(var C=s(this.reference_list),S=C.next();!S.done;S=C.next())w(S.value)}catch(e){n={error:e}}finally{try{S&&!S.done&&(a=C.return)&&a.call(C)}finally{if(n)throw n.error}}}}else this.reference_list=void 0}}},r.prototype.ListDependencies=function(){return this.ParseDependencies(),this.dependency_list||[]},r.prototype.AcceptAutocomplete=function(e){var t,r,o,i;if(this.editor_node){var n=window.getSelection(),a=we.Function;if(e.data&&e.data.completions)try{for(var l=s(e.data.completions),c=l.next();!c.done;c=l.next()){var d=c.value;if(d.name.toLowerCase()===(null===(o=e.value)||void 0===o?void 0:o.toLowerCase())){a=d.type||we.Function;break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}if(!n)throw new Error("error getting selection");var u=n.getRangeAt(0),h=u.cloneRange(),f=document.createElement("div");h.selectNodeContents(this.editor_node),h.setEnd(u.endContainer,u.endOffset),f.appendChild(h.cloneContents());var p=(f.textContent||"").substr(0,e.data?e.data.position:0)+e.value,m=a===we.Token?p:p+"(";this.editor_node.textContent=m,this.autocomplete.Hide(),De.is_firefox||this.Reconstruct(),n=window.getSelection(),u=document.createRange(),(null===(i=this.editor_node)||void 0===i?void 0:i.lastChild)&&u.setStartAfter(this.editor_node.lastChild),u.collapse(!0),null==n||n.removeAllRanges(),null==n||n.addRange(u),this.selecting_=!0,e.click&&this.UpdateSelectState()}},r.FormulaChars=("$^&*(-+={[<>/~%"+M.argument_separator).split(""),r}(X);!function(e){e[e.not_handled=0]="not_handled",e[e.handled=1]="handled",e[e.commit=2]="commit",e[e.discard=3]="discard"}(Oe||(Oe={}));var je,Ge="function"==typeof(null===(Ue=null===document||void 0===document?void 0:document.body)||void 0===Ue?void 0:Ue.createTextRange),Be=function(e){function r(t,r,o,i,n){var a=e.call(this,r,o,i,n)||this;return a.container=t,a._editing=!1,a.scale=1,a.edit_container=document.createElement("div"),a.edit_container.classList.add("overlay-editor-container"),a.edit_container.classList.add("notranslate"),a.edit_container.translate=!1,a.edit_node=document.createElement("div"),a.edit_node.classList.add("overlay-editor"),a.edit_node.contentEditable="true",a.edit_node.tabIndex=-1,a.edit_node.spellcheck=!0,a.edit_node.inputMode="none",a.edit_node.addEventListener("input",(function(){a.editing&&(a.Reconstruct(),a.UpdateSelectState())})),a.edit_node.addEventListener("keyup",(function(e){if(a.editing&&!a.autocomplete.HandleKey("keyup",e).handled){if(a.selecting_)switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Shift":case"Control":return}a.FlushReference(),a.UpdateSelectState(!0)}})),a.edit_inset=document.createElement("div"),a.edit_inset.classList.add("overlay-inset"),a.edit_container.appendChild(a.edit_inset),a.edit_inset.appendChild(a.edit_node),t.appendChild(a.edit_container),a.edit_container.style.opacity="0",a.editor_node=a.edit_node,a.container_node=a.edit_container,a.ClearContents(),a}return t(r,e),Object.defineProperty(r.prototype,"editing",{get:function(){return this._editing},set:function(e){this._editing!==e&&(this._editing=e,e?(this.edit_container.style.opacity="1",this.edit_container.style.pointerEvents="initial"):(this.edit_container.style.opacity="0",this.edit_container.style.pointerEvents="none",De.trident&&(this.edit_container.style.top="-200px")))},enumerable:!1,configurable:!0}),r.prototype.Focus=function(){this.edit_node!==document.activeElement&&(this.edit_container.style.top=this.container.scrollTop+2+"px",this.edit_container.style.left=this.container.scrollLeft+2+"px"),this.edit_node.focus()},r.prototype.CloseEditor=function(){this.editing=!1,this.ClearContents(),this.edit_node.spellcheck=!0,this.autocomplete.Hide(),this.active_cell=void 0},r.prototype.ClearContents=function(){De.is_firefox?this.edit_node.innerHTML="<span></span>":this.edit_node.textContent=""},r.prototype.Edit=function(e,t,r,o,i){var n=this;this.Publish({type:"start-editing",editor:"ice"}),this.active_cell=r;var a=r.style||{};switch(this.edit_node.style.font=R.Font(a,this.scale),this.edit_node.style.color=F(this.theme,a.text,1),this.edit_inset.style.backgroundColor=N(this.theme,a.fill),a.horizontal_align){case R.HorizontalAlign.Right:this.edit_inset.classList.add("align-right"),this.edit_inset.classList.remove("align-center"),this.edit_inset.classList.remove("align-left");break;case R.HorizontalAlign.Center:this.edit_inset.classList.remove("align-right"),this.edit_inset.classList.add("align-center"),this.edit_inset.classList.remove("align-left");break;default:this.edit_inset.classList.remove("align-right"),this.edit_inset.classList.remove("align-center"),this.edit_inset.classList.add("align-left")}this.edit_node.style.paddingBottom=Math.max(0,(self.devicePixelRatio||1)-1)+"px";var s=(null==o?void 0:o.toString())||"";if(s&&"="===s[0]&&(this.edit_node.spellcheck=!1),this.autocomplete.ResetBlock(),this.FlushReference(),this.selection=e,void 0!==o){var l="="!==s[0]&&"%"===s[s.length-1],c=s.length;if(this.edit_node.textContent=s,Ge)J().then((function(){var e=document.body.createTextRange();e.moveToElementText(n.editor_node),l?c>1&&(e.moveStart("character",c),e.move("character",-1),e.select()):(e.moveStart("character",c),e.select())}));else{var d=document.createRange(),u=window.getSelection();if(!u)throw new Error("invalid selection object");this.edit_node.lastChild&&(l?(d.setStart(this.edit_node.lastChild,c-1),d.setEnd(this.edit_node.lastChild,c-1)):d.setStartAfter(this.edit_node.lastChild)),d.collapse(!0),u.removeAllRanges(),u.addRange(d)}if(!i){var h=this.ListDependencies();this.Publish({type:"update",text:o.toString(),dependencies:h})}}t.ApplyStyle(this.edit_container),this.editing=!0,J().then((function(){n.last_reconstructed_text="",n.Reconstruct()}))},r.prototype.HandleKeyDown=function(e){if(!this.editing)return Oe.not_handled;var t=this.autocomplete.HandleKey("keydown",e);if(t.accept&&this.AcceptAutocomplete(t),t.handled)return Oe.handled;switch(e.key){case"Enter":case"Tab":return this.selecting_=!1,Oe.commit;case"Escape":case"Esc":return this.selecting_=!1,Oe.discard;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"Up":case"Down":case"Left":case"Right":return this.selecting_?Oe.not_handled:Oe.handled}return Oe.handled},r.prototype.UpdateTheme=function(e){this.scale=e},r}(He),Ze=new(function(){function e(){this.cache={},this.canvas=document.createElement("canvas")}return e.prototype.GetFirstIndex=function(e){for(var t=3,r=e.length;t<r;t+=4)if(e[t]>0)return(t-3)/4;return e.length},e.prototype.GetLastIndex=function(e){for(var t=e.length-1;t>=3;t-=4)if(e[t]>0)return t/4;return 0},e.prototype.Get=function(e){var t=this.cache[e];return t||(t=this.Measure(e),this.cache[e]=t,t)},e.prototype.Measure=function(e){var t=this.canvas.getContext("2d");if(!t)throw new Error("invalid context");t.font=e;var r=t.measureText("MMM"),o=Math.ceil(r.width);if(this.canvas.setAttribute("width",o.toString()),this.canvas.setAttribute("height",o.toString()),!(t=this.canvas.getContext("2d")))throw new Error("invalid context");t.font=e,t.textAlign="center",t.textBaseline="alphabetic",t.fillStyle="#000";var i=Math.round(2*o/3),n=Math.round(o/2);t.clearRect(0,0,o,o);for(var a=32;a<=126;a++){var s=String.fromCharCode(a);t.fillText(s,n,i)}var l=t.getImageData(0,0,this.canvas.width,this.canvas.height).data,c=Math.floor(this.GetFirstIndex(l)/o),d=Math.floor(this.GetLastIndex(l)/o);return{ascender:i-c,descender:d-i,block:d-c+1,paren:t.measureText("(").width,hash:t.measureText("##").width-t.measureText("#").width}},e}()),Je="bottom",qe=/webkit/i.test((null===navigator||void 0===navigator?void 0:navigator.userAgent)||"")?1:0,We=function(){function e(e,t,r,o){this.theme=e,this.layout=t,this.model=r,this.options=o,this.cell_edge_buffer=4,this.overflow_areas=[],this.buffer_canvas_size={width:256,height:256},this.buffer_canvas=document.createElement("canvas"),this.buffer_canvas.width=this.buffer_canvas_size.width,this.buffer_canvas.height=this.buffer_canvas_size.height;var i=this.buffer_canvas.getContext("2d",{alpha:!1});if(i){var n=this.layout.dpr;this.buffer_context=i,this.buffer_context.setTransform(n,0,0,n,0,0),this.buffer_context.textAlign="left",this.buffer_context.textBaseline=Je}}return e.prototype.EnsureBuffer=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0);var o=this.layout.dpr;if(t*=o,r*=o,(e*=o)>this.buffer_canvas_size.width||t>this.buffer_canvas_size.height){this.buffer_canvas_size.width=Math.max(256*Math.ceil(e/256),this.buffer_canvas_size.width),this.buffer_canvas_size.height=Math.max(256*Math.ceil(t/256),this.buffer_canvas_size.height),this.buffer_canvas.width=this.buffer_canvas_size.width,this.buffer_canvas.height=this.buffer_canvas_size.height;var i=this.buffer_canvas.getContext("2d",{alpha:!1});i&&(this.buffer_context=i,this.buffer_context.textAlign="left",this.buffer_context.textBaseline=Je)}this.buffer_context.setTransform(o,0,0,o,r,0)},e.prototype.OverflowDirty=function(e){var t,r;void 0===e&&(e=!1);var o=[];try{for(var i=s(this.overflow_areas),n=i.next();!n.done;n=i.next()){var a=n.value,l=a.area.start.row,c=e;if(!c)for(var d=a.area.start.column;!c&&d<=a.area.end.column;d++)c=!(!(u=this.model.active_sheet.cells.GetCell({row:l,column:d},!1))||!u.render_dirty);if(c){for(d=a.area.start.column;d<=a.area.end.column;d++){var u;(u=this.model.active_sheet.cells.GetCell({row:l,column:d},!1))&&(u.render_dirty=!0,u.renderer_data&&u.renderer_data.overflowed&&(u.renderer_data=void 0))}a.tile.dirty=!0}else o.push(a)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}this.overflow_areas=o},e.prototype.RenderCorner=function(){var e,t,r,o,i=this.layout.corner_canvas.getContext("2d",{alpha:!1});if(!i)throw new Error("invalid context");for(var n=Ze.Get(R.Font(this.theme.headers||{},this.layout.scale)),a=this.layout.dpr,s=this.layout.header_offset,l=s.x,c=0;c<this.model.active_sheet.freeze.columns;c++)l+=this.layout.ColumnWidth(c);var d=s.y;for(c=0;c<this.model.active_sheet.freeze.rows;c++)d+=this.layout.RowHeight(c);if(i.setTransform(a,0,0,a,0,0),i.fillStyle=(null===(e=this.theme.headers)||void 0===e?void 0:e.fill)?N(this.theme,this.theme.headers.fill):"",i.fillRect(0,0,l,s.y),i.fillRect(0,0,s.x,d),i.strokeStyle=this.theme.grid_color||"",i.beginPath(),i.moveTo(s.x-.5,0),i.lineTo(s.x-.5,d),i.moveTo(0,s.y-.5),i.lineTo(l,s.y-.5),i.stroke(),this.model.active_sheet.freeze.columns||this.model.active_sheet.freeze.rows){if(i.textAlign="center",i.textBaseline="middle",i.font=R.Font(this.theme.headers||{},this.layout.scale),i.fillStyle=N(this.theme,null===(t=this.theme.headers)||void 0===t?void 0:t.text),this.model.active_sheet.freeze.rows&&this.layout.header_offset.x>1){i.setTransform(a,0,0,a,0,0),i.translate(0,s.y),i.beginPath(),i.moveTo(0,-.5),i.lineTo(s.x,-.5);for(var u=0;u<this.model.active_sheet.freeze.rows;u++){var h=this.layout.RowHeight(u);i.fillStyle=N(this.theme,null===(r=this.theme.headers)||void 0===r?void 0:r.text),h>=1.2*n.block&&i.fillText(""+(u+1),s.x/2,h/2),i.moveTo(0,h-.5),i.lineTo(s.x,h-.5),i.translate(0,h)}i.strokeStyle=this.theme.grid_color||"",i.stroke()}if(this.model.active_sheet.freeze.columns&&this.layout.header_offset.y>1){i.strokeStyle=this.theme.grid_color||"",i.setTransform(a,0,0,a,0,0),i.translate(s.x,0),i.beginPath(),i.moveTo(-.5,0),i.lineTo(-.5,s.y);for(var p=0;p<this.model.active_sheet.freeze.columns;p++){var m=this.layout.ColumnWidth(p),v=f.ColumnToLabel(p);m>i.measureText(v).width&&(i.fillStyle=N(this.theme,null===(o=this.theme.headers)||void 0===o?void 0:o.text),i.fillText(v,m/2,s.y/2)),i.moveTo(m-.5,0),i.lineTo(m-.5,s.y),i.translate(m,0)}i.stroke()}}},e.prototype.RenderHeaders=function(e,t){var r,o,i,n,a,s;void 0===t&&(t=!1);for(var l=this.layout.dpr,c=this.layout.header_offset,d=Ze.Get(R.Font(this.theme.headers||{},this.layout.scale)),u=e.start.column;u<=e.end.column;u++)if((_=(y=this.layout.column_header_tiles[u]).getContext("2d",{alpha:!1}))&&(_.setTransform(l,0,0,l,0,0),y.dirty||t)){_.fillStyle=(null===(r=this.theme.headers)||void 0===r?void 0:r.fill)?N(this.theme,this.theme.headers.fill):"",_.fillRect(0,0,y.logical_size.width,this.layout.header_offset.y),_.textAlign="center",_.textBaseline="middle",_.font=R.Font(this.theme.headers||{},this.layout.scale),_.fillStyle=N(this.theme,null===(o=this.theme.headers)||void 0===o?void 0:o.text),_.strokeStyle=this.theme.grid_color||"",_.beginPath(),_.moveTo(0,c.y-.5),_.lineTo(y.logical_size.width,c.y-.5);for(var h=y.first_cell.column;h<=y.last_cell.column;h++){var p=this.layout.ColumnWidth(h),m=f.ColumnToLabel(h);p>_.measureText(m).width&&(_.fillStyle=N(this.theme,null===(i=this.theme.headers)||void 0===i?void 0:i.text),_.fillText(m,p/2,c.y/2)),_.moveTo(p-.5,0),_.lineTo(p-.5,c.y),_.translate(p,0)}_.stroke(),y.dirty=!1}for(var v=e.start.row;v<=e.end.row;v++){var y;if((y=this.layout.row_header_tiles[v]).dirty||t){var _;if(!(_=y.getContext("2d",{alpha:!1})))continue;_.fillStyle=(null===(n=this.theme.headers)||void 0===n?void 0:n.fill)?N(this.theme,this.theme.headers.fill):"",_.setTransform(l,0,0,l,0,0),_.fillRect(0,0,this.layout.header_offset.x,y.logical_size.height),_.textAlign="center",_.textBaseline="middle",_.font=R.Font(this.theme.headers||{},this.layout.scale),_.fillStyle=N(this.theme,null===(a=this.theme.headers)||void 0===a?void 0:a.text),_.strokeStyle=this.theme.grid_color||"",_.beginPath(),_.moveTo(c.x-.5,0),_.lineTo(c.x-.5,y.logical_size.height);for(var g=y.first_cell.row;g<=y.last_cell.row;g++){var b=this.layout.RowHeight(g);_.fillStyle=N(this.theme,null===(s=this.theme.headers)||void 0===s?void 0:s.text),b>=1.2*d.block&&_.fillText(""+(g+1),c.x/2,b/2),_.moveTo(0,b-.5),_.lineTo(c.x,b-.5),_.translate(0,b)}_.strokeStyle=this.theme.grid_color||"",_.stroke(),y.dirty=!1}}(this.model.active_sheet.freeze.rows||this.model.active_sheet.freeze.columns)&&this.RenderCorner()},e.prototype.CopyToAdjacent=function(e,t,r,o,i,n,a){var s=this.layout.AdjacentTile(e,o,r);if(s){var l=i,c=n;r>0?l=i-(e.pixel_end.x-e.pixel_start.x)*t:r<0&&(l=i+(s.pixel_end.x-s.pixel_start.x)*t),o>0&&(c=n-(e.pixel_end.y-e.pixel_start.y)*t);var d=s.getContext("2d",{alpha:!1});d&&(d.setTransform(t,0,0,t,l,c),d.drawImage(this.buffer_canvas,0,0,(a.width||0)*t,(a.height||0)*t,a.left||0,0,a.width||0,a.height||0))}},e.prototype.Render=function(e){var t=e.getContext("2d",{alpha:!1});if(t){t.textBaseline=Je;var r=this.layout.dpr;this.last_font=void 0,t.setTransform(r,0,0,r,0,0);for(var o=0,i=0,n=e.first_cell.column;n<=e.last_cell.column;n++){var a=this.layout.ColumnWidth(n);if(a){i=0;for(var s=e.first_cell.row;s<=e.last_cell.row;s++){var l=this.layout.RowHeight(s);if(l){t.setTransform(r,0,0,r,o,i);var c=this.model.active_sheet.CellData({row:s,column:n});if(e.needs_full_repaint||c.render_dirty){var d=this.RenderCell(e,c,t,{row:s,column:n},a,l);d.tile_overflow_right&&this.CopyToAdjacent(e,r,1,0,o,i,d),d.tile_overflow_left&&this.CopyToAdjacent(e,r,-1,0,o,i,d),d.tile_overflow_bottom&&this.CopyToAdjacent(e,r,0,1,o,i,d)}}i+=l*r}o+=a*r}}if(this.model.active_sheet.freeze.rows||this.model.active_sheet.freeze.columns){var u=0,h=0;if(e.first_cell.row<=this.model.active_sheet.freeze.rows-1)for(var f=e.first_cell.row;f<this.model.active_sheet.freeze.rows&&f<=e.last_cell.row;f++)u+=this.layout.RowHeight(f);if(e.first_cell.column<=this.model.active_sheet.freeze.columns-1)for(f=e.first_cell.column;f<this.model.active_sheet.freeze.columns&&f<=e.last_cell.column;f++)h+=this.layout.ColumnWidth(f);if(u){if(!(p=this.layout.frozen_row_tiles[e.tile_position.column]))throw new Error("can't find matching header tile");if(!(m=p.getContext("2d",{alpha:!0})))throw new Error("header context failed");m.setTransform(r,0,0,r,0,0),m.drawImage(e,0,0,e.logical_size.width*r,u*r,0,0,e.logical_size.width,u)}if(h){var p,m;if(!(p=this.layout.frozen_column_tiles[e.tile_position.row]))throw new Error("can't find matching header tile");if(!(m=p.getContext("2d",{alpha:!0})))throw new Error("header context failed");m.setTransform(r,0,0,r,0,0),m.drawImage(e,0,0,h*r,e.logical_size.height*r,0,0,h,e.logical_size.height)}if(h&&u){var v=this.layout.corner_canvas.getContext("2d",{alpha:"false"});if(!v)throw new Error("corner context failed");v.setTransform(r,0,0,r,this.layout.header_offset.x*r,this.layout.header_offset.y*r),v.drawImage(e,0,0,h*r,u*r,0,0,h,u)}}}},e.prototype.PrepText=function(e,t,r){var o,i,n,a,l,c,d=[],h=t.style||{},f=0,p=0,m=!1,v=t.editing?"":t.formatted;if(Array.isArray(v)){try{for(var y=s(v),_=y.next();!_.done;_=y.next()){var g=_.value;if(g.flag!==T.formatting){var b=e.measureText(g.text).width,w={width:b,text:g.text,hidden:g.flag===T.hidden};d.push(w),g.flag===T.padded?l=w:p+=b}else c=g.text}}catch(e){o={error:e}}finally{try{_&&!_.done&&(i=y.return)&&i.call(y)}finally{if(o)throw o.error}}if(l){var x=l.text,C=l.width,S=r-p-2*this.cell_edge_buffer;if(l.width=Math.max(0,S),S>0){for(var A=Math.floor(S/C),k=1;k<A;k++)l.text+=x;p=r-2*this.cell_edge_buffer}else l.text=""}f=p,m=!0}else if(""===v)d.push({text:"",hidden:!1,width:0});else if(v){t.type===u.string&&"'"===v[0]&&(v=v.slice(1));var M=v.split(/\n/);if(h.wrap){var R=r-2*this.cell_edge_buffer,L=[];M.forEach((function(t){var r=t.match(/\S+\s*/g);if(r&&r.length){var o="";do{var i=(o+r[0]).trim();e.measureText(i).width<R?(o+=r[0],r.shift()):o?(L.push(o.trim()),o=""):(L.push(i.trim()),r.shift(),o="")}while(r.length);o&&L.push(o.trim())}else L.push("")})),M=L}try{for(var E=s(M),z=E.next();!z.done;z=E.next()){var D=z.value,P=e.measureText(D).width;f=Math.max(f,P),d.push({text:D,hidden:!1,width:P})}}catch(e){n={error:e}}finally{try{z&&!z.done&&(a=E.return)&&a.call(E)}finally{if(n)throw n.error}}}return c?{strings:d,width:f,single:m,format:c}:{strings:d,width:f,single:m}},e.prototype.ResolveColors=function(e){var t=o({},e);return t.text={text:F(this.theme,e.text,1)},t},e.prototype.RenderCellBorders=function(e,t,r,o,i,n,a){var s,l,c,d;void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0);var u=this.model.active_sheet.SurroundingStyle(e),h=F(this.theme,u[8].fill);h&&(t.fillStyle=h,t.fillRect(o+0,i-1,n,1)),(h=F(this.theme,u[4].fill))&&(t.fillStyle=h,t.fillRect(o-1,i,1,a)),(h=F(this.theme,r.fill))&&(t.fillStyle=h,t.fillRect(o-1,i-1,n+1,a+1)),(h=F(this.theme,u[6].fill))&&(t.fillStyle=h,t.fillRect(o+n-1,i-1,1,a+1)),(h=F(this.theme,u[2].fill))&&(t.fillStyle=h,t.fillRect(o-1,i+a-1,n+1,1)),u[6].border_top&&!u[6].border_left&&(t.fillStyle=F(this.theme,u[6].border_top_fill,1),t.fillRect(o+n-1,i-2+u[6].border_top,1,1)),u[9].border_left&&(t.fillStyle=F(this.theme,u[9].border_left_fill,1),t.fillRect(o+n-1,i-1,1,1)),u[9].border_bottom&&(t.fillStyle=F(this.theme,u[9].border_bottom_fill,1),t.fillRect(o+n-1,i-2+u[9].border_bottom,1,1)),u[4].border_top&&!u[4].border_right&&(t.fillStyle=F(this.theme,u[4].border_right_fill,1),t.fillRect(o-1,i-2+u[4].border_top,1,1)),u[7].border_right&&(t.fillStyle=F(this.theme,u[7].border_right_fill,1),t.fillRect(o-1,i-1,1,1)),u[7].border_bottom&&(t.fillStyle=F(this.theme,u[7].border_bottom_fill,1),t.fillRect(o-1,i-2+u[7].border_bottom,1,1)),u[6].border_bottom&&!u[6].border_left&&(t.fillStyle=F(this.theme,u[6].border_bottom_fill,1),t.fillRect(o+n-1,i+a-u[6].border_bottom,1,1)),u[3].border_left&&(t.fillStyle=F(this.theme,u[3].border_left_fill,1),t.fillRect(o+n-1,i+a-1,1,1)),u[3].border_top&&(t.fillStyle=F(this.theme,u[3].border_top_fill,1),t.fillRect(o+n-1,i+a-u[3].border_top,1,1)),u[4].border_bottom&&!u[4].border_right&&(t.fillStyle=F(this.theme,u[4].border_bottom_fill,1),t.fillRect(o-1,i+a-u[4].border_bottom,1,1)),u[1].border_right&&(t.fillStyle=F(this.theme,u[1].border_right_fill,1),t.fillRect(o-1,i+a-1,1,1)),u[1].border_top&&(t.fillStyle=F(this.theme,u[1].border_top_fill,1),t.fillRect(o-1,i+a-u[1].border_top,1,1)),u[8].border_bottom&&(t.fillStyle=F(this.theme,u[8].border_bottom_fill,1),2===u[8].border_bottom?(t.fillRect(o-1,i-2,n+1,1),t.fillRect(o-1,i-0,n+1,1),t.fillStyle=F(this.theme,u[8].fill)||N(this.theme,null===(s=this.theme.grid_cell)||void 0===s?void 0:s.fill)||"#fff",t.fillRect(o-1,i-1,n+1,1)):t.fillRect(o-1,i-1,n+1,1)),u[4].border_right&&(t.fillStyle=F(this.theme,u[4].border_right_fill,1),t.fillRect(o-1,i-1,1,a+1)),u[6].border_left&&(t.fillStyle=F(this.theme,u[4].border_left_fill,1),t.fillRect(o+n-1,i-1,1,a+1)),u[2].border_top&&(t.fillStyle=F(this.theme,u[2].border_top_fill,1),2===u[2].border_top?(t.fillRect(o-1,i+a-2,n+1,1),t.fillRect(o-1,i+a-0,n+1,1),t.fillStyle=F(this.theme,u[2].fill)||N(this.theme,null===(l=this.theme.grid_cell)||void 0===l?void 0:l.fill)||"#fff",t.fillRect(o-1,i+a-1,n+1,1)):t.fillRect(o-1,i+a-1,n+1,1)),r.border_top&&(t.fillStyle=F(this.theme,r.border_top_fill,1),2===r.border_top?(t.fillRect(o-1,i-2,n+1,1),t.fillRect(o-1,i+0,n+1,1),t.fillStyle=F(this.theme,r.fill)||N(this.theme,null===(c=this.theme.grid_cell)||void 0===c?void 0:c.fill)||"#fff",t.fillRect(o-1,i-1,n+1,1)):t.fillRect(o-1,i-1,n+1,1)),r.border_left&&(t.fillStyle=F(this.theme,r.border_left_fill,1),t.fillRect(o-1,i-1,1,a+1)),r.border_right&&(t.fillStyle=F(this.theme,r.border_right_fill,1),t.fillRect(o+n-1,i-1,1,a+1)),r.border_bottom&&(t.fillStyle=F(this.theme,r.border_bottom_fill,1),2===r.border_bottom?(t.fillRect(o-1,i+a-2,n+1,1),t.fillRect(o-1,i+a+0,n+1,1),t.fillStyle=F(this.theme,r.fill)||N(this.theme,null===(d=this.theme.grid_cell)||void 0===d?void 0:d.fill)||"#fff",t.fillRect(o-1,i+a-1,n+1,1)):t.fillRect(o-1,i+a-1,n+1,1))},e.prototype.RenderCellBackground=function(e,t,r,o,i,n){var a;r.fillStyle=this.theme.grid_color,r.fillRect(0,0,i,n);var s=F(this.theme,o.fill);s?(r.fillStyle=s,r.fillRect(0,0,i-1,n-1)):(r.fillStyle=N(this.theme,null===(a=this.theme.grid_cell)||void 0===a?void 0:a.fill)||"#fff",r.fillRect(0,0,i-1,n-1)),e&&(r.fillStyle=this.theme.note_marker_color,r.beginPath(),r.moveTo(i-2,1),r.lineTo(i-2-8,1),r.lineTo(i-2,9),r.lineTo(i-2,1),r.fill()),this.RenderCellBorders(t,r,o,0,0,i,n)},e.prototype.RenderCell=function(e,t,r,i,n,a){var l,c,d,h,p,m,v,y,_,g={},b=t.render_dirty;if(t.render_dirty=!1,e.needs_full_repaint&&(null===(v=t.renderer_data)||void 0===v?void 0:v.overflowed))return{};var w=t.style?o({},t.style):{};if(t.merge_area){if(i.row!==t.merge_area.start.row||i.column!==t.merge_area.start.column)return{};for(var x=t.merge_area.start.column+1;x<=t.merge_area.end.column;x++)n+=this.layout.ColumnWidth(x);for(var C=t.merge_area.start.row+1;C<=t.merge_area.end.row;C++)a+=this.layout.RowHeight(C);if(t.merge_area.count>1){var S=this.model.active_sheet.CellStyleData(t.merge_area.end);S&&(w.border_bottom=S.border_bottom,w.border_right=S.border_right,w.border_bottom_fill=S.border_bottom_fill,w.border_right_fill=S.border_right_fill)}t.merge_area.end.column>e.last_cell.column&&(g.tile_overflow_right=!0),t.merge_area.end.row>e.last_cell.row&&(g.tile_overflow_bottom=!0),(g.tile_overflow_bottom||g.tile_overflow_right)&&this.overflow_areas.push({tile:e,head:o({},i),area:new f(t.merge_area.start,t.merge_area.end)})}var A=!!t.hyperlink;if(t.render_function){this.RenderCellBackground(!!t.note,i,r,w,n,a),r.strokeStyle=r.fillStyle=F(this.theme,w.text,1);var k=this.ResolveColors(w);if(t.render_function.call(void 0,{width:n,height:a,context:r,cell:t,style:k,scale:this.layout.scale||1}).handled)return g}if(!t.formatted)return this.RenderCellBackground(!!t.note,i,g.tile_overflow_bottom||g.tile_overflow_right?this.buffer_context:r,w,n,a),g;var M=R.Font(w,this.layout.scale);M!==this.last_font&&(r.font=this.last_font=M),!b&&t.renderer_data&&t.renderer_data.width===n&&t.renderer_data.height===a||(t.renderer_data={text_data:this.PrepText(r,t,n),width:n,height:a});var T=t.renderer_data.text_data,E=T.width>n-2*this.cell_edge_buffer,z=n,D=0,P=!1,I=t.type===u.number||t.calculated_type===u.number||t.type===u.complex||t.calculated_type===u.complex,U=w.horizontal_align;U===R.HorizontalAlign.None&&(U=I?R.HorizontalAlign.Right:R.HorizontalAlign.Left);var O=[];if(E)if(t.type===u.number||t.calculated_type===u.number||w.wrap||t.merge_area)P=!I;else{var V=T.width-n+this.cell_edge_buffer,H=0,j=0;U===R.HorizontalAlign.Center?H=j=V/2:U===R.HorizontalAlign.Right?H=V:j=V;for(var G=i.column,B=i.column;j>0&&G<this.layout.last_column;){G++;var Z={row:i.row,column:G},J=this.model.active_sheet.CellData(Z);if(j-=q=this.layout.ColumnWidth(G),!J||J.type||J.calculated_type){P=!0;break}O.push({address:Z,cell:J,grid:new L(z,0,q,a),background:new L(z-1,0,q,a-1),border:new L(z,0,q,a)}),z+=q,J.render_dirty=!1,J.renderer_data={overflowed:!0}}for(G>e.last_cell.column&&(g.tile_overflow_right=!0);H>0&&B>=1;){var q;if(B--,Z={row:i.row,column:B},J=this.model.active_sheet.CellData(Z),H-=q=this.layout.ColumnWidth(B),!J||J.type||J.calculated_type){P=!0;break}D-=q,O.push({address:Z,cell:J,grid:new L(D,0,q,a),background:new L(D,0,q,a-1),border:new L(D,0,q,a)})}B<e.first_cell.column&&(g.tile_overflow_left=!0),this.overflow_areas.push({head:o({},i),tile:e,area:new f({row:i.row,column:B},{row:i.row,column:G})})}var W=!1,K=r;(g.tile_overflow_bottom||g.tile_overflow_left||g.tile_overflow_right)&&(W=!0,g.width=z-D,g.height=a,g.left=D,this.EnsureBuffer(g.width+1,a+1,-D),(r=this.buffer_context).font=M),this.RenderCellBackground(!!t.note,i,r,w,n,a);try{for(var X=s(O),Y=X.next();!Y.done;Y=X.next()){var $=Y.value;(null===(y=$.cell.style)||void 0===y?void 0:y.fill)&&($.cell.style.fill.text||$.cell.style.fill.theme||0===$.cell.style.fill.theme)&&!this.options.grid_over_background?(r.fillStyle=N(this.theme,$.cell.style.fill),r.fillRect($.grid.left,$.grid.top,$.grid.width,$.grid.height)):(r.fillStyle=this.theme.grid_color||"",r.fillRect($.grid.left,$.grid.top,$.grid.width,$.grid.height),r.fillStyle=(null===(_=this.theme.grid_cell)||void 0===_?void 0:_.fill)?N(this.theme,this.theme.grid_cell.fill):"",r.fillRect($.background.left,$.background.top,$.background.width,$.background.height)),$.cell.style&&this.RenderCellBorders($.address,r,$.cell.style,$.border.left,$.border.top,$.border.width,$.border.height)}}catch(e){l={error:e}}finally{try{Y&&!Y.done&&(c=X.return)&&c.call(X)}finally{if(l)throw l.error}}var Q=Ze.Get(M);r.lineWidth=1,r.strokeStyle=r.fillStyle=T.format?T.format:F(this.theme,w.text,1),r.beginPath();var ee=this.cell_edge_buffer,te=1.3,re=T.single?1:T.strings.length,oe=re*Q.block*te;(P=(P||oe>=a)&&!W)&&(r.save(),r.beginPath(),r.moveTo(D+1.5,0),r.lineTo(D+1.5,a),r.lineTo(z-1.5,a),r.lineTo(z-1.5,0),r.clip()),r.beginPath();var ie=Math.round(a-2-Q.block*te*(re-1)+qe);switch(w.vertical_align){case R.VerticalAlign.Top:ie=Math.round(Q.block*te)+1;break;case R.VerticalAlign.Middle:ie=Math.round((a-oe)/2+Q.block*te)}if(t.type!==u.number&&t.calculated_type!==u.number&&t.type!==u.complex&&t.calculated_type!==u.complex||!E)if(T.single){U===R.HorizontalAlign.Center?ee=Math.round((n-T.width)/2):U===R.HorizontalAlign.Right&&(ee=n-this.cell_edge_buffer-T.width);var ne=ie-.5-qe,ae=Math.round(ie-Q.ascender/2)+.5;try{for(var se=s(T.strings),le=se.next();!le.done;le=se.next())(pe=le.value).hidden||(r.fillText(pe.text,ee,ie),w.font_underline&&(r.moveTo(ee,ne),r.lineTo(ee+pe.width,ne)),w.font_strike&&(r.moveTo(ee,ae),r.lineTo(ee+pe.width,ae))),A&&(pe.left=ee,pe.top=ie-Q.block,pe.height=Q.block),ee+=pe.width}catch(e){d={error:e}}finally{try{le&&!le.done&&(h=se.return)&&h.call(se)}finally{if(d)throw d.error}}}else{var ce=ie,de=0,ue=r.font;/italic/i.test(ue);try{for(var he=s(T.strings),fe=he.next();!fe.done;fe=he.next()){var pe=fe.value;U===R.HorizontalAlign.Center?ee=Math.round((n-pe.width)/2):U===R.HorizontalAlign.Right&&(ee=n-this.cell_edge_buffer-pe.width),w.font_underline&&(ne=ce-.5-qe,r.moveTo(ee,ne),r.lineTo(ee+pe.width,ne)),w.font_strike&&(ae=Math.round(ce-Q.ascender/2)+.5,r.moveTo(ee,ae),r.lineTo(ee+pe.width,ae)),r.fillText(pe.text,ee,ce),A&&(pe.left=ee,pe.top=ce-Q.block,pe.height=Q.block),de++,ce=Math.round(ie+de*Q.block*te)}}catch(e){p={error:e}}finally{try{fe&&!fe.done&&(m=he.return)&&m.call(he)}finally{if(p)throw p.error}}}else{for(var me=Math.floor((n-2*this.cell_edge_buffer)/Q.hash),ve="",ye=0;ye<me;ye++)ve+="#";var _e=r.measureText(ve).width;U===R.HorizontalAlign.Center?ee=Math.round((n-_e)/2):U===R.HorizontalAlign.Right&&(ee=n-this.cell_edge_buffer-_e),r.fillText(ve,ee,ie)}if(r.stroke(),P)r.restore();else if(W){var ge=this.layout.dpr;K.drawImage(this.buffer_canvas,0,0,(g.width||0)*ge,a*ge,D,0,g.width||0,a)}return g},e}(),Ke=function(e){function r(t,r,o,i,n,a){var s=e.call(this,r,o,i,a)||this;s.container=t,s.options=n,s.focused_=!1,s.lines=1,s.last_formula="",s.label_update_timer=0;var l=ke.CreateDiv("treb-formula-bar-container notranslate",t),c=ke.CreateDiv("treb-formula-bar",l);return s.address_label_container=ke.CreateDiv("address-label",c),s.address_label=ke.CreateDiv("",s.address_label_container),s.InitAddressLabel(),s.options.insert_function_button&&(s.button=ke.Create("button","formula-button",c),s.button.addEventListener("click",(function(){var e=s.editor_node&&s.editor_node.textContent||"";s.Publish({type:"formula-button",formula:e})}))),s.container_node=ke.CreateDiv("editor-container",c),s.editor_node=ke.CreateDiv("formula-editor",s.container_node),s.editor_node.setAttribute("contenteditable","true"),s.editor_node.spellcheck=!0,s.editor_node.addEventListener("focusin",(function(){if(s.editor_node){var e=s.editor_node.textContent||"";"{"===e[0]&&"}"===e[e.length-1]&&(e=e.substr(1,e.length-2),s.editor_node.textContent=e,s.last_reconstructed_text=""),s.editor_node.spellcheck="="!==e[0],s.autocomplete.ResetBlock(),J().then((function(){s.Reconstruct()}));var t=s.ListDependencies();s.Publish([{type:"start-editing",editor:"formula-bar"},{type:"update",text:e,cell:s.active_cell,dependencies:t},{type:"retain-focus",focus:!0}]),s.focused_=!0}})),s.editor_node.addEventListener("focusout",(function(){s.autocomplete.Hide(),s.Publish([{type:"stop-editing"},{type:"retain-focus",focus:!1}]),s.focused_=!1})),s.editor_node.addEventListener("keydown",(function(e){return s.FormulaKeyDown(e)})),s.editor_node.addEventListener("keyup",(function(e){return s.FormulaKeyUp(e)})),s.editor_node.addEventListener("input",(function(){s.Reconstruct(),s.UpdateSelectState()})),s.options.expand_formula_button&&(s.expand_button=ke.Create("button","expand-button",c),s.expand_button.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),s.editor_node&&(s.editor_node.scrollTop=0),c.classList.toggle("expanded")}))),s}return t(r,e),Object.defineProperty(r.prototype,"focused",{get:function(){return this.focused_},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"formula",{get:function(){return this.editor_node&&this.editor_node.textContent||""},set:function(e){this.editor_node&&(this.editor_node.textContent=e,this.last_reconstructed_text=""),this.last_formula=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"label",{get:function(){var e;return(null===(e=this.address_label)||void 0===e?void 0:e.textContent)||""},set:function(e){var t=this;e.trim().length?(this.address_label.textContent=e,this.label_update_timer||(this.label_update_timer=requestAnimationFrame((function(){t.label_update_timer=0,t.address_label.scrollWidth>t.address_label.offsetWidth?t.address_label.setAttribute("title",e):t.address_label.removeAttribute("title")})))):(this.address_label.innerHTML="&nbsp;",this.address_label.removeAttribute("title"))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"editable",{set:function(e){this.editor_node&&this.container_node&&(this.editor_node.setAttribute("contenteditable",e.toString()),e?this.container_node.classList.remove("locked"):this.container_node.classList.add("locked"))},enumerable:!1,configurable:!0}),r.prototype.IsElement=function(e){return e===this.editor_node},r.prototype.InitAddressLabel=function(){var e=this;this.address_label.contentEditable="true",this.address_label.spellcheck=!1,this.address_label.addEventListener("focusin",(function(t){requestAnimationFrame((function(){if(document.body.createTextRange)(t=document.body.createTextRange()).moveToElementText(e.address_label),t.select();else{var t,r=window.getSelection();(t=document.createRange()).selectNodeContents(e.address_label),null==r||r.removeAllRanges(),null==r||r.addRange(t)}}))})),this.address_label.addEventListener("keydown",(function(t){switch(t.key){case"Enter":t.stopPropagation(),t.preventDefault(),e.Publish({type:"address-label-event",text:e.address_label.textContent||void 0});break;case"Esc":case"Escape":t.stopPropagation(),t.preventDefault(),e.Publish({type:"address-label-event"})}}))},r.prototype.FocusEditor=function(){this.editor_node&&this.editor_node.focus()},r.prototype.GetTextContent=function(e){for(var t=e.childNodes,r=[],o=0;o<t.length;o++){var i=t[o];switch(i.nodeType){case Node.ELEMENT_NODE:r.push.apply(r,c([],l(this.GetTextContent(i)))),i instanceof Element&&"DIV"===i.tagName&&r.push("\n");break;case Node.TEXT_NODE:i.nodeValue&&r.push(i.nodeValue)}}return r},r.prototype.FormulaKeyDown=function(e){var t=this.autocomplete.HandleKey("keydown",e);if(t.accept&&this.AcceptAutocomplete(t),!t.handled){switch(e.key){case"Enter":case"Tab":this.selecting_=!1;var r="Enter"===e.key&&e.ctrlKey&&e.shiftKey,o=(this.editor_node?this.GetTextContent(this.editor_node).join(""):"").trim();this.Publish({type:"commit",selection:this.selection,value:o,event:e,array:r}),this.FlushReference();break;case"Escape":case"Esc":this.selecting_=!1,this.Publish({type:"discard"}),this.FlushReference();break;default:return}e.stopPropagation(),e.preventDefault()}},r.prototype.FormulaKeyUp=function(e){this.autocomplete.HandleKey("keyup",e).handled||(this.FlushReference(),this.trident&&(this.UpdateSelectState(),this.Reconstruct()))},r}(He),Xe={scrollbars:!0,in_cell_editor:!0,formula_bar:!0,add_tab:!1,tab_bar:"auto",insert_function_button:!1,expand_formula_button:!1,expand:!0,repaint_on_cell_change:!0,grid_over_background:!1};!function(e){e.None="none",e.All="all",e.Outside="outside",e.Top="top",e.Bottom="bottom",e.Left="left",e.Right="right",e.DoubleTop="double-top",e.DoubleBottom="double-bottom"}(je||(je={}));var Ye,$e=function(){function e(e){var t=this;void 0===e&&(e={}),this.options=e,this.completion_list_visible=!1,this.tooltip_visible=!1,this.selected_index=0,this.block=!1,this.autocomplete_data={},this.completion_list=ke.CreateDiv("treb-cell-editor-ac-list treb-autocomplete",e.container||document.body),this.completion_list.addEventListener("mousedown",(function(e){return t.ListMouseDown(e)})),this.completion_list.addEventListener("mousemove",(function(e){return t.ListMouseMove(e)})),this.tooltip=ke.CreateDiv("treb-cell-editor-ac-tooltip treb-autocomplete-tooltip",e.container||document.body)}return e.prototype.Hide=function(){this.tooltip.style.top="-1000px",this.completion_list.style.top="-1000px",this.completion_list_visible=!1,this.tooltip_visible=!1,this.active_element=void 0},e.prototype.ResetBlock=function(){this.block=!1},e.prototype.ListMouseMove=function(e){var t=e.target;"A"===t.tagName&&t!==this.active_element&&this.active_element&&(this.active_element.classList.remove("selected"),this.active_element=t,this.active_element.classList.add("selected"),this.selected_index=Number(t.dataset.index||"0"),this.last_completion=t.textContent||"")},e.prototype.ListMouseDown=function(e){e.stopPropagation(),e.preventDefault();for(var t=e.target;t;){if(t===this.completion_list)return;if("A"===t.tagName)break;t=t.parentElement}t&&(console.info(t),this.callback&&this.callback({handled:!0,accept:!0,value:t.textContent?t.textContent:void 0,data:this.autocomplete_data,click:!0}))},e.prototype.HandleKey=function(e,t){if(!this.completion_list_visible)return{handled:!1};var r=0,o=!1,i=!1;switch(t.key){case"Up":case"ArrowUp":r=-1;break;case"Down":case"ArrowDown":r=1;break;case"Tab":i=!0;break;case"Escape":case"Esc":o=!0;break;default:return{handled:!1}}if(t.stopPropagation(),t.preventDefault(),"keyup"===e)return{handled:!0};if(r){var n=this.completion_list.getBoundingClientRect();this.selected_index+=r,this.selected_index=Math.max(0,this.selected_index);var a=this.completion_list.querySelectorAll("a");this.selected_index=Math.min(this.selected_index,a.length-1);for(var s=0;s<a.length;s++){var l=a[s];if(s===this.selected_index){l.classList.add("selected"),this.active_element=l;var c=l.getBoundingClientRect();c.top<n.top?this.completion_list.scrollBy(0,-c.height):c.bottom>n.bottom&&this.completion_list.scrollBy(0,c.height),this.last_completion=l.textContent||void 0}else l.classList.remove("selected")}return{handled:!0}}return o?(this.block=!0,this.Hide(),{handled:!0}):i?{handled:!0,accept:!0,value:this.last_completion,data:this.autocomplete_data}:{handled:!1}},e.prototype.Show=function(e,t,r){var o=this;if(void 0===t&&(t={}),this.completion_list_visible=!1,this.tooltip_visible=!1,this.autocomplete_data=t,this.callback=e,!this.block)if(t.tooltip?(this.tooltip.innerHTML=t.tooltip+t.arguments+(t.description?"\n"+t.description:""),this.tooltip.style.left=r.left+"px",this.options.tooltip_prefer_top?this.tooltip.style.top=r.top-this.tooltip.offsetHeight-5+"px":this.tooltip.style.top=r.bottom+5+"px",this.tooltip_visible=!0):this.tooltip.style.top="-1000px",t.completions&&t.completions.length){this.tooltip.style.top="-1000px",this.selected_index=0,this.completion_list.innerHTML='<ul class="notranslate">'+t.completions.map((function(e,t){return e.name===o.last_completion&&(o.selected_index=t),'<li><a data-index="'+t+'">'+e.name+"</a></li>"})).join("\n")+"<ul>";var i=this.completion_list.offsetHeight,n=!1;this.options.autocomplete_prefer_top?n=r.top>=200:document.documentElement&&Math.max(document.documentElement.clientHeight,window.innerHeight||0)-r.bottom<200&&(n=!0),this.completion_list.style.top=n?r.top-i-5+"px":r.bottom+5+"px",this.completion_list.style.left=r.left+"px";var a=this.completion_list.querySelectorAll("a");this.active_element=a[this.selected_index],a[this.selected_index].classList.add("selected"),this.last_completion=a[this.selected_index].textContent||void 0,this.completion_list.scrollTop=this.active_element.offsetTop,this.completion_list_visible=!0}else this.completion_list.style.top="-1000px"},e}();!function(e){e[e.Null=0]="Null",e[e.InsertRows=1]="InsertRows",e[e.InsertColumns=2]="InsertColumns",e[e.ResizeRows=3]="ResizeRows",e[e.ResizeColumns=4]="ResizeColumns",e[e.Select=5]="Select",e[e.SetRange=6]="SetRange",e[e.UpdateStyle=7]="UpdateStyle",e[e.UpdateBorders=8]="UpdateBorders",e[e.MergeCells=9]="MergeCells",e[e.UnmergeCells=10]="UnmergeCells",e[e.Clear=11]="Clear",e[e.UpdateTheme=12]="UpdateTheme",e[e.SetNote=13]="SetNote",e[e.SetLink=14]="SetLink",e[e.Freeze=15]="Freeze",e[e.SetName=16]="SetName",e[e.ShowHeaders=17]="ShowHeaders",e[e.AddSheet=18]="AddSheet",e[e.DuplicateSheet=19]="DuplicateSheet",e[e.DeleteSheet=20]="DeleteSheet",e[e.ActivateSheet=21]="ActivateSheet",e[e.RenameSheet=22]="RenameSheet",e[e.ReorderSheet=23]="ReorderSheet",e[e.ShowSheet=24]="ShowSheet",e[e.DataValidation=25]="DataValidation"}(Ye||(Ye={}));var Qe,et=function(){function e(){this.forward={},this.backward=[]}return e.prototype.Count=function(){return this.backward.length},e.prototype.Serialize=function(){return JSON.parse(JSON.stringify(this.Map()))},e.prototype.Deserialize=function(e){var t,r;if(this.Reset(),e){try{for(var o=s(Object.keys(e)),i=o.next();!i.done;i=o.next()){var n=i.value;this.SetName(n,new f(e[n].start,e[n].end),!1)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.RebuildList()}},e.prototype.MatchSelection=function(e,t){var r,o,i;if(!e.start.sheet_id)throw new Error("match selection without sheet id");try{for(var n=s(this.List()),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.range.start.sheet_id===e.start.sheet_id&&(l.range.Equals(e)&&(i=l.name),null==t?void 0:t.Equals(l.range)))return l.name}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return i},e.prototype.SetName=function(e,t,r){void 0===r&&(r=!0);var o=this.ValidateNamed(e);return o?t.entire_column||t.entire_row?(console.warn("invalid range"),!1):(this.forward[o]=t,r&&this.RebuildList(),!0):(console.warn("invalid name"),!1)},e.prototype.SetNames=function(e){var t,r;try{for(var o=s(Object.keys(e)),i=o.next();!i.done;i=o.next()){var n=i.value,a=e[n];this.SetName(n,new f(a.start,a.end),!1)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.RebuildList()},e.prototype.ClearName=function(e,t){void 0===t&&(t=!0),delete this.forward[e],t&&this.RebuildList()},e.prototype.Reset=function(){this.forward={},this.backward=[]},e.prototype.Get=function(e){return this.forward[e.toUpperCase()]},e.prototype.Map=function(){return this.forward},e.prototype.List=function(){return this.backward},e.prototype.ValidateNamed=function(e){return!!(e=e.trim()).length&&!/^[A-Za-z]{1,3}\d+$/.test(e)&&!/[^A-Za-z\d_.]/.test(e)&&!/^[^A-Za-z_]/.test(e)&&e.toUpperCase()},e.prototype.PatchNamedRanges=function(e,t,r,o){var i,n,a=this.List().slice(0);try{for(var l=s(a),c=l.next();!c.done;c=l.next()){var d=c.value,u=d.name,h=d.range;if(t&&e<=h.end.column)if(t>0)e<=h.start.column?h.Shift(0,t):e>h.start.column&&e<=h.end.column?h.ConsumeAddress({row:h.end.row,column:h.end.column+t}):console.warn("PNR X case 1",e,t,JSON.stringify(h));else if(t<0)if(e-t<=h.start.column)h.Shift(0,t);else if(e<=h.start.column&&e-t>h.end.column)this.ClearName(u,!1);else if(e<=h.start.column){var p=e-t-1;this.SetName(u,new f({row:h.start.row,column:p+1+t},{row:h.end.row,column:h.end.column+t}),!1)}else e<=h.end.column?(p=e-t-1)>=h.end.column?this.SetName(u,new f({row:h.start.row,column:h.start.column},{row:h.end.row,column:e-1}),!1):this.SetName(u,new f({row:h.start.row,column:h.start.column},{row:h.end.row,column:h.start.column+h.columns+t-1}),!1):console.warn("PNR X case 2",e,t,JSON.stringify(h));if(o&&r<=h.end.row)if(o>0)r<=h.start.row?h.Shift(o,0):r>h.start.row&&r<=h.end.row?h.ConsumeAddress({row:h.end.row+o,column:h.end.column}):console.warn("PNR X case 3",r,o,JSON.stringify(h));else if(o<0)if(r-o<=h.start.row)h.Shift(o,0);else if(r<=h.start.row&&r-o>h.end.row)this.ClearName(u,!1);else if(r<=h.start.row){var m=r-o-1;this.SetName(u,new f({column:h.start.column,row:m+1+o},{column:h.end.column,row:h.end.row+o}),!1)}else r<=h.end.row?(m=r-o-1)>=h.end.row?this.SetName(u,new f({column:h.start.column,row:h.start.row},{column:h.end.column,row:r-1}),!1):this.SetName(u,new f({column:h.start.column,row:h.start.row},{column:h.end.column,row:h.start.row+h.rows+o-1}),!1):console.warn("PNR X case 4",r,o,JSON.stringify(h))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}this.RebuildList()},e.prototype.RebuildList=function(){var e,t;this.backward=[];try{for(var r=s(Object.keys(this.forward)),o=r.next();!o.done;o=r.next()){var i=o.value;this.backward.push({name:i,range:this.forward[i]})}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e}(),tt=r(7646);Ne()(tt.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),tt.Z.locals,function(e){e[e.NotEditing=0]="NotEditing",e[e.CellEditor=1]="CellEditor",e[e.FormulaBar=2]="FormulaBar"}(Qe||(Qe={}));var rt,ot=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=P),this.grid_events=new X,this.command_log=new X,this.headless=!1,this.hover_data={},this.batch=!1,this.batch_events=[],this.editing_state=Qe.NotEditing,this.editing_cell={row:-1,column:-1,sheet_id:0},this.tile_update_pending=!1,this.parser=new Z,this.decimal_separator_code=46,this.RESIZE_PIXEL_BUFFER=5,this.select_argument=!1,this.cell_resize={row:-1,column:-1},this.render_tiles=new f({row:0,column:0}),this.primary_selection={target:{row:0,column:0},area:new f({row:0,column:0}),empty:!0},this.active_selection={target:{row:0,column:0},area:new f({row:0,column:0}),empty:!0},this.nub_select_flag=!1,this.additional_selections=[],this.double_click_data={},this.layout_token=0,this.render_token=0,this.autocomplete_matcher=new Ve,this.theme_style_properties=R.Composite([R.DefaultProperties]);var r,i=[Ae.Blank(this.theme_style_properties)];this.model={sheets:i,active_sheet:i[0],named_ranges:new et,macro_functions:{}},this.theme=JSON.parse(JSON.stringify(t)),this.options=o(o({},Xe),e),this.layout=(r=this.model,De.is_modern?new Le(r):new ze(r)),e.initial_scale&&("string"==typeof e.initial_scale&&(e.initial_scale=Number(e.initial_scale)),this.layout.scale=e.initial_scale),this.tile_renderer=new We(this.theme,this.layout,this.model,this.options),this.selection_renderer=new ge(this.theme,this.layout,this.model,this.primary_selection,this.additional_selections),"."===M.decimal_separator?(this.parser.decimal_mark=z.Period,this.parser.argument_separator=E.Comma):(this.parser.decimal_mark=z.Comma,this.parser.argument_separator=E.Semicolon),this.decimal_separator_code=M.decimal_separator.charCodeAt(0)}return Object.defineProperty(e.prototype,"active_sheet",{get:function(){return this.model.active_sheet},set:function(e){this.model.active_sheet=e},enumerable:!1,configurable:!0}),e.prototype.SetNote=function(e,t){if(!e){if(this.primary_selection.empty)return;e=this.primary_selection.target}this.ExecCommand({key:Ye.SetNote,address:e,note:t})},e.prototype.SetLink=function(e,t){if(!e){if(this.primary_selection.empty)return;e=this.primary_selection.target}this.ExecCommand({key:Ye.SetLink,address:e,reference:t})},e.prototype.FindAnnotation=function(e){var t,r;try{for(var o=s(this.active_sheet.annotations),i=o.next();!i.done;i=o.next()){var n=i.value;if(n.node===e)return n}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.CreateAnnotation=function(e,t,r,o){var i,n;void 0===e&&(e={}),void 0===t&&(t=!0),void 0===r&&(r=!1);var a=new Se(e);if(r)if(!a.layout&&a.scaled_rect&&(a.layout=this.layout.RectToAnnotationLayout(a.scaled_rect)),a.layout){for(var l=this.layout.AnnotationLayoutToRect(a.layout).Shift(20,20),c=!0;c;){c=!1;try{for(var d=(i=void 0,s(this.active_sheet.annotations)),u=d.next();!u.done;u=d.next()){var h=u.value;if(h!==a&&h.scaled_rect&&h.scaled_rect.top===l.top&&h.scaled_rect.left===l.left){l=l.Shift(20,20),c=!0;break}}}catch(e){i={error:e}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}}a.layout=this.layout.RectToAnnotationLayout(l)}else console.warn("can't offset annotation without layout");return o&&(L.IsRectangle(o)?(a.layout=void 0,a.rect=L.Create(o)):o.start&&(a.rect=void 0,a.layout=this.layout.AddressToAnnotationLayout(o.start,o.end||o.start))),t&&(this.active_sheet.annotations.some((function(e){return e===a}))||this.active_sheet.annotations.push(a),this.AddAnnotation(a)),a},e.prototype.UpdateScale=function(e){var t,r,o,i,n,a;void 0===e&&(e=1),this.layout.scale=e,this.UpdateLayout(),this.UpdateAnnotationLayout(),this.layout.UpdateAnnotation(this.active_sheet.annotations),this.layout.ApplyTheme(this.theme),null===(n=this.overlay_editor)||void 0===n||n.UpdateTheme(e),null===(a=this.tab_bar)||void 0===a||a.UpdateScale(e),this.grid_events.Publish({type:"scale",scale:e});try{for(var l=s(this.model.sheets),c=l.next();!c.done;c=l.next()){var d=c.value;try{for(var u=(o=void 0,s(d.annotations)),h=u.next();!h.done;h=u.next())h.value.dirty=!0}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}},e.prototype.UpdateAnnotationLayout=function(){},e.prototype.AddAnnotation=function(e,t,r){var o=this;if(void 0===t&&(t=!1),void 0===r&&(r=!0),!e.node){e.node=document.createElement("div"),e.node.dataset.scale=this.layout.scale.toString(),e.node.style.fontSize=10*this.layout.scale+"pt",e.content_node=ke.CreateDiv("annotation-content",e.node);var i=ke.CreateDiv("annotation-move-target",e.node),n=ke.CreateDiv("annotation-resize-target",e.node);if(e.node){var a=e.node;a.setAttribute("tabindex","-1"),a.addEventListener("mousedown",(function(t){o.layout.AnnotationMouseDown(e,a,t,i,n).then((function(e){e&&o.grid_events.Publish(e)}))})),e.node.addEventListener("focusin",(function(){var t,r;try{for(var i=s(o.layout.GetFrozenAnnotations(e)),n=i.next();!n.done;n=i.next())n.value.classList.add("clone-focus")}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}o.selected_annotation=e,o.primary_selection.empty=!0,o.primary_selection.target={row:-1,column:-1,sheet_id:o.active_sheet.id},o.HideGridSelection()})),e.node.addEventListener("focusout",(function(t){var r,i;try{for(var n=s(o.layout.GetFrozenAnnotations(e)),a=n.next();!a.done;a=n.next())a.value.classList.remove("clone-focus")}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}o.formula_bar&&o.formula_bar.IsElement(t.relatedTarget)?(o.primary_selection.empty=!0,o.RenderSelections(),o.editing_annotation=e,o.layout.ShowSelections(!0)):(o.selected_annotation===e&&(o.selected_annotation=void 0),o.ShowGridSelection())})),e.node.addEventListener("keydown",(function(t){var r,i,n=e.scaled_rect;if(n){var d=c([a],l(o.layout.GetFrozenAnnotations(e))),u={x:n.left,y:n.top};switch(t.key){case"ArrowUp":case"Up":t.ctrlKey?(o.layout.AnnotationLayoutOrder(e,1)&&o.grid_events.Publish({type:"annotation",event:"move",annotation:e}),a.focus()):u.y--;break;case"ArrowLeft":case"Left":if(t.ctrlKey)return;u.x--;break;case"ArrowRight":case"Right":if(t.ctrlKey)return;u.x++;break;case"ArrowDown":case"Down":t.ctrlKey?(o.layout.AnnotationLayoutOrder(e,-1)&&o.grid_events.Publish({type:"annotation",event:"move",annotation:e}),a.focus()):u.y++;break;case"Escape":case"Esc":o.Focus();break;case"Delete":case"Del":o.Focus(),o.RemoveAnnotation(e);break;default:return}if(t.stopPropagation(),t.preventDefault(),u.x=Math.max(u.x,0),u.y=Math.max(u.y,0),n.left!==u.x||n.top!==u.y){n.left=Math.round(u.x),n.top=Math.round(u.y);try{for(var h=s(d),f=h.next();!f.done;f=h.next()){var p=f.value;p.style.top=n.top+"px",p.style.left=n.left+"px"}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}e.extent=void 0,o.grid_events.Publish({type:"annotation",event:"move",annotation:e}),e.layout=o.layout.RectToAnnotationLayout(n)}}else console.info("missing scaled rect!")}))}}e.node.classList.add("annotation"),r&&this.layout.AddAnnotation(e),t||this.grid_events.Publish({type:"annotation",annotation:e,event:"create"})},e.prototype.AnnotationUpdated=function(e){this.layout.CloneFrozenAnnotation(e)},e.prototype.RemoveAnnotation=function(e){for(var t=0;t<this.active_sheet.annotations.length;t++)if(e===this.active_sheet.annotations[t])return this.active_sheet.annotations.splice(t,1),this.layout.RemoveAnnotation(e),void this.grid_events.Publish({type:"annotation",annotation:e,event:"delete"})},e.prototype.RemoveAnnotationNodes=function(){this.layout.RemoveAnnotationNodes()},e.prototype.Serialize=function(e){var t,r;void 0===e&&(e={}),this.active_sheet.selection=JSON.parse(JSON.stringify(this.primary_selection)),this.active_sheet.scroll_offset=this.layout.scroll_offset;var i,n=this.model.sheets.map((function(t){return t.toJSON(e)})),a=Object.keys(this.model.macro_functions);if(a.length){i=[];try{for(var l=s(a),c=l.next();!c.done;c=l.next()){var d=c.value;i.push(o(o({},this.model.macro_functions[d]),{expression:void 0}))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}return{sheet_data:n,active_sheet:this.active_sheet.id,named_ranges:this.model.named_ranges.Count()?this.model.named_ranges.Serialize():void 0,macro_functions:i}},e.prototype.RealArea=function(e){return this.active_sheet.RealArea(e)},e.prototype.CellRenderData=function(e){return this.active_sheet.CellData(e)},e.prototype.Clear=function(){this.ExecCommand({key:Ye.Clear})},e.prototype.FromCSV=function(e){var t=function(e,t){void 0===t&&(t=",");var r=U.default,o=[],i="",n=[],a=e.length;if(/[\r\n"]/.test(t))throw new Error("invalid delimiter");for(var s=0;s<a;s++){var l=e[s];if(r===U.default)switch(l){case t:o.push(i),i="";break;case"\r":break;case"\n":o.push(i),i="",n.push(o),o=[];break;case'"':0===i.length?r=U.quoted:i+=l;break;default:i+=l}else'"'===l?s+1<a&&'"'===e[s+1]?(i+='"',s++):r=U.default:i+=l}return(o.length||i.length)&&(o.push(i),n.push(o)),n}(e).map((function(e){return e.map((function(e){return pe.TryParse(e).value}))})),r={row:Math.max(0,t.length-1),column:t.reduce((function(e,t){return Math.max(e,Math.max(0,t.length-1))}),0)};this.ExecCommand([{key:Ye.Clear},{key:Ye.SetRange,area:{start:{row:0,column:0},end:r},value:t}])},e.prototype.ShowHeaders=function(e){void 0===e&&(e=!0),this.ExecCommand({key:Ye.ShowHeaders,show:e})},e.prototype.FromImportData=function(e,t){var r,o,i,n,a,l=this;void 0===t&&(t=!1),this.RemoveAnnotationNodes();var c,d=e.sheets,u=d.map((function(){return Ae.Blank(l.theme_style_properties).toJSON()}));if("number"==typeof e.active_tab)c=null===(a=u[e.active_tab])||void 0===a?void 0:a.id;else for(var h=0;h<e.sheets.length;h++)if(!e.sheets[h].hidden){c=u[h].id;break}this.UpdateSheets(u,!0,c);var p={};for(this.model.macro_functions={},this.ClearSelection(this.primary_selection),h=0;h<d.length;h++){var m=this.model.sheets[h];m.ImportData(d[h]),p[m.name]=m.id}if(this.model.named_ranges.Reset(),e.names){try{for(var v=s(Object.keys(e.names)),y=v.next();!y.done;y=v.next()){var _,g=y.value,b=e.names[g],w=this.parser.Parse(b);if(w.expression)"range"===w.expression.type&&(_=p[w.expression.start.sheet||""])&&(w.expression.start.sheet_id=_,this.model.named_ranges.SetName(g,new f(w.expression.start,w.expression.end),!1)),"address"===w.expression.type&&(_=p[w.expression.sheet||""])&&(w.expression.sheet_id=_,this.model.named_ranges.SetName(g,new f(w.expression),!1))}}catch(e){r={error:e}}finally{try{y&&!y.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}this.model.named_ranges.RebuildList()}try{for(var x=s(this.active_sheet.annotations),C=x.next();!C.done;C=x.next()){var S=C.value;this.AddAnnotation(S,!0)}}catch(e){i={error:e}}finally{try{C&&!C.done&&(n=x.return)&&n.call(x)}finally{if(i)throw i.error}}this.QueueLayoutUpdate(),this.StyleDefaultFromTheme(),t&&this.Repaint(!1,!1),this.tab_bar&&this.tab_bar.Update()},e.prototype.ResetMetadata=function(){this.model.document_name=void 0,this.model.user_data=void 0},e.prototype.NextSheet=function(e){if(void 0===e&&(e=1),1!==this.model.sheets.length)for(var t=0;t<this.model.sheets.length;t++)if(this.model.sheets[t]===this.active_sheet){for(var r=(t+e)%this.model.sheets.length;r<0;)r+=this.model.sheets.length;return void this.ActivateSheet(r)}},e.prototype.InsertSheet=function(e,t){var r=this;if(void 0===e&&!this.model.sheets.some((function(t,o){return t===r.active_sheet&&(e=o+1,!0)})))throw new Error("invalid index");this.ExecCommand({key:Ye.AddSheet,insert_index:e,name:t})},e.prototype.DeleteSheet=function(e){var t=this;if(void 0===e&&!this.model.sheets.some((function(r,o){return r===t.active_sheet&&(e=o,!0)})))throw new Error("invalid index");this.ExecCommand({key:Ye.DeleteSheet,index:e})},e.prototype.DuplicateSheet=function(e,t,r){var o={key:Ye.DuplicateSheet,new_name:t,insert_before:r};void 0===e?o.id=this.active_sheet.id:o.index=e,this.ExecCommand(o)},e.prototype.AddSheet=function(e){this.ExecCommand({key:Ye.AddSheet,name:e})},e.prototype.ActivateSheet=function(e){var t="number"==typeof e?e:void 0,r="string"==typeof e?e:void 0;this.ExecCommand({key:Ye.ActivateSheet,index:t,name:r})},e.prototype.ActivateSheetID=function(e){this.ExecCommand({key:Ye.ActivateSheet,id:e})},e.prototype.ShowAll=function(){for(var e=[],t=0;t<this.model.sheets.length;t++)e.push({key:Ye.ShowSheet,index:t,show:!0});this.ExecCommand(e)},e.prototype.ShowSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!0);var r={key:Ye.ShowSheet,show:t};"string"==typeof e?r.name=e:r.index=e,this.ExecCommand(r)},e.prototype.UpdateSheets=function(e,t,r){var o,i,n,a,l,c,d,u,h=this;void 0===t&&(t=!1),this.RemoveAnnotationNodes(),Ae.Reset();var p=e.map((function(e){return Ae.FromJSON(e,h.theme_style_properties)}));if(0===p.length&&p.push(Ae.Blank(this.theme_style_properties)),this.model.sheets=p,this.active_sheet=p[0],r)if("number"==typeof r)try{for(var m=s(this.model.sheets),v=m.next();!v.done;v=m.next())if(r===(C=v.value).id){this.active_sheet=C;break}}catch(e){o={error:e}}finally{try{v&&!v.done&&(i=m.return)&&i.call(m)}finally{if(o)throw o.error}}else if("string"==typeof r)try{for(var y=s(this.model.sheets),_=y.next();!_.done;_=y.next())if(r===(C=_.value).name){this.active_sheet=C;break}}catch(e){n={error:e}}finally{try{_&&!_.done&&(a=y.return)&&a.call(y)}finally{if(n)throw n.error}}if(this.ClearSelection(this.primary_selection),e[0]&&e[0].primary_selection){var g=e[0].primary_selection;g.empty||this.Select(this.primary_selection,new f(g.area.start,g.area.end),g.target)}else if(!this.active_sheet.selection.empty){var b=this.active_sheet.selection;this.Select(this.primary_selection,new f(b.area.start,b.area.end),b.target)}this.ResetMetadata(),this.layout.ClearLayoutCaches();try{for(var w=s(this.model.sheets),x=w.next();!x.done;x=w.next()){var C=x.value;try{for(var S=(d=void 0,s(C.annotations)),A=S.next();!A.done;A=S.next()){var k=A.value;this.AddAnnotation(k,!0,C===this.active_sheet)}}catch(e){d={error:e}}finally{try{A&&!A.done&&(u=S.return)&&u.call(S)}finally{if(d)throw d.error}}}}catch(e){l={error:e}}finally{try{x&&!x.done&&(c=w.return)&&c.call(w)}finally{if(l)throw l.error}}this.QueueLayoutUpdate(),this.StyleDefaultFromTheme(),t&&this.Repaint(!1,!1),this.tab_bar&&this.tab_bar.Update()},e.prototype.UpdateLayout=function(){this.layout.UpdateTiles(),this.render_tiles=this.layout.VisibleTiles(),this.Repaint(!0)},e.prototype.ApplyTheme=function(){this.UpdateTheme(!0)},e.prototype.UpdateTheme=function(e,t){var r,i,n;if(void 0===e&&(e=!1),!e)try{for(var a=s(Object.keys(this.theme)),l=a.next();!l.done;l=a.next()){var c=l.value;delete this.theme[c]}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}var d=JSON.parse(JSON.stringify(P));if(this.grid_container){var u=function(e){var t,r,o,i=JSON.parse(JSON.stringify(P)),n=function(e,t){var r=document.createElement("div");return r.setAttribute("class",t),e.appendChild(r),r},a=n(e,""),s=function(e,t){return window.getComputedStyle(n(e,t))}.bind(0,a),l=s("grid-cells");i.grid_cell=I(l),i.grid_color=l.stroke||"",l=s("grid-headers"),i.headers=I(l),l=s("note-marker"),i.note_marker_color=l.backgroundColor,a.style.color="rgba(1,2,3,.4)";var c=(l=s("")).color;i.theme_colors=[(null===(t=i.grid_cell.fill)||void 0===t?void 0:t.text)||"rgb(255, 255, 255)",(null===(r=i.grid_cell.text)||void 0===r?void 0:r.text)||"rgb(51, 51, 51)"];for(var d=1;d<32&&(l=s("theme-color-"+d)).color&&l.color!==c;d++)i.theme_colors.push(l.color);var u=document.createElement("canvas");u.width=3,u.height=3;var h=u.getContext("2d");return h&&(i.theme_colors_rgb=i.theme_colors.map((function(e){h.fillStyle=e,h.fillRect(0,0,3,3);var t=h.getImageData(1,1,1,1);return Array.from(t.data)}))),null===(o=a.parentElement)||void 0===o||o.removeChild(a),i}(this.grid_container);d=o({},u)}d=o(o(o({},this.theme),d),t),Object.assign(this.theme,d),this.StyleDefaultFromTheme(),this.active_sheet.UpdateDefaultRowHeight(),this.active_sheet.FlushCellStyles(),this.layout.ApplyTheme(this.theme),e||(this.UpdateLayout(),null===(n=this.overlay_editor)||void 0===n||n.UpdateTheme(this.layout.scale),this.Repaint(!0,!0,!0))},e.prototype.Initialize=function(e,t){var r=this;void 0===t&&(t=!1),this.grid_container=e,e.classList.add("treb-main"),De.is_windows&&e.classList.add("treb-ua-windows"),e.classList.add("treb-theme"),this.ApplyTheme();var o,i=document.createElement("div"),n=document.createElement("div");n.classList.add("treb-layout-master"),n.appendChild(i),e.appendChild(n),this.options.formula_bar&&(o||(o=new $e({theme:this.theme,container:i})),this.InitFormulaBar(e,o)),this.options.tab_bar&&(this.tab_bar=new xe(this.layout,this.model,this.options,this.theme,e),this.tab_bar.Subscribe((function(e){switch(e.type){case"cancel":break;case"scale":var t=r.layout.scale;switch(e.action){case"increase":t+=.05;break;case"decrease":t-=.05;break;default:t=e.action}t=Math.round(100*t)/100,t=Math.min(2,Math.max(t,.5)),r.options.persist_scale_key&&localStorage.setItem(r.options.persist_scale_key,JSON.stringify({scale:t})),r.UpdateScale(t);break;case"reorder-sheet":r.ReorderSheet(e.index,e.move_before);break;case"delete-sheet":r.DeleteSheet();break;case"add-sheet":r.AddSheet();break;case"rename-sheet":r.RenameSheet(e.sheet,e.name);break;case"activate-sheet":r.ActivateSheetID(e.sheet.id)}r.Focus()}))),this.container=i,this.container.classList.add("treb-grid"),De.is_mac&&De.is_safari&&this.container.classList.add("safari"),this.container.setAttribute("tabindex","-1"),this.layout.Initialize(i,(function(){return r.OnScroll()}),(function(e){return r.OnDropdownSelect(e)}),this.options.scrollbars),this.selection_renderer.Initialize(),this.layout.UpdateTiles(),o||(o=new $e({theme:this.theme,container:i})),this.InitOverlayEditor(o),this.AttachListeners(),this.render_tiles=this.layout.VisibleTiles(),t||this.Repaint(!0)},e.prototype.MergeSelection=function(){this.primary_selection.empty||(this.layout.HideDropdownCaret(),this.ExecCommand({key:Ye.MergeCells,area:this.primary_selection.area}))},e.prototype.UnmergeSelection=function(){this.primary_selection.empty||(this.layout.HideDropdownCaret(),this.ExecCommand({key:Ye.UnmergeCells,area:this.primary_selection.area}))},e.prototype.Focus=function(){var e,t;De.is_mobile?null===(e=this.container)||void 0===e||e.focus():null===(t=this.overlay_editor)||void 0===t||t.Focus()},e.prototype.SetValidation=function(e,t){if(!e){if(this.primary_selection.empty)throw new Error("invalid target in set validation");e=this.primary_selection.target}console.info("target",e);var r={key:Ye.DataValidation,target:e};t&&(Array.isArray(t)?r.list=t:"object"==typeof t&&t.start&&t.end&&h(t.start)&&h(t.end)&&(r.range=t)),this.ExecCommand(r)},e.prototype.SetName=function(e,t){var r={key:Ye.SetName,name:e};t&&(h(t)&&(t=new f(t)),t.start.sheet_id||(t=new f(o(o({},t.start),{sheet_id:this.active_sheet.id}),t.end)),r.area=new f(t.start,t.end)),this.ExecCommand(r)},e.prototype.GetNumberFormat=function(e){var t=this.active_sheet.CellStyleData(e);if(t&&t.number_format)return ue.Get(t.number_format).toString()},e.prototype.SelectAll=function(){this.Select(this.primary_selection,new f({row:1/0,column:1/0}),void 0,!0),this.RenderSelections()},e.prototype.SelectRange=function(e){this.Select(this.primary_selection,e),this.RenderSelections()},e.prototype.GetRange=function(e,t,r){var o,i,n,a;void 0===t&&(t=!1),void 0===r&&(r=!1);var l=0;if(h(e)){l=e.sheet_id||this.active_sheet.id;try{for(var c=s(this.model.sheets),d=c.next();!d.done;d=c.next())if((p=d.value).id===l)return t?p.cells.RawValue(e):r?p.GetFormattedRange(e):p.cells.GetRange(e)}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}else{l=e.start.sheet_id||this.active_sheet.id;try{for(var u=s(this.model.sheets),f=u.next();!f.done;f=u.next()){var p;if((p=f.value).id===l)return t?p.cells.RawValue(e.start,e.end):r?p.GetFormattedRange(e.start,e.end):p.cells.GetRange(e.start,e.end)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}},e.prototype.SetRange=function(e,t,r,o,i){if(void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=!1),Array.isArray(t)){if(!((p=t)&&Array.isArray(p)&&Array.isArray(p[0])))if(r){var n=e.entire_column?this.active_sheet.rows:e.rows,a=e.entire_row?this.active_sheet.columns:e.columns,s=n*a;if(s>t.length){for(var l=t.slice(0),c=Math.ceil(s/l.length),d=1;d<c;d++)l=l.concat(t.slice(0));t=l}for(var u=[],h=0,f=0;h<a;h++,f+=n)u[h]=t.slice(f,f+n);t=u}else t=[t];o&&(t=this.Transpose(t)),this.ExecCommand({key:Ye.SetRange,area:e,value:t,array:i})}else r||i?this.ExecCommand({key:Ye.SetRange,area:e,value:t,array:i}):this.ExecCommand({key:Ye.SetRange,area:e.start,value:t,array:i});var p;!this.primary_selection.empty&&e.Contains(this.primary_selection.target)&&this.UpdateFormulaBarFormula()},e.prototype.SetRowHeight=function(e,t){this.ExecCommand({key:Ye.ResizeRows,row:e,height:t})},e.prototype.SetColumnWidth=function(e,t){void 0===t&&(t=0),this.ExecCommand({key:Ye.ResizeColumns,column:e,width:t})},e.prototype.ApplyStyle=function(e,t,r){if(void 0===t&&(t={}),void 0===r&&(r=!0),!e){if(this.primary_selection.empty)return;e=this.primary_selection.area}this.ExecCommand({key:Ye.UpdateStyle,area:e,style:t,delta:r}),this.UpdateFormulaBarFormula()},e.prototype.GetSelection=function(){return this.primary_selection},e.prototype.Update=function(e,t){void 0===e&&(e=!1),this.DelayedRender(e,t)},e.prototype.ApplyBorders=function(e,t,r,o){if(void 0===t&&(t=je.None),void 0===o&&(o=1),!e){if(this.primary_selection.empty)return;e=this.primary_selection.area}t===je.None&&(o=0),this.ExecCommand({key:Ye.UpdateBorders,color:{text:r},area:e,borders:t,width:o})},e.prototype.ApplyBorders2=function(e,t,r,o){if(void 0===t&&(t=je.None),void 0===o&&(o=1),!e){if(this.primary_selection.empty)return;e=this.primary_selection.area}t===je.None&&(o=0),this.ExecCommand({key:Ye.UpdateBorders,color:r,area:e,borders:t,width:o})},e.prototype.GetFreeze=function(){return o({},this.active_sheet.freeze)},e.prototype.Freeze=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=!0),this.ExecCommand({key:Ye.Freeze,rows:e,columns:t,highlight_transition:r})},e.prototype.Batch=function(e,t){void 0===t&&(t=!0),this.batch=!0,e(),this.batch=!1;var r=this.batch_events.slice(0);return this.batch_events=[],t&&this.DelayedRender(!1),r},e.prototype.DeleteColumns=function(){if(!this.primary_selection.empty){var e=this.primary_selection.area;if(e.entire_row)this.Clear();else{var t=e.start.column,r=-e.columns;this.ExecCommand({key:Ye.InsertColumns,before_column:t,count:r})}}},e.prototype.DeleteRows=function(){if(!this.primary_selection.empty){var e=this.primary_selection.area;if(e.entire_column)this.Clear();else{var t=e.start.row,r=-e.rows;this.ExecCommand({key:Ye.InsertRows,before_row:t,count:r})}}},e.prototype.InsertColumn=function(){if(!this.primary_selection.empty){var e=this.primary_selection.area,t=e.entire_row?0:e.start.column;this.InsertColumns(t,1)}},e.prototype.InsertColumns=function(e,t){void 0===e&&(e=0),void 0===t&&(t=1),this.ExecCommand({key:Ye.InsertColumns,before_column:e,count:t})},e.prototype.ReorderSheet=function(e,t){this.ExecCommand({key:Ye.ReorderSheet,index:e,move_before:t})},e.prototype.RenameSheet=function(e,t){void 0===e&&(e=this.active_sheet),this.ExecCommand({key:Ye.RenameSheet,new_name:t,id:e.id})},e.prototype.InsertRow=function(){if(!this.primary_selection.empty){var e=this.primary_selection.area,t=e.entire_column?0:e.start.row;this.InsertRows(t,1)}},e.prototype.InsertRows=function(e,t){void 0===e&&(e=0),void 0===t&&(t=1),this.ExecCommand({key:Ye.InsertRows,before_row:e,count:t})},e.prototype.SetAutocompleteFunctions=function(e){var t=e.slice(0).concat(this.model.named_ranges.List().map((function(e){return{name:e.name,type:we.Token}})));this.autocomplete_matcher.SetFunctions(t)},e.prototype.ScrollTo=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),this.layout.ScrollTo(e,t,r)},e.prototype.ScrollIntoView=function(e){this.options.scrollbars&&this.layout.ScrollIntoView(e)},e.prototype.GetScrollOffset=function(){return this.layout.GetScrollOffset()},e.prototype.DeleteSheetInternal=function(e){var t=this,r=!1,o=-1,i=e.name?e.name.toLowerCase():"",n=this.model.sheets.filter((function(n,a){return a!==e.index&&n.id!==e.id&&n.name.toLowerCase()!==i||(r=n===t.active_sheet,o=a,!1)}));if(n.length)if(n.every((function(e){return!e.visible})))n.unshift(Ae.Blank(this.theme_style_properties)),o=0;else for(o>=n.length&&(o=0);!n[o].visible;)o++;else n.push(Ae.Blank(this.theme_style_properties)),o=0;this.model.sheets=n,r&&this.ActivateSheetInternal({key:Ye.ActivateSheet,index:o}),this.tab_bar&&this.tab_bar.Update()},e.prototype.AddSheetInternal=function(e,t){if(void 0===e&&(e=Ae.default_sheet_name),void 0===t&&(t=-1),this.options.add_tab){for(;this.model.sheets.some((function(t){return t.name===e}));){var r=e.match(/^(.*?)(\d+)$/);r?e=r[1]+(Number(r[2])+1):e+="2"}var o=Ae.Blank(this.theme_style_properties,e);return t>=0?this.model.sheets.splice(t,0,o):this.model.sheets.push(o),this.tab_bar&&this.tab_bar.Update(),o.id}console.warn("add tab option not set or false")},e.prototype.DuplicateSheetInternal=function(e){if(this.options.add_tab){for(var t=this.ResolveSheet(e),r=this.model.sheets.reduce((function(e,t){return Math.max(e,t.id)}),0)+1,o=-1,i=0;i<this.model.sheets.length;i++)this.model.sheets[i]===t&&(o=i+1);if(!t||o<0)throw new Error("source sheet not found");if("number"==typeof e.insert_before)o=e.insert_before;else if("string"==typeof e.insert_before){var n=e.insert_before.toLowerCase();for(i=0;i<this.model.sheets.length;i++)if(this.model.sheets[i].name.toLowerCase()===n){o=i;break}}for(var a=Ae.FromJSON(t.toJSON({rendered_values:!0}),this.theme_style_properties),s=e.new_name||t.name;this.model.sheets.some((function(e){return e.name===s}));){var l=s.match(/^(.*?)(\d+)$/);l?s=l[1]+(Number(l[2])+1):s+="2"}return a.name=s,a.id=r,this.model.sheets.splice(o,0,a),this.tab_bar&&this.tab_bar.Update(),a.id}console.warn("add tab option not set or false")},e.prototype.ActivateSheetInternal=function(e){var t,r,o=this.SelectingArgument(),i=this.ResolveSheet(e)||this.model.sheets[0];if(this.active_sheet!==i){if(!i.visible)throw new Error("cannot activate hidden sheet");this.HideHoverInfo(),this.active_sheet.selection=JSON.parse(JSON.stringify(this.primary_selection)),this.active_sheet.scroll_offset=this.layout.scroll_offset;var n=this.active_sheet;this.RemoveAnnotationNodes(),this.active_sheet=i,o?this.RenderSelections():(this.ClearSelection(this.primary_selection),i.selection&&!i.selection.empty&&this.Select(this.primary_selection,new f(i.selection.area.start,i.selection.area.end),i.selection.target));var a=this.active_sheet.annotations;try{for(var l=s(a),c=l.next();!c.done;c=l.next()){var d=c.value;this.AddAnnotation(d,!0)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}this.QueueLayoutUpdate(),this.Repaint(!1,!1),this.grid_events.Publish({type:"sheet-change",deactivate:n,activate:this.active_sheet}),this.tab_bar&&this.tab_bar.Update(),this.layout.scroll_offset=this.active_sheet.scroll_offset}},e.prototype.ResolveSheet=function(e){var t,r,o,i;if(void 0!==e.index)return this.model.sheets[e.index];if(void 0!==e.name){var n=e.name.toLowerCase();try{for(var a=s(this.model.sheets),l=a.next();!l.done;l=a.next())if((u=l.value).name.toLowerCase()===n)return u}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}if(e.id)try{for(var c=s(this.model.sheets),d=c.next();!d.done;d=c.next()){var u;if((u=d.value).id===e.id)return u}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}},e.prototype.ShowSheetInternal=function(e){var t,r,o=this.ResolveSheet(e);if(o&&o.visible!==e.show){if(!e.show){var i=0;try{for(var n=s(this.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;o.visible&&l!==o||i++}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}if(i>=this.model.sheets.length)throw new Error("can't hide all sheets")}if(o.visible=e.show,o===this.active_sheet)for(var c=0;c<this.model.sheets.length;c++)if(this.model.sheets[c]===this.active_sheet)return void this.ActivateSheetInternal({key:Ye.ActivateSheet,index:c+1});this.tab_bar&&this.tab_bar.Update()}},e.prototype.StyleDefaultFromTheme=function(){var e,t,r;this.theme_style_properties.font_face=(null===(e=this.theme.grid_cell)||void 0===e?void 0:e.font_face)||"",this.theme_style_properties.font_size_unit=(null===(t=this.theme.grid_cell)||void 0===t?void 0:t.font_size_unit)||"pt",this.theme_style_properties.font_size_value=(null===(r=this.theme.grid_cell)||void 0===r?void 0:r.font_size_value)||10},e.prototype.HighlightFreezeArea=function(){var e,t,r=function(e){var t=e.getAttribute("class")||"";De.trident?e.setAttribute("class",t+" highlight-area"):e.classList.add("highlight-area"),setTimeout((function(){De.trident?e.setAttribute("class",t):e.classList.remove("highlight-area")}),400)};try{for(var o=s([this.layout.corner_selection,this.layout.row_header_selection,this.layout.column_header_selection]),i=o.next();!i.done;i=o.next())r(i.value)}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.QueueLayoutUpdate=function(){this.tile_update_pending=!0},e.prototype.HandleAddressLabelEvent=function(e){var t=this;if(e){var r=function(e){var r,o;void 0===e&&(e="");var i=e.toLowerCase();try{for(var n=s(t.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.name.toLowerCase()===i)return l.id}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return t.active_sheet.id},o=void 0,i=this.parser.Parse(e);if(i.expression)switch(i.expression.type){case"address":i.expression.sheet_id=r(i.expression.sheet),o=new f(i.expression);break;case"range":i.expression.start.sheet_id=r(i.expression.start.sheet),o=new f(i.expression.start,i.expression.end);break;case"identifier":(o=this.model.named_ranges.Get(i.expression.name))||this.primary_selection.empty||this.SetName(i.expression.name.toUpperCase(),this.primary_selection.area)}if(o){var n=function(e){var r,o;try{for(var i=s(t.model.sheets),n=i.next();!n.done;n=i.next()){var a=n.value;if(a.id===e)return a}}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return t.active_sheet}(o.start.sheet_id);if(n.columns>=o.end.column&&n.rows>=o.end.row)return void this.ExecCommand({key:Ye.Select,area:o});console.warn("address out of range")}}this.UpdateAddressLabel(),this.Focus()},e.prototype.InitFormulaBar=function(e,t){var r=this;this.formula_bar=new Ke(e,this.parser,this.theme,this.model,this.options,t),this.formula_bar.autocomplete_matcher=this.autocomplete_matcher,this.formula_bar.Subscribe((function(e){switch(e.type){case"address-label-event":r.HandleAddressLabelEvent(e.text);break;case"stop-editing":r.editing_state=Qe.NotEditing;break;case"start-editing":r.editing_state=Qe.FormulaBar,r.editing_cell=o({},r.primary_selection.target);break;case"discard":if(r.editing_state=Qe.NotEditing,r.editing_annotation)return r.ClearAdditionalSelections(),r.ClearSelection(r.active_selection),r.editing_annotation.node&&r.editing_annotation.node.focus(),r.editing_annotation=void 0,r.UpdateFormulaBarFormula(),void r.DelayedRender();r.container&&r.Focus(),r.ClearAdditionalSelections(),r.ClearSelection(r.active_selection),r.UpdateFormulaBarFormula(),r.DelayedRender();break;case"commit":if(r.active_sheet.id!==r.editing_cell.sheet_id&&r.editing_cell.sheet_id&&r.ActivateSheetID(r.editing_cell.sheet_id),r.editing_state=Qe.NotEditing,r.editing_annotation){var t=r.editing_annotation;return r.ClearAdditionalSelections(),r.ClearSelection(r.active_selection),t.formula=e.value?r.FixFormula(e.value):"",t.node&&t.node.focus(),r.grid_events.Publish({type:"annotation",event:"update",annotation:t}),r.editing_annotation=void 0,void r.DelayedRender()}r.container&&r.Focus(),r.SetInferredType(r.primary_selection,e.value,e.array),r.ClearAdditionalSelections(),r.ClearSelection(r.active_selection),r.options.repaint_on_cell_change&&r.DelayedRender(!1,r.primary_selection.area),e.event&&r.OverlayKeyDown(e.event);break;case"update":e.dependencies&&r.HighlightDependencies(e.dependencies)}}))},e.prototype.InitOverlayEditor=function(e){var t=this;this.container&&(this.overlay_editor=new Be(this.container,this.parser,this.theme,this.model,e),this.overlay_editor.UpdateTheme(this.layout.scale),this.overlay_editor.autocomplete_matcher=this.autocomplete_matcher,this.overlay_editor.Subscribe((function(e){switch(e.type){case"stop-editing":t.editing_state=Qe.NotEditing;break;case"start-editing":t.editing_state=Qe.CellEditor,t.editing_cell=o({},t.primary_selection.target);break;case"update":e.dependencies&&t.HighlightDependencies(e.dependencies);break;case"end-selection":t.ClearSelection(t.active_selection),t.DelayedRender()}})))},e.prototype.DelayedRender=function(e,t,r){var o=this;void 0===e&&(e=!1),void 0===r&&(r=!1),!this.tile_update_pending&&t?this.layout.DirtyArea(t):!this.tile_update_pending&&e&&this.layout.DirtyAll(),this.render_token||(this.render_token=1,J().then((function(){o.render_token=0,o.Repaint(e,r)})))},e.prototype.Repaint=function(e,t,r){var o,i,n,a,l,c,d,u;if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1),!this.headless){if(this.tile_update_pending&&(this.tile_update_pending=!1,this.layout.UpdateTiles(),this.render_tiles=this.layout.VisibleTiles(),this.layout.UpdateAnnotation(this.active_sheet.annotations)),this.layout_token=0,this.tile_renderer.OverflowDirty(t),e)try{for(var h=s(this.layout.grid_tiles),f=h.next();!f.done;f=h.next()){var p=f.value;try{for(var m=(n=void 0,s(p)),v=m.next();!v.done;v=m.next())(k=v.value).dirty=!0}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}}}catch(e){o={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}for(var y=this.render_tiles.start,_=this.render_tiles.end,g=[],b=y.row;b<=_.row;b++)g.push(b);var w=[];for(p=y.column;p<=_.column;p++)w.push(p);y.row>0&&this.active_sheet.freeze.rows&&g.push(0),y.column>0&&this.active_sheet.freeze.columns&&w.push(0);try{for(var x=s(w),C=x.next();!C.done;C=x.next()){p=C.value;try{for(var S=(d=void 0,s(g)),A=S.next();!A.done;A=S.next()){b=A.value;var k=this.layout.grid_tiles[p][b];(e||k.dirty||k.needs_full_repaint)&&(this.tile_renderer.Render(k),k.dirty=k.needs_full_repaint=!1)}}catch(e){d={error:e}}finally{try{A&&!A.done&&(u=S.return)&&u.call(S)}finally{if(d)throw d.error}}}}catch(e){l={error:e}}finally{try{C&&!C.done&&(c=x.return)&&c.call(x)}finally{if(l)throw l.error}}this.tile_renderer.RenderHeaders(this.render_tiles,r),this.tile_renderer.RenderCorner(),this.RenderSelections()}},e.prototype.MouseMove_RowHeader=function(e){var t=this.layout.CoordinateToRowHeader(e.offsetY),r=this.layout.OffsetCellAddressToRectangle({row:t.row,column:0});!this.hover_data.address||-1===this.hover_data.address.row&&-1===this.hover_data.address.column||this.HoverCell({row:-1,column:-1});var o=-1;e.offsetY-r.top<=this.RESIZE_PIXEL_BUFFER&&t.row>0?o=t.row-1:r.bottom-e.offsetY<=this.RESIZE_PIXEL_BUFFER&&(o=t.row),o>=0?this.layout.ResizeCursor("row"):this.cell_resize.row&&(this.cell_resize.row=-1,this.layout.ResizeCursor()),this.cell_resize.row=o},e.prototype.MouseMove_ColumnHeader=function(e){var t=this.layout.CoordinateToColumnHeader(e.offsetX),r=this.layout.OffsetCellAddressToRectangle({row:0,column:t.column});!this.hover_data.address||-1===this.hover_data.address.row&&-1===this.hover_data.address.column||this.HoverCell({row:-1,column:-1});var o=-1;e.offsetX-r.left<=this.RESIZE_PIXEL_BUFFER&&t.column>0?o=t.column-1:r.right-e.offsetX<=this.RESIZE_PIXEL_BUFFER&&(o=t.column),o>=0?this.layout.ResizeCursor("column"):this.cell_resize.column&&(this.cell_resize.column=-1,this.layout.ResizeCursor()),this.cell_resize.column=o},e.prototype.MouseDown_RowHeader=function(e){var t,r,o=this;e.stopPropagation(),e.preventDefault();var i=this.layout.CoordinateToRowHeader(e.offsetY),n=this.layout.row_header_cover.getBoundingClientRect(),a=(n.left,n.top);if(this.cell_resize.row>=0){var d=this.cell_resize.row,u=a+e.offsetY;if(this.layout.HideDropdownCaret(),this.IsDoubleClick({row:d,column:-1})){var h=[d];if(!this.primary_selection.empty&&this.primary_selection.area.rows>1&&this.primary_selection.area.start.column===1/0&&this.primary_selection.area.ContainsRow(d)){var p=this.active_sheet.RealArea(this.primary_selection.area);h=[];for(var m=p.start.row;m<=p.end.row;m++)h.push(m)}return void this.ExecCommand({key:Ye.ResizeRows,row:h})}var v=this.layout.RowHeight(d),y=v,_=this.layout.OffsetCellAddressToRectangle({row:d,column:0}),g=a+_.bottom;this.layout.ShowTooltip({left:!0,text:y+"px",x:Math.round(n.right+10),y:g});var b=[],w=[];try{for(var x=s(this.active_sheet.annotations),C=x.next();!C.done;C=x.next()){var S=C.value,A=_.bottom-1;if(S.scaled_rect&&!(S.scaled_rect.bottom<A)){var k=c([],l(this.layout.GetFrozenAnnotations(S)));S.node&&k.push(S.node),A<=S.scaled_rect.top&&S.move_with_cells?b.push({annotation:S,y:S.scaled_rect.top,nodes:k}):A>S.scaled_rect.top&&S.resize_with_cells&&w.push({annotation:S,height:S.scaled_rect.height,nodes:k})}}}catch(e){t={error:e}}finally{try{C&&!C.done&&(r=x.return)&&r.call(x)}finally{if(t)throw t.error}}be(this.layout.mask,"row-resize",(function(e){var t,r,i,n,a=Math.max(-v,Math.round(e.offsetY-u));if(a+v!==y){y=a+v,o.layout.SetRowHeight(d,y),o.layout.UpdateTooltip({text:y+"px",y:g+a});try{for(var l=s(b),c=l.next();!c.done;c=l.next()){var h=c.value,f=h.annotation,p=h.y;f.scaled_rect&&(f.scaled_rect.top=p+a)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}try{for(var m=s(w),_=m.next();!_.done;_=m.next()){var x=_.value,C=(f=x.annotation,x.height);f.scaled_rect&&(f.scaled_rect.height=C+a)}}catch(e){i={error:e}}finally{try{_&&!_.done&&(n=m.return)&&n.call(m)}finally{if(i)throw i.error}}requestAnimationFrame((function(){var e,t,r,i,n,a,l,c;try{for(var u=s(w),h=u.next();!h.done;h=u.next()){var f=h.value,p=f.annotation,m=f.nodes;if(p.scaled_rect)try{for(var v=(r=void 0,s(m)),y=v.next();!y.done;y=v.next()){var _=y.value;p.scaled_rect.ApplyStyle(_)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}try{for(var g=s(b),x=g.next();!x.done;x=g.next()){var C=x.value;if(p=C.annotation,m=C.nodes,p.scaled_rect)try{for(var S=(l=void 0,s(m)),A=S.next();!A.done;A=S.next())_=A.value,p.scaled_rect.ApplyStyle(_)}catch(e){l={error:e}}finally{try{A&&!A.done&&(c=S.return)&&c.call(S)}finally{if(l)throw l.error}}}}catch(e){n={error:e}}finally{try{x&&!x.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}o.layout.UpdateTileHeights(!0,d),o.Repaint(!1,!0),o.layout.UpdateAnnotation(o.active_sheet.annotations)}))}}),(function(){o.layout.HideTooltip(),requestAnimationFrame((function(){var e,t,r,i,n=[d];if(!o.primary_selection.empty&&o.primary_selection.area.rows>1&&o.primary_selection.area.start.column===1/0&&o.primary_selection.area.ContainsRow(d)){var a=o.active_sheet.RealArea(o.primary_selection.area);n=[];for(var l=a.start.row;l<=a.end.row;l++)n.push(l)}o.ExecCommand({key:Ye.ResizeRows,row:n,height:y});try{for(var c=s(b),u=c.next();!u.done;u=c.next())(p=u.value.annotation).scaled_rect&&(p.layout=o.layout.RectToAnnotationLayout(p.scaled_rect))}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}try{for(var h=s(w),f=h.next();!f.done;f=h.next()){var p;(p=f.value.annotation).scaled_rect&&(p.layout=o.layout.RectToAnnotationLayout(p.scaled_rect)),p.resize_callback&&p.resize_callback.call(void 0)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}))}))}else{var M=this.SelectingArgument()?this.active_selection:this.primary_selection;if(this.SelectingArgument()||this.Focus(),e.shiftKey&&!M.empty){var R=M.target;this.Select(M,new f(M.target,i,!0),void 0,!0),i=R}else this.Select(M,new f(i),{column:0,row:i.row});this.RenderSelections(),be(this.layout.mask,[],(function(e){var t=o.layout.CoordinateToRowHeader(e.offsetY-a),r=new f(t,i,!0);!M.empty&&r.Equals(M.area)||(o.Select(M,r,void 0,!0),o.RenderSelections())}),(function(){}))}},e.prototype.MouseDown_ColumnHeader=function(e){var t,r,o=this;e.stopPropagation(),e.preventDefault();var i=this.layout.CoordinateToColumnHeader(e.offsetX),n=this.layout.column_header_cover.getBoundingClientRect(),a=n.left;if(n.top,this.cell_resize.column>=0){var d=this.cell_resize.column,u=a+e.offsetX;if(this.layout.HideDropdownCaret(),this.IsDoubleClick({row:-1,column:d})){var h=[d];if(!this.primary_selection.empty&&this.primary_selection.area.columns>1&&this.primary_selection.area.start.row===1/0&&this.primary_selection.area.ContainsColumn(d)){var p=this.active_sheet.RealArea(this.primary_selection.area);h=[];for(var m=p.start.column;m<=p.end.column;m++)h.push(m)}return void this.ExecCommand({key:Ye.ResizeColumns,column:h})}var v=this.layout.ColumnWidth(d),y=v,_=this.layout.OffsetCellAddressToRectangle({row:0,column:d}),g=a+_.right;this.layout.ShowTooltip({up:!0,text:y+"px",x:g,y:Math.round(n.bottom+10)});var b=[],w=[];try{for(var x=s(this.active_sheet.annotations),C=x.next();!C.done;C=x.next()){var S=C.value,A=_.right-1;if(S.scaled_rect&&!(S.scaled_rect.right<A)){var k=c([],l(this.layout.GetFrozenAnnotations(S)));S.node&&k.push(S.node),A<=S.scaled_rect.left&&S.move_with_cells?b.push({annotation:S,x:S.scaled_rect.left,nodes:k}):A>S.scaled_rect.left&&S.resize_with_cells&&w.push({annotation:S,width:S.scaled_rect.width,nodes:k})}}}catch(e){t={error:e}}finally{try{C&&!C.done&&(r=x.return)&&r.call(x)}finally{if(t)throw t.error}}be(this.layout.mask,"column-resize",(function(e){var t,r,i,n,a=Math.max(-v,Math.round(e.offsetX-u));if(a+v!==y){y=a+v,o.layout.UpdateTooltip({text:y+"px",x:g+a}),o.layout.SetColumnWidth(d,y);try{for(var l=s(b),c=l.next();!c.done;c=l.next()){var h=c.value,f=h.annotation,p=h.x;f.scaled_rect&&(f.scaled_rect.left=p+a)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}try{for(var m=s(w),_=m.next();!_.done;_=m.next()){var x=_.value,C=(f=x.annotation,x.width);f.scaled_rect&&(f.scaled_rect.width=C+a)}}catch(e){i={error:e}}finally{try{_&&!_.done&&(n=m.return)&&n.call(m)}finally{if(i)throw i.error}}requestAnimationFrame((function(){var e,t,r,i,n,a,l,c;try{for(var u=s(w),h=u.next();!h.done;h=u.next()){var f=h.value,p=f.annotation,m=f.nodes;if(p.scaled_rect)try{for(var v=(r=void 0,s(m)),y=v.next();!y.done;y=v.next()){var _=y.value;p.scaled_rect.ApplyStyle(_)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}try{for(var g=s(b),x=g.next();!x.done;x=g.next()){var C=x.value;if(p=C.annotation,m=C.nodes,p.scaled_rect)try{for(var S=(l=void 0,s(m)),A=S.next();!A.done;A=S.next())_=A.value,p.scaled_rect.ApplyStyle(_)}catch(e){l={error:e}}finally{try{A&&!A.done&&(c=S.return)&&c.call(S)}finally{if(l)throw l.error}}}}catch(e){n={error:e}}finally{try{x&&!x.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}o.layout.UpdateTileWidths(!0,d),o.Repaint(!1,!0)}))}}),(function(){o.layout.HideTooltip(),requestAnimationFrame((function(){var e,t,r,i,n=[d];if(!o.primary_selection.empty&&o.primary_selection.area.columns>1&&o.primary_selection.area.start.row===1/0&&o.primary_selection.area.ContainsColumn(d))for(var a=o.active_sheet.RealArea(o.primary_selection.area),l=a.start.column;l<=a.end.column;l++)n.push(l);o.ExecCommand({key:Ye.ResizeColumns,column:n,width:y});try{for(var c=s(b),u=c.next();!u.done;u=c.next())(p=u.value.annotation).scaled_rect&&(p.layout=o.layout.RectToAnnotationLayout(p.scaled_rect))}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}try{for(var h=s(w),f=h.next();!f.done;f=h.next()){var p;(p=f.value.annotation).scaled_rect&&(p.layout=o.layout.RectToAnnotationLayout(p.scaled_rect)),p.resize_callback&&p.resize_callback.call(void 0)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}))}))}else{var M=this.SelectingArgument()?this.active_selection:this.primary_selection;if(this.SelectingArgument()||this.Focus(),e.shiftKey&&!M.empty){var R=M.target;this.Select(M,new f(M.target,i,!0),void 0,!0),i=R}else this.Select(M,new f(i),{row:0,column:i.column});this.RenderSelections(),be(this.layout.mask,[],(function(e){var t=o.layout.CoordinateToColumnHeader(e.offsetX-a),r=new f(t,i,!0);!M.empty&&r.Equals(M.area)||(o.Select(M,r,void 0,!0),o.RenderSelections())}))}},e.prototype.HoverCell=function(e,t){var r=this.active_sheet.cells.GetCell(e,!1);if(null==r?void 0:r.merge_area){var i=r.merge_area;e=i.start,r=this.active_sheet.cells.GetCell(e,!1),e={row:i.start.row,column:i.end.column}}(null==r?void 0:r.note)?(this.layout.ShowNote(r.note,e,t),this.hover_data.note=!0):this.hover_data.note&&(this.layout.HideNote(),this.hover_data.note=!1),(null==r?void 0:r.hyperlink)?(this.layout.ShowTitle("Link: "+r.hyperlink,e,t),this.hover_data.link=!0,this.hover_data.cell=r):this.hover_data.link&&(this.layout.HideTitle(),this.hover_data.cell=void 0),this.hover_data.address=o({},e)},e.prototype.HideHoverInfo=function(){this.layout.HideTitle(),this.layout.HideTooltip(),this.hover_data.note=this.hover_data.link=!1,this.hover_data.cell=void 0,this.hover_data.pointer&&this.layout.grid_cover.classList.remove("link-pointer"),this.hover_data.pointer=!1},e.prototype.MouseMove_Grid=function(e){var t,r=this;e.stopPropagation(),e.preventDefault(),(this.cell_resize.row>=0||this.cell_resize.column>=0)&&this.layout.ResizeCursor();var o,i={x:e.offsetX,y:e.offsetY};if((null===(t=this.overlay_editor)||void 0===t?void 0:t.editing)||(o=this.layout.PointToAddress_Grid(i),this.hover_data.address&&this.hover_data.address.row===o.row&&this.hover_data.address.column===o.column||this.HoverCell(o,e)),this.hover_data.link&&o&&(this.hover_data.point=i,this.hover_data.handler||(this.hover_data.handler=requestAnimationFrame((function(){var e=r.hover_data.address&&r.hover_data.point&&r.hover_data.cell&&r.PointInTextPart(r.hover_data.address,r.hover_data.point,r.hover_data.cell);e!==!!r.hover_data.pointer&&(r.hover_data.pointer=e,e?r.layout.grid_cover.classList.add("link-pointer"):r.layout.grid_cover.classList.remove("link-pointer")),r.hover_data.handler=void 0})))),!this.primary_selection.empty&&this.selection_renderer.nub_rectangle){var n=this.selection_renderer.nub_rectangle.Contains(e.offsetX,e.offsetY);n!==this.nub_select_flag&&(n?this.layout.grid_cover.classList.add("nub-select"):this.layout.grid_cover.classList.remove("nub-select"),this.nub_select_flag=n)}else this.nub_select_flag&&(this.layout.grid_cover.classList.remove("nub-select"),this.nub_select_flag=!1)},e.prototype.ClearDoubleClick=function(){this.double_click_data.address=void 0},e.prototype.IsDoubleClick=function(e,t){var r=this;if(void 0===t&&(t=300),this.double_click_data.address&&this.double_click_data.address.row===e.row&&this.double_click_data.address.column===e.column)return clearTimeout(this.double_click_data.timeout),this.double_click_data.address=void 0,this.double_click_data.timeout=void 0,!0;this.double_click_data.timeout&&clearTimeout(this.double_click_data.timeout),this.double_click_data.address=o({},e),this.double_click_data.timeout=window.setTimeout((function(){r.double_click_data.address=void 0,r.double_click_data.timeout=void 0}),t)},e.prototype.PointInTextPart=function(e,t,r){var o,i,n,a,l=this.layout.CellAddressToRectangle(e);r.merge_area&&(l=l.Combine(this.layout.CellAddressToRectangle(r.merge_area.end)));var c=t.x-l.left,d=t.y-l.top,u=(null===(a=null===(n=r.renderer_data)||void 0===n?void 0:n.text_data)||void 0===a?void 0:a.strings)||[];try{for(var h=s(u),f=h.next();!f.done;f=h.next()){var p=f.value;if("number"==typeof p.left&&"number"==typeof p.top&&"number"==typeof p.width&&"number"==typeof p.height&&c>=p.left&&d>=p.top&&c<=p.left+p.width&&d<=p.top+p.height)return!0}}catch(e){o={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}return!1},e.prototype.MouseDown_Grid=function(e){var t,r,o,i,n,a=this;e.stopPropagation(),e.preventDefault();var s=this.SelectingArgument();!s&&this.additional_selections.length&&this.ClearAdditionalSelections(),s&&(null===(t=this.formula_bar)||void 0===t?void 0:t.selecting)||this.Focus(),(null===(r=this.overlay_editor)||void 0===r?void 0:r.editing)&&!(null===(o=this.overlay_editor)||void 0===o?void 0:o.selecting)&&this.DismissEditor();var l={x:e.offsetX,y:e.offsetY},c=this.layout.PointToAddress_Grid(l),d=s?this.active_selection:this.primary_selection;if(!s&&this.IsDoubleClick(c))return De.is_mobile&&(null===(n=null===(i=this.overlay_editor)||void 0===i?void 0:i.edit_node)||void 0===n||n.focus()),void this.OverlayEditCell({target:c,area:new f(c)},!1);var u,h=this.layout.grid_cover.getBoundingClientRect(),p={x:h.left,y:h.top},m=[];if(e.shiftKey&&!d.empty){var v=d.target;this.Select(d,new f(c,d.target,!0),void 0,!0),c=v}else if(this.nub_select_flag)c=d.area.TopLeft(),m.push("nub-select"),u=this.active_sheet.RealArea(d.area);else{var y=c,_=this.active_sheet.CellData(y);if(_.merge_area&&(y=_.merge_area.start,_=this.active_sheet.CellData(_.merge_area.start)),_.hyperlink&&this.PointInTextPart(y,l,_)){var g=_.hyperlink;return J().then((function(){a.grid_events.Publish({type:"cell-event",data:{type:"hyperlink",data:g}})})),void this.ClearDoubleClick()}if(_.click_function){var b=this.layout.CellAddressToRectangle(y);_.merge_area&&(b=b.Combine(this.layout.CellAddressToRectangle(_.merge_area.end)));var w=_.click_function.call(this,{cell:_,x:l.x-b.left,y:l.y-b.top,width:b.width,height:b.height});if(w.value&&this.ExecCommand({key:Ye.SetRange,value:w.value,area:y}),w.block_selection)return this.ClearDoubleClick(),void(this.primary_selection.empty||this.primary_selection.target.row!==y.row||this.primary_selection.target.column!==y.column||this.UpdateFormulaBarFormula())}this.Select(d,new f(c),c)}this.RenderSelections(),s&&this.UpdateSelectedArgument(d);var x=this.layout.CellAddressToRectangle({row:0,column:0}).Combine(this.layout.CellAddressToRectangle({row:this.active_sheet.rows-1,column:this.active_sheet.columns-1})).Expand(-1,-1);be(this.layout.mask,m,(function(e){var t={x:e.offsetX-p.x,y:e.offsetY-p.y},r=x.Clamp(t.x,t.y),o=a.layout.PointToAddress_Grid(r,!0),i=a.layout.scroll_reference_node,n=!1;a.container&&a.options.scrollbars&&(t.x<i.scrollLeft?(i.scrollLeft-=25,n=!0):t.x>i.scrollLeft+a.container.clientWidth&&(i.scrollLeft+=25,n=!0),t.y<i.scrollTop?(i.scrollTop-=25,n=!0):t.y>i.scrollTop+a.container.clientHeight&&(i.scrollTop+=25,n=!0),n&&(h=a.layout.grid_cover.getBoundingClientRect(),p.x=h.left+document.body.scrollLeft,p.y=h.top+document.body.scrollTop));var l=new f(o,c,!0);if(u&&((l=u.Clone()).ConsumeAddress(o),l.rows!==u.rows&&l.columns!==u.columns)){var m={rows:o.row>u.end.row?o.row-u.end.row:u.start.row-o.row,columns:o.column>u.end.column?o.column-u.end.column:u.start.column-o.column};l=m.rows>=m.columns?new f({row:l.start.row,column:u.start.column},{row:l.end.row,column:u.end.column}):new f({row:u.start.row,column:l.start.column},{row:u.end.row,column:l.end.column})}!d.empty&&l.Equals(d.area)||(a.Select(d,l,void 0,!0),a.RenderSelections(),s?a.UpdateSelectedArgument(d):d.empty||d.area.entire_sheet||(d.area.entire_column?a.UpdateAddressLabel(void 0,d.area.columns+"C"):d.area.entire_row?a.UpdateAddressLabel(void 0,d.area.rows+"R"):d.area.count>1?a.UpdateAddressLabel(void 0,d.area.rows+"R x "+d.area.columns+"C"):a.UpdateAddressLabel(d)))}),(function(){var e;a.UpdateAddressLabel(),s?(null===(e=a.overlay_editor)||void 0===e?void 0:e.editing)||a.select_argument||a.formula_bar&&a.formula_bar.FocusEditor():u&&a.RecycleNubArea(d.area,u)}))},e.prototype.Transpose=function(e){for(var t=[],r=e.length,o=e[0].length,i=0;i<o;i++){t[i]=[];for(var n=0;n<r;n++)t[i][n]=e[n][i]}return t},e.prototype.RecycleNubArea=function(e,t){var r;if(!e.Equals(t)){for(var o=[],i=0;i<t.rows;i++){o[i]=[];for(var n=0;n<t.columns;n++){var a={row:t.start.row+i,column:t.start.column+n};o[i][n]=this.active_sheet.CellData(a)}}if(o[0][0].area&&o[0][0].area.Equals(t))this.ExecCommand({key:Ye.SetRange,value:o[0][0].value,array:!0,area:e});else{var s=[],l=[],c=t.columns,d=e.rows,u=!1,h=!1;for(e.columns===t.columns?u=e.start.row<t.start.row:(c=t.rows,d=e.columns,u=e.start.column<t.start.column,o=this.Transpose(o),h=!0),i=0;i<d;i++)s[i]=[],l[i]=[];var f=function(e){var t=0;if(o.length>1){t=1;for(var i=[],n=[],a=0;a<o.length;a++)(h=o[a][e]).ValueIsNumber()&&(n.push(a),i.push(h.value));if(i.length>1){var c=i.slice(1).map((function(e,t){return e-i[t]}));c.every((function(e){return e===c[0]}))&&(t=c[0])}i.length&&(t+=i[i.length-1]-i[0])}for(a=0;a<o.length;a++){var h,f=void 0;if((h=o[a][e]).ValueIsFormula()){var m=p.parser.Parse(h.value);m.expression&&(null===(r=m.full_reference_list)||void 0===r?void 0:r.length)&&(f=m.expression)}var v=0,y=a,_=o.length,g=0,b=t;u&&(y=d-o.length+a,_=-o.length,b=-t);for(var w=y;w>=0&&w<d;w+=_,v+=_,g+=b){if(f)s[w][e]="="+p.parser.Render(f,{rows:v,columns:0});else{var x=o[a][e];x.ValueIsNumber()?s[w][e]=x.value+g:s[w][e]=x.value}l[w][e]=o[a][e].style||{}}}},p=this;for(n=0;n<c;n++)f(n);var m=[{key:Ye.SetRange,value:h?this.Transpose(s):s,array:!1,area:e}];for(h&&(l=this.Transpose(l)),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)m.push({key:Ye.UpdateStyle,area:{row:i+e.start.row,column:n+e.start.column},style:l[i][n],delta:!1});this.ExecCommand(m)}}},e.prototype.UpdateSelectedArgument=function(e){var t,r=this.active_sheet.CellData(e.area.start),o=new f(r.merge_area?r.merge_area.start:e.target),i=this.model.named_ranges.MatchSelection(e.area,o);if(!i&&(i=e.area.spreadsheet_label,r.merge_area&&r.merge_area.Equals(e.area)&&(i=f.CellAddressToLabel(r.merge_area.start)),this.active_sheet.id!==this.editing_cell.sheet_id)){var n=this.active_sheet.name;i=O.test(n)?"'"+n+"'!"+i:n+"!"+i}(null===(t=this.overlay_editor)||void 0===t?void 0:t.editing)&&this.overlay_editor.selecting?this.overlay_editor.InsertReference(i,0):this.formula_bar&&this.formula_bar.selecting?this.formula_bar.InsertReference(i,0):this.select_argument&&this.grid_events.Publish({type:"alternate-selection",selection:this.active_selection})},e.prototype.SelectingArgument=function(){var e,t;return(null===(e=this.overlay_editor)||void 0===e?void 0:e.editing)&&(null===(t=this.overlay_editor)||void 0===t?void 0:t.selecting)||this.formula_bar&&this.formula_bar.selecting||this.select_argument},e.prototype.OverlayKeyDown=function(e){var t,r,o,i=!1;if(this.overlay_editor&&this.overlay_editor.editing)switch(i=!0,this.overlay_editor.HandleKeyDown(e)){case Oe.handled:return;case Oe.discard:return this.editing_state=Qe.NotEditing,this.DismissEditor(),void this.DelayedRender();case Oe.commit:if(this.active_sheet.id!==this.editing_cell.sheet_id&&this.editing_cell.sheet_id&&this.ActivateSheetID(this.editing_cell.sheet_id),this.editing_state=Qe.NotEditing,null===(t=this.overlay_editor)||void 0===t?void 0:t.selection){var n=(null===(r=this.overlay_editor)||void 0===r?void 0:r.edit_node.textContent)||void 0,a="Enter"===e.key&&e.ctrlKey&&e.shiftKey;this.SetInferredType(this.overlay_editor.selection,n,a)}this.DismissEditor(),this.options.repaint_on_cell_change&&this.DelayedRender(!1,(null===(o=this.overlay_editor)||void 0===o?void 0:o.selection.area)||void 0)}var s=this.SelectingArgument();if((!this.formula_bar||!this.formula_bar.focused||s)&&(!this.selected_annotation||s)){var l=s?this.active_selection:this.primary_selection,c={rows:0,columns:0},d=!1,u=!1;if(e.ctrlKey||De.is_mac&&e.metaKey){switch(e.key){case"ArrowDown":case"Down":c.rows++;break;case"ArrowUp":case"Up":c.rows--;break;case"ArrowLeft":case"Left":c.columns--;break;case"ArrowRight":case"Right":c.columns++;break;case"Delete":case"Del":e.stopPropagation(),e.preventDefault();for(var h=0;h<this.model.sheets.length;h++)if(this.model.sheets[h]===this.active_sheet){this.DeleteSheet(h);break}return;case"/":e.stopPropagation(),e.preventDefault(),this.SelectArray();break;default:if(e.shiftKey)return}if(c.columns||c.rows){if(e.stopPropagation(),e.preventDefault(),l.empty||!c.columns&&!c.rows)return;if(this.BlockSelection(l,!!e.shiftKey,c.columns,c.rows))return}else{var f={},p=this.primary_selection.empty?{}:this.active_sheet.CellData(this.primary_selection.target).style||{};switch(e.key.toLowerCase()){case"b":f.font_bold=!p.font_bold;break;case"i":f.font_italic=!p.font_italic;break;case"u":f.font_underline=!p.font_underline;break;case"a":this.SelectAll();break;case"0":if(!e.altKey)return;this.ClearSelection(this.primary_selection),this.RenderSelections();break;default:return void e.key}Object.keys(f).length&&this.ApplyStyle(void 0,f)}}else switch(e.key){case"Tab":e.shiftKey?c.columns--:c.columns++,d=!0;break;case"Enter":e.shiftKey?c.rows--:c.rows++,d=!0;break;case"ArrowDown":case"Down":c.rows++,u=e.shiftKey;break;case"ArrowUp":case"Up":c.rows--,u=e.shiftKey;break;case"ArrowLeft":case"Left":c.columns--,u=e.shiftKey;break;case"ArrowRight":case"Right":c.columns++,u=e.shiftKey;break;case"Delete":case"Del":l.empty||this.DeleteSelection(l);break;case"PageUp":case"PageDown":if(e.shiftKey){this.NextSheet("PageUp"===e.key?-1:1);break}return;case"Control":case"Shift":case"Alt":return;default:return void(l.empty||this.OverlayEditCell(l,!0,e))}e.stopPropagation(),e.preventDefault(),(c.rows||c.columns)&&this.AdvanceSelection(c,l,d,u,!i)}},e.prototype.SelectArray=function(){if(!this.primary_selection.empty){var e=this.active_sheet.CellData(this.primary_selection.target);e&&e.area&&(this.Select(this.primary_selection,e.area,e.area.start),this.RenderSelections())}},e.prototype.RenderSelections=function(e){void 0===e&&(e=!0);var t=!this.editing_state||this.editing_cell.sheet_id===this.active_sheet.id;this.selection_renderer.RenderSelections(t,e)},e.prototype.BlockSelection=function(e,t,r,i,n){if(void 0===n&&(n=!0),e.empty)return!1;var a=o({},e.target);i>0?a.row=Math.max(a.row,e.area.end.row):i<0&&(a.row=Math.min(a.row,e.area.start.row)),r>0?a.column=Math.max(a.column,e.area.end.column):r<0&&(a.column=Math.min(a.column,e.area.start.column));var s=this.active_sheet.cells,l=s.GetCell(e.target,!1);if(!l||l.type===u.undefined&&!l.area)return!1;for(var c=o({},a);;){var d={row:c.row+i,column:c.column+r};if(d.column<0||d.row<0||d.column>=this.active_sheet.columns||d.row>=this.active_sheet.rows)break;var h=!1;if(i)for(var p=e.area.start.column;!h&&p<=e.area.end.column;p++)l=s.GetCell({row:d.row,column:p},!1),!(h=h||!!l&&(l.type!==u.undefined||!!l.area))&&l&&l.merge_area&&(l=s.GetCell(l.merge_area.start,!1),h=h||!!l&&(l.type!==u.undefined||!!l.area));else for(var m=e.area.start.row;!h&&m<=e.area.end.row;m++)l=s.GetCell({row:m,column:d.column},!1),!(h=h||!!l&&(l.type!==u.undefined||!!l.area))&&l&&l.merge_area&&(l=s.GetCell(l.merge_area.start,!1),h=h||!!l&&(l.type!==u.undefined||!!l.area));if(!h)break;c=d}if(t){i?(a.row=e.target.row,a.column=e.area.start.column,c.column=e.area.end.column):(a.column=e.target.column,a.row=e.area.start.row,c.row=e.area.end.row);var v=new f(a,c,!0);this.Select(e,v,e.target,!0)}else this.Select(e,new f(c));return this.ScrollIntoView(c),this.SelectingArgument()&&this.UpdateSelectedArgument(e),n&&this.DelayedRender(),!0},e.prototype.DeleteSelection=function(e){if(!e.empty){var t=this.active_sheet.RealArea(e.area);this.ExecCommand({key:Ye.Clear,area:t})}},e.prototype.Error=function(e){console.info("Error",e),this.grid_events.Publish({type:"error",message:e})},e.prototype.SetInferredType=function(e,t,r,i){var n,a,l,c,d;void 0===r&&(r=!1),void 0===i&&(i=!0);var h=e.target||e.area.start,f=this.active_sheet.CellData(h);if(f.area){if(!r&&f.area.count>1||!e.area||!e.area.Equals(f.area))return void this.Error("You can't change part of an array.")}else if(r){var p=!1;if(this.active_sheet.cells.Apply(e.area,(function(e){e.area&&(p=!0)}),!1),p)return void this.Error("You can't change part of an array.")}if(f.validation){var v=void 0;if(f.validation.type===m.List?v=f.validation.list:f.validation.type===m.Range&&(v=this.GetValidationRange(f.validation.area)),v&&v.length){var y=!1;if(t){var _=t.toUpperCase();try{for(var g=s(v),b=g.next();!b.done;b=g.next()){var w=b.value;if(w&&w.toString().toUpperCase()===_){t=w.toString(),y=!0;break}}}catch(e){n={error:e}}finally{try{b&&!b.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}}if(!y)return void this.Error("Invalid value (data validation).")}}f.merge_area&&(h=f.merge_area.start);var x="string"==typeof t&&"="===t.trim()[0],C=[];if(x&&(t=this.FixFormula(t||""),!this.active_sheet.HasCellStyle(h))){var S=this.parser.Parse(t);if(S){if("call"===(null===(d=S.expression)||void 0===d?void 0:d.type)&&(!f.style||!f.style.number_format||ue.Equals(f.style.number_format,"General"))){var A=void 0;switch(S.expression.name.toLowerCase()){case"today":A="Short Date";break;case"now":A="Timestamp"}A&&C.push({key:Ye.UpdateStyle,area:r?e.area:h,style:{number_format:A},delta:!0})}if(S.dependencies){v=S.dependencies;try{for(var k=s(Object.keys(v.addresses)),M=k.next();!M.done;M=k.next()){var R=M.value,T=v.addresses[R];if(this.active_sheet.HasCellStyle(o({},T))){var L=this.active_sheet.CellData(o({},T));if(L.style&&L.style.number_format){var E={number_format:L.style.number_format};C.push({key:Ye.UpdateStyle,area:r?e.area:h,style:E,delta:!0})}break}}}catch(e){l={error:e}}finally{try{M&&!M.done&&(c=k.return)&&c.call(k)}finally{if(l)throw l.error}}}}}var z=this.parser.Parse(t||"").expression;"group"===(null==z?void 0:z.type)&&1===z.elements.length&&"complex"===z.elements[0].type&&(z=z.elements[0]);var D=z&&"complex"===z.type?{type:u.complex,value:{real:z.real,imaginary:z.imaginary}}:pe.TryParse(t);if(!x&&D.type===u.number){A="";var P=D.hints||ae.None;f.style&&f.style.number_format&&!ue.Equals(f.style.number_format,"General")||(P&ae.Date?A="Short Date":P&ae.Exponential?A="Exponential":P&ae.Percent?A="Percent":P&ae.Currency?A="Currency":(P&ae.Grouping||P&ae.Parens)&&(A="Accounting")),A&&C.push({key:Ye.UpdateStyle,area:r?e.area:h,style:{number_format:A},delta:!0})}if(C.push({key:Ye.SetRange,area:r?e.area:h,array:r,value:x?t:D.value}),!i)return C;this.ExecCommand(C)},e.prototype.FixFormula=function(e){if("="!==e.trim()[0])return e;for(var t=!1,r=!1,o=0,i=!1,n=(e=e.replace(/^\s+/,"")).length,a=0;a<n;a++){var s=e[a];if(!i)switch(s){case'"':t?'"'===e[a+1]?a++:t=!1:r||(t=!0);break;case"'":r?r=!1:t||(r=!0);break;case"\\":i=!0;break;case"(":t||r||o++;break;case")":t||r||o--}}for(t?e+='"':r&&(e+="'");o>0;)e+=")",o--;return this.NormalizeFormula(e)},e.prototype.NormalizeFormula=function(e){var t=this,r=this.parser.Parse(e);return r&&r.expression&&(this.parser.Walk(r.expression,(function(e){switch(e.type){case"call":e.name=t.autocomplete_matcher.NormalizeIdentifier(e.name)||e.name;break;case"identifier":t.model.named_ranges.Get(e.name)&&(e.name=e.name.toUpperCase())}return!0})),e="="+this.parser.Render(r.expression,void 0,"")),e},e.prototype.DismissEditor=function(){var e,t;(null===(e=this.overlay_editor)||void 0===e?void 0:e.active_cell)&&(this.overlay_editor.active_cell.editing=!1,this.overlay_editor.active_cell.render_dirty=!0,this.DelayedRender(void 0,this.overlay_editor.selection.area)),this.editing_state=Qe.NotEditing,this.Focus(),null===(t=this.overlay_editor)||void 0===t||t.CloseEditor(),this.ClearAdditionalSelections(),this.ClearSelection(this.active_selection)},e.prototype.NormalizeCellValue=function(e){var t=e.value;if(e.ValueIsNumber()&&e.style&&e.style.number_format)if(ue.Get(e.style.number_format).date_format){var r=le(e.value),o=r.getUTCHours()||r.getUTCMinutes()||r.getUTCSeconds()?"Timestamp":"Short Date";t=ue.Get(o).Format(t)}else if(/(?:%|percent)/i.test(e.style.number_format)){var i=0,n=e.value.toString().match(/\.(.*?)$/);n&&n[1]&&(i=Math.max(0,n[1].length-2)),t=(100*e.value).toFixed(i)+"%",","===M.decimal_separator&&(t=t.replace(/\./,","))}else t&&","===M.decimal_separator&&(t=e.value.toString().replace(/\./,","));else{if(e.ValueIsBoolean())return e.value.toString().toUpperCase();if(e.ValueIsNumber())t&&","===M.decimal_separator&&(t=e.value.toString().replace(/\./,","));else if(e.ValueIsComplex()){var a={real:e.value.real.toString(),imaginary:Math.abs(e.value.imaginary).toString()};","===M.decimal_separator&&(a.real=a.real.replace(/\./,","),a.imaginary=a.imaginary.replace(/\./,",")),t=a.real+(e.value.imaginary<0?" - ":" + ")+a.imaginary+"i"}}return t},e.prototype.IsNumeric=function(e){return e>=48&&e<=57||e===this.decimal_separator_code||45===e||43===e},e.prototype.OverlayEditCell=function(e,t,r){var o,i;if(void 0===t&&(t=!0),this.options.in_cell_editor){var n,a=e.target||e.area.start,s=this.active_sheet.CellData(a);if(this.HideHoverInfo(),s.merge_area?(n=this.layout.OffsetCellAddressToRectangle(s.merge_area.start).Combine(this.layout.OffsetCellAddressToRectangle(s.merge_area.end)),a=s.merge_area.start,s=this.active_sheet.CellData(a)):n=this.layout.OffsetCellAddressToRectangle(a),null===(o=s.style)||void 0===o?void 0:o.locked)console.info("cell is locked for editing");else{n=n.Shift(this.layout.header_size.width,this.layout.header_size.height);var l=s.value;l=t?s.type!==u.number&&s.rendered_type!==u.number||!s.style||!s.style.number_format||!/(?:%|percent)/i.test(s.style.number_format)||r&&!this.IsNumeric(r.key.charCodeAt(0))?void 0:"%":this.NormalizeCellValue(s),null===(i=this.overlay_editor)||void 0===i||i.Edit(e,n.Expand(-1,-1),s,l,r),s.editing=!0,s.render_dirty=!0,this.DelayedRender(!1,e.area)}}},e.prototype.BoundAddressArea=function(e,t){e.column>t.end.column?(e.row=this.StepVisibleRows(e.row,1),e.row>t.end.row&&(e.row=t.start.row),e.column=t.start.column):e.column<t.start.column?(e.row=this.StepVisibleRows(e.row,-1),e.row<t.start.row&&(e.row=t.end.row),e.column=t.end.column):e.row>t.end.row?(e.column=this.StepVisibleColumns(e.column,1),e.column>t.end.column&&(e.column=t.start.column),e.row=t.start.row):e.row<t.start.row&&(e.column=this.StepVisibleColumns(e.column,-1),e.column<t.start.column&&(e.column=t.end.column),e.row=t.end.row)},e.prototype.StepVisibleRows=function(e,t){if(t>0)for(var r=0;r<t;r++)this.layout.RowHeight(++e)||r--;else if(t<0)for(r=0;r>t;r--)--e>=0&&!this.layout.RowHeight(e)&&r++;return e},e.prototype.StepVisibleColumns=function(e,t){if(t>0)for(var r=0;r<t;r++)this.layout.ColumnWidth(++e)||r--;else if(t<0)for(r=0;r>t;r--)--e>=0&&!this.layout.ColumnWidth(e)&&r++;return e},e.prototype.AdvanceSelection=function(e,t,r,o,i){var n,a,l,c;void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=!0);var d=this.SelectingArgument(),u=!1;if(t.empty)if(d){var h={row:Math.max(0,this.StepVisibleRows(this.primary_selection.target.row,e.rows)),column:Math.max(0,this.StepVisibleColumns(this.primary_selection.target.column,e.columns))};this.Select(t,new f(h))}else this.Select(t,new f({row:0,column:0}));else{var p=this.active_sheet.CellData(t.target);if(p.merge_area&&r&&(r=!p.merge_area.Equals(t.area)),r&&t.area.count>1){for(var m=this.RealArea(t.area),v=t.target;;){v.row=this.StepVisibleRows(v.row,e.rows),v.column=this.StepVisibleColumns(v.column,e.columns),this.BoundAddressArea(v,m);var y=this.active_sheet.CellData(v);if(!y.merge_area||y.merge_area.start.row===v.row&&y.merge_area.start.column===v.column)break}this.Select(t,m,v)}else if(o&&t&&t.target){m=t.area,h=t.target;var _=m.start,g=m.end,b={row:1/0,column:1/0};if(e.columns&&(1===m.columns?e.columns>0?(g.column=this.StepVisibleColumns(g.column,1),b.column=g.column):(_.column=this.StepVisibleColumns(_.column,-1),b.column=_.column):m.end.column>h.column?(g.column=this.StepVisibleColumns(g.column,e.columns),b.column=g.column):m.start.column<h.column&&(_.column=this.StepVisibleColumns(_.column,e.columns),b.column=_.column),g.column=Math.max(0,g.column),_.column=Math.max(0,_.column)),e.rows&&(1===m.rows?e.rows>0?(g.row=this.StepVisibleRows(g.row,1),b.row=g.row):(_.row=this.StepVisibleRows(_.row,-1),b.row=_.row):m.end.row>h.row?(g.row=this.StepVisibleRows(g.row,e.rows),b.row=g.row):m.start.row<h.row&&(_.row=this.StepVisibleRows(_.row,e.rows),b.row=_.row),g.row=Math.max(0,g.row),_.row=Math.max(0,_.row)),this.options.expand){try{for(var w=s([_,g,b]),x=w.next();!x.done;x=w.next())(M=x.value).row!==1/0&&(M.row=Math.max(0,M.row)),M.column!==1/0&&(M.column=Math.max(0,M.column))}catch(e){l={error:e}}finally{try{x&&!x.done&&(c=w.return)&&c.call(w)}finally{if(l)throw l.error}}if(g.row!==1/0&&g.row>=this.active_sheet.rows&&this.options.expand){for(var C=this.active_sheet.rows;g.row>=C;)C+=8;this.active_sheet.cells.EnsureRow(C),u=!0}if(g.column!==1/0&&g.column>=this.active_sheet.columns&&this.options.expand){for(var S=this.active_sheet.columns;g.column>=S;)S+=8;this.active_sheet.cells.EnsureColumn(S),u=!0}u&&(this.layout.UpdateTiles(),this.layout.UpdateContentsSize(),this.Repaint(!0,!0),i=!0),this.ScrollIntoView(b),this.Select(t,new f(_,g),void 0,!0)}else{try{for(var A=s([_,g,b]),k=A.next();!k.done;k=A.next()){var M;(M=k.value).row!==1/0&&(M.row=Math.max(0,Math.min(M.row,this.active_sheet.rows-1))),M.column!==1/0&&(M.column=Math.max(0,Math.min(M.column,this.active_sheet.columns-1)))}}catch(e){n={error:e}}finally{try{k&&!k.done&&(a=A.return)&&a.call(A)}finally{if(n)throw n.error}}this.ScrollIntoView(b),this.Select(t,new f(_,g),void 0,!0)}}else{if(v=t.target,p.merge_area?(e.columns<0?v.column=this.StepVisibleColumns(p.merge_area.start.column,-1):e.columns>0&&(v.column=this.StepVisibleColumns(p.merge_area.end.column,1)),e.rows<0?v.row=this.StepVisibleRows(p.merge_area.start.row,-1):e.rows>0&&(v.row=this.StepVisibleRows(p.merge_area.end.row,1))):(v.row=this.StepVisibleRows(v.row,e.rows),v.column=this.StepVisibleColumns(v.column,e.columns)),v.row>=this.active_sheet.rows&&this.options.expand){for(C=this.active_sheet.rows;v.row>=C;)C+=8;this.active_sheet.cells.EnsureRow(C),u=!0}if(v.column>=this.active_sheet.columns&&this.options.expand){for(S=this.active_sheet.columns;v.column>=S;)S+=8;this.active_sheet.cells.EnsureColumn(S),u=!0}u&&(this.layout.UpdateTiles(),this.layout.UpdateContentsSize(),this.Repaint(!0,!0),i=!0),this.Select(t,new f({row:Math.min(Math.max(0,v.row),this.active_sheet.rows-1),column:Math.min(Math.max(0,v.column),this.active_sheet.columns-1)})),this.RenderSelections(),this.ScrollIntoView(t.target)}}this.SelectingArgument()&&this.UpdateSelectedArgument(t),i&&this.DelayedRender()},e.prototype.HighlightDependencies=function(e,t){var r,o;void 0===t&&(t=!0);var i=0;try{e:for(var n=s(e),a=n.next();!a.done;a=n.next()){var l=a.value;if((l.start.row===1/0||l.start.row<this.active_sheet.rows)&&(l.start.column===1/0||l.start.column<this.active_sheet.columns)){var c=(l=this.active_sheet.RealArea(l)).spreadsheet_label;if(this.additional_selections[i]&&this.additional_selections[i].area.spreadsheet_label===c)i++;else{for(var d=0;d<i;d++)if(this.additional_selections[d].area.spreadsheet_label===c&&this.additional_selections[d].area.start.sheet_id===l.start.sheet_id)continue e;this.additional_selections[i++]={target:l.start,area:l}}}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}this.additional_selections.splice(i),t&&this.RenderSelections(!1)},e.prototype.AddAdditionalSelection=function(e,t){var r=t.spreadsheet_label;return!this.additional_selections.some((function(e){return e.area.spreadsheet_label===r}))&&(this.additional_selections.push({target:e,area:t}),!0)},e.prototype.ClearAdditionalSelections=function(){this.additional_selections.splice(0,this.additional_selections.length)},e.prototype.ClearSelection=function(e){this.Select(e)},e.prototype.HideGridSelection=function(){this.UpdateAddressLabel(void 0,"");var e=this.selected_annotation&&this.selected_annotation.formula?this.selected_annotation.formula:"";this.UpdateFormulaBarFormula(e),this.layout.ShowSelections(!1)},e.prototype.ShowGridSelection=function(){this.UpdateAddressLabel(),this.UpdateFormulaBarFormula(),this.layout.ShowSelections(!0)},e.prototype.Select=function(e,t,r,i){var n=this;if(void 0===i&&(i=!1),e.empty||i&&(r=e.target),t){var a=this.active_sheet.RealArea(t);r||(r=a.start);for(var s=!0;s;)s=!1,this.active_sheet.cells.Apply(a,(function(e){e.merge_area&&!a.ContainsArea(e.merge_area)&&(t.ConsumeArea(e.merge_area),a=n.active_sheet.RealArea(t),s=!0)}));e.area=new f(o(o({},t.start),{sheet_id:this.active_sheet.id}),t.end),r&&(e.target=o(o({},r),{sheet_id:this.active_sheet.id})),e.empty=!1}else e.empty=!0;e===this.primary_selection&&(De.is_edge&&this.Focus(),this.grid_events.Publish({type:"selection",selection:this.primary_selection}),this.UpdateAddressLabel(),this.UpdateFormulaBarFormula())},e.prototype.SetValidationInternal=function(e){var t,r,o,i;if(e.target.sheet_id&&e.target.sheet_id!==this.model.active_sheet.id)try{for(var n=s(this.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.id===e.target.sheet_id){o=l;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}else o=this.model.active_sheet;if(o&&(i=o.cells.GetCell(e.target,!0)),!i)throw new Error("invalid cell in set validation");e.range?i.validation={type:m.Range,area:e.range}:e.list?i.validation={type:m.List,list:JSON.parse(JSON.stringify(e.list))}:i.validation=void 0},e.prototype.GetValidationRange=function(e){var t,r,o,i;if(e.start.sheet_id&&e.start.sheet_id!==this.model.active_sheet.id)try{for(var n=s(this.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.id===e.start.sheet_id){o=l;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}else o=this.model.active_sheet;if(o){i=[];for(var c=(e=o.RealArea(new f(e.start,e.end),!0)).start.row;c<=e.end.row;c++)for(var d=e.start.column;d<=e.end.column;d++){var u=o.CellData({row:c,column:d});u&&u.formatted&&("string"==typeof u.formatted?i.push(u.formatted):i.push(de.FormatPartsAsText(u.formatted)))}}return i},e.prototype.UpdateFormulaBarFormula=function(e){var t,r;if(this.formula_bar)if(e)this.formula_bar.formula=e;else if(this.primary_selection.empty)this.formula_bar.formula="";else{var o=this.active_sheet.CellData(this.primary_selection.target),i=o.merge_area||o.area;i&&(i.start.column===this.primary_selection.target.column&&i.start.row===this.primary_selection.target.row||(o=this.active_sheet.CellData(i.start))),this.formula_bar.editable=!(null===(t=o.style)||void 0===t?void 0:t.locked);var n=this.NormalizeCellValue(o);if(o.validation&&!(null===(r=o.style)||void 0===r?void 0:r.locked)){var a=void 0;o.validation.type===m.List?a=o.validation.list:o.validation.type===m.Range&&(a=this.GetValidationRange(o.validation.area)),a&&a.length&&this.layout.ShowDropdownCaret(o.merge_area||new f(this.primary_selection.target),a,o.value)}else this.layout.HideDropdownCaret();o.area?this.formula_bar.formula="{"+(n||"")+"}":this.formula_bar.formula=void 0!==n?n.toString():""}},e.prototype.UpdateAddressLabel=function(e,t){if(void 0===e&&(e=this.primary_selection),this.formula_bar)if(void 0!==t)this.formula_bar.label=t;else if(e.empty)this.formula_bar.label="";else{var r=this.active_sheet.CellData(this.primary_selection.target),o=new f(r.merge_area?r.merge_area.start:e.target);this.formula_bar.label=this.model.named_ranges.MatchSelection(e.area,o)||f.CellAddressToLabel(o.start)}},e.prototype.OnDropdownSelect=function(e){if(void 0!==e){var t=pe.TryParse(e.toString());t.type===u.number&&(e=t.value)}var r=this.active_sheet.CellData(this.primary_selection.target),o=r.merge_area?r.merge_area.start:this.primary_selection.target;this.ExecCommand({key:Ye.SetRange,area:o,value:e}),this.UpdateFormulaBarFormula()},e.prototype.OnScroll=function(){var e=this,t=this.layout.VisibleTiles();t.Equals(this.render_tiles)||(this.render_tiles=t,this.layout_token||(this.layout_token=requestAnimationFrame((function(){return e.Repaint()}))))},e.prototype.AttachListeners=function(){var e,t=this;if(!this.container)throw new Error("invalid container");this.container.addEventListener("copy",this.HandleCopy.bind(this)),this.container.addEventListener("cut",this.HandleCut.bind(this)),this.container.addEventListener("paste",this.HandlePaste.bind(this)),this.layout.grid_cover.addEventListener("mousedown",(function(e){return t.MouseDown_Grid(e)})),this.layout.column_header_cover.addEventListener("mousedown",(function(e){return t.MouseDown_ColumnHeader(e)})),this.layout.row_header_cover.addEventListener("mousedown",(function(e){return t.MouseDown_RowHeader(e)})),this.layout.column_header_cover.addEventListener("mousemove",(function(e){return t.MouseMove_ColumnHeader(e)})),this.layout.row_header_cover.addEventListener("mousemove",(function(e){return t.MouseMove_RowHeader(e)})),this.layout.grid_cover.addEventListener("mousemove",(function(e){return t.MouseMove_Grid(e)})),null===(e=this.overlay_editor)||void 0===e||e.edit_node.addEventListener("keydown",(function(e){return t.OverlayKeyDown(e)})),this.layout.corner.addEventListener("dblclick",(function(){t.SelectAll()}))},e.prototype.HandleCopy=function(e){if(e.stopPropagation(),e.preventDefault(),this.primary_selection.empty){if(e.clipboardData&&e.clipboardData.clearData(),this.selected_annotation&&e.clipboardData){var t=JSON.stringify({data:this.selected_annotation,source:this.active_sheet.id});if(e.clipboardData.setData("text/x-treb-annotation",t),this.selected_annotation.node){var r=this.selected_annotation.node.firstChild;if(r){var o=function(e){if(!q){var t={},r=document.createElement("iframe");r.style.width="10px",r.style.height="10px",r.style.position="absolute",r.style.left="-100px",document.body.appendChild(r);var o=r.contentDocument;if(o){var i=o.createElement("div");o.body.appendChild(i);var n=getComputedStyle(i);Array.prototype.forEach.call(n,(function(e){return t[e]=n[e]}))}document.body.removeChild(r),q=t}return Q(e,q)}(r).outerHTML;e.clipboardData.setData("text/plain",o)}}}}else{for(var i=this.active_sheet.RealArea(this.primary_selection.area),n=i.columns,a=i.rows,s=[],l=[],c=0;c<a;c++){for(var d=[],u=0;u<n;u++){var h={row:i.start.row+c,column:i.start.column+u},f=this.active_sheet.CellData(h);d.push(void 0===f.calculated?f.value:f.calculated);var p={address:h,data:f.value,type:f.type,style:this.active_sheet.GetCopyStyle(h)};f.area&&f.area.start.row===h.row&&f.area.start.column===h.column&&(p.array={rows:f.area.rows,columns:f.area.columns}),l.push(JSON.parse(JSON.stringify(p)))}s.push(d)}var m=s.map((function(e){return e.join("\t")})).join("\n");e.clipboardData&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",m),e.clipboardData.setData("text/x-treb",JSON.stringify({source:i,data:l})))}},e.prototype.HandleCut=function(e){if(e.stopPropagation(),e.preventDefault(),this.HandleCopy(e),this.primary_selection.empty)this.selected_annotation&&this.RemoveAnnotation(this.selected_annotation);else{var t=this.active_sheet.RealArea(this.primary_selection.area);this.ExecCommand({key:Ye.Clear,area:t})}},e.prototype.RecyclePasteAreas=function(e,t){var r=[];if(1===e.count)for(var o=t.start.row;o<=t.end.row;o++)for(var i=t.start.column;i<=t.end.column;i++)r.push(new f({row:o,column:i}));else if(e.columns===t.columns&&t.rows>=e.rows&&t.rows%e.rows==0)for(o=t.start.row;o<=t.end.row;o+=e.rows)r.push(new f({row:o,column:t.start.column},{row:o+e.rows-1,column:t.end.column}));else if(e.rows===t.rows&&t.columns>=e.columns&&t.columns%e.columns==0)for(i=t.start.column;i<=t.end.column;i+=e.columns)r.push(new f({column:i,row:t.start.row},{column:i+e.columns-1,row:t.end.row}));else r.push(t.Clone().Resize(e.rows,e.columns));return r},e.prototype.HandlePaste=function(e){var t,r,i,n,a,l,c,d,h,p=this;if(!(null===(h=this.overlay_editor)||void 0===h?void 0:h.editing)&&(e.stopPropagation(),e.preventDefault(),e.clipboardData)){var m=e.clipboardData.getData("text/x-treb-annotation");if(m)try{var v=JSON.parse(m);if(v.source&&v.source!==this.active_sheet.id&&v.data&&v.data.formula){var y="";try{for(var _=s(this.model.sheets),g=_.next();!g.done;g=_.next()){var b=g.value;if(b.id===v.source){y=b.name;break}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}if(y){var w=this.parser.Parse(v.data.formula);w.expression&&(this.parser.Walk(w.expression,(function(e){return"address"===e.type&&(e.sheet_id||e.sheet||(e.sheet=y)),!0})),v.data.formula="="+this.parser.Render(w.expression,void 0,""))}}var x=this.CreateAnnotation(v.data,!0,!0);if(x.node){var C=x.node;setTimeout((function(){C.focus()}),1)}}catch(e){console.error(e)}else if(!this.primary_selection.empty){var S=this.active_sheet.RealArea(this.primary_selection.area),A=[],k=e.clipboardData.getData("text/x-treb");if(k)try{var M=JSON.parse(k),R=new f(M.source.start,M.source.end);1===(N=this.RecyclePasteAreas(R,S)).length&&S.Resize(N[0].rows,N[0].columns);var T=[],L=function(e){E.active_sheet.cells.EnsureCell(e.end),A.push({key:Ye.Clear,area:e});var t={rows:e.start.row-R.start.row,columns:e.start.column-R.start.column};M.data.forEach((function(r){var i,n,a=r.data,l={row:r.address.row-R.start.row+e.start.row,column:r.address.column-R.start.column+e.start.column};if(r.type===u.formula){var c=p.parser.Parse(a);c.expression&&(a="="+p.parser.Render(c.expression,t,""))}if(r.array){var d={start:o({},l),end:{row:l.row+r.array.rows-1,column:l.column+r.array.columns-1}},h={key:Ye.SetRange,value:a,array:!0,area:d};T.push(new f(d.start,d.end)),A.push(h)}else{var m=!1;try{for(var v=(i=void 0,s(T)),y=v.next();!y.done;y=v.next())if(y.value.Contains(l)){m=!0;break}}catch(e){i={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}m||A.push({key:Ye.SetRange,value:a,area:l})}A.push({key:Ye.UpdateStyle,style:r.style||{},area:l})}))},E=this;try{for(var z=s(N),D=z.next();!D.done;D=z.next())L(O=D.value)}catch(e){i={error:e}}finally{try{D&&!D.done&&(n=z.return)&&n.call(z)}finally{if(i)throw i.error}}}catch(e){return console.error("invalid treb data on clipboard"),void console.info(e)}else{var P=e.clipboardData.getData("text/plain");if(!P)return!0;var N,F=P.trim().split("\n").map((function(e){return e.split("\t").map((function(e){return e.trim()}))}));1===(N=this.RecyclePasteAreas(new f({row:0,column:0},{row:F.length-1,column:F[0].length-1}),S)).length&&(S.Resize(F.length,F[0].length),S.Resize(N[0].rows,N[0].columns));try{for(var I=s(N),U=I.next();!U.done;U=I.next())for(var O=U.value,V=0;V<F.length;V++)for(var H=0;H<F[0].length;H++){var j=new f({row:V+O.start.row,column:H+O.start.column});if(this.active_sheet.cells.EnsureCell(j.end),F[V][H]){var G=this.SetInferredType({area:j,target:j.start,empty:!1},F[V][H],!1,!1);if(G)try{for(var B=(c=void 0,s(G)),Z=B.next();!Z.done;Z=B.next()){var J=Z.value;A.push(J)}}catch(e){c={error:e}}finally{try{Z&&!Z.done&&(d=B.return)&&d.call(B)}finally{if(c)throw c.error}}}else{var q=this.active_sheet.cells.GetCell(j.start,!1);q&&q.type!==u.undefined&&A.push({key:Ye.Clear,area:j.Clone()})}}}catch(e){a={error:e}}finally{try{U&&!U.done&&(l=I.return)&&l.call(I)}finally{if(a)throw a.error}}}this.ExecCommand(A),this.Select(this.primary_selection,S)}}},e.prototype.AllSelections=function(e){void 0===e&&(e=!1);var t=[this.primary_selection,this.active_selection].concat(this.additional_selections);return e?t:t.filter((function(e){return!e.empty}))},e.prototype.FreezeInternal=function(e){var t="boolean"!=typeof e.highlight_transition||e.highlight_transition;e.rows!==this.active_sheet.freeze.rows||e.columns!==this.active_sheet.freeze.columns?(this.active_sheet.freeze.rows=e.rows,this.active_sheet.freeze.columns=e.columns,this.QueueLayoutUpdate(),this.Repaint(),t&&this.HighlightFreezeArea(),e.rows||e.columns?this.layout.CloneFrozenAnnotations():this.layout.ClearFrozenAnnotations()):t&&this.HighlightFreezeArea()},e.prototype.RenameSheetInternal=function(e,t){var r,o,i,n,a,l,c=this;if(!t||V.test(t))throw new Error("invalid sheet name");var d=t.toLowerCase();try{for(var u=s(this.model.sheets),h=u.next();!h.done;h=u.next())if((v=h.value)!==e&&v.name.toLowerCase()===d)throw new Error("sheet name already exists")}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}var f=e.name.toLowerCase();e.name=t;try{for(var p=s(this.model.sheets),m=p.next();!m.done;m=p.next()){var v;(v=m.value).cells.IterateAll((function(e){if(e.ValueIsFormula()){var r=!1,o=c.parser.Parse(e.value||"");o.expression&&(c.parser.Walk(o.expression,(function(e){return"address"===e.type&&e.sheet&&e.sheet.toLowerCase()===f&&(e.sheet=t,r=!0),!0})),r&&(e.value="="+c.parser.Render(o.expression,void 0,"")))}}));var y=function(e){if(e.formula){var r=!1,o=_.parser.Parse(e.formula||"");o.expression&&(_.parser.Walk(o.expression,(function(e){return"address"===e.type&&e.sheet&&e.sheet.toLowerCase()===f&&(e.sheet=t,r=!0),!0})),r&&(e.formula="="+_.parser.Render(o.expression,void 0,"")))}},_=this;try{for(var g=(a=void 0,s(v.annotations)),b=g.next();!b.done;b=g.next())y(b.value)}catch(e){a={error:e}}finally{try{b&&!b.done&&(l=g.return)&&l.call(g)}finally{if(a)throw a.error}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}},e.prototype.PatchFormulasInternal=function(e,t,r,o,i,n,a){var l=this.parser.Parse(e||""),c=!1;if(l.expression&&(this.parser.Walk(l.expression,(function(e){var l,d;if("range"===e.type||"address"===e.type){var u=[];"range"===e.type?(e.start.sheet&&e.start.sheet.toLowerCase()===n||!e.start.sheet&&a)&&u.push(e.start,e.end):"address"===e.type&&(e.sheet&&e.sheet.toLowerCase()===n||!e.sheet&&a)&&u.push(e);try{for(var h=s(u),f=h.next();!f.done;f=h.next()){var p=f.value;r&&p.row>=t&&(r<0&&p.row+r<t?p.column=p.row=-1:p.row+=r,c=!0),i&&p.column>=o&&(i<0&&p.column+i<o?p.column=p.row=-1:p.column+=i,c=!0)}}catch(e){l={error:e}}finally{try{f&&!f.done&&(d=h.return)&&d.call(h)}finally{if(l)throw l.error}}return!1}return!0})),c))return"="+this.parser.Render(l.expression,void 0,"")},e.prototype.InsertRowsInternal=function(e){var t,r,o,i,n,a,l,c,d,u,h,f,p=this;if(this.active_sheet.InsertRows(e.before_row,e.count)){this.model.named_ranges.PatchNamedRanges(0,0,e.before_row,e.count);var m=this.active_sheet.name.toLowerCase(),v=function(t){var r,o,i=t===y.active_sheet;t.cells.IterateAll((function(t){if(t.ValueIsFormula()){var r=p.PatchFormulasInternal(t.value||"",e.before_row,e.count,0,0,m,i);r&&(t.value=r)}}));try{for(var n=(r=void 0,s(t.annotations)),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.formula){var c=y.PatchFormulasInternal(l.formula||"",e.before_row,e.count,0,0,m,i);c&&(l.formula=c)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}},y=this;try{for(var _=s(this.model.sheets),g=_.next();!g.done;g=_.next())v(g.value)}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}var b=[],w=[];if(e.count>0){var x=this.layout.CellAddressToRectangle({row:e.before_row,column:0}),C=this.layout.default_row_height*e.count+1;try{for(var S=s(this.active_sheet.annotations),A=S.next();!A.done;A=S.next())if((U=A.value).scaled_rect){if(x.top>=U.scaled_rect.bottom)continue;x.top<=U.scaled_rect.top?U.scaled_rect.top+=C-1:(U.scaled_rect.height+=C,w.push(U)),U.layout=this.layout.RectToAnnotationLayout(U.scaled_rect),b.push(U)}}catch(e){o={error:e}}finally{try{A&&!A.done&&(i=S.return)&&i.call(S)}finally{if(o)throw o.error}}}else if(e.count<0){var k=this.layout.CellAddressToRectangle({row:e.before_row,column:0});e.count<-1&&(k=k.Combine(this.layout.CellAddressToRectangle({row:e.before_row-e.count-1,column:0})));try{for(var M=s(this.active_sheet.annotations),R=M.next();!R.done;R=M.next())if((U=R.value).scaled_rect){if(U.scaled_rect.bottom<=k.top)continue;if(U.scaled_rect.top>=k.bottom-1)U.scaled_rect.top-=k.height;else if(U.scaled_rect.top<=k.top&&U.scaled_rect.bottom>=k.bottom)U.scaled_rect.height=Math.max(U.scaled_rect.height-k.height,10),w.push(U);else{if(U.scaled_rect.top>=k.top&&U.scaled_rect.bottom<=k.bottom)continue;if(U.scaled_rect.top>=k.top&&U.scaled_rect.bottom>k.bottom){var T=U.scaled_rect.top-k.top+1,L=k.height-T;U.scaled_rect.top-=T,U.scaled_rect.height=Math.max(U.scaled_rect.height-L,10),w.push(U)}else U.scaled_rect.top<k.top&&U.scaled_rect.bottom<=k.bottom?(L=U.scaled_rect.bottom-k.top,U.scaled_rect.height=Math.max(U.scaled_rect.height-L,10),w.push(U)):console.info("unhandled case")}U.layout=this.layout.RectToAnnotationLayout(U.scaled_rect),b.push(U)}}catch(e){n={error:e}}finally{try{R&&!R.done&&(a=M.return)&&a.call(M)}finally{if(n)throw n.error}}}if(e.count<0)try{for(var E=s(this.AllSelections()),z=E.next();!z.done;z=E.next())(N=z.value).empty=!0}catch(e){l={error:e}}finally{try{z&&!z.done&&(c=E.return)&&c.call(E)}finally{if(l)throw l.error}}else try{for(var D=s(this.AllSelections()),P=D.next();!P.done;P=D.next()){var N;(N=P.value).target.row>=e.before_row&&(N.target.row+=e.count),N.area.entire_column||(N.area.start.row>=e.before_row?N.area.Shift(e.count,0):N.area.end.row>=e.before_row&&N.area.ConsumeAddress({row:N.area.end.row+e.count,column:N.area.end.column}))}}catch(e){d={error:e}}finally{try{P&&!P.done&&(u=D.return)&&u.call(D)}finally{if(d)throw d.error}}if(this.QueueLayoutUpdate(),this.Repaint(),b.length){this.layout.UpdateAnnotation(b);try{for(var F=s(w),I=F.next();!I.done;I=F.next()){var U;(U=I.value).resize_callback&&U.resize_callback.call(void 0)}}catch(e){h={error:e}}finally{try{I&&!I.done&&(f=F.return)&&f.call(F)}finally{if(h)throw h.error}}}}else this.Error("You can't change part of an array.")},e.prototype.InsertColumnsInternal=function(e){var t,r,o,i,n,a,l,c,d,u,h,f,p=this;if(this.active_sheet.InsertColumns(e.before_column,e.count)){this.model.named_ranges.PatchNamedRanges(e.before_column,e.count,0,0);var m=this.active_sheet.name.toLowerCase(),v=function(t){var r,o,i=t===y.active_sheet;t.cells.IterateAll((function(t){if(t.ValueIsFormula()){var r=p.PatchFormulasInternal(t.value||"",0,0,e.before_column,e.count,m,i);r&&(t.value=r)}}));try{for(var n=(r=void 0,s(t.annotations)),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.formula){var c=y.PatchFormulasInternal(l.formula,0,0,e.before_column,e.count,m,i);c&&(l.formula=c)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}},y=this;try{for(var _=s(this.model.sheets),g=_.next();!g.done;g=_.next())v(g.value)}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}var b=[],w=[];if(e.count>0){var x=this.layout.CellAddressToRectangle({row:0,column:e.before_column}),C=this.layout.default_column_width*e.count+1;try{for(var S=s(this.active_sheet.annotations),A=S.next();!A.done;A=S.next())if((U=A.value).scaled_rect){if(x.left>=U.scaled_rect.right)continue;x.left<=U.scaled_rect.left?U.scaled_rect.left+=C-1:(U.scaled_rect.width+=C,w.push(U)),U.layout=this.layout.RectToAnnotationLayout(U.scaled_rect),b.push(U)}}catch(e){o={error:e}}finally{try{A&&!A.done&&(i=S.return)&&i.call(S)}finally{if(o)throw o.error}}}else if(e.count<0){var k=this.layout.CellAddressToRectangle({row:0,column:e.before_column});e.count<-1&&(k=k.Combine(this.layout.CellAddressToRectangle({row:0,column:e.before_column-e.count-1})));try{for(var M=s(this.active_sheet.annotations),R=M.next();!R.done;R=M.next())if((U=R.value).scaled_rect){if(U.scaled_rect.right<=k.left)continue;if(U.scaled_rect.left>=k.right-1)U.scaled_rect.left-=k.width;else if(U.scaled_rect.left<=k.left&&U.scaled_rect.right>=k.right)U.scaled_rect.width=Math.max(U.scaled_rect.width-k.width,10),w.push(U);else{if(U.scaled_rect.left>=k.left&&U.scaled_rect.right<=k.right)continue;if(U.scaled_rect.left>=k.left&&U.scaled_rect.right>k.right){var T=U.scaled_rect.left-k.left+1,L=k.width-T;U.scaled_rect.left-=T,U.scaled_rect.width=Math.max(U.scaled_rect.width-L,10),w.push(U)}else U.scaled_rect.left<k.left&&U.scaled_rect.right<=k.right?(L=U.scaled_rect.right-k.left,U.scaled_rect.width=Math.max(U.scaled_rect.width-L,10),w.push(U)):console.info("unhandled case")}U.layout=this.layout.RectToAnnotationLayout(U.scaled_rect),b.push(U)}}catch(e){n={error:e}}finally{try{R&&!R.done&&(a=M.return)&&a.call(M)}finally{if(n)throw n.error}}}if(e.count<0)try{for(var E=s(this.AllSelections()),z=E.next();!z.done;z=E.next())(N=z.value).empty=!0}catch(e){l={error:e}}finally{try{z&&!z.done&&(c=E.return)&&c.call(E)}finally{if(l)throw l.error}}else try{for(var D=s(this.AllSelections()),P=D.next();!P.done;P=D.next()){var N;(N=P.value).target.column>=e.before_column&&(N.target.column+=e.count),N.area.entire_row||(N.area.start.column>=e.before_column?N.area.Shift(0,e.count):N.area.end.column>=e.before_column&&N.area.ConsumeAddress({row:N.area.end.row,column:N.area.end.column+e.count}))}}catch(e){d={error:e}}finally{try{P&&!P.done&&(u=D.return)&&u.call(D)}finally{if(d)throw d.error}}if(this.QueueLayoutUpdate(),this.Repaint(),b.length){this.layout.UpdateAnnotation(b);try{for(var F=s(w),I=F.next();!I.done;I=F.next()){var U;(U=I.value).resize_callback&&U.resize_callback.call(void 0)}}catch(e){h={error:e}}finally{try{I&&!I.done&&(f=F.return)&&f.call(F)}finally{if(h)throw h.error}}}}else this.Error("You can't change part of an array.")},e.prototype.ApplyBordersInternal=function(e){var t,r,i=e.borders,n=e.borders===je.None?0:e.width,a=new f(e.area.start,e.area.end),l=this.active_sheet;if(e.area.start.sheet_id&&e.area.start.sheet_id!==this.active_sheet.id)try{for(var c=s(this.model.sheets),d=c.next();!d.done;d=c.next()){var u=d.value;if(u.id===e.area.start.sheet_id){l=u;break}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var h={border_top:n},p={border_bottom:n},m={border_left:n},v={border_right:n};return e.color&&(h.border_top_fill=o({},e.color),p.border_bottom_fill=o({},e.color),m.border_left_fill=o({},e.color),v.border_right_fill=o({},e.color)),i!==je.None&&i!==je.All||l.UpdateAreaStyle(a,o(o(o(o({},h),p),m),v),!0),i!==je.Top&&i!==je.Outside||a.entire_column||l.UpdateAreaStyle(a.top,o({},h),!0),i!==je.None&&i!==je.All&&i!==je.Outside&&i!==je.Top||a.entire_column||a.start.row&&l.UpdateAreaStyle(new f({row:a.start.row-1,column:a.start.column},{row:a.start.row-1,column:a.end.column}),o({},{border_bottom:0}),!0),i!==je.Bottom&&i!==je.Outside||a.entire_column||l.UpdateAreaStyle(a.bottom,o({},p),!0),i!==je.None&&i!==je.All&&i!==je.Outside&&i!==je.Bottom||a.entire_column||l.UpdateAreaStyle(new f({row:a.end.row+1,column:a.start.column},{row:a.end.row+1,column:a.end.column}),o({},{border_top:0}),!0),i!==je.Left&&i!==je.Outside||a.entire_row||l.UpdateAreaStyle(a.left,o({},m),!0),i!==je.None&&i!==je.All&&i!==je.Outside&&i!==je.Left||a.entire_row||a.start.column&&l.UpdateAreaStyle(new f({row:a.start.row,column:a.start.column-1},{row:a.end.row,column:a.start.column-1}),o({},{border_right:0}),!0),i!==je.Right&&i!==je.Outside||a.entire_row||l.UpdateAreaStyle(a.right,o({},v),!0),i!==je.None&&i!==je.All&&i!==je.Outside&&i!==je.Right||a.entire_row||l.UpdateAreaStyle(new f({row:a.start.row,column:a.end.column+1},{row:a.end.row,column:a.end.column+1}),o({},{border_left:0}),!0),f.Bleed(a)},e.prototype.SetRangeInternal=function(e){var t,r,o=h(e.area)?new f(e.area):new f(e.area.start,e.area.end),i=this.active_sheet;if(o.start.sheet_id&&o.start.sheet_id!==this.active_sheet.id)try{for(var n=s(this.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.id===o.start.sheet_id){i=l;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}if(o.entire_row||o.entire_column||!(o.end.row>=i.rows||o.end.column>=i.columns)||(i.cells.EnsureCell(o.end),this.QueueLayoutUpdate()),h(e.area)){var c=i.CellData(e.area);if(c.area&&(c.area.rows>1||c.area.columns>1))return void this.Error("You can't change part of an array.");var d=Array.isArray(e.value)?Array.isArray(e.value[0])?e.value[0][0]:e.value[0]:e.value;return e.array?i.SetArrayValue(o,d):i.SetCellValue(e.area,d),o}return e.array?(d=Array.isArray(e.value)?Array.isArray(e.value[0])?e.value[0][0]:e.value[0]:e.value,i.SetArrayValue(o,d)):i.SetAreaValues2(o,e.value),o},e.prototype.ClearAreaInternal=function(e){var t=!1;e=this.active_sheet.RealArea(e),this.active_sheet.cells.Apply(e,(function(r){r.area&&!e.ContainsArea(r.area)&&(t=!0)})),t?this.Error("You can't change part of an array."):this.active_sheet.ClearArea(e)},e.prototype.ExecCommand=function(e){var t,r,o,i,n,a,d=!1,u=!1,p=[];Array.isArray(e)||(e=[e]),this.command_log.Publish({command:e,timestamp:(new Date).getTime()});var m=function(e){var t,r,o,l,c,p,m,y,_,g,b,w,x,C;switch(e.key){case Ye.Clear:if(e.area){var S=new f(e.area.start,e.area.end);v.ClearAreaInternal(S),n=f.Join(S,n),v.UpdateFormulaBarFormula()}else Ae.Reset(),v.RemoveAnnotationNodes(),v.UpdateSheets([],!0),v.model.named_ranges.Reset(),v.model.macro_functions={},v.ClearSelection(v.primary_selection),v.ScrollIntoView({row:0,column:0}),v.QueueLayoutUpdate(),v.layout.HideNote();break;case Ye.Select:e.area?(e.area.start.sheet_id&&e.area.start.sheet_id!==v.active_sheet.id&&v.ActivateSheetInternal({key:Ye.ActivateSheet,id:e.area.start.sheet_id}),v.Select(v.primary_selection,new f(e.area.start,e.area.end)),v.RenderSelections()):v.ClearSelection(v.primary_selection);break;case Ye.Freeze:v.FreezeInternal(e),d=!0;break;case Ye.MergeCells:v.active_sheet.MergeCells(new f(e.area.start,e.area.end)),i=f.Join(e.area,i),d=!0,u=!0,n=f.Join(e.area,n);break;case Ye.UnmergeCells:var A={};S=new f(e.area.start,e.area.end),v.active_sheet.cells.Apply(S,(function(e){if(e.merge_area){var t=f.CellAddressToLabel(e.merge_area.start)+":"+f.CellAddressToLabel(e.merge_area.end);A[t]=e.merge_area}}),!1);for(var k=Object.keys(A),M=0;M<k.length;M++)v.active_sheet.UnmergeCells(A[k[M]]);i=f.Join(e.area,i),n=f.Join(e.area,n),d=!0,u=!0;break;case Ye.UpdateStyle:S=void 0;var R=v.active_sheet;if(h(e.area)){if((S=new f(e.area)).start.sheet_id&&S.start.sheet_id!==v.active_sheet.id)try{for(var T=(t=void 0,s(v.model.sheets)),L=T.next();!L.done;L=T.next())if((W=L.value).id===S.start.sheet_id){R=W;break}}catch(e){t={error:e}}finally{try{L&&!L.done&&(r=T.return)&&r.call(T)}finally{if(t)throw t.error}}R.UpdateCellStyle(e.area,e.style,!!e.delta)}else{if((S=new f(e.area.start,e.area.end)).start.sheet_id&&S.start.sheet_id!==v.active_sheet.id)try{for(var E=(o=void 0,s(v.model.sheets)),z=E.next();!z.done;z=E.next())if((W=z.value).id===S.start.sheet_id){R=W;break}}catch(e){o={error:e}}finally{try{z&&!z.done&&(l=E.return)&&l.call(E)}finally{if(o)throw o.error}}R.UpdateAreaStyle(S,e.style,!!e.delta)}R===v.active_sheet&&(a=f.Join(S,a),(!e.delta||e.style.fill||e.style.border_top||e.style.border_left||e.style.border_right||e.style.border_bottom)&&(S=f.Bleed(S),v.active_sheet.Invalidate(S)),i=f.Join(S,i));break;case Ye.DataValidation:v.SetValidationInternal(e),i=f.Join(new f(e.target),i);break;case Ye.SetName:e.area?(v.model.named_ranges.SetName(e.name,new f(e.area.start,e.area.end)),v.autocomplete_matcher.AddFunctions({type:we.Token,name:e.name})):(v.model.named_ranges.ClearName(e.name),v.autocomplete_matcher.RemoveFunctions({type:we.Token,name:e.name})),d=!0,u=!0;break;case Ye.UpdateBorders:S=v.ApplyBordersInternal(e),i=f.Join(S,i),a=f.Join(S,a);break;case Ye.ShowSheet:v.ShowSheetInternal(e),d=!0;break;case Ye.ReorderSheet:var D=[],P=v.model.sheets[e.index];for(M=0;M<v.model.sheets.length;M++)M!==e.index&&(M===e.move_before&&D.push(P),D.push(v.model.sheets[M]));e.move_before>=v.model.sheets.length&&D.push(P),v.model.sheets=D,v.tab_bar&&v.tab_bar.Update(),d=!0;break;case Ye.RenameSheet:(R=v.ResolveSheet(e))&&(v.RenameSheetInternal(R,e.new_name),v.tab_bar&&v.tab_bar.Update(),d=!0);break;case Ye.ResizeRows:var N=e.row;if(void 0===N)for(N=[],M=0;M<v.active_sheet.rows;M++)N.push(M);if("number"==typeof N&&(N=[N]),"number"==typeof e.height)try{for(var F=(c=void 0,s(N)),I=F.next();!I.done;I=F.next()){var U=I.value;v.layout.SetRowHeight(U,e.height)}}catch(e){c={error:e}}finally{try{I&&!I.done&&(p=F.return)&&p.call(F)}finally{if(c)throw c.error}}else try{for(var O=(m=void 0,s(N)),V=O.next();!V.done;V=O.next())U=V.value,v.active_sheet.AutoSizeRow(U,v.theme.grid_cell)}catch(e){m={error:e}}finally{try{V&&!V.done&&(y=O.return)&&y.call(O)}finally{if(m)throw m.error}}v.layout.UpdateTotalSize(),v.layout.container&&v.layout.container.offsetHeight&&v.layout.container.offsetHeight>v.layout.total_height?v.UpdateLayout():(v.layout.UpdateTileHeights(!0),v.render_tiles=v.layout.VisibleTiles(),v.Repaint(!1,!0)),v.layout.UpdateAnnotation(v.active_sheet.annotations),d=!0,v.RenderSelections();break;case Ye.ResizeColumns:var H=e.column;if(void 0===H)for(H=[],M=0;M<v.active_sheet.columns;M++)H.push(M);if("number"==typeof H&&(H=[H]),"number"==typeof e.width)try{for(var j=(_=void 0,s(H)),G=j.next();!G.done;G=j.next())U=G.value,v.layout.SetColumnWidth(U,e.width)}catch(e){_={error:e}}finally{try{G&&!G.done&&(g=j.return)&&g.call(j)}finally{if(_)throw _.error}}else try{for(var B=(b=void 0,s(H)),Z=B.next();!Z.done;Z=B.next())U=Z.value,v.active_sheet.AutoSizeColumn(U,!1)}catch(e){b={error:e}}finally{try{Z&&!Z.done&&(w=B.return)&&w.call(B)}finally{if(b)throw b.error}}v.layout.UpdateTotalSize(),v.layout.container&&v.layout.container.offsetWidth&&v.layout.container.offsetWidth>v.layout.total_width?v.UpdateLayout():(v.layout.UpdateTileWidths(!0),v.render_tiles=v.layout.VisibleTiles(),v.Repaint(!1,!0)),v.layout.UpdateAnnotation(v.active_sheet.annotations),d=!0,v.RenderSelections();break;case Ye.ShowHeaders:v.active_sheet.SetHeaderSize(e.show?void 0:1,e.show?void 0:1),v.QueueLayoutUpdate(),v.Repaint();break;case Ye.InsertRows:v.InsertRowsInternal(e),d=!0,u=!0;break;case Ye.InsertColumns:v.InsertColumnsInternal(e),d=!0,u=!0;break;case Ye.SetLink:case Ye.SetNote:if(R=v.active_sheet,e.address.sheet_id)try{for(var J=(x=void 0,s(v.model.sheets)),q=J.next();!q.done;q=J.next()){var W;if((W=q.value).id===e.address.sheet_id){R=W;break}}}catch(e){x={error:e}}finally{try{q&&!q.done&&(C=J.return)&&C.call(J)}finally{if(x)throw x.error}}var K=R.cells.GetCell(e.address,!0);K&&(S=void 0,K.merge_area?(S=new f(K.merge_area.start),K=R.cells.GetCell(K.merge_area.start,!0)):S=new f(e.address),e.key===Ye.SetNote?K.SetNote(e.note):(K.hyperlink=e.reference||void 0,K.render_dirty=!0),R===v.active_sheet&&v.DelayedRender(!1,S),a=f.Join(S,a),i=f.Join(S,i));break;case Ye.SetRange:(S=v.SetRangeInternal(e))&&(n=f.Join(S,n),v.options.repaint_on_cell_change&&(i=f.Join(S,i)));break;case Ye.DeleteSheet:v.DeleteSheetInternal(e),d=!0,u=!0;break;case Ye.DuplicateSheet:v.DuplicateSheetInternal(e),d=!0,u=!0;break;case Ye.AddSheet:v.ActivateSheetInternal({key:Ye.ActivateSheet,id:v.AddSheetInternal(e.name,e.insert_index)}),d=!0;break;case Ye.ActivateSheet:v.ActivateSheetInternal(e);break;default:console.warn("unhandled command: "+Ye[e.key]+" ("+e.key+")")}},v=this;try{for(var y=s(e),_=y.next();!_.done;_=y.next())m(_.value)}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}n&&(n.start.sheet_id||n.SetSheetID(this.active_sheet.id),p.push({type:"data",area:n})),a&&(a.start.sheet_id||a.SetSheetID(this.active_sheet.id),p.push({type:"style",area:a})),d&&p.push({type:"structure",rebuild_required:u}),this.batch?(o=this.batch_events).push.apply(o,c([],l(p))):(this.grid_events.Publish(p),i&&this.DelayedRender(!1,i))},e}();!function(e){e[e.white=0]="white",e[e.gray=1]="gray",e[e.black=2]="black"}(rt||(rt={}));var it,nt=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirty=!1,t}return t(r,e),r}(function(){function e(){this.type=e.type,this.color=rt.white,this.edges_in=[],this.edges_out=[]}return Object.defineProperty(e.prototype,"has_inbound_edges",{get:function(){return this.edges_in.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"has_outbound_edges",{get:function(){return this.edges_out.length>0},enumerable:!1,configurable:!0}),e.prototype.Reset=function(){var e,t,r,o;try{for(var i=s(this.edges_out),n=i.next();!n.done;n=i.next())n.value.RemoveDependency(this)}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}try{for(var a=s(this.edges_in),l=a.next();!l.done;l=a.next())l.value.RemoveDependent(this)}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}this.edges_out=[],this.edges_in=[]},e.prototype.ClearDependencies=function(){var e,t;try{for(var r=s(this.edges_in),o=r.next();!o.done;o=r.next())o.value.RemoveDependent(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.edges_in=[]},e.prototype.AddDependent=function(e){var t,r;if(e!==this){try{for(var o=s(this.edges_out),i=o.next();!i.done;i=o.next())if(i.value===e)return}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.edges_out.push(e)}},e.prototype.RemoveDependent=function(e){this.edges_out=this.edges_out.filter((function(t){return t!==e}))},e.prototype.AddDependency=function(e){var t,r;if(e!==this){try{for(var o=s(this.edges_in),i=o.next();!i.done;i=o.next())if(i.value===e)return}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.edges_in.push(e)}},e.prototype.RemoveDependency=function(e){this.edges_in=this.edges_in.filter((function(t){return t!==e}))},e.prototype.LinkTo=function(e){this.AddDependent(e),e.AddDependency(this)},e.prototype.DependsOn=function(e){this.AddDependency(e),e.AddDependent(this)},e.prototype.LoopCheck=function(){var e,t;this.color=rt.gray;for(var r=[this];r.length;){var o=r[r.length-1],i=!0;if(o.color!==rt.black)try{for(var n=(e=void 0,s(o.edges_out)),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.color===rt.gray)return this.color=rt.white,!0;l.color===rt.white&&(l.color=rt.gray,r.push(l),i=!1)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i&&(r.pop(),o.color=rt.black)}return this.color=rt.black,!1},e.type="vertex",e}());!function(e){e[e.None=0]="None",e[e.CalculationError=1]="CalculationError"}(it||(it={}));var at,st=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.error=it.None,t.result=b(),t.expression={type:"missing",id:-1},t.expression_error=!1,t.short_circuit=!1,t.type=r.type,t}return t(r,e),Object.defineProperty(r.prototype,"array_head",{get:function(){return!!this.address&&!!this.reference&&!!this.reference.area&&this.reference.area.start.column===this.address.column&&this.reference.area.start.row===this.address.row},enumerable:!1,configurable:!0}),r.prototype.TakeReferenceValue=function(){this.reference&&(this.result=w(this.reference.GetValue()))},r.prototype.Calculate=function(e){var t,r,o,i,n,a;if(this.dirty)if(this.color===rt.white&&this.LoopCheck()&&(this.dirty=!1,this.edges_in.length)){this.reference&&(this.array_head||this.reference.type===u.formula)&&this.reference.SetCalculationError("LOOP");try{for(var l=s(this.edges_out),c=l.next();!c.done;c=l.next())(y=c.value).Calculate(e)}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}else{try{for(var d=s(this.edges_in),h=d.next();!h.done;h=d.next())if((y=h.value).dirty)return}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}if(this.reference){if(this.reference.type===u.formula){this.short_circuit=!1;var f=e.CalculationCallback.call(e,this);if(this.result=f.value,this.short_circuit)return;f.volatile&&e.volatile_list.push(this)}else this.result=this.reference.GetValue4();if(this.array_head)e.SpreadCallback.call(e,this,this.result);else if(this.reference.type===u.formula){var p=Array.isArray(this.result)?this.result[0][0]:this.result;this.reference.SetCalculatedValue(p.value,p.type)}}else console.info("skip dirty constant? [or dangling...]");this.dirty=!1;try{for(var m=s(this.edges_out),v=m.next();!v.done;v=m.next()){var y;(y=v.value).dirty&&e.calculation_list.push(y)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}}},r.type="spreadsheet-vertex",r}(nt),lt=function(e){function r(t){var o=e.call(this)||this;return o.type=r.type,o.area=t.Clone(),r.list.push(o),o}return t(r,e),r.GetVertex=function(e){var t,o;try{for(var i=s(this.list),n=i.next();!n.done;n=i.next()){var a=n.value;if(a.area.start.sheet_id===e.start.sheet_id&&a.area.Equals(e))return[a,!1]}}catch(e){t={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}return[new r(e),!0]},r.Clear=function(){this.list=[]},r.GetContainingArrays=function(e){var t,r,o=[];try{for(var i=s(this.list),n=i.next();!n.done;n=i.next()){var a=n.value;a.area.start.sheet_id===e.sheet_id&&a.area.Contains(e)&&o.push(a)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o},r.CreateImplicitEdges=function(e,t){var r,o;try{for(var i=s(this.list),n=i.next();!n.done;n=i.next()){var a=n.value;a.area.start.sheet_id===t.sheet_id&&a.area.Contains(t)&&a.DependsOn(e)}}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},r.prototype.RemoveDependent=function(t){var o=this;e.prototype.RemoveDependent.call(this,t),this.edges_out.length||(this.Reset(),r.list=r.list.filter((function(e){return e!==o})))},r.prototype.Calculate=function(e){var t,r,o,i,n,a;if(this.dirty)if(this.color===rt.white&&this.LoopCheck()&&(this.dirty=!1,this.edges_in.length))try{for(var l=s(this.edges_out),c=l.next();!c.done;c=l.next())c.value.Calculate(e)}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}else{try{for(var d=s(this.edges_in),u=d.next();!u.done;u=d.next())if(u.value.dirty)return}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}this.dirty=!1;try{for(var h=s(this.edges_out),f=h.next();!f.done;f=h.next())f.value.Calculate(e)}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}},r.type="array-vertex",r.list=[],r}(nt);!function(e){e[e.OK=0]="OK",e[e.Loop=1]="Loop",e[e.CalculationError=2]="CalculationError"}(at||(at={}));var ct,dt=function(){function e(){this.vertices=[[]],this.volatile_list=[],this.calculation_list=[],this.cells_map={},this.leaf_vertices=[],this.dirty_list=[],this.loop_check_required=!1}return e.prototype.IsSpreadsheetVertex=function(e){return e.type===st.type},e.prototype.AttachData=function(e){var t,r;this.model=e,this.cells_map={};try{for(var o=s(e.sheets),i=o.next();!i.done;i=o.next()){var n=i.value;this.cells_map[n.id]=n.cells}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.FlushTree=function(){this.dirty_list=[],this.volatile_list=[],this.vertices=[[]],this.leaf_vertices=[],this.cells_map={},lt.Clear()},e.prototype.ResolveArrayHead=function(e){if(!e.sheet_id)throw new Error("resolve array head with no sheet id");var t=this.cells_map[e.sheet_id];if(!t)throw new Error("no cells? sheet id "+e.sheet_id);var r=t.data[e.row];if(r){var o=r[e.column];if(o&&o.area){var i={row:o.area.start.row,column:o.area.start.column,sheet_id:e.sheet_id};return console.info("array head",e,i),i}}return e},e.prototype.GetVertex=function(e,t){if(!e.sheet_id)throw new Error("getvertex with no sheet id");var r=this.cells_map[e.sheet_id];if(!r)throw new Error("no cells? sheet id "+e.sheet_id);if(!this.vertices[e.sheet_id]){if(!t)return;this.vertices[e.sheet_id]=[]}if(this.vertices[e.sheet_id][e.column]){var o=this.vertices[e.sheet_id][e.column][e.row];if(o)return o;if(!t)return}else{if(!t)return;this.vertices[e.sheet_id][e.column]=[]}var i=new st;return i.address={row:e.row,column:e.column,absolute_row:e.absolute_row,absolute_column:e.absolute_column,sheet_id:e.sheet_id},i.reference=r.EnsureCell(e),this.vertices[e.sheet_id][e.column][e.row]=i,lt.CreateImplicitEdges(i,e),i},e.prototype.RemoveVertex=function(e){if(!e.sheet_id)throw new Error("removevertex with no sheet id");var t=this.GetVertex(e,!1);t&&(t.Reset(),this.vertices[e.sheet_id][e.column][e.row]=void 0)},e.prototype.ResetVertex=function(e){var t=this.GetVertex(e,!1);t&&t.Reset()},e.prototype.ResetInbound=function(e,t,r,o){var i,n;void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===o&&(o=!1);var a=this.GetVertex(e,r);if(a)a.ClearDependencies(),t&&this.SetVertexDirty(a),o&&this.RemoveVertex(e);else if(t){var l=lt.GetContainingArrays(e);try{for(var c=s(l),d=c.next();!d.done;d=c.next()){var u=d.value;this.SetVertexDirty(u)}}catch(e){i={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}}},e.prototype.ResetLoopState=function(){var e,t,r,o,i,n,a,l;try{for(var c=s(this.vertices),d=c.next();!d.done;d=c.next()){var u=d.value;if(u)try{for(var h=(r=void 0,s(u)),f=h.next();!f.done;f=h.next()){var p=f.value;if(p)try{for(var m=(i=void 0,s(p)),v=m.next();!v.done;v=m.next())(g=v.value)&&(g.color=g.edges_out.length?rt.white:rt.black)}catch(e){i={error:e}}finally{try{v&&!v.done&&(n=m.return)&&n.call(m)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}try{for(var y=s(this.leaf_vertices),_=y.next();!_.done;_=y.next()){var g;(g=_.value).color=rt.black}}catch(e){a={error:e}}finally{try{_&&!_.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}},e.prototype.LoopCheck=function(e){var t,r,o,i,n,a,l,c,d,u;if(void 0===e&&(e=!1),!this.loop_check_required&&!e)return!1;var h=[];try{for(var f=s(this.vertices),p=f.next();!p.done;p=f.next()){var m=p.value;if(m)try{for(var v=(o=void 0,s(m)),y=v.next();!y.done;y=v.next()){var _=y.value;if(_)try{for(var g=(n=void 0,s(_)),b=g.next();!b.done;b=g.next())(S=b.value)&&(S.color=S.edges_out.length?rt.white:rt.black,h.push(S))}catch(e){n={error:e}}finally{try{b&&!b.done&&(a=g.return)&&a.call(g)}finally{if(n)throw n.error}}}}catch(e){o={error:e}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}var w=[];try{for(var x=s(h),C=x.next();!C.done;C=x.next()){var S;if((S=C.value).color===rt.white){for(S.color=rt.gray,w.push(S);w.length;){var A=w[w.length-1],k=!0;if(A.color!==rt.black)try{for(var M=(d=void 0,s(A.edges_out)),R=M.next();!R.done;R=M.next()){var T=R.value;if(T.color===rt.gray)return this.loop_hint=this.RenderAddress(S.address),console.info("loop detected @",this.loop_hint),!0;T.color===rt.white&&(T.color=rt.gray,w.push(T),k=!1)}}catch(e){d={error:e}}finally{try{R&&!R.done&&(u=M.return)&&u.call(M)}finally{if(d)throw d.error}}k&&(w.pop(),A.color=rt.black)}S.color=rt.black}}}catch(e){l={error:e}}finally{try{C&&!C.done&&(c=x.return)&&c.call(x)}finally{if(l)throw l.error}}return this.loop_check_required=!1,this.loop_hint=void 0,!1},e.prototype.RenderAddress=function(e){var t,r;if(!e)return"undefined";var o="";if(e.sheet_id&&this.model)try{for(var i=s(this.model.sheets),n=i.next();!n.done;n=i.next()){var a=n.value;if(e.sheet_id===a.id){o=a.name+"!";break}}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return o+new f(e).spreadsheet_label},e.prototype.AddArrayEdge=function(e,t){var r,o;if(!e.start.sheet_id)throw new Error("AddArrayEdge called without sheet ID");var i=this.GetVertex(t,!0),n=l(lt.GetVertex(e),2),a=n[0],c=n[1];if(i.DependsOn(a),this.loop_check_required=!0,c){var d=this.vertices[e.start.sheet_id];if(d)if(e.entire_row){for(var u=0;u<d.length;u++)if(d[u])for(var h=e.start.row;h<=e.end.row;h++)(m=d[u][h])&&a.DependsOn(m);console.groupEnd()}else if(e.entire_column){for(u=e.start.column;u<=e.end.column;u++)if(d[u])try{for(var f=(r=void 0,s(d[u])),p=f.next();!p.done;p=f.next())(null==(m=p.value)?void 0:m.address)&&a.DependsOn(m)}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}console.groupEnd()}else for(h=e.start.row;h<=e.end.row;h++)for(u=e.start.column;u<=e.end.column;u++){var m;(m=d[u][h])&&a.DependsOn(m)}}},e.prototype.AddEdge=function(e,t){var r=this.GetVertex(e,!0);this.GetVertex(t,!0).DependsOn(r),r.reference&&r.reference.area&&!r.array_head&&this.AddEdge(o(o({},e),{row:r.reference.area.start.row,column:r.reference.area.start.column}),t),this.loop_check_required=!0},e.prototype.RemoveEdge=function(e,t){var r=this.GetVertex(e,!1),o=this.GetVertex(t,!1);r&&o&&(r.RemoveDependent(o),o.RemoveDependency(r))},e.prototype.SetAreaDirty=function(e){if(e.start.column===1/0||e.end.column===1/0||e.start.row===1/0||e.end.row===1/0)throw new Error("don't iterate over infinite area");var t=e.start.sheet_id;if(!t)throw new Error("invalid area, missing sheet id");for(var r=e.start.column;r<=e.end.column;r++)for(var o=e.start.row;o<=e.end.row;o++){var i={row:o,column:r,sheet_id:t};this.GetVertex(i,!1)&&this.SetDirty(i)}},e.prototype.SetVertexDirty=function(e){var t,r;if(!e.dirty){this.dirty_list.push(e),e.dirty=!0;try{for(var o=s(e.edges_out),i=o.next();!i.done;i=o.next()){var n=i.value;this.SetVertexDirty(n)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}},e.prototype.SetDirty=function(e){var t=this.GetVertex(e,!0);this.SetVertexDirty(t)},e.prototype.AddLeafVertex=function(e){var t,r;try{for(var o=s(this.leaf_vertices),i=o.next();!i.done;i=o.next())if(i.value===e)return}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.leaf_vertices.push(e)},e.prototype.RemoveLeafVertex=function(e){this.leaf_vertices=this.leaf_vertices.filter((function(t){return t!==e}))},e.prototype.AddLeafVertexEdge=function(e,t){var r=this.GetVertex(e,!0);return t.DependsOn(r),at.OK},e.prototype.RemoveLeafVertexEdge=function(e,t){var r=this.GetVertex(e,!1);r&&(r.RemoveDependent(t),t.RemoveDependency(r))},e.prototype.InitializeGraph=function(){var e,t;try{for(var r=s(this.dirty_list),o=r.next();!o.done;o=r.next()){var i=o.value;this.IsSpreadsheetVertex(i)&&(i.TakeReferenceValue(),this.CheckVolatile(i)&&this.volatile_list.push(i)),i.dirty=!1}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.dirty_list=[]},e.prototype.Recalculate=function(){var e,t;try{for(var r=s(this.volatile_list),o=r.next();!o.done;o=r.next()){var i=o.value;this.SetVertexDirty(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.calculation_list=this.dirty_list.slice(0),this.volatile_list=[],this.dirty_list=[],this.loop_check_required&&(this.ResetLoopState(),this.loop_check_required=!1);for(var n=0;n<this.calculation_list.length;n++)this.calculation_list[n].Calculate(this);this.calculation_list=[]},e}();!function(e){e.Argument="ARG",e.Data="DATA",e.Reference="REF",e.Name="NAME",e.Expression="EXPR",e.Value="VALUE",e.Unknown="UNK",e.NotImpl="NOTIMPL",e.Div0="DIV/0",e.NA="N/A"}(ct||(ct={}));var ut,ht={error:ct.NotImpl},ft=function(){return{type:u.error,value:ct.Expression}},pt=function(){return{type:u.error,value:ct.Data}},mt=function(){return{type:u.error,value:ct.Div0}},vt=function(){return{type:u.error,value:ct.Argument}},yt=function(){return{type:u.error,value:ct.Value}},_t=function(){return{type:u.error,value:ct.Reference}},gt=function(){return{type:u.error,value:ct.Name}},bt=function(){return{type:u.error,value:ct.Unknown}};!function(e){e[e.value=0]="value",e[e.reference=1]="reference"}(ut||(ut={}));var wt,xt=function(e){return{r:Math.sqrt(e.real*e.real+e.imaginary*e.imaginary),theta:Math.atan2(e.imaginary,e.real)}},Ct=function(e,t){return{real:e.real*t.real-e.imaginary*t.imaginary,imaginary:e.real*t.imaginary+e.imaginary*t.real}},St=function(e,t){for(var r=[],o=0;o<e.m;o++){for(var i=[],n=0;n<t.n;n++){for(var a=0,s=0;s<e.n;s++)a+=e.array[o][s]*t.array[s][n];i.push(a)}r.push(i)}return{array:r,m:e.m,n:t.n}},At=function(e){var t={real:0,imaginary:0},r=e.n;if(2==r){var i=Ct(e.array[0][0],e.array[1][1]),n=Ct(e.array[1][0],e.array[0][1]);return{real:i.real-n.real,imaginary:i.imaginary-n.imaginary}}for(var a=function(e){for(var t={m:e,n:e,array:[]},r=0;r<e;r++){for(var o=[],i=0;i<e;i++)o.push({real:0,imaginary:0});t.array.push(o)}return t}(e.n),s=0;s<r;s++){for(var l=0,c=1;c<r;c++){for(var d=0,u=0;u<r;u++)u!=s&&(a.array[l][d]=o({},e.array[c][u]),d++);l++}a.m=a.n=r-1;var h=Math.pow(-1,s),f=Ct({real:e.array[0][s].real*h,imaginary:e.array[0][s].imaginary*h},At(a));t.real+=f.real,t.imaginary+=f.imaginary}return t},kt=function(e){if(e.m===e.n){var t,r,o,i,n=function(e){var t=e.array.map((function(e){return e.slice(0)}));return{m:e.m,n:e.n,array:t}}(e),a=n.array,s=e.m;for(r=1;r<s;r++)a[0][r]/=a[0][0];for(r=1;r<s;r++){for(o=r;o<s;o++){for(t=0,i=0;i<r;i++)t+=a[o][i]*a[i][r];a[o][r]-=t}if(r!=s-1)for(o=r+1;o<s;o++){for(t=0,i=0;i<r;i++)t+=a[r][i]*a[i][o];a[r][o]=(a[r][o]-t)/a[r][r]}}for(r=0;r<s;r++)for(o=r;o<s;o++){var l=1;if(r!=o)for(l=0,i=r;i<o;i++)l-=a[o][i]*a[i][r];a[o][r]=l/a[o][o]}for(r=0;r<s;r++)for(o=r;o<s;o++)if(r!=o){for(t=0,i=r;i<o;i++)t+=a[i][o]*(r==i?1:a[r][i]);a[r][o]=-t}for(r=0;r<s;r++)for(o=0;o<s;o++){for(t=0,i=r>o?r:o;i<s;i++)t+=(o==i?1:a[o][i])*a[i][r];a[o][r]=t}return n}},Mt=function(e){var t=e.real||0,r=e.imaginary||0;return Ct({real:Math.exp(t),imaginary:0},{real:Math.cos(r),imaginary:Math.sin(r)})},Rt=function(e,t){if(t.imaginary)return Mt(Ct(t,function(e){var t=xt(e);return{real:Math.log(t.r),imaginary:t.theta}}(e)));var r=xt(e);return function(e){var t=e.r,r=e.theta;return{real:t*Math.cos(r),imaginary:t*Math.sin(r)}}({r:Math.pow(r.r,t.real),theta:r.theta*t.real})},Tt=function(e,t){return void 0===t&&(t=0),e&&e.type===u.complex?e:{type:u.complex,value:{real:t,imaginary:0}}},Lt=function(e){return e.imaginary?{type:u.complex,value:e}:{type:u.number,value:e.real}},Et=function(e,t){if(e.type===u.error)return[0,0,e];if(t.type===u.error)return[0,0,t];var r=[0,0];switch(e.type){case u.number:r[0]=e.value;break;case u.boolean:r[0]=e.value?1:0;break;case u.undefined:break;case u.complex:r[3]=e;break;default:return[0,0,yt()]}switch(t.type){case u.number:r[1]=t.value;break;case u.boolean:r[1]=t.value?1:0;break;case u.undefined:break;case u.complex:r[4]=t;break;default:return[0,0,yt()]}return(r[3]||r[4])&&(r[3]=Tt(r[3],r[0]),r[4]=Tt(r[4],r[1])),r},zt=function(e,t){var r=l(Et(e,t),5),o=r[0],i=r[1],n=r[2],a=r[3],s=r[4];return n||(a&&s?Lt({real:a.value.real+s.value.real,imaginary:a.value.imaginary+s.value.imaginary}):{value:o+i,type:u.number})},Dt=function(e,t){var r=l(Et(e,t),5),o=r[0],i=r[1],n=r[2],a=r[3],s=r[4];return n||(a&&s?Lt({real:a.value.real-s.value.real,imaginary:a.value.imaginary-s.value.imaginary}):{value:o-i,type:u.number})},Pt=function(e,t){var r=l(Et(e,t),5),o=r[0],i=r[1],n=r[2],a=r[3],s=r[4];if(n)return n;if(a&&s)return Lt(Rt(a.value,s.value));var c=Math.pow(o,i);return isNaN(c)?yt():{type:u.number,value:c}},Nt=function(e,t){var r=l(Et(e,t),5),o=r[0],i=r[1],n=r[2],a=r[3],s=r[4];return n||(a&&s?Lt(Ct(a.value,s.value)):{value:o*i,type:u.number})},Ft=function(e,t){var r=l(Et(e,t),5),o=r[0],i=r[1],n=r[2],a=r[3],s=r[4];return n||(a&&s?0===s.value.real&&0===s.value.imaginary?mt():Lt(function(e,t){var r={real:t.real,imaginary:-t.imaginary},o=Ct(e,r),i=Ct(t,r);return{real:o.real/i.real,imaginary:o.imaginary/i.real}}(a.value,s.value)):0===i?mt():{value:o/i,type:u.number})},It=function(e,t){var r=l(Et(e,t),3),o=r[0],i=r[1];return r[2]||(0===i?mt():{value:o%i,type:u.number})},Ut=function(e,t){return e.type===u.error?e:t.type===u.error?t:{type:u.string,value:""+(e.type===u.undefined?"":e.value)+(t.type===u.undefined?"":t.value)}},Ot=function(e,t){if(e.type===u.error)return e;if(t.type===u.error)return t;if(e.type===u.undefined&&(""===t.value||0===t.value||t.type===u.complex&&0===t.value.real&&0===t.value.complex)||t.type===u.undefined&&(""===e.value||0===e.value||e.type===u.complex&&0===e.value.real&&0===e.value.complex))return{type:u.boolean,value:!0};if(e.type===u.complex||t.type===u.complex){var r=!1;return e.type===t.type?r=e.value.real==t.value.real&&e.value.imaginary==t.value.imaginary:e.type===u.number?r=t.value.real==e.value&&!t.value.imaginary:t.type===u.number&&(r=e.value.real==t.value&&!e.value.imaginary),{type:u.boolean,value:r}}return{type:u.boolean,value:e.value==t.value}},Vt=function(e,t){var r=Ot(e,t);return{type:u.boolean,value:!r.value}},Ht=function(e,t){return e.type===u.error?e:t.type===u.error?t:e.type===u.complex||t.type===u.complex?yt():{type:u.boolean,value:(e.value||0)>(t.value||0)}},jt=function(e,t){return e.type===u.error?e:t.type===u.error?t:e.type===u.complex||t.type===u.complex?yt():{type:u.boolean,value:e.value>=t.value}},Gt=function(e,t){return e.type===u.error?e:t.type===u.error?t:e.type===u.complex||t.type===u.complex?yt():{type:u.boolean,value:e.value<t.value}},Bt=function(e,t){return e.type===u.error?e:t.type===u.error?t:e.type===u.complex||t.type===u.complex?yt():{type:u.boolean,value:e.value<=t.value}},Zt=function(e){return!Array.isArray(e)&&e.type===u.object&&!!e.value.type},Jt=function(e){return!Array.isArray(e)&&e.type===u.object&&"metadata"===e.value.type},qt=function(){function e(e,t){this.library=e,this.parser=t,this.context={address:{row:-1,column:-1},volatile:!1,call_index:0},this.call_index=0,this.cells_map={},this.sheet_name_map={},this.named_range_map={}}return e.prototype.SetModel=function(e){var t,r;this.cells_map={},this.sheet_name_map={};try{for(var o=s(e.sheets),i=o.next();!i.done;i=o.next()){var n=i.value;this.cells_map[n.id]=n.cells,this.sheet_name_map[n.name.toLowerCase()]=n.id}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.data_model=e,this.named_range_map=e.named_ranges.Map(),this.context.model=e},e.prototype.Calculate=function(e,t,r){return void 0===r&&(r=!1),r||(this.context.address=t,this.context.volatile=!1,this.context.call_index=0,this.call_index=0),{value:this.CalculateExpression(e),volatile:this.context.volatile}},e.prototype.CellFunction2=function(e){if(!e.sheet_id){if(!e.sheet)return function(){return _t()};e.sheet_id=this.sheet_name_map[e.sheet.toLowerCase()]}var t=this.cells_map[e.sheet_id];if(!t)return console.warn("missing cells reference @ "+e.sheet_id),function(){return _t()};var r=t.GetCell(e);return r?function(){return r.GetValue4()}:function(){return{type:u.undefined,value:void 0}}},e.prototype.CellFunction4=function(e,t){if(!e.sheet_id)throw new Error("missing sheet id in CellFunction4");return this.cells_map[e.sheet_id].GetRange4(e,t,!0)},e.prototype.GetMetadata=function(e,t){var r,i,n,a,l,c;switch(e.type){case"address":l=e;break;case"range":c=e;break;case"identifier":var d=this.named_range_map[e.name.toUpperCase()];d&&(1===d.count?l=d.start:c=d);break;case"call":var h=this.CalculateExpression(e,!0);if(!Zt(h))return h;if("address"===h.value.type)l=h.value;else{if("range"!==h.value.type)return h;c=h.value}break;default:return this.CalculateExpression(e)}if(l){var f=this.data_model.active_sheet;if(l.sheet_id&&l.sheet_id!==f.id)try{for(var p=s(this.data_model.sheets),m=p.next();!m.done;m=p.next())if((b=m.value).id===l.sheet_id){f=b;break}}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}var v=(A=f.CellData(l)).calculated_type?A.calculated:A.value,y=o({type:"metadata",address:o({},l),value:v,format:A.style?A.style.number_format:void 0},t(A,l));return{type:u.object,value:y}}if(c){if(c.start.row===1/0||c.start.column===1/0)return _t();if(f=this.data_model.active_sheet,c.start.sheet_id&&c.start.sheet_id!==f.id)try{for(var _=s(this.data_model.sheets),g=_.next();!g.done;g=_.next()){var b;if((b=g.value).id===c.start.sheet_id){f=b;break}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}for(var w=[],x=c.start.column;x<=c.end.column;x++){for(var C=[],S=c.start.row;S<=c.end.row;S++){var A=f.CellData({row:S,column:x});l=o(o({},c.start),{row:S,column:x}),v=A.calculated_type?A.calculated:A.value,y=o({type:"metadata",address:l,value:v,format:A.style?A.style.number_format:void 0},t(A,l)),C.push({type:u.object,value:y})}w.push(C)}return w}return this.CalculateExpression(e)},e.prototype.RewriteMacro=function(e,t){var r,o=this;switch(e.type){case"identifier":if(r=t[e.name.toUpperCase()])return JSON.parse(JSON.stringify(r));break;case"binary":e.left=this.RewriteMacro(e.left,t),e.right=this.RewriteMacro(e.right,t);break;case"unary":e.operand=this.RewriteMacro(e.operand,t);break;case"group":e.elements=e.elements.map((function(e){return o.RewriteMacro(e,t)}));break;case"call":e.args=e.args.map((function(e){return o.RewriteMacro(e,t)}))}return e},e.prototype.CallMacro=function(e,t){var r,o=this;if(!t.expression)return function(){return ft()};var i=JSON.stringify(t.expression),n={},a=(null===(r=t.argument_names)||void 0===r?void 0:r.map((function(e){return e.toUpperCase()})))||[];return function(e){for(var t=JSON.parse(i),r=0;r<a.length;r++)n[a[r]]=e.args[r]||{type:"missing"};return o.CalculateExpression(o.RewriteMacro(t,n))}},e.prototype.CallExpression=function(e,t){var r=this;void 0===t&&(t=!1);var o=this.library.Get(e.name);return o?function(i){var n=r.call_index++;r.context.volatile=r.context.volatile||!!o.volatile;var a,s="if"===e.name.toLowerCase(),l=-1,c=o.arguments||[],d=i.args.map((function(e,t){if(!a){var o=c[Math.min(t,c.length-1)]||{};if(t===l)return o.boxed?b():void 0;if(void 0===e)return s&&0===t&&(l=1),o.boxed?b():void 0;if(o.address)return o.boxed?{type:u.string,value:r.parser.Render(e).replace(/\$/g,"")}:r.parser.Render(e).replace(/\$/g,"");if(o.metadata)return r.GetMetadata(e,(function(){return{}}));var i=r.CalculateExpression(e);if(!Array.isArray(i)&&i.type===u.error)return o.allow_error?i:void(a=i);if(s&&0===t&&!Array.isArray(i)){var n=!1;if(i.type===u.string){var d=i.value.toLowerCase().trim();n="false"!==d&&"f"!==d}else n=!!i.value;l=n?2:1}return o.boxed?i:Array.isArray(i)?i.map((function(e){return e.map((function(e){return e.value}))})):i.value}}));if(a)return a;if(r.context.call_index=n,o.return_type===ut.reference){var h=o.fn.apply(null,d);if(t)return h;if(Zt(h)){if("address"===h.value.type)return r.CellFunction2(h.value)();if("range"===h.value.type)return r.CellFunction4(h.value.start,h.value.end)}return h}return o.fn.apply(null,d)}:function(){return gt()}},e.prototype.UnaryExpression=function(e){var t=this;switch(e.operator){case"+":return function(e){return t.CalculateExpression(e.operand)};case"-":var r=Dt,o={type:u.number,value:0};return function(e){var i=t.CalculateExpression(e.operand);return Array.isArray(i)?i.map((function(e){return e.map((function(e){return r(o,e)}))})):r(o,i)};default:return function(){return console.warn("unexpected unary operator:",e.operator),ft()}}},e.prototype.RecycleArray=function(e,t,r){var o,i;if(e[0].length<r){var n=e[0].length;try{for(var a=s(e),l=a.next();!l.done;l=a.next())for(var c=l.value,d=n;d<r;d++)c[d]=c[d%n]}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}if(e.length<t)for(var u=n=e.length;u<t;u++)e[u]=e[u%n].slice(0);return e},e.prototype.ElementwiseBinaryExpression=function(e,t,r){var o=Math.max(t.length,r.length),i=Math.max(t[0].length,r[0].length);t=this.RecycleArray(t,o,i),r=this.RecycleArray(r,o,i);for(var n=[],a=0;a<o;a++){for(var s=[],l=0;l<i;l++)s[l]=e(t[a][l],r[a][l]);n.push(s)}return n},e.prototype.BinaryExpression=function(e){var t=this,r=function(e){switch(e){case"&":return Ut;case"+":return zt;case"-":return Dt;case"*":return Nt;case"/":return Ft;case"^":case"**":return Pt;case"%":return It;case"=":case"==":return Ot;case"!=":case"<>":return Vt;case">":return Ht;case">=":return jt;case"<":return Gt;case"<=":return Bt}}(e.operator);return r?function(e){var o=t.CalculateExpression(e.left),i=t.CalculateExpression(e.right);return Array.isArray(o)?Array.isArray(i)?t.ElementwiseBinaryExpression(r,o,i):t.ElementwiseBinaryExpression(r,o,[[i]]):Array.isArray(i)?t.ElementwiseBinaryExpression(r,[[o]],i):r(o,i)}:function(){return console.info("(unexpected binary operator: "+e.operator+")"),ft()}},e.prototype.Identifier=function(e){var t=this,r=e.name,o=r.toUpperCase();switch(o){case"FALSE":case"F":return function(){return{value:!1,type:u.boolean}};case"TRUE":case"T":return function(){return{value:!0,type:u.boolean}};case"UNDEFINED":return function(){return{value:void 0,type:u.undefined}}}return function(){var e=t.named_range_map[o];return e?1===e.count?t.CellFunction4(e.start,e.start):t.CellFunction4(e.start,e.end):(console.info("** identifier",r),gt())}},e.prototype.GroupExpression=function(e){var t=this;return e.elements&&1===e.elements.length?function(e){return t.CalculateExpression(e.elements[0])}:(console.warn("Can't handle group !== 1"),function(){return ft()})},e.prototype.CalculateExpression=function(e,t){var r=this;if(void 0===t&&(t=!1),e.user_data)return e.user_data(e);switch(e.type){case"call":var o=this.data_model.macro_functions[e.name.toUpperCase()];return o?(e.user_data=this.CallMacro(e,o))(e):(e.user_data=this.CallExpression(e,t))(e);case"address":return(e.user_data=this.CellFunction2(e))();case"range":return(e.user_data=function(e){return r.CellFunction4(e.start,e.end)})(e);case"binary":return(e.user_data=this.BinaryExpression(e))(e);case"unary":return(e.user_data=this.UnaryExpression(e))(e);case"identifier":return(e.user_data=this.Identifier(e))();case"missing":return(e.user_data=function(){return{value:void 0,type:u.undefined}})();case"literal":var i={value:e.value,type:v(e.value)};return(e.user_data=function(){return i})();case"group":return(e.user_data=this.GroupExpression(e))(e);case"complex":var n={value:{real:e.real,imaginary:e.imaginary},type:u.complex};return(e.user_data=function(){return n})();case"array":return(e.user_data=function(){return e.values.map((function(e){return(Array.isArray(e)?e:[e]).map((function(e){return{value:e,type:v(e)}}))}))})();default:return console.warn("Unhandled parse expr:",e),bt()}},e}(),Wt=function(e){for(var t=[],r=e.length,o=e[0].length,i=0;i<o;i++){t[i]=[];for(var n=0;n<r;n++)t[i][n]=e[n][i]}return t},Kt=function(e){return Array.isArray(e)?e.reduce((function(e,t){return void 0===t?e:Array.isArray(t)?e.concat(Kt(t)):t instanceof Float32Array||t instanceof Float64Array?e.concat(Array.from(t)):e.concat([t])}),[]):[e]},Xt=function(e){return function(t){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return Array.isArray(t)?t.map((function(t){return t.map((function(t){return e.apply(void 0,c([t],l(r)))}))})):e.apply(void 0,c([t],l(r)))}},Yt=function(e){return function(t,r){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return Array.isArray(t)?Array.isArray(r)?t.map((function(t,i){return t.map((function(t,n){return e.apply(void 0,c([t,r[i][n]],l(o)))}))})):t.map((function(t){return t.map((function(t){return e.apply(void 0,c([t,r],l(o)))}))})):e.apply(void 0,c([t,r],l(o)))}},$t=function(){function e(){this.functions={}}return e.prototype.Register=function(){for(var e,t,r,o,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];try{for(var a=s(i),l=a.next();!l.done;l=a.next()){var c=l.value;try{for(var d=(r=void 0,s(Object.keys(c))),u=d.next();!u.done;u=d.next()){var h=u.value;if(/[^a-zA-Z0-9._]/.test(h))throw new Error("invalid function name (invalid character)");if(h.length>255)throw new Error("invalid function name (too long, > 255)");if(/^[^a-zA-Z]/.test(h))throw new Error("invalid function name (start with an ascii letter)");var f=h.toLowerCase();if(this.functions[f])throw new Error("function name ("+f+") is already in use");var p=c[h];p.canonical_name=h,this.functions[f]=p}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},e.prototype.Get=function(e){var t=e.toLowerCase();return this.functions[t]},e.prototype.List=function(){var e,t,r={};try{for(var o=s(Object.keys(this.functions)),i=o.next();!i.done;i=o.next()){var n=i.value;r[n]=this.functions[n]}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r},e.prototype.Alias=function(e,t){var r,i=this.Get(t);if(!i)throw new Error("referenced function "+t+" does not exist");this.Register(((r={})[e]=o({},i),r))},e}();!function(e){e[e.move=0]="move",e[e.line=1]="line"}(wt||(wt={}));var Qt,er,tr,rr,or,ir,nr=function(){function e(){}return e.UnpackValues=function(e){var t=this;if(Array.isArray(e)){var r=e[0];return Array.isArray(r)||r instanceof Float64Array||r instanceof Float32Array?e.reduce((function(e,r){return e.concat(t.UnpackValues(r))}),[]):e.map((function(e){return isNaN(e)?void 0:e}))}if(e instanceof Float32Array||e instanceof Float64Array)return Array.prototype.slice.call(e);if(e&&"object"==typeof e){var o=Object.keys(e).length;if(void 0!==e[0]&&void 0!==e[(o-1).toString()]){for(var i=[],n=0;n<o;n++)i[n]=e[n.toString()];return i}}return[]},e.SparklineCommon=function(e,t){var r,o=[],i=(null===(r=t.text)||void 0===r?void 0:r.text)||this.default_color,n=[i,i];return Array.isArray(e.calculated)&&(o=this.UnpackValues(e.calculated[0]),"string"==typeof e.calculated[1]&&(n[0]=e.calculated[1]),"string"==typeof e.calculated[2]&&(n[1]=e.calculated[2])),{values:o,colors:n}},e.RenderLine=function(e,t,r,o,i){var n=this.SparklineCommon(o,i),a=n.values,s=n.colors,l=1;Array.isArray(o.calculated)&&"number"==typeof o.calculated[2]&&(l=o.calculated[2]);for(var c=0,d=0,u=-1,h=0;h<a.length;h++)"number"==typeof(_=a[h])&&(u>=0?(c=Math.min(c,_),d=Math.max(d,_)):(u=h,c=d=_));if(c!==d){var f=.9*e/(a.length-1),p=d-c,m=.8*t,v=.1*t;r.strokeStyle=s[0],r.lineWidth=l,r.lineCap="round",r.lineJoin="round",r.beginPath();var y=wt.move;for(h=u;h<a.length;h++){var _;if("number"==typeof(_=a[h])){var g=.05*e+f*h,b=t-(_-c)*m/p-v;y===wt.move?(r.moveTo(g,b),y=wt.line):r.lineTo(g,b)}else y=wt.move}r.stroke()}},e.RenderColumn=function(e,t,r,o,i){var n,a,l=this.SparklineCommon(o,i),c=l.values,d=l.colors,u=0,h=0,f=!1;try{for(var p=s(c),m=p.next();!m.done;m=p.next())"number"==typeof(k=m.value)&&(f?(u=Math.min(u,k),h=Math.max(h,k)):(f=!0,u=h=k))}catch(e){n={error:e}}finally{try{m&&!m.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}if(c.length){var v=(e-6-2)/(c.length-0),y=t-5;if(u!==h)if(u<0&&h>0){for(var _=2.5+h/(S=h-u)*y,g=0;g<c.length;g++)if("number"==typeof(k=c[g])){var b=3+g*v,w=Math.abs(k)/S*y;if(k>=0){r.fillStyle=d[0];var x=_-w;r.fillRect(b+2,x,v-2,w)}else{r.fillStyle=d[1];var C=_;r.fillRect(b+2,C,v-2,w)}}}else if(h>0){r.fillStyle=d[0];var S=h-u;for(g=0;g<c.length;g++)if("number"==typeof(k=c[g])){b=3+g*v;var A=t-2.5-(w=Math.max(1,(k-u)/S*y));r.fillRect(b+2,A,v-2,w)}}else for(r.fillStyle=d[1],S=h-u,g=0;g<c.length;g++){var k;"number"==typeof(k=c[g])&&(b=3+g*v,w=Math.max(1,Math.abs(h-k)/S*y),r.fillRect(b+2,2.5,v-2,w))}}},e.default_color="#888",e}(),ar=function(e){var t=1/(1+.3275911*(e=Math.abs(e)));return 1-((((1.061405429*t-1.453152027)*t+1.421413741)*t-.284496736)*t+.254829592)*t*Math.exp(-1*e*e)},sr=function(e){if(.5===e)return 0;var t=e<1&&e>.5?1-e:e,r=Math.sqrt(Math.log(1/Math.pow(t,2))),o=r-(2.515517+.802853*r+.010328*Math.pow(r,2))/(1+1.432788*r+.189269*Math.pow(r,2)+.001308*Math.pow(r,3));return e>.5?o:-o},lr={type:u.boolean,value:!0},cr={type:u.boolean,value:!1},dr={Rand:{volatile:!0,fn:function(){return{type:u.number,value:Math.random()}}},RandBetween:{arguments:[{name:"min"},{name:"max"}],volatile:!0,fn:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=1),e>t){var r=e;e=t,t=r}return{type:u.number,value:Math.floor(Math.random()*(t+1-e)+e)}}},Sum:{description:"Adds arguments and ranges",arguments:[{boxed:!0,name:"values or ranges"}],fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i={real:0,imaginary:0},n=Kt(r);try{for(var a=s(n),l=a.next();!l.done;l=a.next()){var c=l.value;switch(c.type){case u.number:i.real+=c.value;break;case u.boolean:i.real+=c.value?1:0;break;case u.complex:i.real+=c.value.real,i.imaginary+=c.value.imaginary;break;case u.error:return c}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return x(i)}},Now:{description:"Returns current time",volatile:!0,fn:function(){return{type:u.number,value:ce((new Date).getTime())}}},Today:{description:"Returns current day",volatile:!0,fn:function(){var e=new Date;return e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0),e.setHours(12),{type:u.number,value:ce(e.getTime())}}},IfError:{description:"Returns the original value, or the alternate value if the original value contains an error",arguments:[{name:"original value",allow_error:!0,boxed:!0},{name:"alternate value"}],fn:function(e,t){return void 0===t&&(t=0),e&&e.type===u.error?{value:t,type:v(t)}:e}},IsError:{description:"Checks if another cell contains an error",arguments:[{name:"reference",allow_error:!0,boxed:!0}],fn:function(e){var t,r;if(Array.isArray(e)){var o=Kt(e);try{for(var i=s(o),n=i.next();!n.done;n=i.next())if(n.value.type===u.error)return{type:u.boolean,value:!0}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}else if(e)return{type:u.boolean,value:e.type===u.error};return{type:u.boolean,value:!1}}},Cell:{description:"Returns data about a cell",arguments:[{name:"type",description:"Type of data to return"},{name:"reference",description:"Cell reference",metadata:!0}],fn:function(e,t){if(!Jt(t))return _t();if(e)switch(e.toString().toLowerCase()){case"format":return t.value.format?{type:u.string,value:t.value.format}:_t();case"address":return{type:u.string,value:t.value.address.label.replace(/\$/g,"")}}return{type:u.error,value:ht.error}}},Year:{description:"Returns year from date",arguments:[{name:"date"}],fn:function(e){return w(new Date(le(e)).getUTCFullYear())}},Month:{description:"Returns month from date",arguments:[{name:"date"}],fn:function(e){return w(new Date(le(e)).getUTCMonth()+1)}},Day:{description:"Returns day of month from date",arguments:[{name:"date"}],fn:function(e){return w(new Date(le(e)).getUTCDate())}},Radians:{description:"Converts degrees to radians",arguments:[{name:"Degrees",description:"Angle in degrees"}],fn:Xt((function(e){return w(e*Math.PI/180)}))},Degrees:{description:"Converts radians to degrees",arguments:[{name:"Radians",description:"Angle in radians"}],fn:Xt((function(e){return w(e/Math.PI*180)}))},CountA:{description:"Counts cells that are not empty",fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return w(Kt(e).reduce((function(e,t){return void 0===t?e:e+1}),0))}},Count:{description:"Counts cells that contain numbers",fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return w(Kt(e).reduce((function(e,t){return"number"==typeof t?e+1:e}),0))}},Or:{fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i=!1;r=Kt(r);try{for(var n=s(r),a=n.next();!a.done;a=n.next()){var l=a.value;i=i||!!l}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return w(i)}},And:{fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i=!0;r=Kt(r);try{for(var n=s(r),a=n.next();!a.done;a=n.next()){var l=a.value;i=i&&!!l}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return w(i)}},Not:{fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?vt():1===e.length?w(!e[0]):w(!0)}},If:{arguments:[{name:"test value",boxed:!0},{name:"value if true",boxed:!0,allow_error:!0},{name:"value if false",boxed:!0,allow_error:!0}],fn:function(e,t,r){return void 0===t&&(t=lr),void 0===r&&(r=cr),Array.isArray(e)?e.map((function(e,o){return e.map((function(e,i){return(_(e)?"false"!==e.value.toLowerCase()&&"f"!==e.value.toLowerCase():e.value)?Array.isArray(t)?t[o][i]:t:Array.isArray(r)?r[o][i]:r}))})):(_(e)?"false"!==e.value.toLowerCase()&&"f"!==e.value.toLowerCase():e.value)?t:r}},Fact:{description:"Returns the factorial of a number",arguments:[{name:"number"}],fn:Xt((function(e){e=Math.floor(e);for(var t=1;e>1;)t*=e,e--;return{type:u.number,value:t}}))},Power:{description:"Returns base raised to the given power",arguments:[{name:"base",boxed:!0},{name:"exponent",boxed:!0}],fn:Yt((function(e,t){if(e.type===u.complex||t.type===u.complex){var r=e.type===u.complex?e.value:{real:e.value||0,imaginary:0},o=t.type===u.complex?t.value:{real:t.value||0,imaginary:0},i=Rt(r,o);return x(i)}return i=Math.pow(e.value,t.value),isNaN(i)?yt():{type:u.number,value:i}}))},Mod:{fn:Yt((function(e,t){return t?w(e%t):mt()}))},Sort:{arguments:[{name:"values"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(e=Kt(e)).every((function(e){return"number"==typeof e}))?e.sort((function(e,t){return e-t})):e.sort(),[e.map((function(e){return w(e)}))]}},Transpose:{description:"Returns transpose of input matrix",arguments:[{name:"matrix",boxed:!0}],fn:function(e){return Array.isArray(e)?Wt(e):e}},Max:{fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Math.max.apply(0,Kt(e).filter((function(e){return"number"==typeof e})))}}},Min:{fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Math.min.apply(0,Kt(e).filter((function(e){return"number"==typeof e})))}}},SumProduct:{description:"Returns the sum of pairwise products of two or more ranges",fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.map((function(e){return Kt(e)})),o=Math.max.apply(0,r.map((function(e){return e.length}))),i=0,n=function(e){i+=r.reduce((function(t,r){return t*(r[e]||0)}),1)},a=0;a<o;a++)n(a);return{type:u.number,value:i}}},VLookup:{fn:function(e,t,r,o){if(void 0===o&&(o=!0),r=Math.max(0,r-1),o){for(var i=Math.abs(e-t[0][0]),n=t[r][0],a=1;a<t[0].length;a++){var s=Math.abs(t[0][a]-e);s<i&&(i=s,n=t[r][a])}return w(n)}for(a=1;a<t[0].length;a++)if(t[0][a]==e)return t[r][a];return{type:u.error,value:ct.NA}}},Product:{arguments:[{boxed:!0}],fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i={real:1,imaginary:0};r=Kt(r);try{for(var n=s(r),a=n.next();!a.done;a=n.next()){var l=a.value;l.type===u.complex?i=Ct(i,l.value):l.type===u.number&&(i.real*=l.value,i.imaginary*=l.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return x(i)}},Log:{fn:Yt((function(e,t){return void 0===t&&(t=10),{type:u.number,value:Math.log(e)/Math.log(t)}}))},Log10:{fn:Xt((function(e){return{type:u.number,value:Math.log(e)/Math.log(10)}}))},Ln:{fn:Xt((function(e){return{type:u.number,value:Math.log(e)}}))},Round:{fn:Yt((function(e,t){void 0===t&&(t=0);var r=Math.pow(10,t);return{type:u.number,value:Math.round(r*e)/r}}))},RoundDown:{fn:Yt((function(e,t){void 0===t&&(t=0);var r=Math.pow(10,t),o=e>=0;return{type:u.number,value:o?Math.floor(r*e)/r:Math.ceil(r*e)/r}}))},Reverse:{arguments:[{boxed:!0}],fn:function(e){return Array.isArray(e)?1===e.length?[e[0].reverse()]:e.reverse():{type:u.string,value:e.value.toString().split("").reverse().join("")}}},Exp:{arguments:[{boxed:!0}],fn:Xt((function(e){if(e.type===u.complex){var t=Mt(e.value);return x(t)}return{type:u.number,value:Math.exp(e.value||0)}}))},Abs:{arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.complex?{type:u.number,value:Math.sqrt(e.value.real*e.value.real+e.value.imaginary*e.value.imaginary)}:{type:u.number,value:Math.abs(e.value||0)}}))},Simplify:{fn:Yt((function(e,t){if(void 0===t&&(t=2),t=t||2,0===e)return{type:u.number,value:e};var r=e<0?-1:1;e*=r;var o=Math.pow(10,Math.floor(Math.log10(e))+1-t);return{type:u.number,value:Math.round(e/o)*o*r}}))},Erf:{fn:function(e){return{type:u.number,value:ar(e)}}},NormsInv:{description:"Inverse of the normal cumulative distribution",arguments:[{name:"probability"}],fn:function(e){return{type:u.number,value:sr(e)}}},"Norm.Inv":{description:"Inverse of the normal cumulative distribution",arguments:[{name:"probability"},{name:"mean",default:0},{name:"standard deviation",default:1}],fn:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),{type:u.number,value:sr(e)*r+t}}},"Norm.Dist":{description:"Cumulative normal distribution",arguments:[{name:"value"},{name:"mean",default:0},{name:"standard deviation",default:1}],fn:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1);var o=e<t?-1:1;return{type:u.number,value:.5*(1+o*ar(Math.abs(e-t)/(r*Math.sqrt(2))))}}},Sqrt:{description:"Returns the square root of the argument",arguments:[{boxed:!0}],fn:Xt((function(e){if(e.type===u.complex){var t=Rt(e.value,{real:.5,imaginary:0});return x(t)}return e.type!==u.undefined&&e.value?(t=Math.sqrt(e.value),isNaN(t)?yt():{type:u.number,value:t}):{type:u.number,value:0}}))},HexToDec:{arguments:[{description:"hexadecimal string"}],fn:function(e){return{type:u.number,value:parseInt(e,16)}}},DecToHex:{arguments:[{description:"number"}],fn:function(e){return{type:u.string,value:e.toString(16)}}},Checkbox:{arguments:[{name:"checked"}],click:function(e){var t=e.x,r=e.y,o=e.width,i=e.height,n=e.cell,a={};if(n&&o&&i&&t&&r){var s={x:3,y:i-3-16};if(n.style){switch(n.style.vertical_align){case R.VerticalAlign.Top:s.y=3;break;case R.VerticalAlign.Middle:s.y=Math.round(i/2-8)}switch(n.style.horizontal_align){case R.HorizontalAlign.Right:s.x=Math.round(o-3-16);break;case R.HorizontalAlign.Center:s.x=Math.round(o/2-8)}}t>=s.x&&t<=s.x+16&&r>=s.y&&r<=s.y+16&&(a.value="=Checkbox("+(n.calculated?"FALSE":"TRUE")+")",a.block_selection=!0)}return a},render:function(e){var t,r,o=e.context,i=e.width,n=e.height,a=e.cell,l=e.scale||1;o.lineJoin="round",o.lineCap="round";var c=3*l,d=c,u=n-c-16*l;if(a.style){switch(a.style.vertical_align){case R.VerticalAlign.Top:u=c;break;case R.VerticalAlign.Middle:u=Math.round(n/2-8*l)}switch(a.style.horizontal_align){case R.HorizontalAlign.Right:d=Math.round(i-c-16*l);break;case R.HorizontalAlign.Center:d=Math.round(i/2-8*l)}}if(a&&a.calculated){o.lineWidth=.5,o.fillStyle=o.strokeStyle,o.beginPath(),o.moveTo(d,u),o.lineTo(d+16*l,u),o.lineTo(d+16*l,u+16*l),o.lineTo(d,u+16*l),o.closePath(),o.moveTo(d+15*l,u+4*l);try{for(var h=s([[13.59,2.58],[6,10.17],[2.41,6.59],[1,8],[6,13]]),f=h.next();!f.done;f=h.next()){var p=f.value;o.lineTo(d+p[0]*l,u+p[1]*l)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}o.closePath(),o.fill()}else o.lineWidth=Math.max(2,2*l),o.strokeRect(d,u,16*l,16*l);return{handled:!0}},fn:function(e){return{value:!!e,type:u.boolean}}},"Sparkline.Column":{arguments:[{name:"data"},{name:"color"},{name:"negative color"}],render:function(e){return nr.RenderColumn(e.width,e.height,e.context,e.cell,e.style),{handled:!0}},fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.object,value:e}}},"Sparkline.Line":{arguments:[{name:"data"},{name:"color"},{name:"line width"}],render:function(e){return nr.RenderLine(e.width,e.height,e.context,e.cell,e.style),{handled:!0}},fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.object,value:e}}}},ur={};try{for(var hr=s(Object.keys(dr)),fr=hr.next();!fr.done;fr=hr.next()){var pr=fr.value;ur[pr.toLowerCase()]=pr}}catch(e){Qt={error:e}}finally{try{fr&&!fr.done&&(er=hr.return)&&er.call(hr)}finally{if(Qt)throw Qt.error}}var mr={};try{for(var vr=s(["pow"]),yr=vr.next();!yr.done;yr=vr.next()){var _r=yr.value;mr[_r.toLowerCase()]=_r}}catch(e){tr={error:e}}finally{try{yr&&!yr.done&&(rr=vr.return)&&rr.call(vr)}finally{if(tr)throw tr.error}}var gr=function(e){var t=e.toLowerCase();if(ur[t])return"continue";if(mr[t])return"continue";var r=Object.getOwnPropertyDescriptor(Math,e);if(!r)return"continue";var o=r.value,i=typeof o;switch(i){case"number":dr[e]={fn:function(){return{type:u.number,value:o}},category:["Math Functions"]};break;case"function":dr[e]={fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return w(o.apply(void 0,c([],l(e))))},category:["Math Functions"]};break;default:console.info("unexpected type:",i,e)}};try{for(var br=s(Object.getOwnPropertyNames(Math)),wr=br.next();!wr.done;wr=br.next())gr(wr.value)}catch(e){or={error:e}}finally{try{wr&&!wr.done&&(ir=br.return)&&ir.call(br)}finally{if(or)throw or.error}}Math.log10||(Math.log10=function(e){return Math.log(e)/Math.log(10)});var xr,Cr=function(e,t,r,o,i){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),i?-r*(e/(1-Math.pow(1+e,-t)))/(1+e)-o*(1/((1+e)*((Math.pow(1+e,t)-1)/e))):-(r*e*Math.pow(1+e,t)+o*e)/(Math.pow(1+e,t)-1)},Sr=function(e,t,r,o,i){return void 0===o&&(o=0),void 0===i&&(i=0),i?(1+e)*-r/e*(Math.pow(1+e,t)-1)-o*Math.pow(1+e,t):-r/e*(Math.pow(1+e,t)-1)-o*Math.pow(1+e,t)},Ar=function(e,t,r,o,i,n){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),t<1)return NaN;if(1===t&&n)return 0;var a=Cr(e,r,o,i,n),s=Sr(e,t-1,a,o,n)*e;return n?s/(1+e):s},kr=function(e,t,r,o,i,n){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),Cr(e,r,o,i,n)-Ar(e,t,r,o,i,n)},Mr={NPV:{description:"Returns the present value of a series of future cashflows",arguments:[{name:"Rate"},{name:"Cashflow"}],fn:function(e){void 0===e&&(e=0);for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=0,i=Kt(t),n=0;n<i.length;n++){var a=i[n];"number"==typeof a&&(o+=Math.pow(1+e,-(n+1))*a)}return{type:u.number,value:o}}},IRR:{description:"Calculates the internal rate of return of a series of cashflows",arguments:[{name:"Cashflows"},{name:"Guess",default:.1}],fn:function(e,t){void 0===t&&(t=.1);for(var r=Kt(e).map((function(e){return"number"==typeof e?e:0})),o=[{found:!1,value:0},{found:!1,value:0}],i=0;i<50;i++){for(var n=0,a=0;a<r.length;a++)n+=Math.pow(1+t,-(a+1))*r[a];if(Math.abs(n)<=.00125)return{type:u.number,value:t};if(n>0){if(o[0].value=o[0].found?Math.max(o[0].value,t):t,o[0].found=!0,!o[1].found){t+=.1;continue}}else if(o[1].value=o[1].found?Math.min(o[1].value,t):t,o[1].found=!0,!o[0].found){t-=.1;continue}t=o[0].value+(o[1].value-o[0].value)/2}return{type:u.error,value:"NUM"}}},CUMPRINC:{description:"Returns cumulative principal paid on a loan between two periods",arguments:[{name:"Rate"},{name:"Periods"},{name:"Present Value"},{name:"Start Period"},{name:"End Period"},{name:"Type",default:0}],fn:function(e,t,r,o,i,n){void 0===n&&(n=0);for(var a=0,s=o;s<=i;s++)a+=kr(e,s,t,r,0,n);return{type:u.number,value:a}}},CUMIPMT:{description:"Returns cumulative interest paid on a loan between two periods",arguments:[{name:"Rate"},{name:"Periods"},{name:"Present Value"},{name:"Start Period"},{name:"End Period"},{name:"Type",default:0}],fn:function(e,t,r,o,i,n){void 0===n&&(n=0);for(var a=0,s=o;s<=i;s++)a+=Ar(e,s,t,r,0,n);return{type:u.number,value:a}}},IPMT:{description:"Returns the interest portion of a payment",arguments:[{name:"Rate"},{name:"Period"},{name:"Periods"},{name:"Present Value",default:0},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i,n){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),{type:u.number,value:Ar(e,t,r,o,i,n)}}},PPMT:{description:"Returns the principal portion of a payment",arguments:[{name:"Rate"},{name:"Period"},{name:"Periods"},{name:"Present Value",default:0},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i,n){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),{type:u.number,value:kr(e,t,r,o,i,n)}}},Rate:{description:"Returns the interest rate of a loan",arguments:[{name:"Periods"},{name:"Payment"},{name:"Present Value",default:0},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i){void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0);for(var n=.25,a=[-1,1],s=0;s<32;s++){var l=Cr(n,e,r,o,i);if(Math.abs(l-t)<=1e-6)return{type:u.number,value:n};var c=Cr(a[1],e,r,o,i);t>=l&&t<=c||t>=c&&t<=l?a[0]=n:a[1]=n,n=a[0]+(a[1]-a[0])/2}return{type:u.number,value:n}}},FV:{description:"Returns the future value of an investment",arguments:[{name:"Rate"},{name:"Periods"},{name:"Payment"},{name:"Present Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i){return void 0===o&&(o=0),void 0===i&&(i=0),{type:u.number,value:Sr(e,t,r,o,i)}}},PV:{description:"Returns the present value of an investment",arguments:[{name:"Rate"},{name:"Periods"},{name:"Payment"},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i){return void 0===o&&(o=0),void 0===i&&(i=0),i?(r+=o*(1/((1+e)*((Math.pow(1+e,t)-1)/e))),{type:u.number,value:-(r+r/e*(1-Math.pow(1+e,-(t-1))))}):{type:u.number,value:-(o+r/e*(Math.pow(1+e,t)-1))/Math.pow(1+e,t)}}},NPER:{description:"Returns the number of periods of an investment",arguments:[{name:"Rate"},{name:"Payment"},{name:"Present Value"},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),i?{type:u.number,value:1+(-Math.log(1+e*(1-r/-t))+Math.log(1+o*e/(-t*(1+e))))/Math.log(1+e)}:{type:u.number,value:(Math.log(Math.pow(1-r*e/-t,-1))+Math.log(1+o*e/-t))/Math.log(1+e)}}},PMT:{description:"Returns the periodic payment of a loan",arguments:[{name:"Rate"},{name:"Periods"},{name:"Present Value"},{name:"Future Value",default:0},{name:"Type",default:0}],fn:function(e,t,r,o,i){return void 0===o&&(o=0),void 0===i&&(i=0),{type:u.number,value:Cr(e,t,r,o,i)}}}},Rr={Char:{arguments:[{name:"number"}],fn:function(e){return{type:u.string,value:String.fromCodePoint(e||32)}},category:["text"]},Code:{arguments:[{name:"string"}],fn:function(e){return{type:u.number,value:e.codePointAt(0)}},category:["text"]},Text:{arguments:[{name:"value"},{name:"number format"}],fn:function(e,t){return void 0===t&&(t="0.00####"),{type:u.string,value:ue.Get(t).Format(e||0)}},category:["text"]},Left:{arguments:[{name:"string"},{name:"count"}],fn:function(e,t){return void 0===t&&(t=1),{type:u.string,value:e.substr(0,t)}},category:["text"]},Right:{arguments:[{name:"string"},{name:"count"}],fn:function(e,t){return void 0===t&&(t=1),{type:u.string,value:e.slice(-t)}},category:["text"]},Mid:{arguments:[{name:"string"},{name:"left"},{name:"count"}],fn:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),{type:u.string,value:e.substr(Math.max(0,t-1),r)}},category:["text"]},Search:{description:"Find a string (needle) in another string (haystack). Case-insensitive.",arguments:[{name:"Needle"},{name:"Haystack"},{name:"Start",default:1}],fn:function(e,t,r){if(void 0===r&&(r=1),r>=1){if(!e)return{type:u.number,value:r};var o=function(e){for(var t=[],r=e.length,o="[\\^$.|?*+()",i=0;i<r;i++){var n=e[i];switch(n){case"*":t.push(".","*");break;case"?":t.push(".");break;case"~":n=e[++i]||"";default:for(var a=0;a<o.length;a++)if(n===o[a]){t.push("\\");break}t.push(n)}}return t.join("")}(e),i=new RegExp(o,"i").exec(t.substr(r-1));if(i)return{type:u.number,value:i.index+r}}return yt()}},Find:{description:"Find a string (needle) in another string (haystack). Case-sensitive.",arguments:[{name:"Needle"},{name:"Haystack"},{name:"Start",default:1}],fn:function(e,t,r){if(void 0===r&&(r=1),r>=1){if(!e)return{type:u.number,value:r};var o=new RegExp(e).exec(t.substr(r-1));if(o)return{type:u.number,value:o.index+r}}return yt()}},Concat:{description:"Pastes strings together",fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Kt(e),o=r.map((function(e){var t,r=(null===(t=e)||void 0===t?void 0:t.toString())||"";return"number"==typeof e&&","===M.decimal_separator?r.replace(/\./,","):r})).join("");return{type:u.string,value:o}}}},Tr={Concatenate:"Concat"},Lr={IsBlank:{description:"Returns true if the reference is blank",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){return{type:u.boolean,value:!(null==e?void 0:e.value)||void 0===e.value.value}}))},IsNumber:{description:"Returns true if the reference is a number",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){return{type:u.boolean,value:(null==e?void 0:e.value)&&"number"==typeof e.value.value}}))},IsLogical:{description:"Returns true if the reference is a logical TRUE or FALSE",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){return{type:u.boolean,value:(null==e?void 0:e.value)&&"boolean"==typeof e.value.value}}))},IsText:{description:"Returns true if the reference is text",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){return{type:u.boolean,value:(null==e?void 0:e.value)&&"string"==typeof e.value.value}}))}},Er=function(e,t){void 0===t&&(t=!1);for(var r=e.length,o=0,i=0,n=0;n<r;n++)o+=e[n];for(o/=r,n=0;n<r;n++){var a=e[n]-o;i+=a*a}return t?i/(r-1):i/r},zr={StDev:{description:"Returns the standard deviation of a set of values, corresponding to a population",arguments:[{name:"data"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Math.sqrt(Er(Kt(e),!1))}}},"StDev.S":{description:"Returns the standard deviation of a set of values, corresponding to a sample of a population",arguments:[{name:"data"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Math.sqrt(Er(Kt(e),!0))}}},Var:{description:"Returns the variance of a set of values, corresponding to a population",arguments:[{name:"data"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Er(Kt(e),!1)}}},"Var.S":{description:"Returns the variance of a set of values, corresponding to a sample of a population",arguments:[{name:"data"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{type:u.number,value:Er(Kt(e),!0)}}},Correl:{description:"Returns the correlation between two ranges of values",arguments:[{name:"A"},{name:"B"}],fn:function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return yt();if(!Array.isArray(e[0])||!Array.isArray(t[0]))return yt();for(var r=0,o=0,i=0,n=0,a=0,s=0,l=0,c=0;c<e.length;c++)if(e[c]&&t[c])for(var d=e[c].length,h=0;h<d;h++){var f=Number(e[c][h]),p=Number(t[c][h]);isNaN(f)||isNaN(p)||(o+=f*p,i+=f,n+=p,a+=f*f,s+=p*p,l++)}return(r=l*o-i*n)&&(r/=Math.sqrt((l*a-i*i)*(l*s-n*n))),{type:u.number,value:r}}},GeoMean:{description:"Returns the geometric mean of all numeric arguments",arguments:[{boxed:!0}],fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];r=Kt(r);var i=0,n={real:1,imaginary:0},a=!1,l=!1;try{for(var c=s(r),d=c.next();!d.done;d=c.next()){var h=d.value;h.type===u.complex?(a=!0,n=Ct(n,h.value),i++):h.type===u.number&&(h.value<0&&(l=!0),i++,n.real*=h.value,n.imaginary*=h.value)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}if(a){var f=Rt(n,{real:1/i,imaginary:0});return f.imaginary?{type:u.complex,value:f}:{type:u.number,value:f.real}}return l?yt():{type:u.number,value:Math.pow(n.real,1/i)}}},Average:{description:"Returns the arithmetic mean of all numeric arguments",arguments:[{boxed:!0}],fn:function(){for(var e,t,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];r=Kt(r);var i={real:0,imaginary:0},n=0;try{for(var a=s(r),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.type===u.error)return c;c.type===u.number&&(i.real+=c.value,n++),c.type===u.complex&&(i.real+=c.value.real,i.imaginary+=c.value.imaginary,n++)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return i.real/=n,i.imaginary/=n,i.imaginary?{type:u.complex,value:i}:{type:u.number,value:i.real}}},Percentile:{description:"Returns the kth percentile value from the range of data",arguments:[{name:"range"},{name:"percentile"}],fn:function(e,t){var r=Kt(e).filter((function(e){return"number"==typeof e}));r.sort((function(e,t){return e-t}));var o=r.length,i=Math.pow(10,8),n=Math.round((1+(o-1)*t)*i)/i,a=Math.floor(n),s=Math.ceil(n);return{type:u.number,value:(r[a-1]+r[s-1])/2}}},Median:{description:"Returns the median value of the range of data",arguments:[{name:"range"}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Kt(e).filter((function(e){return"number"==typeof e}));r.sort((function(e,t){return e-t}));var o=r.length,i=1+.5*(o-1),n=Math.floor(i),a=Math.ceil(i);return{type:u.number,value:(r[n-1]+r[a-1])/2}}}},Dr={Mean:"Average","StDev.P":"StDev","Var.P":"Var"},Pr={IsComplex:{description:"Returns true if the reference is a complex number",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){return{type:u.boolean,value:(null==e?void 0:e.value)&&p(e.value.value)}}))},Real:{description:"Returns the real part of a complex number",arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.number?o({},e):e.type===u.complex?{type:u.number,value:e.value.real||0}:e.type===u.undefined||e.type===u.string&&""===e.value?{type:u.number,value:0}:yt()}))},Imaginary:{description:"Returns the imaginary part of a complex number (as real)",arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.complex?{type:u.number,value:e.value.imaginary||0}:e.type===u.number||e.type===u.undefined||e.type===u.string&&""===e.value?{type:u.number,value:0}:yt()}))},Conjugate:{description:"Returns the conjugate of a complex number",arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.complex?{type:u.complex,value:{real:e.value.real,imaginary:-e.value.imaginary}}:e.type!==u.number&&e.type!==u.undefined&&e.value?yt():{type:u.number,value:e.value||0}}))},Arg:{description:"Returns the principal argument of a complex number",arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.complex?{type:u.number,value:Math.atan2(e.value.imaginary,e.value.real)}:e.type===u.number||e.type===u.undefined||e.type===u.string&&""===e.value?{type:u.number,value:Math.atan2(0,e.value||0)}:yt()}))},Rectangular:{description:"Converts a complex number in polar form to rectangular form",arguments:[{name:"r"},{name:"θ in radians"}],fn:function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),{type:u.complex,value:{real:e*Math.cos(t),imaginary:e*Math.sin(t)}}}},Complex:{description:"Ensures that the given value will be treated as a complex number",arguments:[{boxed:!0}],fn:Xt((function(e){return e.type===u.complex?e:e.type!==u.number&&e.type!==u.undefined&&e.value?yt():{type:u.complex,value:{imaginary:0,real:e.value||0}}}))},ComplexLog:{description:"Returns the principal value Log(z) of a complex number z",arguments:[{boxed:!0}],fn:Xt((function(e){if(e.type===u.number){if(!e.value)return yt();e={type:u.complex,value:{real:e.value,imaginary:0}}}else if(e.type===u.undefined||e.type===u.string&&""===e.value)return yt();if(e.type===u.complex){var t=xt(e.value),r={real:Math.log(t.r),imaginary:t.theta};return r.imaginary?{type:u.complex,value:r}:{type:u.number,value:r.real}}return yt()}))}},Nr=function(e){Array.isArray(e)||(e=[[e]]);var t=e.length,r=t?e[0].length:0,i=[];if(!t||!r)return{m:t,n:r,array:i};for(var n=0;n<t;n++){for(var a=[],s=0;s<r;s++){var l=e[n][s];if(l.type===u.complex)a.push(o({},l.value));else if(l.type===u.number)a.push({real:l.value,imaginary:0});else{if(l.type!==u.undefined&&""!==l.value)return{m:t,n:r,error:!0,array:[]};a.push({real:0,imaginary:0})}}i.push(a)}return{m:t,n:r,array:i}},Fr={MDeterm:{description:"Returns the determinant of a matrix",arguments:[{name:"matrix",boxed:!0}],fn:function(e){var t=Nr(e);if(!t.array||!t.m||!t.n||t.m!==t.n||t.error)return yt();var r=At(t);return r?x(r):yt()}},MInverse:{description:"Returns the inverse matrix",arguments:[{name:"matrix",boxed:!0}],fn:function(e){var t=Nr(e);if(!t.array||!t.m||!t.n||t.m!==t.n||t.error)return yt();var r=At(t);if(r&&0===r.real&&0===(null==r?void 0:r.imaginary))return yt();var o=function(e){var t=[];if(e.m===e.n){var r=function(e){for(var t={real_values:!1,imaginary_values:!1,square:e.m===e.n,unit_diagonal:!0},r={m:e.m,n:e.n,array:[]},o={m:e.m,n:e.n,array:[]},i=0;i<e.m;i++){for(var n=e.array[i],a=[],s=[],l=0;l<e.n;l++)n[l].real&&(t.real_values=!0),n[l].imaginary&&(t.imaginary_values=!0),l===i&&t.unit_diagonal&&(1===n[l].real&&0===n[l].imaginary||(t.unit_diagonal=!1)),a.push(n[l].real),s.push(n[l].imaginary);r.array.push(a),o.array.push(s)}return{real:r,imaginary:o,flags:t}}(e),o=r.real,i=r.imaginary,n=r.flags,a=kt(o);if(a){if(!n.imaginary_values){for(var s=0;s<e.m;s++){for(var l=[],c=0;c<e.n;c++)l.push({real:a.array[s][c],imaginary:0});t.push(l)}return t}var d=St(a,i),u=function(e,t){for(var r=[],o=0;o<e.m;o++){for(var i=[],n=0;n<e.n;n++)i.push(e.array[o][n]+t.array[o][n]);r.push(i)}return{m:e.m,n:e.n,array:r}}(o,St(i,d)),h=kt(u);if(h){var f=St(d,h);for(s=0;s<e.m;s++){for(l=[],c=0;c<e.n;c++)l.push({real:h.array[s][c],imaginary:-f.array[s][c]});t.push(l)}return t}}}}(t);return o?o.map((function(e){return e.map((function(e){return x(e)}))})):yt()}},MMult:{description:"Returns the dot product of A and B",arguments:[{name:"A",boxed:!0},{name:"B",boxed:!0}],fn:function(e,t){var r=Nr(e),o=Nr(t);return!r.array||r.error||!o.array||o.error||r.m!==o.n?yt():function(e,t){for(var r=[],o=0;o<e.m;o++){for(var i=[],n=0;n<t.n;n++){for(var a={real:0,imaginary:0},s=0;s<e.n;s++)a.real+=e.array[o][s].real*t.array[s][n].real-e.array[o][s].imaginary*t.array[s][n].imaginary,a.imaginary+=e.array[o][s].real*t.array[s][n].imaginary+e.array[o][s].imaginary*t.array[s][n].real;i.push(a)}r.push(i)}return r}(o,r).map((function(e){return e.map((function(e){return x(e)}))}))}}},Ir=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.state_id=0,t.type=r.type,t.color=rt.black,t.state_representation="",t}return t(r,e),r.prototype.UpdateState=function(){var e=JSON.stringify(this.edges_in.map((function(e){return e.result})));e!==this.state_representation&&(this.state_representation=e,this.state_id++)},r.prototype.Calculate=function(e){var t,r;if(this.dirty){try{for(var o=s(this.edges_in),i=o.next();!i.done;i=o.next())if(i.value.dirty)return}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.UpdateState(),this.dirty=!1}},r.prototype.AddDependent=function(e){throw new Error("leaf vertex cannot have dependents")},r.type="leaf-vertex",r}(st),Ur=function(e){function r(){var t,r,i,n,a=e.call(this)||this;a.library=new $t,a.parser=new Z,a.expression_calculator=new qt(a.library,a.parser),a.full_rebuild_required=!1,a.UpdateLocale(),a.library.Register(dr,Rr,zr,Mr,Lr,Pr,Fr);try{for(var l=s(Object.keys(Dr)),c=l.next();!c.done;c=l.next()){var d=c.value;a.library.Alias(d,Dr[d])}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}try{for(var h=s(Object.keys(Tr)),f=h.next();!f.done;f=h.next())d=f.value,a.library.Alias(d,Tr[d])}catch(e){i={error:e}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}return a.library.Register({CountIf:{arguments:[{name:"range"},{name:"criteria"}],fn:function(e,t){var r,o,i,n,l=Kt(e);"string"!=typeof t?t="="+(t||0).toString():(t=t.trim(),/^[=<>]/.test(t)||(t="="+t));var c=a.parser.Parse("{}"+t),d=c.expression;if(c.error||!d)return ft();if("binary"!==d.type)return ft();if("array"!==d.left.type)return ft();d.left.values=[l];var h=a.CalculateExpression(d);if(Array.isArray(h)){var f=0;try{for(var p=s(h),m=p.next();!m.done;m=p.next()){var v=m.value;try{for(var y=(i=void 0,s(v)),_=y.next();!_.done;_=y.next())_.value.value&&f++}catch(e){i={error:e}}finally{try{_&&!_.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}return{type:u.number,value:f}}return h}},Offset:{arguments:[{name:"reference",description:"Base reference",metadata:!0},{name:"rows",description:"number of rows to offset"},{name:"columns",description:"number of columns to offset"}],return_type:ut.reference,volatile:!0,fn:function(e,t,r,i,n){if(void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=1),!e)return vt();if(!Jt(e))return _t();var s=a.DynamicDependencies(e.value.address,a.expression_calculator.context.address,!0,t,r,i,n);if(!s)return _t();if(s.dirty)return a.GetVertex(a.expression_calculator.context.address,!0).short_circuit=!0,{type:u.undefined,value:void 0};if(s.area){var l=o(o({type:"address"},s.area.start),{label:"",position:0,id:0}),c=o(o({type:"address"},s.area.end),{label:"",position:0,id:0}),d=1===s.area.count?l:{type:"range",start:l,end:c,label:"",position:0,id:0};return{type:u.object,value:d}}return yt()}.bind(a)},Indirect:{arguments:[{name:"reference",description:"Cell reference (string)"}],return_type:ut.reference,volatile:!0,fn:function(e){if(!e||"string"!=typeof e)return vt();var t=a.parser.Parse(e);if(t.error||!t.expression||"address"!==t.expression.type&&"range"!==t.expression.type)return _t();var r=a.DynamicDependencies(t.expression,a.expression_calculator.context.address);return r?r.dirty?(a.GetVertex(a.expression_calculator.context.address,!0).short_circuit=!0,{type:u.undefined,value:void 0}):{type:u.object,value:t.expression}:_t()}.bind(a)},Rows:{arguments:[{name:"reference",description:"Array or reference"}],volatile:!1,fn:function(e){if(!e)return vt();if(Array.isArray(e)){var t=e[0];return Array.isArray(t)?{type:u.number,value:t.length}:yt()}return{type:u.number,value:1}}},Columns:{arguments:[{name:"reference",description:"Array or reference"}],volatile:!1,fn:function(e){return e?Array.isArray(e)?{type:u.number,value:e.length}:{type:u.number,value:1}:vt()}},IsFormula:{description:"Returns true if the reference is a formula",arguments:[{name:"Reference",metadata:!0}],fn:Xt((function(e){var t,r,o,i;if(null===(o=null==e?void 0:e.value)||void 0===o?void 0:o.address)try{for(var n=s((null===(i=a.model)||void 0===i?void 0:i.sheets)||[]),l=n.next();!l.done;l=n.next()){var c=l.value;if(c.id===e.value.address.sheet_id){var d=c.cells.GetCell(e.value.address,!1);return{type:u.boolean,value:(null==d?void 0:d.type)===u.formula}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return{type:u.boolean,value:!1}}))}}),a}return t(r,e),r.prototype.SpreadCallback=function(e,t){if(!e.address||!e.address.sheet_id)throw new Error("spread callback called without sheet id");var r=this.cells_map[e.address.sheet_id];if(!r)throw new Error("spread callback called without cells");if(e&&e.reference){var o=e.reference.area;if(o){var i=o.rows,n=o.columns;if(Array.isArray(t)){t=Wt(t);for(var a=0;a<i;a++)if(t[a]){for(var s=0;s<n&&s<t[a].length;s++)r.data[a+o.start.row][s+o.start.column].SetCalculatedValue(t[a][s].value,t[a][s].type);for(;s<n;s++)r.data[a+o.start.row][s+o.start.column].SetCalculatedValue(void 0,u.undefined)}else for(s=0;s<n;s++)r.data[a+o.start.row][s+o.start.column].SetCalculatedValue(void 0,u.undefined)}else for(a=0;a<i;a++)for(s=0;s<n;s++)r.data[a+o.start.row][s+o.start.column].SetCalculatedValue(t.value,t.type)}}},r.prototype.CalculationCallback=function(e){if(!e.address)throw new Error("vertex missing address");return e.expression_error?{value:bt()}:this.expression_calculator.Calculate(e.expression,e.address)},r.prototype.DynamicDependencies=function(e,t,r,o,i,n,a){if(void 0===r&&(r=!1),void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===a&&(a=1),this.model){var s=this.ResolveExpressionAddress(e,t);if(s){var l=!1,c=(s=this.model.active_sheet.RealArea(s)).start.sheet_id;r&&(s=new f({column:s.start.column+i,row:s.start.row+o,sheet_id:s.start.sheet_id},{column:s.start.column+i+n-1,row:s.start.row+o+a-1,sheet_id:s.end.sheet_id}));for(var d=s.start.row;d<=s.end.row;d++)for(var u=s.start.column;u<=s.end.column;u++){var h=this.GetVertex({row:d,column:u,sheet_id:c},!1);h&&h.dirty&&(this.AddEdge({row:d,column:u,sheet_id:c},this.expression_calculator.context.address),l=!0)}return{dirty:l,area:s}}}},r.prototype.UpdateLocale=function(){","===M.decimal_separator?(this.parser.decimal_mark=z.Comma,this.parser.argument_separator=E.Semicolon):(this.parser.decimal_mark=z.Period,this.parser.argument_separator=E.Comma)},r.prototype.GetFunction=function(e){return this.library.Get(e)},r.prototype.SupportedFunctions=function(){var e,t,r=this.library.List(),o=Object.keys(r).map((function(e){var t=r[e].canonical_name;return t||(t=e.replace(/_/g,".")),{name:t,description:r[e].description,arguments:(r[e].arguments||[]).map((function(e){return{name:e.name||""}}))}}));if(this.model)try{for(var i=s(Object.keys(this.model.macro_functions)),n=i.next();!n.done;n=i.next()){var a=n.value,l=this.model.macro_functions[a];o.push({name:l.name,description:l.description,arguments:(l.argument_names||[]).map((function(e){return{name:e}}))})}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return o},r.prototype.RegisterFunction=function(e){var t,r,i=this,n=function(t){var r,n=e[t],s=n.fn;n.fn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.apply({address:o({},i.expression_calculator.context.address)},e)},a.library.Register(((r={})[t]=n,r))},a=this;try{for(var l=s(Object.keys(e)),c=l.next();!c.done;c=l.next())n(c.value)}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}},r.prototype.AttachModel=function(e){this.AttachData(e),this.expression_calculator.SetModel(e)},r.prototype.Calculate=function(e,t){if(this.AttachModel(e),t&&!t.start.sheet_id)throw new Error("CalculateInternal called with subset w/out sheet ID");this.full_rebuild_required&&(t=void 0,this.UpdateAnnotations(),this.full_rebuild_required=!1),this.RebuildGraph(t);try{this.Recalculate()}catch(e){console.error(e),console.info("calculation error trapped")}},r.prototype.Reset=function(){this.FlushTree(),this.model&&this.AttachModel(this.model),this.full_rebuild_required=!0},r.prototype.CalculateExpression=function(e,t,r){return void 0===t&&(t={row:-1,column:-1}),void 0===r&&(r=!1),this.expression_calculator.Calculate(e,t,r).value},r.prototype.RebuildClean=function(e,t){void 0===t&&(t=!1),this.full_rebuild_required=!1,this.AttachModel(e),this.RebuildGraph(),this.UpdateAnnotations(),this.InitializeGraph(),t&&this.volatile_list.length&&this.Recalculate()},r.prototype.FlattenCellList=function(e){var t,r,o={},i=[];try{for(var n=s(e),a=n.next();!a.done;a=n.next()){var l=a.value,c={column:l.column,row:l.row,sheet_id:l.sheet_id},d=f.CellAddressToLabel(c,!0);o[d]||(o[d]=d,i.push(c))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return i},r.prototype.MetadataReferences=function(e){var t=[];if(!this.model)return t;var r=this.parser.Parse(e);if(r.expression&&"call"===r.expression.type){var o=this.GetFunction(r.expression.name);if(!o||!o.arguments)return t;for(var i=0;i<o.arguments.length;i++){var n=o.arguments[i];if(n&&n.metadata){var a=r.expression.args[i];if(a){var s=this.ResolveExpressionAddress(a);s&&t.push(s.start)}}}}return t},r.prototype.RemoveAnnotation=function(e){var t=e.temp.vertex;t&&(t.Reset(),this.RemoveLeafVertex(t))},r.prototype.UpdateAnnotations=function(e){var t,r;if(!e&&this.model&&(e=this.model.active_sheet.annotations),e){void 0===e||Array.isArray(e)||(e=[e]);try{for(var o=s(e),i=o.next();!i.done;i=o.next()){var n=i.value;if(n.formula){n.temp.vertex||(n.temp.vertex=new Ir);var a=n.temp.vertex;this.AddLeafVertex(a),this.UpdateLeafVertex(a,n.formula)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}},r.prototype.ResolveSheetID=function(e,t){var r,o;if(!this.model)throw new Error("ResolveSheetID called without model");var i="address"===e.type?e:e.start;if(i.sheet_id)return!0;if(!i.sheet)return i.sheet_id=(null==t?void 0:t.sheet_id)||this.model.active_sheet.id,!0;var n=i.sheet.toLowerCase();try{for(var a=s(this.model.sheets),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.name.toLowerCase()===n)return i.sheet_id=c.id,!0}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return!1},r.prototype.ResolveExpressionAddress=function(e,t){switch(e.type){case"address":if(this.ResolveSheetID(e,t))return new f(e);break;case"range":if(this.ResolveSheetID(e,t))return new f(e.start,e.end);break;case"identifier":if(this.model){var r=this.model.named_ranges.Get(e.name.toUpperCase());if(r)return new f(r.start,r.end)}}},r.prototype.NamedRangeToAddressUnit=function(e){if(this.model){var t=e.name.toUpperCase(),r=this.model.named_ranges.Get(t);return r?1===r.count?this.ConstructAddressUnit(r.start,t,e.id,e.position):{type:"range",start:this.ConstructAddressUnit(r.start,t,e.id,e.position),end:this.ConstructAddressUnit(r.end,t,e.id,e.position),label:t,id:e.id,position:e.position}:void 0}},r.prototype.ConstructAddressUnit=function(e,t,r,o){return{type:"address",row:e.row,column:e.column,sheet_id:e.sheet_id,label:t,id:r,position:o}},r.prototype.RebuildDependencies=function(e,t,r,o,i){var n,a,l,c,d=this;if(void 0===o&&(o={addresses:{},ranges:{}}),!i&&(i={},this.model)){try{for(var u=s(this.model.sheets),h=u.next();!h.done;h=u.next()){var f=h.value;i[f.name.toLowerCase()]=f.id}}catch(e){n={error:e}}finally{try{h&&!h.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!r)try{for(var p=s(this.model.sheets),m=p.next();!m.done;m=p.next())if((f=m.value).id===t){r=f.name;break}}catch(e){l={error:e}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(l)throw l.error}}}switch(e.type){case"literal":case"missing":case"operator":break;case"identifier":var v=this.NamedRangeToAddressUnit(e);v&&("address"===v.type?o.addresses[v.label]=v:o.ranges[v.label]=v);break;case"address":e.sheet_id||(e.sheet_id=e.sheet?i[e.sheet.toLowerCase()]||0:t,e.sheet||(e.sheet=r)),o.addresses[e.sheet_id+"!"+e.label]=e;break;case"range":e.start.sheet_id||(e.start.sheet_id=e.start.sheet?i[e.start.sheet.toLowerCase()]||0:t,e.start.sheet||(e.start.sheet=r)),o.ranges[e.start.sheet_id+"!"+e.start.label+":"+e.end.label]=e;break;case"unary":this.RebuildDependencies(e.operand,t,r,o,i);break;case"binary":this.RebuildDependencies(e.left,t,r,o,i),this.RebuildDependencies(e.right,t,r,o,i);break;case"group":e.elements.forEach((function(e){return d.RebuildDependencies(e,t,r,o,i)}));break;case"call":var y=e.args.slice(0),_=this.library.Get(e.name);_&&_.arguments&&_.arguments.forEach((function(e,o){e&&e.address&&(d.RebuildDependencies(y[o],t,r,void 0,i),y[o]={type:"missing",id:-1})})),y.forEach((function(e){return d.RebuildDependencies(e,t,r,o,i)}))}return o},r.prototype.UpdateLeafVertex=function(e,t){var r,o,i,n,a=this;if(!this.model)throw new Error("UpdateLeafVertex called without model");e.Reset();var l=this.parser.Parse(t);if(l.expression){var c=this.RebuildDependencies(l.expression,this.model.active_sheet.id,this.model.active_sheet.name);try{for(var d=s(Object.keys(c.ranges)),u=d.next();!u.done;u=d.next()){var h=u.value,p=c.ranges[h];new f(p.start,p.end).Iterate((function(t){a.AddLeafVertexEdge(t,e)}))}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}try{for(var m=s(Object.keys(c.addresses)),v=m.next();!v.done;v=m.next()){h=v.value;var y=c.addresses[h];this.AddLeafVertexEdge(y,e)}}catch(e){i={error:e}}finally{try{v&&!v.done&&(n=m.return)&&n.call(m)}finally{if(i)throw i.error}}}e.expression=l.expression||{type:"missing",id:-1},e.expression_error=!l.valid},r.prototype.ApplyMacroFunctionInternal=function(e,t,r){var o=this;switch(e.type){case"identifier":if(r[0]){var i=r[0][(e.name||"").toUpperCase()];if(i)return JSON.parse(JSON.stringify(i))}break;case"binary":e.left=this.ApplyMacroFunctionInternal(e.left,t,r),e.right=this.ApplyMacroFunctionInternal(e.right,t,r);break;case"unary":e.operand=this.ApplyMacroFunctionInternal(e.operand,t,r);break;case"group":e.elements=e.elements.map((function(e){return o.ApplyMacroFunctionInternal(e,t,r)}));break;case"call":if(e.args=e.args.map((function(e){return o.ApplyMacroFunctionInternal(e,t,r)})),!this.library.Get(e.name)){var n=t.macro_functions[e.name.toUpperCase()];if(n&&n.expression){var a=JSON.parse(JSON.stringify(n.expression)),s={};if(n.argument_names)for(var l=0;l<n.argument_names.length;l++)s[n.argument_names[l].toUpperCase()]=e.args[l]?e.args[l]:{type:"missing"};r.unshift(s);var c=this.ApplyMacroFunctionInternal(a,t,r);return r.shift(),c}}}return e},r.prototype.ApplyMacroFunctions=function(e){if(this.model&&Object.keys(this.model.macro_functions).length)return this.ApplyMacroFunctionInternal(e,this.model,[])},r.prototype.RebuildGraphCell=function(e,t){var r,i,n,a,l=this;if(e.area&&e.area.start.column===t.column&&e.area.start.row===t.row){var c=e.area,d=c.start,h=c.end,p=d.sheet_id||t.sheet_id;d.sheet_id||(d.sheet_id=p);for(var m=d.column;m<=h.column;m++)for(var v=d.row;v<=h.row;v++)this.ResetInbound({column:m,row:v,sheet_id:p},!0,!1);for(this.SetDirty(t),m=d.column;m<=h.column;m++)for(v=d.row;v<=h.row;v++)v===d.row&&m===d.column||this.AddEdge(d,o(o({},d),{row:v,column:m}))}if(e.type===u.formula){this.ResetInbound(t,!0);var y=this.parser.Parse(e.value);if(y.expression){if("call"===y.expression.type){var _=this.library.Get(y.expression.name);_&&(_.render||_.click)&&(e.render_function=_.render,e.click_function=_.click)}var g=this.RebuildDependencies(y.expression,t.sheet_id,"");try{for(var b=s(Object.keys(g.ranges)),w=b.next();!w.done;w=b.next()){var x=w.value,C=g.ranges[x],S=new f(C.start,C.end);S.entire_row||S.entire_column?this.AddArrayEdge(S,t):S.Iterate((function(e){return l.AddEdge(e,t)}))}}catch(e){r={error:e}}finally{try{w&&!w.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}try{for(var A=s(Object.keys(g.addresses)),k=A.next();!k.done;k=A.next()){x=k.value;var M=g.addresses[x];this.AddEdge(M,t)}}catch(e){n={error:e}}finally{try{k&&!k.done&&(a=A.return)&&a.call(A)}finally{if(n)throw n.error}}}var R=this.GetVertex(t,!0);R&&(R.expression=y.expression||{type:"missing",id:-1},R.expression_error=!y.valid)}else e.value!==e.calculated?this.ResetInbound(t,!0,!1):e.type===u.undefined?this.ResetInbound(t,!0,!1,!0):console.warn("UNHANDLED CASE",e)},r.prototype.RebuildGraph=function(e){var t,r,o;if(e){if(!e.start.sheet_id)throw new Error("subset missing sheet id");for(var i=this.cells_map[e.start.sheet_id],n=e.start.row;n<=e.end.row;n++)if(h=i.data[n])for(var a=e.start.column;a<=e.end.column;a++)(p=h[a])&&this.RebuildGraphCell(p,{row:n,column:a,sheet_id:e.start.sheet_id})}else try{for(var l=s((null===(o=this.model)||void 0===o?void 0:o.sheets)||[]),c=l.next();!c.done;c=l.next()){var d=c.value,u=d.cells.data.length;for(n=0;n<u;n++){var h;if(h=d.cells.data[n]){var f=h.length;for(a=0;a<f;a++){var p;(p=h[a])&&this.RebuildGraphCell(p,{row:n,column:a,sheet_id:d.id})}}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}},r.prototype.IsNativeOrTypedArray=function(e){return Array.isArray(e)||e instanceof Float64Array||e instanceof Float32Array},r.prototype.CheckVolatile=function(e){var t=this;if(!e.expression||e.expression_error)return!1;var r=!1;return this.parser.Walk(e.expression,(function(e){if("call"===e.type){var o=t.library.Get(e.name);o&&o.volatile&&(r=!0)}return!r})),r},r}(dt);!function(e){e.default="",e.info="info",e.error="error",e.warning="warning",e.success="success",e.about="about",e.initial="initial"}(xr||(xr={}));var Or,Vr,Hr,jr,Gr=function(){function e(e){var t=this;this.parent_node=e,this.visible_=!1,this.pending_dialog_resoltion=[],this.options_={type:xr.initial},this.event_handler=function(e){"Escape"!==e.key&&"Esc"!==e.key||(e.stopPropagation(),e.preventDefault(),t.visible=!1)},this.model=ie(Or||(Or=d(["<div id='mask' class='treb-embed-mask'><div id='dialog' class='treb-embed-dialog'><div id='left'><a href='https://treb.app' target='_blank'><svg width=48 height=48 viewBox='0 0 64 64'><path fill=\"#8CC63F\" d=\"M37.913,14.323c-2.042,0-7.067,2.558-8.72,3.481c-0.959-1.012-1.065-2.522-1.243-4.475 c-0.959,0.994-0.337,4.014,0,5.115c-4.19,3.125-7.707,6.357-11.295,10.016c-1.225-1.936-2.06-3.517-2.344-7.033 c-1.243,2.664,0.355,6.163,1.278,8.098c-3.96,4.99-7.885,10.354-11.064,15.486C-10.001,14.323,34.344-3.916,63.327,8.641 c-17.955,11.952-22.59,49.672-54.13,39.639c-2.22,3.197-3.712,7.37-5.541,11.082c-1.527,0.107-2.593-0.675-2.983-1.278    c3.072-7.441,7.033-13.995,11.082-20.459c4.387,0.125,8.737,0.195,12.36-0.426c-3.144-0.834-6.908-0.319-10.655-1.278    c2.291-4.387,5.63-7.726,8.95-11.082c3.605,0.32,7.264,1.314,11.082,0.426c-3.32-0.586-6.535-0.799-9.377-1.705 C27.223,20.131,33.438,16.401,37.913,14.323z\"/></svg></a></div><div id='middle'><div id='title' class='treb-embed-dialog-title'></div><div id='message' class='treb-embed-dialog-message'></div><div id='about' class='treb-embed-dialog-body'>TREB version ","<div class='smaller'><a target=_blank href='https://treb.app'>http://treb.app</a></div></div></div><div id='close' class='close-box'><svg viewBox='0 0 16 16'><path d='M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z'/><path d='M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z'/></svg></div></div></div>"],["<div id='mask' class='treb-embed-mask'><div id='dialog' class='treb-embed-dialog'><div id='left'><a href='https://treb.app' target='_blank'><svg width=48 height=48 viewBox='0 0 64 64'><path fill=\"#8CC63F\" d=\"M37.913,14.323c-2.042,0-7.067,2.558-8.72,3.481c-0.959-1.012-1.065-2.522-1.243-4.475 c-0.959,0.994-0.337,4.014,0,5.115c-4.19,3.125-7.707,6.357-11.295,10.016c-1.225-1.936-2.06-3.517-2.344-7.033 c-1.243,2.664,0.355,6.163,1.278,8.098c-3.96,4.99-7.885,10.354-11.064,15.486C-10.001,14.323,34.344-3.916,63.327,8.641 c-17.955,11.952-22.59,49.672-54.13,39.639c-2.22,3.197-3.712,7.37-5.541,11.082c-1.527,0.107-2.593-0.675-2.983-1.278    c3.072-7.441,7.033-13.995,11.082-20.459c4.387,0.125,8.737,0.195,12.36-0.426c-3.144-0.834-6.908-0.319-10.655-1.278    c2.291-4.387,5.63-7.726,8.95-11.082c3.605,0.32,7.264,1.314,11.082,0.426c-3.32-0.586-6.535-0.799-9.377-1.705 C27.223,20.131,33.438,16.401,37.913,14.323z\"/></svg></a></div><div id='middle'><div id='title' class='treb-embed-dialog-title'></div><div id='message' class='treb-embed-dialog-message'></div><div id='about' class='treb-embed-dialog-body'>TREB version ","<div class='smaller'><a target=_blank href='https://treb.app'>http://treb.app</a></div></div></div><div id='close' class='close-box'><svg viewBox='0 0 16 16'><path d='M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z'/><path d='M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z'/></svg></div></div></div>"])),"11.0.1"),this.model.close.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),t.HideDialog()})),e.appendChild(this.model.mask)}return Object.defineProperty(e.prototype,"options",{set:function(e){if(e.type===xr.about&&(e.close_box=!0,e.icon=!0),this.options_.icon!==e.icon&&(this.model.left.style.display=e.icon?"block":"none"),this.options_.close_box!==e.close_box&&(this.model.close.style.display=e.close_box?"block":"none"),this.options_.message!==e.message&&(this.model.message.textContent=e.message||"",this.model.message.style.display=e.message?"block":"none"),this.options_.title!==e.title&&(this.model.title.textContent=e.title||"",this.model.title.style.display=e.title?"block":"none"),this.options_.type!==e.type){var t=this.model.dialog.className.replace(/dialog-type-\S+/g,"").trim();e.type&&(t+=" dialog-type-"+e.type),this.model.dialog.className=t,"about"===e.type?this.model.about.style.display="block":this.model.about.style.display="none"}this.options_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this.visible_},set:function(e){if(e!==this.visible_)if(this.visible_=e,e)this.parent_node.classList.add("masked"),this.model.mask.classList.add("visible"),window.addEventListener("keydown",this.event_handler);else{this.parent_node.classList.remove("masked"),this.model.mask.classList.remove("visible"),window.removeEventListener("keydown",this.event_handler);var t=this.pending_dialog_resoltion.slice(0);this.pending_dialog_resoltion=[],Promise.resolve().then((function(){var e,r;try{for(var o=s(t),i=o.next();!i.done;i=o.next())(0,i.value)()}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}}))}},enumerable:!1,configurable:!0}),e.prototype.Div=function(e,t){var r=document.createElement("div");return e&&r.setAttribute("class",e),t&&t.appendChild(r),r},e.prototype.Update=function(e,t){void 0===t&&(t=!0),t&&(e=o(o({},this.options_),e)),this.options=e},e.prototype.HideDialog=function(){this.visible=!1},e.prototype.ShowDialog=function(e){var t=this;return new Promise((function(r){t.pending_dialog_resoltion.push(r),t.options=e,t.visible=!0,t.timeout&&(clearTimeout(t.timeout),t.timeout=0),e.timeout&&(t.timeout=setTimeout((function(){return t.HideDialog()}),e.timeout))}))},e}(),Br={delimiter:","},Zr={formula_bar:!0,in_cell_editor:!0,undo:!0,scrollbars:!0,dnd:!1,export:!0,fork:!1,popout:!0,tab_bar:"auto",add_tab:!1,max_workers:1,resizable:!0,default_trials:5e3,screen_updates:!1,lhs:!0,hyperlinks:"_blank",max_file_size:94208,complex:!1};!function(e){e.json="json",e.treb="treb",e.csv="csv",e.tsv="tsv",e.xlsx="xlsx"}(Vr||(Vr={})),function(e){e.DRAG_AND_DROP="drag-and-drop",e.LOCAL_FILE="local-file",e.NETWORK_FILE="network-file",e.LOCAL_STORAGE="local-storage",e.UNDO="undo"}(Hr||(Hr={})),function(e){e.TREB="treb",e.CSV="csv",e.XLSX="xlsx"}(jr||(jr={}));var Jr,qr,Wr,Kr,Xr,Yr,$r={"fa/light/arrow-down-to-line":{viewbox:"0 0 384 512",paths:[{d:"M181 395C184 398 188 400 192 400S200 398 203 395L347 251C354 245 354 235 347 229S331 222 325 229L208 345V48C208 39 201 32 192 32S176 39 176 48V345L59 229C53 222 43 222 37 229S30 245 37 251L181 395ZM368 448H16C7 448 0 455 0 464S7 480 16 480H368C377 480 384 473 384 464S377 448 368 448Z",classes:["fa-light"]}]},"fa/light/arrow-up-to-line":{viewbox:"0 0 384 512",paths:[{d:"M203 117C200 114 196 112 192 112S184 114 181 117L37 261C30 267 30 277 37 283S53 290 59 283L176 167V464C176 473 183 480 192 480S208 473 208 464V167L325 283C331 290 341 290 347 283S354 267 347 261L203 117ZM368 32H16C7 32 0 39 0 48S7 64 16 64H368C377 64 384 57 384 48S377 32 368 32Z",classes:["fa-light"]}]},"fa/light/arrows-rotate":{viewbox:"0 0 512 512",paths:[{d:"M464 32C455 32 448 39 448 48V177C416 100 341 48 256 48C154 48 68 121 51 221C49 230 55 238 64 240C65 240 66 240 67 240C74 240 81 234 82 227C97 142 170 80 256 80C328 80 393 125 420 192H304C295 192 288 199 288 208S295 224 304 224H464C473 224 480 217 480 208V48C480 39 473 32 464 32ZM448 272C439 271 431 277 430 285C415 370 342 432 256 432C184 432 119 387 92 320H208C217 320 224 313 224 304S217 288 208 288H48C39 288 32 295 32 304V464C32 473 39 480 48 480S64 473 64 464V335C96 412 171 464 256 464C358 464 444 391 461 291C463 282 457 274 448 272Z",classes:["fa-light"]}]},"fa/light/border-all":{viewbox:"0 0 448 512",paths:[{d:"M400 32H48C22 32 0 54 0 80V432C0 458 22 480 48 480H400C426 480 448 458 448 432V80C448 54 426 32 400 32ZM32 80C32 71 39 64 48 64H208V240H32V80ZM48 448C39 448 32 441 32 432V272H208V448H48ZM416 432C416 441 409 448 400 448H240V272H416V432ZM416 240H240V64H400C409 64 416 71 416 80V240Z",classes:["fa-light"]}]},"fa/light/border-bottom":{viewbox:"0 0 448 512",paths:[{d:"M224 88C237 88 248 77 248 64C248 51 237 40 224 40S200 51 200 64C200 77 211 88 224 88ZM224 184C237 184 248 173 248 160C248 147 237 136 224 136S200 147 200 160C200 173 211 184 224 184ZM320 88C333 88 344 77 344 64C344 51 333 40 320 40S296 51 296 64C296 77 307 88 320 88ZM416 376C429 376 440 365 440 352C440 339 429 328 416 328S392 339 392 352C392 365 403 376 416 376ZM320 280C333 280 344 269 344 256C344 243 333 232 320 232S296 243 296 256C296 269 307 280 320 280ZM416 88C429 88 440 77 440 64C440 51 429 40 416 40S392 51 392 64C392 77 403 88 416 88ZM416 280C429 280 440 269 440 256C440 243 429 232 416 232S392 243 392 256C392 269 403 280 416 280ZM416 184C429 184 440 173 440 160C440 147 429 136 416 136S392 147 392 160C392 173 403 184 416 184ZM32 376C45 376 56 365 56 352C56 339 45 328 32 328S8 339 8 352C8 365 19 376 32 376ZM32 88C45 88 56 77 56 64C56 51 45 40 32 40S8 51 8 64C8 77 19 88 32 88ZM32 280C45 280 56 269 56 256C56 243 45 232 32 232S8 243 8 256C8 269 19 280 32 280ZM32 184C45 184 56 173 56 160C56 147 45 136 32 136S8 147 8 160C8 173 19 184 32 184ZM432 448H16C7 448 0 455 0 464S7 480 16 480H432C441 480 448 473 448 464S441 448 432 448ZM128 280C141 280 152 269 152 256C152 243 141 232 128 232S104 243 104 256C104 269 115 280 128 280ZM224 376C237 376 248 365 248 352C248 339 237 328 224 328S200 339 200 352C200 365 211 376 224 376ZM224 280C237 280 248 269 248 256C248 243 237 232 224 232S200 243 200 256C200 269 211 280 224 280ZM128 88C141 88 152 77 152 64C152 51 141 40 128 40S104 51 104 64C104 77 115 88 128 88Z",classes:["fa-light"]}]},"fa/light/border-inner":{viewbox:"0 0 448 512",paths:[{d:"M128 88C141 88 152 77 152 64C152 51 141 40 128 40S104 51 104 64C104 77 115 88 128 88ZM32 88C45 88 56 77 56 64C56 51 45 40 32 40S8 51 8 64C8 77 19 88 32 88ZM32 184C45 184 56 173 56 160C56 147 45 136 32 136S8 147 8 160C8 173 19 184 32 184ZM416 88C429 88 440 77 440 64C440 51 429 40 416 40S392 51 392 64C392 77 403 88 416 88ZM416 184C429 184 440 173 440 160C440 147 429 136 416 136S392 147 392 160C392 173 403 184 416 184ZM320 88C333 88 344 77 344 64C344 51 333 40 320 40S296 51 296 64C296 77 307 88 320 88ZM32 424C19 424 8 435 8 448C8 461 19 472 32 472S56 461 56 448C56 435 45 424 32 424ZM416 328C403 328 392 339 392 352C392 365 403 376 416 376S440 365 440 352C440 339 429 328 416 328ZM416 424C403 424 392 435 392 448C392 461 403 472 416 472S440 461 440 448C440 435 429 424 416 424ZM320 424C307 424 296 435 296 448C296 461 307 472 320 472S344 461 344 448C344 435 333 424 320 424ZM128 424C115 424 104 435 104 448C104 461 115 472 128 472S152 461 152 448C152 435 141 424 128 424ZM32 328C19 328 8 339 8 352C8 365 19 376 32 376S56 365 56 352C56 339 45 328 32 328ZM432 240H240V48C240 39 233 32 224 32S208 39 208 48V240H16C7 240 0 247 0 256S7 272 16 272H208V464C208 473 215 480 224 480S240 473 240 464V272H432C441 272 448 265 448 256S441 240 432 240Z",classes:["fa-light"]}]},"fa/light/border-left":{viewbox:"0 0 448 512",paths:[{d:"M128 40C115 40 104 51 104 64C104 77 115 88 128 88S152 77 152 64C152 51 141 40 128 40ZM224 424C211 424 200 435 200 448C200 461 211 472 224 472S248 461 248 448C248 435 237 424 224 424ZM224 328C211 328 200 339 200 352C200 365 211 376 224 376S248 365 248 352C248 339 237 328 224 328ZM224 232C211 232 200 243 200 256C200 269 211 280 224 280S248 269 248 256C248 243 237 232 224 232ZM416 88C429 88 440 77 440 64C440 51 429 40 416 40S392 51 392 64C392 77 403 88 416 88ZM224 136C211 136 200 147 200 160C200 173 211 184 224 184S248 173 248 160C248 147 237 136 224 136ZM128 232C115 232 104 243 104 256C104 269 115 280 128 280S152 269 152 256C152 243 141 232 128 232ZM128 424C115 424 104 435 104 448C104 461 115 472 128 472S152 461 152 448C152 435 141 424 128 424ZM416 136C403 136 392 147 392 160C392 173 403 184 416 184S440 173 440 160C440 147 429 136 416 136ZM416 424C403 424 392 435 392 448C392 461 403 472 416 472S440 461 440 448C440 435 429 424 416 424ZM416 328C403 328 392 339 392 352C392 365 403 376 416 376S440 365 440 352C440 339 429 328 416 328ZM416 232C403 232 392 243 392 256C392 269 403 280 416 280S440 269 440 256C440 243 429 232 416 232ZM320 232C307 232 296 243 296 256C296 269 307 280 320 280S344 269 344 256C344 243 333 232 320 232ZM320 40C307 40 296 51 296 64C296 77 307 88 320 88S344 77 344 64C344 51 333 40 320 40ZM320 424C307 424 296 435 296 448C296 461 307 472 320 472S344 461 344 448C344 435 333 424 320 424ZM224 40C211 40 200 51 200 64C200 77 211 88 224 88S248 77 248 64C248 51 237 40 224 40ZM16 32C7 32 0 39 0 48V464C0 473 7 480 16 480S32 473 32 464V48C32 39 25 32 16 32Z",classes:["fa-light"]}]},"fa/light/border-none":{viewbox:"0 0 448 512",paths:[{d:"M128 232C115 232 104 243 104 256C104 269 115 280 128 280S152 269 152 256C152 243 141 232 128 232ZM32 40C19 40 8 51 8 64C8 77 19 88 32 88S56 77 56 64C56 51 45 40 32 40ZM128 424C115 424 104 435 104 448C104 461 115 472 128 472S152 461 152 448C152 435 141 424 128 424ZM128 40C115 40 104 51 104 64C104 77 115 88 128 88S152 77 152 64C152 51 141 40 128 40ZM224 328C211 328 200 339 200 352C200 365 211 376 224 376S248 365 248 352C248 339 237 328 224 328ZM416 88C429 88 440 77 440 64C440 51 429 40 416 40S392 51 392 64C392 77 403 88 416 88ZM32 424C19 424 8 435 8 448C8 461 19 472 32 472S56 461 56 448C56 435 45 424 32 424ZM32 328C19 328 8 339 8 352C8 365 19 376 32 376S56 365 56 352C56 339 45 328 32 328ZM32 136C19 136 8 147 8 160C8 173 19 184 32 184S56 173 56 160C56 147 45 136 32 136ZM32 232C19 232 8 243 8 256C8 269 19 280 32 280S56 269 56 256C56 243 45 232 32 232ZM224 424C211 424 200 435 200 448C200 461 211 472 224 472S248 461 248 448C248 435 237 424 224 424ZM416 328C403 328 392 339 392 352C392 365 403 376 416 376S440 365 440 352C440 339 429 328 416 328ZM416 424C403 424 392 435 392 448C392 461 403 472 416 472S440 461 440 448C440 435 429 424 416 424ZM416 232C403 232 392 243 392 256C392 269 403 280 416 280S440 269 440 256C440 243 429 232 416 232ZM320 40C307 40 296 51 296 64C296 77 307 88 320 88S344 77 344 64C344 51 333 40 320 40ZM224 232C211 232 200 243 200 256C200 269 211 280 224 280S248 269 248 256C248 243 237 232 224 232ZM416 136C403 136 392 147 392 160C392 173 403 184 416 184S440 173 440 160C440 147 429 136 416 136ZM224 40C211 40 200 51 200 64C200 77 211 88 224 88S248 77 248 64C248 51 237 40 224 40ZM320 232C307 232 296 243 296 256C296 269 307 280 320 280S344 269 344 256C344 243 333 232 320 232ZM224 136C211 136 200 147 200 160C200 173 211 184 224 184S248 173 248 160C248 147 237 136 224 136ZM320 424C307 424 296 435 296 448C296 461 307 472 320 472S344 461 344 448C344 435 333 424 320 424Z",classes:["fa-light"]}]},"fa/light/border-outer":{viewbox:"0 0 448 512",paths:[{d:"M224 328C211 328 200 339 200 352C200 365 211 376 224 376S248 365 248 352C248 339 237 328 224 328ZM128 232C115 232 104 243 104 256C104 269 115 280 128 280S152 269 152 256C152 243 141 232 128 232ZM224 232C211 232 200 243 200 256C200 269 211 280 224 280S248 269 248 256C248 243 237 232 224 232ZM320 232C307 232 296 243 296 256C296 269 307 280 320 280S344 269 344 256C344 243 333 232 320 232ZM224 136C211 136 200 147 200 160C200 173 211 184 224 184S248 173 248 160C248 147 237 136 224 136ZM400 32H48C22 32 0 54 0 80V432C0 458 22 480 48 480H400C426 480 448 458 448 432V80C448 54 426 32 400 32ZM416 432C416 441 409 448 400 448H48C39 448 32 441 32 432V80C32 71 39 64 48 64H400C409 64 416 71 416 80V432Z",classes:["fa-light"]}]},"fa/light/border-right":{viewbox:"0 0 448 512",paths:[{d:"M120 40C107 40 96 51 96 64C96 77 107 88 120 88S144 77 144 64C144 51 133 40 120 40ZM24 136C11 136 0 147 0 160C0 173 11 184 24 184S48 173 48 160C48 147 37 136 24 136ZM120 424C107 424 96 435 96 448C96 461 107 472 120 472S144 461 144 448C144 435 133 424 120 424ZM120 232C107 232 96 243 96 256C96 269 107 280 120 280S144 269 144 256C144 243 133 232 120 232ZM24 40C11 40 0 51 0 64C0 77 11 88 24 88S48 77 48 64C48 51 37 40 24 40ZM24 424C11 424 0 435 0 448C0 461 11 472 24 472S48 461 48 448C48 435 37 424 24 424ZM24 328C11 328 0 339 0 352C0 365 11 376 24 376S48 365 48 352C48 339 37 328 24 328ZM24 232C11 232 0 243 0 256C0 269 11 280 24 280S48 269 48 256C48 243 37 232 24 232ZM216 328C203 328 192 339 192 352C192 365 203 376 216 376S240 365 240 352C240 339 229 328 216 328ZM216 40C203 40 192 51 192 64C192 77 203 88 216 88S240 77 240 64C240 51 229 40 216 40ZM312 232C299 232 288 243 288 256C288 269 299 280 312 280S336 269 336 256C336 243 325 232 312 232ZM216 424C203 424 192 435 192 448C192 461 203 472 216 472S240 461 240 448C240 435 229 424 216 424ZM312 40C299 40 288 51 288 64C288 77 299 88 312 88S336 77 336 64C336 51 325 40 312 40ZM312 424C299 424 288 435 288 448C288 461 299 472 312 472S336 461 336 448C336 435 325 424 312 424ZM216 232C203 232 192 243 192 256C192 269 203 280 216 280S240 269 240 256C240 243 229 232 216 232ZM216 136C203 136 192 147 192 160C192 173 203 184 216 184S240 173 240 160C240 147 229 136 216 136ZM424 32C415 32 408 39 408 48V464C408 473 415 480 424 480S440 473 440 464V48C440 39 433 32 424 32Z",classes:["fa-light"]}]},"fa/light/border-top":{viewbox:"0 0 448 512",paths:[{d:"M128 424C115 424 104 435 104 448S115 472 128 472C141 472 152 461 152 448S141 424 128 424ZM224 328C211 328 200 339 200 352S211 376 224 376C237 376 248 365 248 352S237 328 224 328ZM32 136C19 136 8 147 8 160S19 184 32 184C45 184 56 173 56 160S45 136 32 136ZM224 424C211 424 200 435 200 448S211 472 224 472C237 472 248 461 248 448S237 424 224 424ZM128 232C115 232 104 243 104 256S115 280 128 280C141 280 152 269 152 256S141 232 128 232ZM432 32H16C7 32 0 39 0 48S7 64 16 64H432C441 64 448 57 448 48S441 32 432 32ZM32 328C19 328 8 339 8 352S19 376 32 376C45 376 56 365 56 352S45 328 32 328ZM32 232C19 232 8 243 8 256S19 280 32 280C45 280 56 269 56 256S45 232 32 232ZM32 424C19 424 8 435 8 448S19 472 32 472C45 472 56 461 56 448S45 424 32 424ZM416 328C403 328 392 339 392 352S403 376 416 376C429 376 440 365 440 352S429 328 416 328ZM416 232C403 232 392 243 392 256S403 280 416 280C429 280 440 269 440 256S429 232 416 232ZM416 424C403 424 392 435 392 448S403 472 416 472C429 472 440 461 440 448S429 424 416 424ZM416 136C403 136 392 147 392 160S403 184 416 184C429 184 440 173 440 160S429 136 416 136ZM320 424C307 424 296 435 296 448S307 472 320 472C333 472 344 461 344 448S333 424 320 424ZM224 136C211 136 200 147 200 160S211 184 224 184C237 184 248 173 248 160S237 136 224 136ZM224 232C211 232 200 243 200 256S211 280 224 280C237 280 248 269 248 256S237 232 224 232ZM320 232C307 232 296 243 296 256S307 280 320 280C333 280 344 269 344 256S333 232 320 232Z",classes:["fa-light"]}]},"fa/light/check":{viewbox:"0 0 512 512",paths:[{d:"M475 123L203 395C200 398 196 400 192 400S184 398 181 395L37 251C30 245 30 235 37 229S53 222 59 229L192 361L453 101C459 94 469 94 475 101S482 117 475 123Z",classes:["fa-light"]}]},"fa/light/compress":{viewbox:"0 0 448 512",paths:[{d:"M144 320H16C7 320 0 327 0 336S7 352 16 352H128V464C128 473 135 480 144 480S160 473 160 464V336C160 327 153 320 144 320ZM304 192H432C441 192 448 185 448 176S441 160 432 160H320V48C320 39 313 32 304 32S288 39 288 48V176C288 185 295 192 304 192ZM432 320H304C295 320 288 327 288 336V464C288 473 295 480 304 480S320 473 320 464V352H432C441 352 448 345 448 336S441 320 432 320ZM144 32C135 32 128 39 128 48V160H16C7 160 0 167 0 176S7 192 16 192H144C153 192 160 185 160 176V48C160 39 153 32 144 32Z",classes:["fa-light"]}]},"fa/light/expand":{viewbox:"0 0 448 512",paths:[{d:"M144 32H16C7 32 0 39 0 48V176C0 185 7 192 16 192S32 185 32 176V64H144C153 64 160 57 160 48S153 32 144 32ZM144 448H32V336C32 327 25 320 16 320S0 327 0 336V464C0 473 7 480 16 480H144C153 480 160 473 160 464S153 448 144 448ZM432 320C423 320 416 327 416 336V448H304C295 448 288 455 288 464S295 480 304 480H432C441 480 448 473 448 464V336C448 327 441 320 432 320ZM432 32H304C295 32 288 39 288 48S295 64 304 64H416V176C416 185 423 192 432 192S448 185 448 176V48C448 39 441 32 432 32Z",classes:["fa-light"]}]},"fa/light/fill-drip":{viewbox:"0 0 576 512",paths:[{d:"M525 340C519 330 505 330 499 340C480 370 448 423 448 448C448 483 477 512 512 512S576 483 576 448C576 423 544 370 525 340ZM512 480C494 480 480 466 480 448C480 438 494 410 512 379C530 410 544 438 544 448C544 466 530 480 512 480ZM503 217L295 9C289 3 281 0 272 0C264 0 256 3 250 9L157 102L63 8C56 2 46 2 40 8C34 14 34 24 40 31L134 125L28 231C-9 268 -9 329 28 367L145 484C164 503 189 512 213 512C238 512 262 503 281 484L503 262C515 250 515 230 503 217ZM258 461C246 473 230 480 213 480C196 480 180 473 168 461L51 344C44 337 39 329 36 320H400L258 461ZM432 288H33C35 275 41 263 51 254L157 148L245 235C251 242 261 242 267 235C273 229 273 219 267 213L179 125L272 32L480 240L432 288Z",classes:["fa-light"]}]},"fa/light/font":{viewbox:"0 0 448 512",paths:[{d:"M432 448H411L239 41C234 29 214 29 209 41L37 448H16C7 448 0 455 0 464S7 480 16 480H96C105 480 112 473 112 464S105 448 96 448H72L113 352H335L376 448H352C343 448 336 455 336 464S343 480 352 480H432C441 480 448 473 448 464S441 448 432 448ZM126 320L224 88L322 320H126Z",classes:["fa-light"]}]},"fa/light/image-landscape":{viewbox:"0 0 576 512",paths:[{d:"M160 184C173 184 184 173 184 160S173 136 160 136C147 136 136 147 136 160S147 184 160 184ZM347 172C335 156 308 156 297 172L253 233L246 224C234 210 209 210 197 224L134 305C127 314 126 326 132 336C137 346 147 352 158 352H418C429 352 439 346 444 337C444 337 444 337 444 337C450 327 449 315 443 306L347 172ZM162 320L220 244L241 270C245 275 258 281 266 269L321 191L413 320H162ZM512 64H64C29 64 0 93 0 128V384C0 419 29 448 64 448H512C547 448 576 419 576 384V128C576 93 547 64 512 64ZM544 384C544 402 530 416 512 416H64C46 416 32 402 32 384V128C32 110 46 96 64 96H512C530 96 544 110 544 128V384Z",classes:["fa-light"]}]},"fa/light/image":{viewbox:"0 0 512 512",paths:[{d:"M325 158C314 140 285 141 274 158L200 268L184 246C173 230 146 230 134 246L70 335C63 344 62 357 67 367C73 378 83 384 95 384H417C429 384 439 378 444 368C450 358 449 346 443 336L325 158ZM96 352L158 265L188 306C191 310 196 313 201 313C207 312 212 310 214 305L298 175L415 352H96ZM448 32H64C29 32 0 61 0 96V416C0 451 29 480 64 480H448C483 480 512 451 512 416V96C512 61 483 32 448 32ZM480 416C480 434 466 448 448 448H64C46 448 32 434 32 416V96C32 78 46 64 64 64H448C466 64 480 78 480 96V416ZM144 192C170 192 192 170 192 144S170 96 144 96S96 118 96 144S118 192 144 192ZM144 128C153 128 160 135 160 144S153 160 144 160S128 153 128 144S135 128 144 128Z",classes:["fa-light"]}]},"fa/light/lock-keyhole":{viewbox:"0 0 512 512",paths:[{d:"M416 224H384V128C384 57 327 0 256 0S128 57 128 128V224H96C61 224 32 253 32 288V448C32 483 61 512 96 512H416C451 512 480 483 480 448V288C480 253 451 224 416 224ZM160 128C160 75 203 32 256 32S352 75 352 128V224H160V128ZM448 448C448 466 434 480 416 480H96C78 480 64 466 64 448V288C64 270 78 256 96 256H416C434 256 448 270 448 288V448ZM256 320C247 320 240 327 240 336V400C240 409 247 416 256 416S272 409 272 400V336C272 327 265 320 256 320Z",classes:["fa-light"]}]},"fa/light/message":{viewbox:"0 0 512 512",paths:[{d:"M448 0H64C29 0 0 29 0 64V352C0 387 29 416 64 416H160V500C160 510 171 515 179 510L304 416H448C483 416 512 387 512 352V64C512 29 483 0 448 0ZM480 352C480 370 466 384 448 384H304C297 384 290 386 285 390L192 460V400C192 391 185 384 176 384H64C46 384 32 370 32 352V64C32 46 46 32 64 32H448C466 32 480 46 480 64V352Z",classes:["fa-light"]}]},"fa/light/palette":{viewbox:"0 0 512 512",paths:[{d:"M112 264C99 264 88 275 88 288S99 312 112 312C125 312 136 301 136 288S125 264 112 264ZM144 152C131 152 120 163 120 176S131 200 144 200S168 189 168 176S157 152 144 152ZM256 0C239 0 222 2 204 5C105 24 25 104 5 203C-29 378 116 512 239 512C248 512 256 511 264 510C305 504 325 455 306 418C283 373 316 320 367 320H447C483 320 512 290 512 255C511 114 397 0 256 0ZM447 288H367C332 288 300 306 282 336C263 366 262 402 278 433C283 443 283 455 278 464C275 469 270 477 259 479C253 480 246 480 239 480C185 480 125 449 84 398C40 345 23 278 37 210C54 123 124 54 210 37C226 34 241 32 256 32C379 32 480 132 480 255C480 273 465 288 447 288ZM368 136C355 136 344 147 344 160S355 184 368 184S392 173 392 160S381 136 368 136ZM240 88C227 88 216 99 216 112S227 136 240 136C253 136 264 125 264 112S253 88 240 88Z",classes:["fa-light"]}]},"fa/light/save":{viewbox:"0 0 448 512",paths:[{d:"M434 130L350 46C341 37 329 32 316 32H64C29 32 0 61 0 96V416C0 451 29 480 64 480H384C419 480 448 451 448 416V164C448 151 443 139 434 130ZM96 64H288V160H96V64ZM416 416C416 434 402 448 384 448H64C46 448 32 434 32 416V80C32 71 39 64 48 64H64V160C64 178 78 192 96 192H288C306 192 320 178 320 160V65C322 64 321 64 322 64L411 153C414 155 416 160 416 164V416ZM224 240C180 240 144 276 144 320S180 400 224 400S304 364 304 320S268 240 224 240ZM224 368C198 368 176 346 176 320S198 272 224 272S272 294 272 320S250 368 224 368Z",classes:["fa-light"]}]},"fa/light/snowflake":{viewbox:"0 0 512 512",paths:[{d:"M478 384C475 389 470 392 464 392C461 392 459 391 456 390L392 353L406 403C408 412 403 421 394 423C393 423 392 423 390 423C383 423 377 419 375 412L353 331L272 284V377L331 437C338 443 338 453 331 459C328 462 324 464 320 464S312 462 309 459L272 423V496C272 505 265 512 256 512S240 505 240 496V423L203 459C197 466 187 466 181 459S174 443 181 437L240 377V284L159 331L137 412C135 419 129 423 122 423C120 423 119 423 118 423C109 421 104 412 106 403L120 353L56 390C54 391 51 392 48 392C42 392 37 389 34 384C30 376 32 367 40 362L104 325L53 312C45 310 40 301 42 292S53 279 62 281L143 303L224 256L143 209L62 231C60 231 59 231 58 231C51 231 44 227 42 220C40 211 45 202 53 200L104 187L40 150C32 145 30 136 34 128C39 120 48 118 56 122L120 159L106 109C104 100 109 91 118 89C126 87 135 92 137 100L159 181L240 228V135L181 75C174 69 174 59 181 53S197 46 203 53L240 89V16C240 7 247 0 256 0S272 7 272 16V89L309 53C315 46 325 46 331 53S338 69 331 75L272 135V228L353 181L375 100C377 92 386 87 395 89C403 91 408 100 406 109L392 159L456 122C464 118 473 120 478 128C482 136 480 145 472 150L408 187L459 200C467 202 472 211 470 220C468 227 462 231 454 231C453 231 452 231 450 231L369 209L288 256L369 303L450 281C459 279 468 284 470 292C472 301 467 310 459 312L408 325L472 362C480 367 482 376 478 384Z",classes:["fa-light"]}]},"fa/light/table-columns":{viewbox:"0 0 576 512",paths:[{d:"M480 32H96C61 32 32 61 32 96V416C32 451 61 480 96 480H480C515 480 544 451 544 416V96C544 61 515 32 480 32ZM272 448H96C78 448 64 434 64 416V192H272V448ZM512 416C512 434 498 448 480 448H304V192H512V416ZM512 160H64V96C64 78 78 64 96 64H480C498 64 512 78 512 96V160Z",classes:["fa-light"]}]},"bootstrap/arrows-collapse":{viewbox:"0 0 16 16",paths:[{d:"M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zm7-8a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 4.293V.5A.5.5 0 0 1 8 0zm-.5 11.707l-1.146 1.147a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 11.707V15.5a.5.5 0 0 1-1 0v-3.793z",classes:["bootstrap"]}]},"bootstrap/chat-left":{viewbox:"0 0 16 16",paths:[{d:"M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z",classes:["bootstrap"]}]},"bootstrap/text-center":{viewbox:"0 0 16 16",paths:[{d:"M4 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z",classes:["bootstrap"]}]},"bootstrap/text-left":{viewbox:"0 0 16 16",paths:[{d:"M2 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z",classes:["bootstrap"]}]},"bootstrap/text-right":{viewbox:"0 0 16 16",paths:[{d:"M6 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm4-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z",classes:["bootstrap"]}]},"extra/border-double-bottom":{viewbox:"0 0 448 512",paths:[{d:"M224 88C237 88 248 77 248 64C248 51 237 40 224 40S200 51 200 64C200 77 211 88 224 88ZM224 184C237 184 248 173 248 160C248 147 237 136 224 136S200 147 200 160C200 173 211 184 224 184ZM320 88C333 88 344 77 344 64C344 51 333 40 320 40S296 51 296 64C296 77 307 88 320 88ZM416 376C429 376 440 365 440 352C440 339 429 328 416 328S392 339 392 352C392 365 403 376 416 376ZM320 280C333 280 344 269 344 256C344 243 333 232 320 232S296 243 296 256C296 269 307 280 320 280ZM416 88C429 88 440 77 440 64C440 51 429 40 416 40S392 51 392 64C392 77 403 88 416 88ZM416 280C429 280 440 269 440 256C440 243 429 232 416 232S392 243 392 256C392 269 403 280 416 280ZM416 184C429 184 440 173 440 160C440 147 429 136 416 136S392 147 392 160C392 173 403 184 416 184ZM32 376C45 376 56 365 56 352C56 339 45 328 32 328S8 339 8 352C8 365 19 376 32 376ZM32 88C45 88 56 77 56 64C56 51 45 40 32 40S8 51 8 64C8 77 19 88 32 88ZM32 280C45 280 56 269 56 256C56 243 45 232 32 232S8 243 8 256C8 269 19 280 32 280ZM32 184C45 184 56 173 56 160C56 147 45 136 32 136S8 147 8 160C8 173 19 184 32 184ZM432 448H16C7 448 0 455 0 464S7 480 16 480H432C441 480 448 473 448 464S441 448 432 448ZM128 280C141 280 152 269 152 256C152 243 141 232 128 232S104 243 104 256C104 269 115 280 128 280ZM224 376C237 376 248 365 248 352C248 339 237 328 224 328S200 339 200 352C200 365 211 376 224 376ZM224 280C237 280 248 269 248 256C248 243 237 232 224 232S200 243 200 256C200 269 211 280 224 280ZM128 88C141 88 152 77 152 64C152 51 141 40 128 40S104 51 104 64C104 77 115 88 128 88Z",classes:["extra"]}]},"extra/border-double-bottom2":{viewbox:"0 0 448 512",paths:[{d:"M432,477H16c-9,0-16,7-16,16s7,16,16,16h416c9,0,16-7,16-16S441,477,432,477z",classes:["extra"]},{d:"M128,36c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S141,36,128,36z",classes:["extra"]},{d:"M128,228c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S141,228,128,228z",classes:["extra"]},{d:"M224,324c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S237,324,224,324z",classes:["extra"]},{d:"M32,228c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S45,228,32,228z",classes:["extra"]},{d:"M224,228c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S237,228,224,228z",classes:["extra"]},{d:"M32,132c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S45,132,32,132z",classes:["extra"]},{d:"M32,36C19,36,8,47,8,60s11,24,24,24s24-11,24-24S45,36,32,36z",classes:["extra"]},{d:"M32,324c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S45,324,32,324z",classes:["extra"]},{d:"M416,132c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S429,132,416,132z",classes:["extra"]},{d:"M224,132c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S237,132,224,132z",classes:["extra"]},{d:"M416,324c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S429,324,416,324z",classes:["extra"]},{d:"M416,36c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S429,36,416,36z",classes:["extra"]},{d:"M416,228c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S429,228,416,228z",classes:["extra"]},{d:"M224,36c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S237,36,224,36z",classes:["extra"]},{d:"M320,36c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S333,36,320,36z",classes:["extra"]},{d:"M320,228c-13,0-24,11-24,24s11,24,24,24s24-11,24-24S333,228,320,228z",classes:["extra"]},{d:"M432,409H16c-9,0-16,7-16,16s7,16,16,16h416c9,0,16-7,16-16S441,409,432,409z",classes:["extra"]}]},"extra/wrap":{viewbox:"0 0 16 16",paths:[{d:"M4,5h8c0.276,0,0.5-0.224,0.5-0.5S12.276,4,12,4H4C3.724,4,3.5,4.224,3.5,4.5S3.724,5,4,5z",classes:["extra"]},{d:"M10,8H4C3.724,8,3.5,8.224,3.5,8.5S3.724,9,4,9h6c0.828,0,1.5,0.672,1.5,1.5S10.828,12,10,12v-1.203l-2.953,1.707 L10,14.203V13c1.381,0,2.5-1.119,2.5-2.5S11.381,8,10,8z",classes:["extra"]},{d:"M3.75,12.5c0,0.276,0.224,0.5,0.5,0.5H6v-1H4.25C3.974,12,3.75,12.224,3.75,12.5z",classes:["extra"]}]}},Qr={"column-chart":{paths:[{d:"M6,19 L6,10"},{d:"M10,19 L10,13"},{d:"M14,19 L14,5"},{d:"M18,19 L18,9"}]},"donut-chart":{paths:[{d:"M12,4 A8,8,0,0,1,17.65685,6.34315"},{d:"M19.72741,9.92945 A8,8,75,0,1,12,20"},{d:"M8,18.9282 A8,8,75,0,1,8,5.0718"}]},"bar-chart":{paths:[{d:"M5,6 L14,6"},{d:"M5,10 L11,10"},{d:"M5,14 L19,14"},{d:"M5,18 L15,18"}]},"line-chart":{paths:[{d:"M5,15 L9,11 L13,15 L19,9"}]}},eo=r(7835),to=(Ne()(eo.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),eo.Z.locals,function(e){function r(t,r,i){var n,a,l,c,u=e.call(this)||this;u.number_formats=[],u.date_formats=[],u.colors=[],u.background_color={text:"yellow"},u.foreground_color={text:"blue"},u.border_color=void 0,u.theme_color_map=[];try{for(var h=s([0,128,192,212,256]),p=h.next();!p.done;p=h.next()){var m=p.value;u.colors.push("rgb("+m+", "+m+", "+m+")")}}catch(e){n={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}try{for(var v=s(["red","orange","yellow","green","blue","indigo","violet"]),y=v.next();!y.done;y=v.next()){var _=y.value;u.colors.push(_)}}catch(e){l={error:e}}finally{try{y&&!y.done&&(c=v.return)&&c.call(v)}finally{if(l)throw l.error}}u.model=ie(Jr||(Jr=d(["<div id='root' class='treb-toolbar'><div class='group narrow'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li></ul></div></div><div class='group narrow'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li></ul></div></div>","<div class='group wide'>","","","</div><div class='group wide'>","","","</div><div class='group'><button id='wrap' data-command='wrap' title='Wrap text'>","</button><button id='merge' data-command='merge' title='Merge cells'>","","</button>","<button id='comment' class='drop-button' title='Comment'>","</button><div class='drop-menu' tabindex='-1'><div class='comment-editor'><div class='label' id='comment-label'></div><textarea id='comment-text' class='comment-textarea'></textarea><div class='comment-buttons'><button data-command='clear-comment'>Clear</button><button id='update-comment' data-command='update-comment'>Save</button></div></div></div></div><div class='group'><button class='color-button' data-command='background-color' title='Background color'>","<div id='background-color-bar' class='color-bar' ></div></button><button class='drop'></button><div class='drop-menu color-chooser' data-target='background' tabindex='-1'></div></div><div class='group'><button class='color-button' data-command='foreground-color' title='Text color'>","<div id='foreground-color-bar' class='color-bar' ></div></button><button class='drop'></button><div class='drop-menu color-chooser' data-target='foreground' tabindex='-1'></div></div><div class='group'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><hr/><li><button id='border-color' class='color-button drop-button' data-position='horizontal' title='Border color'>","<div id='border-color-bar' class='color-bar'></div></button><div class='drop-menu color-chooser' data-target='border' tabindex='-1'></div></li></ul></div></div>\x3c!-- merge was here --\x3e<div class='group'><button id='layout' class='drop-button' title='Rows/columns'>","</button><div class='drop-menu' tabindex='-1'><ul><li><button class='text' data-command='insert-row'>Insert row</button></li><li><button class='text' data-command='insert-column'>Insert column</button></li><li><button class='text' data-command='delete-row'>Delete row</button></li><li><button class='text' data-command='delete-column'>Delete column</button></li></ul>","</div></div><div class='group'>","\x3c!-- lock was here --\x3e</div><div class='group'><div class='container'><input value='General' id='number-format-input'></div><button class='drop'></button><div class='drop-menu scroll' tabindex='-1' data-number-formats></div></div><div class='split-button'><button data-command='decrease-decimal' title='Decrease precision'><div>0","0</div></button><button data-command='increase-decimal' title='Increase precision'><div>0","00</div></button></div><div class='group'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li><li>","</li><hr/><li>","</li></ul></div></div>","<div class='staging'><div id='color-chooser' class='color-chooser-main'><div class='color-header'>Theme colors</div><div id='theme-color-list' class='color-list'></div><div class='color-header other-colors'>Other colors</div><div id='color-list' class='color-list'></div><div class='new-color'><input id='color-input' placeholder='New Color'><button id='color-button'>","</button></div></div></div></div>"],["<div id='root' class='treb-toolbar'><div class='group narrow'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li></ul></div></div><div class='group narrow'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li></ul></div></div>","<div class='group wide'>","","","</div><div class='group wide'>","","","</div><div class='group'><button id='wrap' data-command='wrap' title='Wrap text'>","</button><button id='merge' data-command='merge' title='Merge cells'>","","</button>","<button id='comment' class='drop-button' title='Comment'>","</button><div class='drop-menu' tabindex='-1'><div class='comment-editor'><div class='label' id='comment-label'></div><textarea id='comment-text' class='comment-textarea'></textarea><div class='comment-buttons'><button data-command='clear-comment'>Clear</button><button id='update-comment' data-command='update-comment'>Save</button></div></div></div></div><div class='group'><button class='color-button' data-command='background-color' title='Background color'>","<div id='background-color-bar' class='color-bar' ></div></button><button class='drop'></button><div class='drop-menu color-chooser' data-target='background' tabindex='-1'></div></div><div class='group'><button class='color-button' data-command='foreground-color' title='Text color'>","<div id='foreground-color-bar' class='color-bar' ></div></button><button class='drop'></button><div class='drop-menu color-chooser' data-target='foreground' tabindex='-1'></div></div><div class='group'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><li>","</li><hr/><li><button id='border-color' class='color-button drop-button' data-position='horizontal' title='Border color'>","<div id='border-color-bar' class='color-bar'></div></button><div class='drop-menu color-chooser' data-target='border' tabindex='-1'></div></li></ul></div></div>\x3c!-- merge was here --\x3e<div class='group'><button id='layout' class='drop-button' title='Rows/columns'>","</button><div class='drop-menu' tabindex='-1'><ul><li><button class='text' data-command='insert-row'>Insert row</button></li><li><button class='text' data-command='insert-column'>Insert column</button></li><li><button class='text' data-command='delete-row'>Delete row</button></li><li><button class='text' data-command='delete-column'>Delete column</button></li></ul>","</div></div><div class='group'>","\x3c!-- lock was here --\x3e</div><div class='group'><div class='container'><input value='General' id='number-format-input'></div><button class='drop'></button><div class='drop-menu scroll' tabindex='-1' data-number-formats></div></div><div class='split-button'><button data-command='decrease-decimal' title='Decrease precision'><div>0","0</div></button><button data-command='increase-decimal' title='Increase precision'><div>0","00</div></button></div><div class='group'>","<button class='drop'></button><div class='drop-menu' tabindex='-1'><ul><li>","</li><li>","</li><li>","</li><li>","</li><hr/><li>","</li></ul></div></div>","<div class='staging'><div id='color-chooser' class='color-chooser-main'><div class='color-header'>Theme colors</div><div id='theme-color-list' class='color-list'></div><div class='color-header other-colors'>Other colors</div><div id='color-list' class='color-list'></div><div class='new-color'><input id='color-input' placeholder='New Color'><button id='color-button'>","</button></div></div></div></div>"])),u.IconButton("bootstrap/text-left","text-align","align-left","Align left"),u.IconButton("bootstrap/text-left","align-left-drop","align-left","Align left","text-align"),u.IconButton("bootstrap/text-center","align-center-drop","align-center","Align center","text-align"),u.IconButton("bootstrap/text-right","align-right-drop","align-right","Align right","text-align"),u.IconButton("fa/light/arrow-up-to-line","vertical-align","align-top","Align top"),u.IconButton("fa/light/arrow-up-to-line","align-top-drop","align-top","Align top","vertical-align"),u.IconButton("bootstrap/arrows-collapse","align-middle-drop","align-middle","Align middle","vertical-align"),u.IconButton("fa/light/arrow-down-to-line","align-bottom-drop","align-bottom","Align bottom","vertical-align"),r.file_menu?"<div class='group wide'><button title='File options' class='drop-button'>"+u.Icon("fa/light/save")+"</button><div class='drop-menu' tabindex='-1'><ul><li><button class='text' data-command='reset'>New Document</button></li><hr/><li><button class='text' data-command='import-desktop'>Import file</button></li><li><button class='text' data-command='save-json'>Save as JSON</button></li><li><button class='text' data-command='export-xlsx'>Export XLSX</button></li></ul></div></div>":"",u.IconButton("bootstrap/text-left","align-left",!0,"Align left"),u.IconButton("bootstrap/text-center","align-center",!0,"Align center"),u.IconButton("bootstrap/text-right","align-right",!0,"Align right"),u.IconButton("fa/light/arrow-up-to-line","align-top",!0,"Align top"),u.IconButton("bootstrap/arrows-collapse","align-middle",!0,"Align middle"),u.IconButton("fa/light/arrow-down-to-line","align-bottom",!0,"Align bottom"),u.Icon("extra/wrap"),u.Icon("fa/light/expand","active-icon"),u.Icon("fa/light/compress","inactive-icon"),u.IconButton("fa/light/lock-keyhole","lock"),u.Icon("fa/light/message"),u.Icon("fa/light/fill-drip"),u.Icon("fa/light/font"),u.IconButton("fa/light/border-bottom","update-border","border-bottom","Bottom border"),u.IconButton("fa/light/border-top","border-top",!0,"Top border","update-border"),u.IconButton("fa/light/border-left","border-left",!0,"Left border","update-border"),u.IconButton("fa/light/border-right","border-right",!0,"Right border","update-border"),u.IconButton("fa/light/border-bottom","border-bottom",!0,"Bottom border","update-border"),u.IconButton("extra/border-double-bottom2","border-double-bottom",!0,"Double bottom border","update-border"),u.IconButton("fa/light/border-all","border-all",!0,"All borders","update-border"),u.IconButton("fa/light/border-outer","border-outside",!0,"Outside borders","update-border"),u.IconButton("fa/light/border-none","border-none",!0,"Clear borders","update-border"),u.Icon("fa/light/palette"),u.Icon("fa/light/table-columns"),r.add_tab?"<ul><hr/><li><button class='text' data-command='insert-sheet'>Insert sheet</button></li><li><button class='text' data-command='delete-sheet'>Delete sheet</button></li></ul>":"",u.IconButton("fa/light/snowflake","freeze"),M.decimal_separator,M.decimal_separator,u.IconButton("column-chart","insert-annotation","column-chart","Insert column chart"),u.IconButton("column-chart","column-chart",!0,"Insert column chart","insert-annotation"),u.IconButton("donut-chart","donut-chart",!0,"Insert donut chart","insert-annotation"),u.IconButton("bar-chart","bar-chart",!0,"Insert bar chart","insert-annotation"),u.IconButton("line-chart","line-chart",!0,"Insert line chart","insert-annotation"),u.IconButton("fa/light/image","insert-image",!0,"Insert image","insert-annotation"),r.toolbar_recalculate_button?"<div class='group end-group'><button data-command='recalculate' title='Recalculate'>"+u.Icon("fa/light/arrows-rotate")+"</button></div>":"",u.Icon("fa/light/check")),u.model["background-color-bar"].style.color="yellow",u.model["foreground-color-bar"].style.color="blue",u.model["border-color-bar"].style.color="#333";var g=u.model["color-button"],b=u.model["color-input"];u.UpdateTheme(i),g.addEventListener("click",(function(){u.CommitColor({text:b.value||""})})),b.addEventListener("keydown",(function(e){"Enter"===e.key&&u.CommitColor({text:b.value||""})})),b.addEventListener("input",(function(){g.style.backgroundColor="";var e=b.value||"";g.style.backgroundColor=e;var t=$.MeasureColor(e),r=D.RGBToHSL(t[0],t[1],t[2]);g.style.color=r.l>.5?"":"#fff"})),u.model["comment-text"].addEventListener("keydown",(function(e){if("Enter"===e.key&&e.ctrlKey)return e.stopPropagation(),e.preventDefault(),void u.model["update-comment"].click()}));var w="",x=u.model["number-format-input"];return x.addEventListener("focus",(function(){return w=x.value||""})),x.addEventListener("keydown",(function(e){switch(e.key){case"Enter":u.Publish({type:"format",format:x.value||""});break;case"Escape":x.value=w,u.Publish({type:"cancel"});break;default:return}e.stopPropagation(),e.preventDefault()})),u.model.root.addEventListener("click",(function(e){var t,r,i,n,a,s,l,c,d,h,p,m=e.target,v=null===(t=null==m?void 0:m.dataset)||void 0===t?void 0:t.command;if(v){var y={};if(/^border-/.test(v))y.border=v,y.color=u.border_color,v="border";else switch(v){case"clear-comment":case"update-comment":(null===(r=u.state)||void 0===r?void 0:r.selection)&&!u.state.selection.empty&&(y.address=o({},u.state.selection.target)),y.comment=u.model["comment-text"].value||"";break;case"background-color":y.target="background",y.color=u.background_color;break;case"foreground-color":y.target="foreground",y.color=u.foreground_color;break;case"border-color":y.target="border",y.color=u.border_color}u.Publish({type:"button",command:v,data:y})}else if((null===(i=null==m?void 0:m.classList)||void 0===i?void 0:i.contains("drop"))||(null===(n=null==m?void 0:m.classList)||void 0===n?void 0:n.contains("drop-button"))){for(var _=m.parentElement;_&&!_.classList.contains("group");){if(_===u.model.root)return;_=_.parentElement}if(_){var w=void 0,x=m.nextSibling;(null===(a=null==x?void 0:x.classList)||void 0===a?void 0:a.contains("drop-menu"))&&(m===u.model.comment&&(u.model["comment-label"].textContent=(null===(l=null===(s=u.state)||void 0===s?void 0:s.selection)||void 0===l?void 0:l.target)?f.CellAddressToLabel(null===(c=u.state)||void 0===c?void 0:c.selection.target):"",u.model["comment-text"].value=(null===(d=u.state)||void 0===d?void 0:d.comment)||"",w=u.model["comment-text"]),void 0!==x.dataset.numberFormats&&u.RenderNumberFormats(x),x.classList.contains("color-chooser")&&(u.color_target=(null===(h=x.dataset)||void 0===h?void 0:h.target)||"",u.RenderColors(u.model["color-list"]),b.value="",g.style.backgroundColor="",g.style.color="",x.appendChild(u.model["color-chooser"])),"horizontal"===(null===(p=m.dataset)||void 0===p?void 0:p.position)?u.Focus(x,m.offsetWidth+12,m.offsetTop-8,w):u.Focus(x,0,m.offsetHeight+4,w))}}})),/narrow/i.test((r.toolbar||"").toString())&&u.model.root.classList.add("narrow"),t.appendChild(u.model.root),u}return t(r,e),r.prototype.ResolveColor=function(e,t){return e||(e=t),e.text?e.text:"number"==typeof e.theme&&this.theme_color_map[e.theme]||""},r.prototype.CommitColor=function(e){switch(this.color_target){case"background":this.model["background-color-bar"].style.color=this.ResolveColor(e,{theme:0}),this.background_color=e?o({},e):void 0;break;case"border":this.model["border-color-bar"].style.color=this.ResolveColor(e,{theme:1}),this.border_color=e?o({},e):void 0;break;case"foreground":e||(e={theme:1}),this.model["foreground-color-bar"].style.color=this.ResolveColor(e,{theme:1}),this.foreground_color=e?o({},e):void 0}this.Publish({type:"button",command:"color",data:{color:e?o({},e):void 0,target:this.color_target||""}})},r.prototype.Focus=function(e,t,r,o){var i=this;e.style.left=t+"px",e.style.top=r+"px",e.classList.add("visible");var n=function(e){"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),i.Publish({type:"cancel"}))};window.addEventListener("keydown",n);var a=function(e){var t,r,o,n,a,s,l,c,d=e.target;if(null===(t=d.dataset)||void 0===t?void 0:t.replace){var u=i.model[d.dataset.replace];u.innerHTML=d.innerHTML,u.setAttribute("title",d.getAttribute("title")||""),u.dataset.command=d.dataset.command||void 0}if("number-format"===(null===(r=d.dataset)||void 0===r?void 0:r.command)){var h=d.textContent||"General";i.model["number-format-input"].value=d.textContent||"",i.Publish({type:"format",format:h})}else{if((null===(o=d.dataset)||void 0===o?void 0:o.command)||(null===(n=d.classList)||void 0===n?void 0:n.contains("drop-button")))return;if(null===(a=d.classList)||void 0===a?void 0:a.contains("color-swatch"))if(void 0!==(null===(s=null==d?void 0:d.dataset)||void 0===s?void 0:s.theme)){var f=Number(null===(l=null==d?void 0:d.dataset)||void 0===l?void 0:l.theme);isNaN(f)&&(f=0),i.CommitColor({theme:f||0})}else{var p=(null===(c=null==d?void 0:d.dataset)||void 0===c?void 0:c.color)||"";i.CommitColor(p?{text:p}:void 0)}}e.stopPropagation()};e.addEventListener("click",a);var s=function(t){var r=t.relatedTarget;r&&e.contains(r)||(e.classList.remove("visible"),e.removeEventListener("focusout",s),e.removeEventListener("click",a),window.removeEventListener("keydown",n))};e.addEventListener("focusout",s),requestAnimationFrame((function(){return(o||e).focus()}))},r.prototype.UpdateState=function(e){var t,r,o,i,n,a,s,l,c=this;this.state=e;var d={"align-center":e.style&&(null===(t=e.style)||void 0===t?void 0:t.horizontal_align)===R.HorizontalAlign.Center,"align-left":e.style&&(null===(r=e.style)||void 0===r?void 0:r.horizontal_align)===R.HorizontalAlign.Left,"align-right":e.style&&(null===(o=e.style)||void 0===o?void 0:o.horizontal_align)===R.HorizontalAlign.Right,"align-top":e.style&&(null===(i=e.style)||void 0===i?void 0:i.vertical_align)===R.VerticalAlign.Top,"align-middle":e.style&&(null===(n=e.style)||void 0===n?void 0:n.vertical_align)===R.VerticalAlign.Middle,"align-bottom":e.style&&(null===(a=e.style)||void 0===a?void 0:a.vertical_align)===R.VerticalAlign.Bottom,wrap:e.style&&!!e.style.wrap,comment:!!e.comment},u=this.model.freeze;e.frozen?(u.classList.add("active"),u.setAttribute("title","Unfreeze panes")):(u.classList.remove("active"),u.setAttribute("title","Freeze panes")),(null===(s=e.style)||void 0===s?void 0:s.locked)?(this.model.lock.classList.add("active"),this.model.lock.setAttribute("title","Unlock cells")):(this.model.lock.classList.remove("active"),this.model.lock.setAttribute("title","Lock cells"));var h=this.model.merge;e.merge?(h.classList.add("active"),h.dataset.command="unmerge",h.setAttribute("title","Unmerge cells")):(h.classList.remove("active"),h.dataset.command="merge",h.setAttribute("title","Merge cells"));var f=(null===(l=e.style)||void 0===l?void 0:l.number_format)||"";this.model["number-format-input"].value=ue.SymbolicName(f)||f,Object.keys(d).forEach((function(e){var t,r;d[e]?null===(t=c.model[e])||void 0===t||t.classList.add("active"):null===(r=c.model[e])||void 0===r||r.classList.remove("active")}))},r.prototype.UpdateTheme=function(e){var t=this.model["theme-color-list"],r=[],o=["Background","Text","Background","Text","Accent","Accent","Accent","Accent","Accent","Accent"],i=0;if(this.theme_color_map=[],e.theme_colors){for(r.push("<div class='color-list-row'>"),i=0;i<10;i++){var n=e.theme_colors[i]||"#000";r.push("<button class='color-swatch' data-theme="+i+" title='"+o[i]+": "+n+"' ></button>"),this.theme_color_map[i]=n}r.push("</div>")}if(t.innerHTML=r.join(""),e.theme_colors)for(var a=t.querySelectorAll("button.color-swatch"),s=0;s<a.length;s++)a[s].style.background=e.theme_colors[s]},r.prototype.RenderColors=function(e){for(var t=["<div class='color-list-row'>","<button class='color-swatch default-color' data-color='' title='Default color'></button>"],r=0;r<9&&r<this.colors.length;r++){var o=this.colors[r];t.push("<button class='color-swatch' data-color='"+o+"' title='"+o+"' ></button>")}for(t.push("</div>");r<this.colors.length;){t.push("<div class='color-list-row'>");for(var i=r+10;r<this.colors.length&&r<i;r++)o=this.colors[r],t.push("<button class='color-swatch' data-color='"+o+"' title='"+o+"' ></button>");t.push("</div>")}e.innerHTML=t.join("");for(var n=e.querySelectorAll("button.color-swatch"),a=0;a<n.length;a++){var s=n[a];s.style.background=s.dataset.color||""}},r.prototype.RenderNumberFormats=function(e){e.innerHTML="<ul>"+this.number_formats.map((function(e){return oe(qr||(qr=d(["<li><button data-command='number-format' class='text'>","</button></li>"],["<li><button data-command='number-format' class='text'>","</button></li>"])),e)})).join("\n")+"</ul><hr/><ul>"+this.date_formats.map((function(e){return oe(Wr||(Wr=d(["<li><button data-command='number-format' class='text'>","</button></li>"],["<li><button data-command='number-format' class='text'>","</button></li>"])),e)})).join("\n")+"</ul>"},r.prototype.UpdateDocumentStyles=function(e,t,r){var o,i,n,a,l=["General","Number","Integer","Percent","Fraction","Accounting","Currency","Scientific"],c=["Timestamp","Long Date","Short Date"];try{for(var d=s(e),u=d.next();!u.done;u=d.next()){var h=u.value;ue.SymbolicName(ue.Translate(h))||(ue.Get(h).date_format?c.push(h):l.push(h))}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}this.number_formats=l,this.date_formats=c;var f=this.colors.map((function(e){return $.MeasureColor(e)})),p=function(e){var t=$.MeasureColor(e);f.some((function(e){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}))||(m.colors.push(e),f.push(t))},m=this;try{for(var v=s(t),y=v.next();!y.done;y=v.next())p(y.value)}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}},r.prototype.IconButton=function(e,t,r,o,i){return void 0===r&&(r=!0),t&&!0===r&&(r=t),"<button"+(t?" id='"+t+"'":"")+(i?" data-replace='"+i+"'":"")+(r?" data-command='"+r+"'":"")+(o?" title='"+o+"'":"")+">"+this.Icon(e)+"</button>"},r.prototype.Icon=function(e,t){void 0===t&&(t="");var r=$r[e],o="",i="";return r||(r=Qr[e],o="symbol"),(t||o)&&(i=" class='"+o+" "+t+"'"),r?"<svg"+i+" viewBox='"+(r.viewbox||"0 0 24 24")+"'>"+(r.paths||[]).map((function(e){var t=" ";return Array.isArray(e.classes)?t+=e.classes.join(" "):e.classes&&(t+=e.classes),"<path d='"+e.d+"' class='"+t.trim()+"'/>"})).join("")+"</svg>":(console.warn(e),"")},r}(X)),ro=function(){function e(e,t,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=100),void 0===o&&(o=100),this.left=e,this.top=t,this.right=r,this.bottom=o}return Object.defineProperty(e.prototype,"width",{get:function(){return this.right-this.left},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.bottom-this.top},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},enumerable:!1,configurable:!0}),e}();!function(e){e[e.horizontal=0]="horizontal",e[e.vertical=1]="vertical"}(Kr||(Kr={})),function(e){e[e.top=0]="top",e[e.bottom=1]="bottom",e[e.left=2]="left",e[e.right=3]="right"}(Xr||(Xr={})),function(e){e[e.line=0]="line",e[e.marker=1]="marker"}(Yr||(Yr={}));var oo="http://www.w3.org/2000/svg",io=/trident/i.test((null===navigator||void 0===navigator?void 0:navigator.userAgent)||""),no=function(e,t,r){var o,i;void 0===t&&(t={});var n=document.createElementNS(oo,e);try{for(var a=s(Object.keys(t)),l=a.next();!l.done;l=a.next()){var c=l.value;if(void 0!==t[c]){var d=t[c];n.setAttribute(c,Array.isArray(d)?d.join(" "):d.toString())}}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return r&&(n.textContent=r),n},ao=function(){function e(){this.size={width:0,height:0},this.bounds=new ro,this.container_group=no("g"),this.group=no("g"),this.axis_group=no("g",{class:"axis-group"}),this.label_group=no("g",{class:"label-group"}),this.container_group.appendChild(this.axis_group),this.container_group.appendChild(this.group),this.container_group.appendChild(this.label_group)}return e.prototype.Initialize=function(e){this.parent=e,this.svg_node=no("svg",{class:"treb-chart"}),this.svg_node.style.overflow="hidden",this.svg_node.style.position="relative",this.svg_node.style.width="100%",this.svg_node.style.height="100%",this.svg_node.appendChild(this.container_group),this.parent.appendChild(this.svg_node),this.Resize()},e.prototype.Legend=function(e){var t=no("g");this.group.appendChild(t);var r=no("text");t.appendChild(r),t.setAttribute("class","legend");var o=[[]],i=e.area.width,n=0,a=0,s=e.area.width,l=e.style===Yr.marker?14:26,c=e.labels.map((function(t,c){r.textContent=t;var d=r.getBoundingClientRect(),u={width:d.width,height:d.height},h=u.width+l+10;return a=Math.max(a,u.height),e.layout===Kr.vertical?o[c]=[c]:h>i?0===o[n].length?(o[n].push(c),n++,o[n]=[],i=s):(n++,o[n]=[c],i=s-h):(o[n].push(c),i-=h),u}));t.removeChild(r);var d=a,u=e.layout||Kr.horizontal;u===Kr.horizontal&&o.every((function(e){return e.length<=1}))&&(u=Kr.horizontal);for(var h=0;h<o.length;h++){for(var f=o[h].reduce((function(e,t){return e+c[t].width+l}),10*(o[h].length-1)),p=0,m=u===Kr.horizontal?Math.round((s-f)/2):Math.round(5),v=0;v<o[h].length;v++){var y=o[h][v],_=c[y],g=e.labels[y],b=d-1;t.appendChild(no("text",{"dominant-baseline":"middle",x:m+l,y:d,dy:io?".3em":void 0},g)),e.style===Yr.marker?t.appendChild(no("rect",{class:"series-"+(y+1),x:m,y:b-4,width:8,height:8})):t.appendChild(no("rect",{class:"series-"+(y+1),x:m,y:b-1,width:l-3,height:2})),p=Math.max(p,_.height),m+=_.width+l+10}d=Math.round(d+1.1*p)}var w=t.getBoundingClientRect(),x=w.width,C=w.height+a;switch(e.position){case Xr.bottom:t.setAttribute("transform","translate("+e.area.left+", "+(e.area.bottom-C)+")");break;case Xr.left:t.setAttribute("transform","translate("+e.area.left+", "+e.area.top+")");break;case Xr.right:t.setAttribute("transform","translate("+(e.area.right-x)+", "+e.area.top+")");break;case Xr.top:default:t.setAttribute("transform","translate("+e.area.left+", "+e.area.top+")")}e.position===Xr.top?e.area.top+=C||0:e.position===Xr.right?e.area.right-=(x||0)+8:e.position===Xr.left?e.area.left+=(x||0)+8:e.area.bottom-=C||0},e.prototype.Clear=function(){this.group.textContent="",this.axis_group.textContent="",this.label_group.textContent=""},e.prototype.Resize=function(){var e=this.parent.getBoundingClientRect();this.svg_node.setAttribute("width",e.width.toString()),this.svg_node.setAttribute("height",e.height.toString()),this.size={width:e.width,height:e.height}},e.prototype.Prerender=function(){var e=this.svg_node.getBoundingClientRect();this.bounds.top=e.top,this.bounds.left=e.left,this.bounds.right=e.right,this.bounds.bottom=e.bottom},e.prototype.RenderTitle=function(e,t,r,o){var i=no("text",{class:"chart-title",x:Math.round(t.width/2)},e);i.style.textAnchor="middle",this.group.appendChild(i);var n=i.getBoundingClientRect();switch(o){case"bottom":i.setAttribute("y",Math.round(t.bottom-n.height).toString()),t.bottom-=n.height+r;break;default:i.setAttribute("y",Math.round(t.top+r+n.height).toString()),t.top+=n.height+r}},e.prototype.MeasureText=function(e,t,r){void 0===r&&(r=!1),this.text_measurement_node||(this.text_measurement_node=no("text",{x:"-100px",y:"-100px"}),this.svg_node.appendChild(this.text_measurement_node)),void 0!==t?("string"==typeof t&&(t=[t]),this.text_measurement_node.setAttribute("class",t.join(" "))):this.text_measurement_node.setAttribute("class",""),this.text_measurement_node.textContent=e;var o=this.text_measurement_node.getBoundingClientRect(),i={width:o.width,height:o.height,y_offset:o.height-(this.bounds.top-o.top-100)};return r&&(i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),i.y_offset=Math.ceil(i.y_offset)),i},e.prototype.RenderTicks=function(e,t,r,o,i){for(var n=[],a=e.width/o,s=0;s<o;s++){var l=Math.round(e.left+a/2+a*s)-.5;n.push("M"+l+" "+t+" L"+l+" "+r)}this.group.appendChild(no("path",{d:n,class:i}))},e.prototype.RenderXAxisBar=function(e,t,r,o,i){var n=r.length;if(n){for(var a=t?e.width/n:e.width/(n-1),s=t?a/2:0,l=1,c=!0;c;){c=!1;for(var d=0,u=0;u<n;u+=l){var h=Math.round(e.left+s+a*u),f=h-o[u].width/2;if(d&&f<=d){l++,c=!0;break}d=h+o[u].width/2+4}}for(u=0;u<n;u+=l){var p=Math.round(e.left+s+a*u);this.RenderText(this.axis_group,r[u],"center",{x:p,y:e.bottom},i)}}},e.prototype.RenderXAxis=function(e,t,r,o,i){var n=r.length;if(n){for(var a=t?e.width/n:e.width/(n-1),s=t?a/2:0,l=1,c=!0,d=(r.length-1)%2==0,u=(r.length-1)%3==0;c;){c=!1;for(var h=0,f=0;f<n;f+=l){var p=Math.round(e.left+s+a*f),m=p-o[f].width/2;if(h&&m<=h){l++,c=!0;break}h=p+o[f].width/2+4}}for(3===l&&!u&&d&&l++,f=0;f<n;f+=l){var v=Math.round(e.left+s+a*f);this.RenderText(this.axis_group,r[f],"center",{x:v,y:e.bottom},i)}}},e.prototype.RenderYAxisBar=function(e,t,r,o){(r=r.slice(0)).reverse();var i=r.length;if(i){for(var n=e.height/i,a=1,s=!0;s;){s=!1;for(var l=0,c=0;c<i;c+=a){var d=r[c],u=Math.round(e.bottom-n*(c+.5)+d.metrics.height/4);if(l&&u>=l){a++,s=!0;break}l=u-d.metrics.height}}for(c=0;c<i;c+=a)d=r[c],u=Math.round(e.bottom-n*(c+.5)+d.metrics.height/4),this.RenderText(this.axis_group,d.label,"right",{x:t,y:u},o)}},e.prototype.RenderYAxis=function(e,t,r,o){var i=r.length;if(i){for(var n=e.height/(i-1),a=1,s=!0;s;){s=!1;for(var l=0,c=0;c<i;c+=a){var d=r[c],u=Math.round(e.bottom-n*c+d.metrics.height/4);if(l&&u>=l){a++,s=!0;break}l=u-d.metrics.height}}for(c=0;c<i;c+=a)d=r[c],u=Math.round(e.bottom-n*c+d.metrics.height/4),this.RenderText(this.axis_group,d.label,"right",{x:t,y:u},o)}},e.prototype.LineProperties=function(e,t){var r=t.x-e.x,o=t.y-e.y;return{length:Math.sqrt(r*r+o*o),angle:Math.atan2(o,r)}},e.prototype.RenderSmoothLine=function(e,t,r,o,i){var n,a,l,c,d=this;void 0===r&&(r=!1);var u=no("g"),h=[],f=[],p=t.length,m=p-1,v=e.width/p/2,y=[],_=t.map((function(t,r){if(void 0!==t)return{x:Math.round(e.left+e.width/m*r),y:e.bottom-t}})),g=[],b=function(){if(!(g.length<2)){var t="",o=g[0],i=g[g.length-1];2===g.length?t=g[0].x+","+g[0].y+" L"+g[1].x+","+g[1].y:g.length>2&&(t=""+d.CatmullRomChain(g).map((function(e){return e.x+","+e.y})).join(" L")),t&&(h.push("M"+t),r&&(f.push("M "+o.x+","+e.bottom+" L "+o.x+","+o.y),f.push("L"+t),f.push("L "+i.x+","+e.bottom)))}};try{for(var w=s(_),x=w.next();!x.done;x=w.next()){var C=x.value;C?g.push(C):(b(),g=[])}}catch(e){n={error:e}}finally{try{x&&!x.done&&(a=w.return)&&a.call(w)}finally{if(n)throw n.error}}if(g.length&&b(),r&&u.appendChild(no("path",{class:"fill",d:f})),u.appendChild(no("path",{class:"line",d:h})),void 0!==i&&("string"==typeof i&&(i=[i]),u.setAttribute("class",i.join(" "))),this.group.appendChild(u),o&&y.length){var S=document.createElementNS(oo,"g"),A=function(e){var t=no("circle",{cx:e.x,cy:e.y,r:v});t.addEventListener("mouseenter",(function(t){d.parent.setAttribute("title",o[e.i]||"")})),t.addEventListener("mouseleave",(function(e){d.parent.setAttribute("title","")})),S.appendChild(t)};try{for(var k=s(y),M=k.next();!M.done;M=k.next())A(M.value)}catch(e){l={error:e}}finally{try{M&&!M.done&&(c=k.return)&&c.call(k)}finally{if(l)throw l.error}}S.setAttribute("class","mouse-layer"),this.group.appendChild(S)}},e.prototype.RenderLine=function(e,t,r,o,i){var n,a,l=this;void 0===r&&(r=!1);for(var c,d=document.createElementNS(oo,"g"),u=[],h=[],f=t.length,p=f-1,m=e.width/f/2,v=[],y=0,_=!0;y<f;y++){var g=t[y];if(void 0!==g){var b=Math.round(+e.left+e.width/p*y);_?(r&&h.push("M"+b+" "+e.bottom+" L"+b+" "+(e.bottom-g)),u.push("M"+b+" "+(e.bottom-g))):(u.push("L"+b+" "+(e.bottom-g)),h.push("L"+b+" "+(e.bottom-g))),v.push({x:b,y:e.bottom-g,i:y}),c=b,_=!1}else _=!0,r&&void 0!==c&&h.push("L"+c+" "+e.bottom+"Z"),c=void 0}if(r&&void 0!==c&&h.push("L"+c+" "+e.bottom+"Z"),r&&d.appendChild(no("path",{class:"fill",d:h})),d.appendChild(no("path",{class:"line",d:u})),void 0!==i&&("string"==typeof i&&(i=[i]),d.setAttribute("class",i.join(" "))),this.group.appendChild(d),o&&v.length){var w=document.createElementNS(oo,"g"),x=function(e){var t=no("circle",{cx:e.x,cy:e.y,r:m});t.addEventListener("mouseenter",(function(t){l.parent.setAttribute("title",o[e.i]||"")})),t.addEventListener("mouseleave",(function(e){l.parent.setAttribute("title","")})),w.appendChild(t)};try{for(var C=s(v),S=C.next();!S.done;S=C.next())x(S.value)}catch(e){n={error:e}}finally{try{S&&!S.done&&(a=C.return)&&a.call(C)}finally{if(n)throw n.error}}w.setAttribute("class","mouse-layer"),this.group.appendChild(w)}},e.prototype.RenderBarGrid=function(e,t,r){for(var o=[],i=e.width/t,n=0;n<=t;n++){var a=Math.round(e.left+i*n)-.5;o.push("M"+a+" "+e.top+" L"+a+" "+e.bottom)}this.group.appendChild(no("path",{d:o,class:r}))},e.prototype.RenderGrid=function(e,t,r,o){void 0===r&&(r=0);for(var i=[],n=e.height/t,a=0;a<=t;a++){var s=Math.round(e.top+n*a)-.5;i.push("M"+e.left+" "+s+" L"+e.right+" "+s)}for(n=e.width/(r-1),a=0;a<r;a++){var l=Math.round(e.left+n*a)-.5;i.push("M"+l+" "+e.top+" L"+l+" "+e.bottom)}this.group.appendChild(no("path",{d:i,class:o}))},e.prototype.MultiplyPoint=function(e,t){return{x:e.x*t,y:e.y*t}},e.prototype.AddPoints=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},e.prototype.CatmullRomSpline=function(e,t){for(var r=function(e,t,r){var o=t.x,i=t.y,n=r.x,a=r.y;return Math.pow(Math.pow(n-o,2)+Math.pow(a-i,2),.25)+e},o=r(0,e[0],e[1]),i=r(o,e[1],e[2]),n=r(i,e[2],e[3]),a=(i-o)/t,s=[],l=0;l<t;l++){var c=o+a*l,d=this.AddPoints(this.MultiplyPoint(e[0],(o-c)/(o-0)),this.MultiplyPoint(e[1],(c-0)/(o-0))),u=this.AddPoints(this.MultiplyPoint(e[1],(i-c)/(i-o)),this.MultiplyPoint(e[2],(c-o)/(i-o))),h=this.AddPoints(this.MultiplyPoint(e[2],(n-c)/(n-i)),this.MultiplyPoint(e[3],(c-i)/(n-i))),f=this.AddPoints(this.MultiplyPoint(d,(i-c)/(i-0)),this.MultiplyPoint(u,(c-0)/(i-0))),p=this.AddPoints(this.MultiplyPoint(u,(n-c)/(n-o)),this.MultiplyPoint(h,(c-o)/(n-o))),m=this.AddPoints(this.MultiplyPoint(f,(i-c)/(i-o)),this.MultiplyPoint(p,(c-o)/(i-o)));s.push(m)}return s},e.prototype.CatmullRomChain=function(e,t){void 0===t&&(t=30);var r=e.slice(0),o=[],i=r.length;if(i){var n=r[i-1].x-r[i-2].x,a=r[i-1].y-r[i-2].y;r.push({x:r[i-1].x+n,y:r[i-1].y+a}),r.push({x:r[i-1].x+n,y:r[i-1].y+a}),n=r[1].x-r[0].x,a=r[1].y-r[0].y,r.unshift({x:r[0].x-n,y:r[0].y-a});for(var s=0;s<r.length-4;s++){var d=r.slice(s,s+4),u=this.CatmullRomSpline(d,t);o.push.apply(o,c([],l(u)))}}return o},e.prototype.RenderDataLabels=function(e,t,r,o,i,n,a){for(var s=Math.max(t.length,r.length),l=o.max-o.min||1,c=i.max-i.min||1,d=0;d<s;d++){var u=t[d],h=r[d];if(void 0!==u&&void 0!==h){var f={x:e.left+(u-o.min)/l*e.width,y:e.bottom-(h-i.min)/c*e.height},p=n[d];if(p){this.label_group.appendChild(no("circle",{class:"label-target",cx:f.x,cy:f.y,r:10}));var m=no("g",{class:"data-label",transform:"translate("+(f.x+10)+","+f.y+")"});this.label_group.appendChild(m);var v=no("circle",{cx:-10,y:0,r:5,class:"marker-highlight series-"+a});m.appendChild(v);var y=no("text",{x:4,y:0},p);m.appendChild(y);var _=y.getBoundingClientRect(),g=_.height,b=_.width+8;b+15+f.x>=e.right&&(m.setAttribute("transform","translate("+(f.x-b-15)+","+f.y+")"),v.setAttribute("cx",(b+15).toString()));var w=no("path",{d:"M0,5 h"+b+" v-"+g+" h-"+b+" Z"});m.insertBefore(w,y)}}}},e.prototype.RenderScatterSeries=function(e,t,r,o,i,n,a,l,c,d){var u,h,f,p,m=this;void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===c&&(c=!1);var v=Math.max(t.length,r.length),y=o.max-o.min||1,_=i.max-i.min||1,g=[],b=[],w=[],x=no("g",{class:d});this.group.appendChild(x);for(var C=0;C<v;C++){var S=t[C],A=r[C];void 0===S||void 0===A?g.push(void 0):g.push({x:e.left+(S-o.min)/y*e.width,y:e.bottom-(A-i.min)/_*e.height})}if(n){var k=[],M=c?function(){return 2===k.length?k[0].x+","+k[0].y+" L"+k[1].x+","+k[1].y:k.length>2?m.CatmullRomChain(k).map((function(e){return e.x+","+e.y})).join(" L"):""}:function(){return k.map((function(e){return e.x+","+e.y})).join(" L")};try{for(var R=s(g),T=R.next();!T.done;T=R.next())if(D=T.value)k.push(D);else{if(k.length>=2){var L=M();b.push("M"+L),w.push("M"+k[0].x+","+e.bottom+"L"+L+"L"+k[k.length-1].x+","+e.bottom+"Z")}k=[]}}catch(e){u={error:e}}finally{try{T&&!T.done&&(h=R.return)&&h.call(R)}finally{if(u)throw u.error}}k.length>=2&&(L=M(),b.push("M"+L),w.push("M"+k[0].x+","+e.bottom+"L"+L+"L"+k[k.length-1].x+","+e.bottom+"Z"))}if(a&&x.appendChild(no("path",{d:w,class:"fill"})),n&&x.appendChild(no("path",{d:b,class:"line"})),l)try{for(var E=s(g),z=E.next();!z.done;z=E.next()){var D;(D=z.value)&&x.appendChild(no("circle",{cx:D.x,cy:D.y,r:3,class:"marker"}))}}catch(e){f={error:e}}finally{try{z&&!z.done&&(p=E.return)&&p.call(E)}finally{if(f)throw f.error}}},e.prototype.RenderPoints=function(e,t,r,o){for(var i=[],n=0;n<t.length;n++){var a=t[n]*e.width+e.left,s=e.bottom-r[n]*e.height;i.push("M"+(a-1)+","+(s-1)+" L"+(a+1)+","+(s+1)),i.push("M"+(a-1)+","+(s+1)+" L"+(a+1)+","+(s-1))}this.group.appendChild(no("path",{d:i,class:o}))},e.prototype.RenderPoint=function(e,t,r){this.group.appendChild(no("circle",{cx:e,cy:t,r:1,class:r}))},e.prototype.RenderRectangle=function(e,t,r,o,i,n){var a=this,s="";if(t)if(t[0]&&t[0]===t[1]&&t[0]>=e.height){var l=t[0],c=t[0]-e.height,d=Math.sqrt(l*l-c*c);s="M"+(e.left+e.width/2-d)+","+e.bottom+" a"+l+","+l+" 0 0 1 "+2*d+",0 z"}else t[1]&&t[1]===t[2]&&t[1]>=e.width?(l=t[1],c=t[1]-e.width,d=Math.sqrt(l*l-c*c),s="M"+e.left+","+(e.top+e.height/2-d)+" a"+l+","+l+" 0 0 1 0,"+2*d+" z"):s="M"+e.left+","+(e.top+t[0])+" a"+t[0]+","+t[0]+" 0 0 1 "+t[0]+","+-t[0]+" h"+(e.width-t[0]-t[1])+" a"+t[1]+","+t[1]+" 0 0 1 "+t[1]+","+t[1]+" v"+(e.height-t[1]-t[2])+" a"+t[2]+","+t[2]+" 0 0 1 "+-t[2]+","+t[2]+" h"+(-e.width+t[2]+t[3])+" a"+t[3]+","+t[3]+" 0 0 1 "+-t[3]+","+-t[3]+" v"+(-e.height+t[3]+t[0])+" ";else s="M"+e.left+","+e.top+" h"+e.width+" v"+e.height+" h"+-e.width+" v"+-e.height+" ";var u=no("path",{d:s,class:r});if(o&&(u.addEventListener("mouseenter",(function(e){a.parent.setAttribute("title",o)})),u.addEventListener("mouseleave",(function(e){a.parent.setAttribute("title","")}))),this.group.appendChild(u),i){this.label_group.appendChild(no("path",{class:"label-target",d:s}));var h=n||{x:Math.round(e.left+e.width/2),y:Math.round(e.top-10)},f=no("g",{class:"data-label",transform:"translate("+h.x+","+h.y+")"});this.label_group.appendChild(f);var p=no("text",{x:0,y:0},i);f.appendChild(p);var m=p.getBoundingClientRect(),v=m.height,y=m.width+8;h.y-m.height<4&&(h.y-=h.y-m.height-4,f.setAttribute("transform","translate("+h.x+","+h.y+")")),p.setAttribute("x",Math.floor(-m.width/2).toString());var _=Math.ceil(.125*v),g=no("rect",{rx:3,x:-y/2,y:Math.round(2*_/3-v),width:y,height:v+_});f.insertBefore(g,p)}},e.prototype.RenderText=function(e,t,r,o,i){var n=no("text",{x:o.x,y:o.y,class:i},t);switch(r){case"right":n.style.textAnchor="end";break;case"center":n.style.textAnchor="middle";break;default:n.style.textAnchor="start"}(e||this.group).appendChild(n)},e.prototype.RenderDonut=function(e,t,r,o,i,n,a){var c,d,u=-Math.PI/2,h=0;n&&(r*=.8,o*=.7);var f=function(e,t,r){return[Math.cos(r)*t+e.x,Math.sin(r)*t+e.y]},p=function(e){var n,c,d=e.title||"",p=e.percent,v=e.index,y=[],_=0,g=f.bind(0,t,r),b=f.bind(0,t,o);if(p>.5){_=u+p/2*Math.PI*2,h=u+p*Math.PI*2;var w=_-u,x=h-_;y.push("M"+g(u),"A"+r+","+r+","+w+",0,1,"+g(_),"A"+r+","+r+","+x+",0,1,"+g(h),"L"+b(h),"A"+o+","+o+","+x+",0,0,"+b(_),"A"+o+","+o+","+w+",0,0,"+b(u),"Z")}else{_=((h=u+p*Math.PI*2)-u)/2+u;var C=h-u;y.push("M"+g(u),"A"+r+","+r+","+C+",0,1,"+g(h),"L"+b(h),"A"+o+","+o+","+C+",0,0,"+b(u),"Z")}var S=no("path",{d:y,class:void 0===v?void 0:"series-"+v}),A=no("g",{class:a});if(A.appendChild(S),m.group.appendChild(A),p>=.05&&d){y=[];var k=f(t,o+(r-o)/2+(r-o),_);y.push("M"+f(t,o+(r-o)/2,_)),y.push("L"+k),A.appendChild(no("path",{d:y,class:"callout"}));var M=[],R=no("text",{class:"callout-label"});A.appendChild(R);var T=_+Math.PI/2,L=d;R.textContent=L;var E=R.getBoundingClientRect(),z={width:E.width,height:E.height},D=l(k,2),P=D[0],N=D[1];P+=z.height/2*Math.cos(_),N+=z.height/4+z.height/2*Math.sin(_);var F=!1;T>Math.PI?P-z.width<=i.left&&(F=!0):P+z.width>i.right&&(F=!0);var I=/[\s-\W]/;if(F&&I.test(L)){for(var U=-1,O=1,V=0;V<L.length;V++)if(I.test(L[V])){var H=Math.abs(.5-V/L.length);H<O&&(O=H,U=V)}U>0&&(M.push(L.substr(0,U+1).trim()),M.push(L.substr(U+1).trim()))}if(M.length){var j=0,G=0,B=M.map((function(e){R.textContent=e;var t={width:(E=R.getBoundingClientRect()).width,height:E.height};return G=Math.max(G,t.width),{text:e,metrics:t}}));R.textContent="";try{for(var Z=(n=void 0,s(B)),J=Z.next();!J.done;J=Z.next()){var q=J.value,W=document.createElementNS(oo,"tspan");W.textContent=q.text;var K=T>Math.PI?P-(G-q.metrics.width)/2:P+(G-q.metrics.width)/2;W.setAttribute("x",K.toString()),W.setAttribute("dy",j.toString()),R.appendChild(W),j=q.metrics.height}}catch(e){n={error:e}}finally{try{J&&!J.done&&(c=Z.return)&&c.call(Z)}finally{if(n)throw n.error}}}var X=T>Math.PI?"end":"start";R.setAttribute("text-anchor",X),R.setAttribute("x",P.toString()),R.setAttribute("y",N.toString())}u=h},m=this;try{for(var v=s(e),y=v.next();!y.done;y=v.next())p(y.value)}catch(e){c={error:e}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(c)throw c.error}}},e}(),so=function(){function e(){}return e.Scale=function(e,t,r){return void 0===r&&(r=6.5),ee(e,t,r)},e.Range=function(e){var t,r,o,i;try{for(var n=s(e),a=n.next();!a.done;a=n.next()){var l=a.value;void 0!==l&&((void 0===o||o>l)&&(o=l),(void 0===i||i<l)&&(i=l))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return{min:o,max:i,range:void 0===o||void 0===i?0:i-o}},e.ApplyScale=function(e,t,r){return t*(e-r.min)/(r.max-r.min)},e.Flatten=function(e){var t,r,o=[];if(Array.isArray(e))try{for(var i=s(e),n=i.next();!n.done;n=i.next()){var a=n.value;Array.isArray(a)?o=o.concat(this.Flatten(a)):o.push(a)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else void 0!==e&&o.push(e);return o},e}();r(7485);var lo,co="#,##0.00",uo=function(){function e(e){void 0===e&&(e=new ao),this.renderer=e,this.chart_data={type:"null"},this.margin={top:.025,left:.05,bottom:.025,right:.075}}return e.prototype.Initialize=function(e){this.renderer.Initialize(e)},e.prototype.Exec=function(e,t){switch(void 0===t&&(t=[]),e.toLowerCase()){case"mc.histogram":this.CreateHistogram(t);break;case"mc.correlation":this.CreateScatter(t);break;case"column.chart":this.CreateColumnChart(t,"column");break;case"bar.chart":this.CreateColumnChart(t,"bar");break;case"line.chart":this.CreateLineChart(t,"line");break;case"area.chart":this.CreateLineChart(t,"area");break;case"donut.chart":case"pie.chart":this.CreateDonut(t,"pie.chart"===e.toLowerCase());break;case"scatter.plot":this.CreateScatterChart(t,"plot");break;case"scatter.line":this.CreateScatterChart(t,"line");break;default:this.Clear()}},e.prototype.Clear=function(){this.chart_data={type:"null"}},e.prototype.CreateColumnChart=function(e,t){var r,o,i,n=Array.isArray(e[0])?this.TransformSeriesData(e[0]):[],a=this.CommonData(n);if(e[1]){i=so.Flatten(e[1]).map((function(e){return e?e.type===u.object&&"metadata"===e.value.type?"number"==typeof e.value.value?ue.Get(e.value.format||co).Format(e.value.value):e.value.value:"number"==typeof e.value?ue.Get(e.format||co).Format(e.value):e.value:""}));var s=n.reduce((function(e,t){return Math.max(e,t.y.data.length)}),0);for(s<i.length&&(i=i.slice(0,s));s>i.length;)i.push("")}var l=(null===(r=e[2])||void 0===r?void 0:r.toString())||void 0,c=(null===(o=e[3])||void 0===o?void 0:o.toString())||void 0;if(this.chart_data={type:t,legend:a.legend,legend_style:Yr.marker,series2:n,scale:a.y.scale,title:l,y_labels:"bar"===t?i:a.y.labels,x_labels:"bar"===t?a.y.labels:i},c){this.chart_data.round=/round/i.test(c),this.chart_data.data_labels=/labels/i.test(c);var d=c.match(/labels="(.*?)"/);d&&n&&this.ApplyLabels(n,d[1],i)}},e.prototype.ReadSeries=function(e){var t,r,o,i,n,a,l={x:{data:[]},y:{data:[]}};if(e[0]&&("object"==typeof(c=so.Flatten(e[0]))[0]?l.label=(null===(i=null===(o=c[0])||void 0===o?void 0:o.value)||void 0===i?void 0:i.toString())||"":l.label=c[0].toString()),e[2]&&Array.isArray(e[2])){var c=so.Flatten(e[2]);if(l.y.data=c.map((function(e){return"number"==typeof e.value.value?e.value.value:void 0})),null===(n=c[0].value)||void 0===n?void 0:n.format){l.y.format=null===(a=c[0].value)||void 0===a?void 0:a.format;var d=ue.Get(l.y.format);l.y.labels=l.y.data.map((function(e){return void 0===e?void 0:d.Format(e)}))}}e[1]&&Array.isArray(e[1])&&(c=so.Flatten(e[1]),l.x.data=c.map((function(e){return"number"==typeof e.value.value?e.value.value:void 0})),c[0].value.format&&(l.x.format=c[0].value.format));try{for(var u=s([l.x,l.y]),h=u.next();!h.done;h=u.next()){var f=h.value;if(f.data.length){var p=f.data.filter((function(e){return e||0===e}));f.range={min:Math.min.apply(0,p),max:Math.max.apply(0,p)}}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return l},e.prototype.ArrayToSeries=function(e){var t={x:{data:[]},y:{data:[]}},r=so.Flatten(e);if(t.y.data=r.map((function(e){return"number"==typeof e.value.value?e.value.value:void 0})),r[0].value.format){t.y.format=r[0].value.format||"";var o=ue.Get(t.y.format||"");t.y.labels=t.y.data.map((function(e){return void 0===e?void 0:o.Format(e)}))}var i=t.y.data.filter((function(e){return e||0===e}));return t.y.range={min:Math.min.apply(0,i),max:Math.max.apply(0,i)},t},e.prototype.TransformSeriesData=function(e,t){var r,o,i,n,a,l,c,d=[];if(Array.isArray(e)){var h=e;if("group"===h._type)try{for(var f=s(h),p=f.next();!p.done;p=f.next()){var m=p.value;if(Array.isArray(m))if("series"===m._type){var v=this.ReadSeries(m);d.push(v)}else v=this.ArrayToSeries(m),d.push(v)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}else"series"===h._type?(v=this.ReadSeries(h),d.push(v)):d.push(this.ArrayToSeries(h))}var y=0;if(t&&Array.isArray(t)){var _="0.00###";(t=so.Flatten(t))[0]&&g(t[0])&&(_=t[0].value.format);var b=t.map((function(e){return e.type===u.number?e.value:g(e)?e.value.value:void 0})),w=b.filter((function(e){return"number"==typeof e}));c={data:b,format:_,range:{min:Math.min.apply(0,w),max:Math.max.apply(0,w)}}}try{for(var x=s(d),C=x.next();!C.done;C=x.next())m=C.value,y=Math.max(y,m.y.data.length),m.x.data.length&&(c||(c=m.x))}catch(e){i={error:e}}finally{try{C&&!C.done&&(n=x.return)&&n.call(x)}finally{if(i)throw i.error}}if(!c){c={data:[],range:{min:0,max:Math.max(0,y-1)}};for(var S=0;S<y;S++)c.data.push(S)}try{for(var A=s(d),k=A.next();!k.done;k=A.next())(m=k.value).x.data.length||(m.x=c)}catch(e){a={error:e}}finally{try{k&&!k.done&&(l=A.return)&&l.call(A)}finally{if(a)throw a.error}}return d},e.prototype.CommonData=function(e,t,r){var o,i,n,a="",l="";try{for(var c=s(e),d=c.next();!d.done;d=c.next()){var u=d.value;u.y.format&&!l&&(l=u.y.format),u.x.format&&!a&&(a=u.x.format)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}e.some((function(e){return e.label&&e.label.length>0}))&&(n=e.map((function(e,t){return e.label||"Series "+(t+1)})));var h=e.filter((function(e){return e.x.range})),f=Math.min.apply(0,h.map((function(e){var t;return(null===(t=e.x.range)||void 0===t?void 0:t.min)||0}))),p=Math.max.apply(0,h.map((function(e){var t;return(null===(t=e.x.range)||void 0===t?void 0:t.max)||0}))),m=(e.filter((function(e){return e.y.range})),Math.min.apply(0,h.map((function(e){var t;return(null===(t=e.y.range)||void 0===t?void 0:t.min)||0})))),v=Math.max.apply(0,h.map((function(e){var t;return(null===(t=e.y.range)||void 0===t?void 0:t.max)||0})));void 0!==t&&(m=Math.min(m,t)),void 0!==r&&(v=Math.max(v,r));var y,_,g=so.Scale(f,p,7),b=so.Scale(m,v,7);if(a){y=[];for(var w=ue.Get(a),x=0;x<=g.count;x++)y.push(w.Format(g.min+x*g.step))}if(l)for(_=[],w=ue.Get(l),x=0;x<=b.count;x++)_.push(w.Format(b.min+x*b.step));return{x:{format:a,scale:g,labels:y},y:{format:l,scale:b,labels:_},legend:n}},e.prototype.CreateScatterChart=function(e,t){var r,o;void 0===t&&(t="plot");var i=Array.isArray(e[0])?this.TransformSeriesData(e[0]):[],n=this.CommonData(i),a=(null===(r=e[1])||void 0===r?void 0:r.toString())||void 0,s=(null===(o=e[2])||void 0===o?void 0:o.toString())||void 0;if(this.chart_data={legend:n.legend,style:t,type:"scatter2",series:i,title:a,x_scale:n.x.scale,x_labels:n.x.labels,y_scale:n.y.scale,y_labels:n.y.labels,lines:!0},s){this.chart_data.markers=/marker/i.test(s),this.chart_data.smooth=/smooth/i.test(s),this.chart_data.data_labels=/labels/i.test(s);var l=s.match(/labels="(.*?)"/);l&&this.chart_data.series&&this.ApplyLabels(this.chart_data.series,l[1])}},e.prototype.ApplyLabels=function(e,t,r){var o,i;try{for(var n=s(e),a=n.next();!a.done;a=n.next()){var l=a.value,c={x:ue.Get(l.x.format||""),y:ue.Get(l.y.format||"")};l.y.labels=[];for(var d=0;d<l.y.data.length;d++){var u=r?r[d]:"number"==typeof l.x.data[d]?c.x.Format(l.x.data[d]):"",h="number"==typeof l.y.data[d]?c.y.Format(l.y.data[d]):"";l.y.labels[d]=t.replace(/\bx\b/g,u).replace(/\by\b/g,h)}}}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}},e.prototype.CreateLineChart=function(e,t){var r,o,i=Array.isArray(e[0])?this.TransformSeriesData(e[0],e[1]):[],n=this.CommonData(i,0,0),a=(null===(r=e[2])||void 0===r?void 0:r.toString())||void 0,s=(null===(o=e[3])||void 0===o?void 0:o.toString())||void 0;this.chart_data={legend:n.legend,type:"scatter2",series:i,title:a,x_scale:n.x.scale,x_labels:n.x.labels,y_scale:n.y.scale,y_labels:n.y.labels,lines:!0,filled:"area"===t},s&&(this.chart_data.smooth=/smooth/i.test(s))},e.prototype.CreateDonut=function(e,t){var r,o,i,n;void 0===t&&(t=!1);var a=e[0],l=so.Flatten(a),c=l.map((function(e){return"number"==typeof e.value.value?e.value.value:void 0})),d=so.Flatten(e[1]).map((function(e){var t,r,o;if(e&&"object"==typeof e){var i=null===(t=e.value)||void 0===t?void 0:t.value;return"number"==typeof i&&(null===(r=e.value)||void 0===r?void 0:r.format)?ue.Get(null===(o=e.value)||void 0===o?void 0:o.format).Format(i):i?i.toString():""}return e?e.toString():""}));c=c.map((function(e){return e<0?(console.warn("pie/donut chart does not support negative values (omitted)"),0):e}));var u=e[2]||"",h=0,f=c.map((function(e,t){return void 0!==e&&(h+=e),{value:e,label:d[t]||"",index:t+1,percent:0}}));if(h)try{for(var p=s(f),m=p.next();!m.done;m=p.next())(x=m.value).percent=(x.value||0)/h}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}var v=l.length&&l[0].format?l[0].format:"",y=ue.Get(v||co),_=ue.Get("percent");void 0===e[4]&&e[1]&&(e[4]="label");var g=e[4]||"";if(g)try{for(var b=s(f),w=b.next();!w.done;w=b.next()){var x=w.value,C=y.Format(x.value||0),S=_.Format(x.percent);x.title=g.replace(/value%/gi,_.Format(x.value||0)).replace(/value/gi,C).replace(/percent/gi,S).replace(/label/gi,x.label||"").trim()}}catch(e){i={error:e}}finally{try{w&&!w.done&&(n=b.return)&&n.call(b)}finally{if(i)throw i.error}}var A=(e[3]||"").toString().trim();/^(asc|inc)/i.test(A)?f.sort((function(e,t){return(e.value||0)-(t.value||0)})):/^(desc|dec)/i.test(A)&&f.sort((function(e,t){return(t.value||0)-(e.value||0)})),this.chart_data={type:t?"pie":"donut",slices:f,title:u}},e.prototype.CreateScatter=function(e){var t=[e[0],e[1]];if(!t[0]||t[0].type!==u.object||!this.IsCellData(t[0].value))return console.warn("invalid args [0]",e),void this.Clear();if(!t[1]||t[1].type!==u.object||!this.IsCellData(t[1].value))return console.warn("invalid args [1]",e),void this.Clear();var r=e[2]||"",o=t[0].value,i=t[1].value,n=(o.simulation_data||[]).slice(0),a=(i.simulation_data||[]).slice(0),s=Math.min.apply(0,n),l=Math.max.apply(0,n)-s;n=n.map((function(e){return(e-s)/l}));var c=Math.min.apply(0,a),d=Math.max.apply(0,a)-c;a=a.map((function(e){return(e-c)/d}));var h=Math.min(n.length,a.length);this.chart_data={type:"scatter",x:n,y:a,count:h,title:r}},e.prototype.CreateHistogram=function(e){var t,r,o,i,n=[],a=[],l=Array.isArray(e[0])?e[0]:[e[0]];try{for(var c=s(l),d=c.next();!d.done;d=c.next()){var h=d.value;if(!h||h.type!==u.object||!this.IsCellData(h.value))return console.warn("invalid args [0]",e),void this.Clear();var f=h.value.simulation_data||[];f.length&&(n.push(Math.min.apply(0,f)),a.push(Math.max.apply(0,f)))}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}if(!n.length||!a.length)return console.info("no data"),void this.Clear();var p=12;"number"==typeof e[3]&&(p=e[3]);for(var m=so.Scale(Math.min.apply(0,n),Math.max.apply(0,a),p),v=[],y=0;y<=m.count;y++)v[y]=m.min+y*m.step;var _=l.map((function(e){for(var t,r,o=e.value.simulation_data||[],i=[],n=0;n<=m.count;n++)i[n]=0;try{for(var a=s(o),l=a.next();!l.done;l=a.next()){var c=l.value;i[Math.round((c-m.min)/m.step)]++}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var d=ue.Get("#,##0"),u=i.filter((function(e){return e||0===e})),h={y:{data:i,format:"#,##0",labels:i.map((function(e){return void 0===e?void 0:d.Format(e)})),range:{min:Math.min.apply(0,u),max:Math.max.apply(0,u)}},x:{data:[],range:{min:0,max:Math.max(0,i.length-1)}}};for(n=0;n<h.y.data.length;n++)h.x.data.push(n);return h})),g=this.CommonData(_),b=ue.Get((null===(o=l[0].value)||void 0===o?void 0:o.format)||"General"),w=v.map((function(e){return b.Format(e)})),x=(null===(i=e[1])||void 0===i?void 0:i.toString())||void 0;_[0].y.labels=(_[0].y.labels||[]).map((function(e,t){return w[t]+" "+e})),this.chart_data={type:"column",series2:_,scale:g.y.scale,title:x,y_labels:g.y.labels,x_labels:w,data_labels:!0}},e.prototype.Resize=function(){this.renderer.Resize()},e.prototype.Update=function(){var e,t,r,o,i,n,a=this;this.renderer.Resize(),this.renderer.Prerender(),this.renderer.Clear();var l=new ro(0,0,this.renderer.size.width,this.renderer.size.height),c={top:Math.round(l.height)*this.margin.top,bottom:Math.round(l.height)*this.margin.bottom,left:Math.round(l.width)*this.margin.left,right:Math.round(l.width)*this.margin.right},d=this.chart_data.title;if(d&&this.renderer.RenderTitle(d,l,c.top,this.chart_data.title_layout||"top"),l.top+=c.top,l.left+=c.left,l.bottom-=c.bottom,l.right-=c.right,this.chart_data.legend&&this.chart_data.legend.length){var u=Xr.top;this.chart_data.title&&(this.chart_data.title_layout&&"top"!==this.chart_data.title_layout||(u=Xr.bottom));var h=this.chart_data.legend_position||u;this.renderer.Legend({labels:this.chart_data.legend,position:h,style:this.chart_data.legend_style,layout:h===Xr.top||h===Xr.bottom?Kr.horizontal:Kr.vertical,area:l})}if("histogram"===this.chart_data.type||"line"===this.chart_data.type||"area"===this.chart_data.type||"column"===this.chart_data.type||"bar"===this.chart_data.type||"scatter2"===this.chart_data.type){var f=[],p=0;if(this.chart_data.x_labels&&this.chart_data.x_labels.length&&(f=this.chart_data.x_labels.map((function(e){var t=a.renderer.MeasureText(e,["axis-label","x-axis-label"],!0);return p=Math.max(p,t.height),t}))),this.chart_data.y_labels&&this.chart_data.y_labels.length){for(var m=[],v=0,y=0,_="scatter2"===this.chart_data.type?this.chart_data.y_scale:this.chart_data.scale,g="bar"===this.chart_data.type?this.chart_data.y_labels.length:_.count+1,b=0;b<g;b++){var w=this.renderer.MeasureText(this.chart_data.y_labels[b],["axis-label","y-axis-label"]);m.push({label:this.chart_data.y_labels[b],metrics:w}),v=Math.max(v,w.width),y=Math.max(y,w.height)}l.bottom=Math.round(l.bottom-y/2),l.top=Math.round(l.top+y/2),f.length&&(l.bottom-=p+c.bottom),"bar"===this.chart_data.type?this.renderer.RenderYAxisBar(l,l.left+v,m,["axis-label","y-axis-label"]):this.renderer.RenderYAxis(l,l.left+v,m,["axis-label","y-axis-label"]),l.left+=v+c.left}f.length&&this.chart_data.x_labels&&this.chart_data.x_labels.length&&(this.chart_data.y_labels&&(l.bottom+=p+c.bottom),this.renderer.RenderXAxis(l,"line"!==this.chart_data.type&&"area"!==this.chart_data.type&&"bar"!==this.chart_data.type&&"scatter2"!==this.chart_data.type,this.chart_data.x_labels,f,["axis-label","x-axis-label"]),l.bottom-=p+c.bottom)}switch(this.chart_data.type){case"scatter":this.renderer.RenderPoints(l,this.chart_data.x,this.chart_data.y,"mc mc-correlation series-1");break;case"scatter2":if(this.renderer.RenderGrid(l,this.chart_data.y_scale.count,this.chart_data.x_scale.count+1,"chart-grid"),this.chart_data.series){for(b=0;b<this.chart_data.series.length;b++){var x=this.chart_data.series[b];this.renderer.RenderScatterSeries(l,x.x.data,x.y.data,this.chart_data.x_scale,this.chart_data.y_scale,!!this.chart_data.lines,!!this.chart_data.filled,!!this.chart_data.markers,!!this.chart_data.smooth,"scatter-plot series-"+(b+1))}if(this.chart_data.data_labels)for(b=0;b<this.chart_data.series.length;b++)(x=this.chart_data.series[b]).y.labels&&this.renderer.RenderDataLabels(l,x.x.data,x.y.data,this.chart_data.x_scale,this.chart_data.y_scale,x.y.labels,b+1)}break;case"pie":case"donut":var C=Math.min(l.height,l.width)/2*.9,S="pie"===this.chart_data.type?0:.8*C;this.renderer.RenderDonut(this.chart_data.slices,l.center,C,S,l,!0,"donut");break;case"line":case"area":var A=this.chart_data.scale;if(this.chart_data.series){var k=this.chart_data.x_scale?this.chart_data.x_scale.max:Math.max.apply(0,this.chart_data.series.map((function(e){return e.length}))),M=this.chart_data.smooth?this.renderer.RenderSmoothLine:this.renderer.RenderLine;this.renderer.RenderGrid(l,this.chart_data.scale.count,this.chart_data.x_scale?this.chart_data.x_scale.count+1:k,"chart-grid");var R=0;try{for(var T=s(this.chart_data.series),L=T.next();!L.done;L=T.next()){if((j=(x=L.value).map((function(e){if(void 0!==e)return so.ApplyScale(e,l.height,A)}))).length<k)for(b=j.length;b<k;b++)j.push(void 0);var E=["area"===this.chart_data.type?"chart-area":"chart-line","series-"+(R+1)];M.call(this.renderer,l,j,"area"===this.chart_data.type,this.chart_data.titles,E),R++}}catch(t){e={error:t}}finally{try{L&&!L.done&&(t=T.return)&&t.call(T)}finally{if(e)throw e.error}}}break;case"bar":var z=void 0;if(this.renderer.RenderBarGrid(l,this.chart_data.scale.count,"chart-grid"),this.chart_data.series2){g=0;var D=this.chart_data.series2.length;try{for(var P=s(this.chart_data.series2),N=P.next();!N.done;N=P.next())x=N.value,g=Math.max(g,x.y.data.length)}catch(e){r={error:e}}finally{try{N&&!N.done&&(o=P.return)&&o.call(P)}finally{if(r)throw r.error}}var F=l.height/g,I=.7;"number"==typeof this.chart_data.space&&(I=Math.max(0,Math.min(1,1-this.chart_data.space)));var U=(F-2*(ee=F*(1-I)/2))/D,O=0;if(this.chart_data.scale.min<0&&(O=so.ApplyScale(0,l.width,this.chart_data.scale)),this.chart_data.round){var V=Math.floor(U/2);z=[0,V,V,0]}for(var H=0;H<D;H++)for(x=this.chart_data.series2[H],b=0;b<x.y.data.length;b++)if("number"==typeof(Y=x.y.data[b])){var j=Math.round(l.top+b*F+ee)+H*U,G=0,B=0;O?Y>0?(B=so.ApplyScale(Y+this.chart_data.scale.min,l.width,this.chart_data.scale),G=l.left+O):(B=so.ApplyScale(this.chart_data.scale.min-Y,l.width,this.chart_data.scale),G=l.left+O-B):(B=so.ApplyScale(Y,l.width,this.chart_data.scale),G=l.left);var Z=void 0;B&&this.renderer.RenderRectangle(new ro(G,j,G+B,j+U),z,["chart-column","series-"+(H+1)],Z||void 0)}}break;case"column":if(this.renderer.RenderGrid(l,this.chart_data.scale.count,0,"chart-grid"),this.chart_data.series2){g=0,D=this.chart_data.series2.length;try{for(var J=s(this.chart_data.series2),q=J.next();!q.done;q=J.next())x=q.value,g=Math.max(g,x.y.data.length)}catch(e){i={error:e}}finally{try{q&&!q.done&&(n=J.return)&&n.call(J)}finally{if(i)throw i.error}}var W=l.width/g,K=.7;if("number"==typeof this.chart_data.space&&(K=Math.max(0,Math.min(1,1-this.chart_data.space))),B=(W-2*(ee=W*(1-K)/2))/D,O=0,this.chart_data.scale.min<0&&(O=so.ApplyScale(0,l.height,this.chart_data.scale)),z=void 0,this.chart_data.round){var X=Math.floor(B/2);z=[X,X,0,0]}for(H=0;H<D;H++)for(x=this.chart_data.series2[H],b=0;b<x.y.data.length;b++){var Y;if("number"==typeof(Y=x.y.data[b])&&(G=Math.round(l.left+b*W+ee)+H*B,U=0,j=0,O?Y>0?(U=so.ApplyScale(Y+this.chart_data.scale.min,l.height,this.chart_data.scale),j=l.bottom-U-O):(U=so.ApplyScale(this.chart_data.scale.min-Y,l.height,this.chart_data.scale),j=l.bottom-O):(U=so.ApplyScale(Y,l.height,this.chart_data.scale),j=l.bottom-U),Z=void 0,U)){var $=this.chart_data.data_labels&&x.y.labels?x.y.labels[b]:"",Q={x:Math.round(G+B/2),y:Math.round(j-10)};this.renderer.RenderRectangle(new ro(G,j,G+B,j+U),z,["chart-column","series-"+(H+1)],Z||void 0,$,Q)}}}break;case"histogram":this.renderer.RenderGrid(l,this.chart_data.scale.count,0,"chart-grid");var ee=(W=l.width/this.chart_data.count)*(1-(K=this.chart_data.column_width))/2;for(b=0;b<this.chart_data.count;b++)G=Math.round(l.left+b*W+ee),B=W-2*ee,U=so.ApplyScale(this.chart_data.bins[b],l.height,this.chart_data.scale),j=l.bottom-U,Z=this.chart_data.titles?this.chart_data.titles[b]:void 0,this.renderer.RenderRectangle(new ro(G,j,G+B,j+U),void 0,"chart-column series-1",Z||void 0)}},e.prototype.IsCellData=function(e){return"object"==typeof e&&"object"==typeof e.address&&"number"==typeof e.address.row&&"number"==typeof e.address.column},e.functions_registered=!1,e}(),ho=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},fo={Group:{arguments:[{name:"Array...",metadata:!0}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e._type="group",e}},Series:{arguments:[{name:"Label"},{name:"X",metadata:!0},{name:"Y",metadata:!0}],fn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e._type="series",e}},"Bar.Chart":{arguments:[{name:"Data",metadata:!0},{name:"Categories",metadata:!0},{name:"ChartTitle"}],fn:ho},"Line.Chart":{arguments:[{name:"y",metadata:!0},{name:"x",metadata:!0},{name:"ChartTitle"}],fn:ho},"Area.Chart":{arguments:[{name:"y",metadata:!0},{name:"x",metadata:!0},{name:"ChartTitle"}],fn:ho},"Pie.Chart":{arguments:[{name:"Values",metadata:!0},{name:"Labels"},{name:"Title"},{name:"Sort"},{name:"Label"}],fn:ho},"Donut.Chart":{arguments:[{name:"Values",metadata:!0},{name:"Labels",metadata:!0},{name:"Title"},{name:"Sort"},{name:"Label"}],fn:ho},"MC.Histogram":{arguments:[{name:"Reference Cell",metadata:!0},{name:"Title"}],fn:ho},"MC.Correlation":{arguments:[{name:"Reference Cell 1",metadata:!0},{name:"Reference Cell 2",metadata:!0},{name:"Title"}],fn:ho},"Scatter.Line":{arguments:[{name:"Data",metadata:!0},{name:"ChartTitle"}],fn:ho},"Column.Chart":{arguments:[{name:"Data",metadata:!0},{name:"Categories",metadata:!0},{name:"Chart Title"}],fn:ho}},po=r(3162),mo=r(4875);Ne()(mo.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),mo.Z.locals,function(e){e[e.automatic=0]="automatic",e[e.manual=1]="manual"}(lo||(lo={}));var vo,yo=function(e){function r(t){var r=e.call(this)||this;r.loaded=!1,r.calculation=lo.automatic,r.file_version=0,r.last_save_version=0,r.registered_libraries={},r.undo_pointer=0,r.undo_stack=[],r.options=o(o({},Zr),t),r.options.complex,"string"==typeof r.options.imaginary_value&&(de.imaginary_character=r.options.imaginary_value);var i,n,a,s=r.options.network_document;r.options.storage_key&&!r.options.toll_initial_load&&((i=localStorage.getItem(r.options.storage_key)||void 0)&&(n=Hr.LOCAL_STORAGE),!i&&r.options.alternate_document&&(s=r.options.alternate_document),window.addEventListener("beforeunload",(function(){r.options.storage_key&&r.SaveLocalStorage(r.options.storage_key)}))),"string"==typeof t.container?a=document.getElementById(t.container):t.container&&(a=t.container);var l={expand:!1,insert_function_button:!1,in_cell_editor:!0,repaint_on_cell_change:!1};if(r.options.scale&&(l.initial_scale=r.options.scale),void 0!==r.options.formula_bar&&(l.formula_bar=r.options.formula_bar),r.options.expand_formula_button&&(l.expand_formula_button=r.options.expand_formula_button),r.options.scrollbars&&(l.scrollbars=r.options.scrollbars),void 0!==r.options.tab_bar&&(l.tab_bar=r.options.tab_bar),r.options.scale_control&&(l.scale_control=!0,l.tab_bar=!0,r.options.persist_scale)){!0===r.options.persist_scale?l.persist_scale_key="spreadsheet-scale":l.persist_scale_key="spreadsheet-scale-"+r.options.persist_scale;var c=localStorage.getItem(l.persist_scale_key);if(c)try{var d=JSON.parse(c);l.initial_scale=d.scale||1}catch(e){}}if(r.options.add_tab&&(l.add_tab=r.options.add_tab),r.options.delete_tab&&(l.delete_tab=r.options.add_tab),r.options.expand&&(l.expand=!0),r.grid=new ot(l),t.headless&&(r.grid.headless=!0),a){r.node=document.createElement("div"),a.appendChild(r.node),a.addEventListener("keydown",r.HandleKeyDown.bind(r));var u=!(!i&&!t.network_document);r.grid.Initialize(r.node,u),r.options.dnd&&(r.node.addEventListener("dragenter",(function(e){return r.HandleDrag(e)})),r.node.addEventListener("dragover",(function(e){return r.HandleDrag(e)})),r.node.addEventListener("drop",(function(e){return r.HandleDrop(e)}))),r.grid.grid_events.Subscribe((function(e){var t;switch(e.type){case"error":null===(t=r.dialog)||void 0===t||t.ShowDialog({type:xr.error,message:e.message,title:e.title,timeout:3e3,close_box:!0});break;case"selection":r.UpdateSelection(e.selection),r.UpdateSelectionStyle(e.selection);break;case"sheet-change":r.OnSheetChange(e),r.UpdateSelectionStyle();break;case"data":var o=r.last_selection;(r.calculation===lo.automatic?r.Recalculate(e):Promise.resolve()).then((function(){r.DocumentChange(o)}));break;case"style":r.DocumentChange(),r.UpdateDocumentStyles(!1),r.UpdateSelectionStyle();break;case"scale":r.RebuildAllAnnotations();break;case"annotation":if(e.annotation)switch(r.DocumentChange(),e.event){case"create":r.InflateAnnotation(e.annotation),r.calculator.UpdateAnnotations(e.annotation),r.grid.AnnotationUpdated(e.annotation);break;case"delete":r.calculator.RemoveAnnotation(e.annotation);break;case"update":e.annotation.update_callback?(e.annotation.update_callback(),r.grid.AnnotationUpdated(e.annotation)):console.info("annotation update event without update callback"),r.calculator.UpdateAnnotations(e.annotation);break;case"resize":e.annotation.resize_callback&&(e.annotation.resize_callback(),r.grid.AnnotationUpdated(e.annotation))}else console.info("annotation event without annotation");break;case"structure":r.DocumentChange(),e.rebuild_required&&r.calculator.Reset(),r.UpdateSelectionStyle();break;case"cell-event":r.HandleCellEvent(e)}})),r.options.prompt_save&&window.addEventListener("beforeunload",(function(e){r.last_save_version!==r.file_version&&(e.preventDefault(),e.returnValue="")}))}else console.info("not initializing grid; don't call UI functions"),r.grid.headless=!0;if(r.calculator=r.InitCalculator(),i?r.LoadDocument(JSON.parse(i),void 0,void 0,!!t.recalculate,void 0,void 0,n):s||r.calculator.RebuildClean(r.grid.model,!0),r.FlushUndo(),void 0!==t.show_headers&&r.grid.ShowHeaders(t.show_headers),r.options.scroll&&!r.options.network_document){var h=r.options.scroll;requestAnimationFrame((function(){r.ScrollTo(h)}))}return r.grid.SetAutocompleteFunctions(r.calculator.SupportedFunctions()),r.options.global_name&&(self[r.options.global_name]=r),s&&r.LoadNetworkDocument(s,r.options),a&&(r.dialog=new Gr(a)),r}return t(r,e),r.SniffPath=function(){for(var e=document.querySelectorAll("script"),t=new RegExp("embedded-treb-bundle"),r=0;r<e.length;r++){var o=e[r].src;if(o&&t.test(o))return o&&/\?.*?engine/i.test(o)&&(this.enable_engine=!0),o&&/\?.*?format/i.test(o)&&(this.enable_formatter=!0),this.treb_embedded_script_path=o,void(this.treb_base_path=o.replace(new RegExp("embedded-treb-bundle.*$"),""))}},Object.defineProperty(r.prototype,"modified",{get:function(){return 1!==this.undo_stack.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"document_name",{get:function(){return this.grid.model.document_name},set:function(e){this.grid.model.document_name=e,this.DocumentChange()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"user_data",{get:function(){return this.grid.model.user_data},set:function(e){this.grid.model.user_data=e,this.DocumentChange()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parser",{get:function(){return this.calculator.parser},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"script_path",{get:function(){var e="embedded-treb-bundle";r.treb_language&&(e+="-"+r.treb_language),/\.js$/.test(e)||(e+=".js");var t=r.treb_base_path;return t&&(/\/$/.test(t)||(t+="/"),e=t+e),e},enumerable:!1,configurable:!0}),r.prototype.HandleCellEvent=function(e){var t;if("hyperlink"===(null===(t=e.data)||void 0===t?void 0:t.type)){var r=e.data.data||"";if("string"==typeof r){if(/^https{0,1}:\/\//i.test(r)){if(!this.options.hyperlinks)return void console.warn("hyperlinks are disabled");var o=document.createElement("a");return o.setAttribute("target",this.options.hyperlinks),o.setAttribute("href",r),o.setAttribute("noreferrer","true"),o.setAttribute("nofollow","true"),void o.click()}var i=this.parser.Parse(r);if(i.expression){if("address"===i.expression.type)return(i.expression.sheet||i.expression.sheet_id)&&this.ActivateSheet(i.expression.sheet||i.expression.sheet_id),void this.Select(r);if("range"===i.expression.type)return(i.expression.start.sheet||i.expression.start.sheet_id)&&this.ActivateSheet(i.expression.start.sheet||i.expression.start.sheet_id),void this.Select(r)}return void console.warn("hyperlink invalid target",2)}}},r.prototype.Batch=function(e,t){return void 0===t&&(t=!1),n(this,void 0,void 0,(function(){var r,o,i,n,l,c,d,u,h;return a(this,(function(a){switch(a.label){case 0:r=this.last_selection,o=this.grid.Batch(e,t),i=!1,n=!1;try{for(l=s(o),c=l.next();!c.done;c=l.next())"data"===(d=c.value).type?i=!0:"structure"===d.type&&d.rebuild_required&&(n=!0)}catch(e){u={error:e}}finally{try{c&&!c.done&&(h=l.return)&&h.call(l)}finally{if(u)throw u.error}}return n&&this.calculator.Reset(),i||n?[4,this.Recalculate()]:[3,2];case 1:a.sent(),this.DocumentChange(r),a.label=2;case 2:return[2]}}))}))},r.prototype.OnSheetChange=function(e){var t,r;try{for(var o=s(e.activate.annotations),i=o.next();!i.done;i=o.next()){var n=i.value;this.InflateAnnotation(n),this.calculator.UpdateAnnotations(n)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.UpdateAnnotations()},r.prototype.HandleDrag=function(e){if(e.dataTransfer&&e.dataTransfer.types)if(e.dataTransfer.types.some&&e.dataTransfer.types.some((function(e){return"Files"===e})))e.preventDefault();else for(var t=0;t<e.dataTransfer.types.length;t++)if("files"===e.dataTransfer.types[t])return void e.preventDefault()},r.prototype.HandleDrop=function(e){var t=this;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){e.preventDefault();var r=e.dataTransfer.files[0];/^image/.test(r.type)?this.InsertImage(r):this.LoadFileInternal(r,Hr.DRAG_AND_DROP).then((function(){})).catch((function(e){var r;null===(r=t.dialog)||void 0===r||r.ShowDialog({title:"Error reading file",close_box:!0,message:"Please make sure your file is a valid XLSX, CSV or TREB file.",type:xr.error,timeout:3e3}),console.error(e)}))}},r.prototype.Freeze=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.grid.Freeze(e,t,!0)},r.prototype.FreezeSelection=function(){var e=this.grid.GetSelection();if(e.empty)this.grid.Freeze(0,0);else{var t=e.area;t.entire_sheet||(t.entire_row?this.grid.Freeze(t.end.row+1,0):t.entire_column?this.grid.Freeze(0,t.end.column+1):this.grid.Freeze(t.end.row+1,t.end.column+1))}},r.prototype.GetFreeze=function(){return this.grid.GetFreeze()},r.prototype.UpdateTheme=function(e){this.grid.UpdateTheme(void 0,e),this.toolbar&&this.toolbar.UpdateTheme(this.grid.theme)},r.prototype.PostDocument=function(e,t){var r=!1,o=0,i=JSON.stringify(this.SerializeDocument(!1,!0)),n=function(e){"ack"===e.data&&(r=!0,window.removeEventListener("message",n))};window.addEventListener("message",n);var a=function(n){if(void 0===n&&(n=100),o++>30)console.warn("timeout");else{try{e.postMessage(i,t)}catch(e){console.error(e)}setTimeout((function(){r||a(n)}),n)}};e.focus(),a()},r.prototype.SetRange=function(e,t,r,o,i){var n;if(void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=!1),"string"==typeof e){var a=this.grid.model.named_ranges.Get(e);if(a)n=a.Clone();else{var s=e.split(":");n=s.length<2?new f(this.EnsureAddress(s[0])):new f(this.EnsureAddress(s[0]),this.EnsureAddress(s[1]))}}else n=h(e)?new f(e):new f(e.start,e.end);this.grid.SetRange(n,t,r,o,i)},r.prototype.ParseNumber=function(e){return pe.TryParse(e).value},r.prototype.FormatNumber=function(e,t){return ue.Get(t).Format(e)},r.prototype.SetScale=function(e){void 0===e&&(e=1),this.grid.UpdateScale(e)},r.prototype.CreateChart=function(){return this.registered_libraries["treb-charts"]||(this.calculator.RegisterFunction(fo),this.registered_libraries["treb-charts"]=!0,this.grid.SetAutocompleteFunctions(this.calculator.SupportedFunctions())),new uo},r.prototype.Evaluate=function(e){var t=this,r=this.parser.Parse(e);if(r&&r.expression){this.parser.Walk(r.expression,(function(e){return"address"!==e.type&&"range"!==e.type||t.calculator.ResolveSheetID(e),!0}));var o=this.calculator.CalculateExpression(r.expression);return Array.isArray(o)?o.map((function(e){return e.map((function(e){return e.value}))})):o.value}},r.prototype.GetSheetID=function(e){var t,r;if("number"==typeof e){var o=this.grid.model.sheets[e];if(o)return o.id}else{var i=e.toUpperCase();try{for(var n=s(this.grid.model.sheets),a=n.next();!a.done;a=n.next()){var l=a.value;if(l.name.toUpperCase()===i)return l.id}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},r.prototype.GetRange=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),"string"==typeof e){var o=this.grid.model.named_ranges.Get(e);if(o)return this.grid.GetRange(o,t,r);var i=e.split(":");return i.length<2?this.grid.GetRange(new f(this.EnsureAddress(i[0])),t,r):this.grid.GetRange(new f(this.EnsureAddress(i[0]),this.EnsureAddress(i[1])),t,r)}return h(e)?this.grid.GetRange(e,t,r):this.grid.GetRange(new f(e.start,e.end),t,r)},r.prototype.DeleteSheet=function(e){if(e){e=e.toLowerCase();for(var t=0;t<this.grid.model.sheets.length;t++)if(this.grid.model.sheets[t].name.toLowerCase()===e){this.grid.DeleteSheet(t);break}}else this.grid.DeleteSheet();this.calculator.Reset()},r.prototype.AddSheet=function(e){this.grid.AddSheet(e),this.calculator.Reset()},r.prototype.InsertAnnotation=function(e,t,r){var o;if(void 0===t&&(t="treb-chart"),r)if(L.IsRectangle(r))o=r;else if("string"==typeof r){var i=void 0;if(!(i=this.grid.model.named_ranges.Get(r))){var n=r.split(":");i=n.length<2?new f(this.EnsureAddress(n[0])):new f(this.EnsureAddress(n[0]),this.EnsureAddress(n[1]))}i&&(o=i)}var a=this.grid.GetScrollOffset(),s=a.x,l=a.y,c=this.grid.layout.scale||1;this.grid.CreateAnnotation({type:t,formula:e},void 0,void 0,o||{top:l/c+30,left:s/c+30,width:300,height:300})},r.prototype.InsertImage=function(e){var t;return n(this,void 0,void 0,(function(){var r,o=this;return a(this,(function(i){switch(i.label){case 0:return e?[3,2]:[4,this.SelectFile(".png, .jpg, .jpeg, .gif, .svg")];case 1:e=i.sent(),i.label=2;case 2:return e?this.options.max_file_size&&e.size>this.options.max_file_size?(null===(t=this.dialog)||void 0===t||t.ShowDialog({type:xr.error,message:"This file exceeds the allowed image size. Please try a smaller image.",title:"Error adding image",timeout:3e3,close_box:!0}),[2]):(r=e,[4,new Promise((function(e,t){var i=new FileReader;i.onload=function(){try{if(i.result){var r=void 0;if("string"==typeof i.result)r=i.result;else{r="";for(var n=new Uint8Array(i.result),a=0;a<n.byteLength;a++)r+=String.fromCharCode(n[a])}var s=document.createElement("img");s.src=r;var l=o.grid.CreateAnnotation({type:"image",formula:""},void 0,void 0,{top:30,left:30,width:s.width||300,height:s.height||300});l.data.src=r,l.data.original_size={width:s.width||300,height:s.height||300}}e()}catch(e){t(e)}},i.onabort=function(){t("Aborted")},i.onerror=function(){t("File error")},setTimeout((function(){i.readAsDataURL(r)}),100)}))]):[2];case 3:return i.sent(),[2]}}))}))},r.prototype.SetLink=function(e,t){void 0===t&&(t=""),e=this.EnsureAddress(e),this.grid.SetLink(e,t)},r.prototype.ShowSheet=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!0),this.grid.ShowSheet(e,t)},r.prototype.ActivateSheet=function(e){this.grid.ActivateSheet(e)},r.prototype.SetColumnWidth=function(e,t){this.grid.SetColumnWidth(e,t)},r.prototype.SetRowHeight=function(e,t){this.grid.SetRowHeight(e,t)},r.prototype.EnsureAddress=function(e){var t={row:0,column:0};if("string"==typeof e){var r=this.parser.Parse(e);if(r.expression&&"address"===r.expression.type)this.calculator.ResolveSheetID(r.expression),t.row=r.expression.row,t.column=r.expression.column,t.sheet_id=r.expression.sheet_id;else if(r.expression&&"range"===r.expression.type)this.calculator.ResolveSheetID(r.expression),t.row=r.expression.start.row,t.column=r.expression.start.column,t.sheet_id=r.expression.start.sheet_id;else if(r.expression&&"identifier"===r.expression.type){var o=this.grid.model.named_ranges.Get(r.expression.name);if(o)return o.start}}else t.row=e.row||0,t.column=e.column||0;return t},r.prototype.ScrollTo=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),this.grid.ScrollTo(this.EnsureAddress(e),t,r)},r.prototype.InsertRow=function(){this.grid.InsertRow()},r.prototype.InsertColumn=function(){this.grid.InsertColumn()},r.prototype.DeleteRows=function(){this.grid.DeleteRows()},r.prototype.DeleteColumns=function(){this.grid.DeleteColumns()},r.prototype.ApplyBorders=function(e,t){void 0===t&&(t=1),this.grid.ApplyBorders(void 0,e,void 0,t)},r.prototype.MergeCells=function(){this.grid.MergeSelection()},r.prototype.UnmergeCells=function(){this.grid.UnmergeSelection()},r.prototype.ImportXLSX=function(e,t){return n(this,void 0,void 0,(function(){var r,o=this;return a(this,(function(i){switch(i.label){case 0:return this.export_worker?[3,2]:(r=this,[4,this.LoadWorker("embedded-treb-export-worker")]);case 1:r.export_worker=i.sent(),i.label=2;case 2:return[2,new Promise((function(r,i){var n;o.export_worker?(null===(n=o.dialog)||void 0===n||n.ShowDialog({message:"Importing XLSX..."}),o.export_worker.onmessage=function(e){var n;return e.data?"error"===e.data.status?i(e.data.error||"unknown error"):(o.grid.FromImportData(e.data.results),o.ResetInternal(),o.grid.Update(),o.calculator.AttachModel(o.grid.model),o.Publish({type:"load",source:t}),o.UpdateDocumentStyles(),o.InflateAnnotations(),null===(n=o.dialog)||void 0===n||n.HideDialog(),void r()):i("unknown error (missing data)")},o.export_worker.onerror=function(e){console.error("import worker error"),console.info(e),i(e)},o.export_worker.postMessage({command:"import",data:e})):i("worker failed")}))]}}))}))},r.prototype.ExportBlob=function(){return n(this,void 0,void 0,(function(){var e,t=this;return a(this,(function(r){switch(r.label){case 0:return this.export_worker?[3,2]:(e=this,[4,this.LoadWorker("embedded-treb-export-worker")]);case 1:e.export_worker=r.sent(),r.label=2;case 2:return[2,new Promise((function(e,r){if(t.export_worker){t.export_worker.onmessage=function(t){e(t.data?t.data.blob:void 0)},t.export_worker.onerror=function(e){console.error("export worker error"),console.info(e),r(e)};var o=t.grid.Serialize({rendered_values:!0,expand_arrays:!0,export_colors:!0,decorated_cells:!0});o.decimal_mark=M.decimal_separator,t.export_worker.postMessage({command:"export",sheet:o})}else r("worker failed")}))]}}))}))},r.prototype.Export=function(){var e=this;this.ExportBlob().then((function(t){var r="export";e.grid.model.document_name&&(r=e.grid.model.document_name.toLowerCase().replace(/\s+/g,"-")),t&&(po.saveAs(t,r+".xlsx",{autoBom:!1}),e.last_save_version=e.file_version)})).catch((function(t){var r;throw/invalid uri/i.test(t.message)&&(null===(r=e.dialog)||void 0===r||r.ShowDialog({title:"Error exporting file",close_box:!0,message:"The worker cannot run from the filesystem, please use a web server.",timeout:3e3,type:xr.error})),t}))},r.prototype.GetSelection=function(e){void 0===e&&(e=!1);var t=this.grid.GetSelection();if(t.empty)return"";var r=t.area.spreadsheet_label;if(e){var o=this.grid.active_sheet.name;return O.test(o)?"'"+o+"'!"+r:o+"!"+r}return r},r.prototype.GetSelectionReference=function(){return this.grid.GetSelection()},r.prototype.Focus=function(){this.grid.Focus()},r.prototype.Resize=function(){this.grid.UpdateLayout(),this.Publish({type:"resize"})},r.prototype.ResetInternal=function(){this.calculator.Reset(),this.FlushUndo(),this.file_version=this.last_save_version=0},r.prototype.Reset=function(){this.grid.Clear(),this.ResetInternal(),this.calculator.AttachModel(this.grid.model),this.Publish({type:"reset"})},r.prototype.Select=function(e){var t;if(e)if("string"==typeof e){var r=this.grid.model.named_ranges.Get(e);if(r)t=r.Clone();else{var o=e.split(":");t=o.length<2?new f(this.EnsureAddress(o[0])):new f(this.EnsureAddress(o[0]),this.EnsureAddress(o[1]))}}else t=h(e)?new f(e):new f(e.start,e.end);this.grid.SelectRange(t)},r.prototype.ApplyStyle=function(e,t,r){var o;if(void 0===t&&(t={}),void 0===r&&(r=!0),e)if("string"==typeof e){var i=this.grid.model.named_ranges.Get(e);if(i)o=i.Clone();else{var n=e.split(":");o=n.length<2?new f(this.EnsureAddress(n[0])):new f(this.EnsureAddress(n[0]),this.EnsureAddress(n[1]))}}else o=h(e)?new f(e):new f(e.start,e.end);this.grid.ApplyStyle(o,t,r)},r.prototype.Fetch=function(e){return n(this,void 0,void 0,(function(){return a(this,(function(t){return[2,new Promise((function(t,r){var o=new XMLHttpRequest;o.onload=function(){return t(o.response)},o.onerror=function(){return r("load error")},o.ontimeout=function(){return r("timeout")},o.open("GET",e),o.send()}))]}))}))},r.prototype.LoadFromLocalStorage=function(e){this.options.storage_key=e;var t=localStorage.getItem(e);if(t)try{var r=JSON.parse(t);return this.LoadDocument(r,void 0,void 0,void 0,void 0,void 0,Hr.LOCAL_STORAGE),!0}catch(e){console.error(e)}return!1},r.prototype.LoadNetworkDocument=function(e,t){var r;return n(this,void 0,void 0,(function(){var o,i,n,s,l,c,d,u;return a(this,(function(a){switch(a.label){case 0:o=t?t.scroll:void 0,i=!!t&&!!t.recalculate,n=t?t.sheet:void 0,s=/csv(?:$|\?|&)/i.test(e),l=/tsv(?:$|\?|&)/i.test(e),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.Fetch(e)];case 2:if("string"==typeof(c=a.sent()))if(s)this.LoadCSV(c,Hr.NETWORK_FILE);else{if(l)throw new Error("tsv not supported (TODO)");"&&&START&&&"===c.substr(0,11)?c=c.substr(11):"for(;;);"===c.substr(0,8)&&(c=c.substr(8)),d=JSON.parse(c),this.LoadDocument(d,o,void 0,i,n,void 0,Hr.NETWORK_FILE)}return[3,4];case 3:return u=a.sent(),console.info("error loading network document",e),console.error(u),null===(r=this.dialog)||void 0===r||r.ShowDialog({title:"Error loading file",close_box:!0,message:"The network document returned an error",type:xr.error,timeout:3e3}),this.Reset(),[3,4];case 4:return[2]}}))}))},r.prototype.SelectFile=function(e){return new Promise((function(t){var r,o,i=document.createElement("input");i.type="file",e&&(i.accept=e);var n=function(){window.removeEventListener("focus",n),o=setTimeout(r,250)},a=function(){o&&clearTimeout(o),r(i.files?i.files[0]:void 0)};r=function(e){i.removeEventListener("change",a),window.removeEventListener("focus",n),t(e)},i.addEventListener("change",a),window.addEventListener("focus",n),i.click()}))},r.prototype.LoadLocalFile=function(){var e;return n(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return[4,this.SelectFile(".treb, .csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/json")];case 1:if(!(t=r.sent()))return[3,5];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.LoadFileInternal(t,Hr.LOCAL_FILE)];case 3:return r.sent(),[2,!0];case 4:return r.sent(),null===(e=this.dialog)||void 0===e||e.ShowDialog({title:"Error reading file",close_box:!0,message:"Please make sure your file is a valid XLSX, CSV or TREB file.",type:xr.error,timeout:3e3}),[2,!1];case 5:return[2,!1]}}))}))},r.prototype.LoadFileInternal=function(e,t){var r=this;if(!e)return Promise.resolve();var o=new FileReader;return new Promise((function(i,n){var a=function(e){o.onload=null,o.onabort=null,o.onerror=null,e?n(e):i()};o.onload=function(){try{if(o.result)if(/\.csv$/i.test(e.name))r.LoadCSV(o.result,t);else{if(/\.xls[xm]$/i.test(e.name)){var i=void 0;if("string"==typeof o.result)i=o.result;else{i="";for(var n=new Uint8Array(o.result),s=0;s<n.byteLength;s++)i+=String.fromCharCode(n[s])}return void r.ImportXLSX(i,t).then((function(){return a()})).catch((function(e){return a(e)}))}var l=JSON.parse(o.result);r.LoadDocument(l,void 0,void 0,void 0,void 0,void 0,t)}a()}catch(e){a(e)}},o.onabort=function(){a("Aborted")},o.onerror=function(){a("File error")},setTimeout((function(){/\.xlsx$/i.test(e.name)?o.readAsBinaryString?o.readAsBinaryString(e):o.readAsArrayBuffer(e):o.readAsText(e)}),100)}))},r.prototype.ExportDelimited=function(e){var t,r,i,n;if(void 0===e&&(e={}),!(e=o(o({},Br),e)).delimiter||","!==e.delimiter&&"\t"!==e.delimiter)throw new Error("invalid delimiter");var a=this.grid.model.active_sheet;switch(typeof e.sheet){case"undefined":break;case"string":a=void 0;try{for(var l=s(this.grid.model.sheets),c=l.next();!c.done;c=l.next()){var d=c.value;d.name===e.sheet&&(a=d)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}break;case"number":a=this.grid.model.sheets[e.sheet];break;default:a=void 0}if(!a)throw new Error("invalid sheet identifier");for(var u=a.cells.toJSON({nested:!1,expand_arrays:!0,calculated_value:!0}),h=[],f=0;f<u.columns;f++)h.push("");var p=[];for(f=0;f<u.rows;f++)p.push(h.slice(0));var m=new RegExp('[\t\n\r"'+e.delimiter+"]");if(S(u.data))try{for(var v=s(u.data),y=v.next();!y.done;y=v.next()){var _=y.value,g="";e.formulas||void 0===_.calculated?"string"==typeof _.value&&"'"===_.value[0]?g=_.value.substr(1):void 0!==_.value&&(g=_.value.toString()):g=_.calculated.toString(),m.test(g)&&(g='"'+(g=g.replace(/"/g,'""'))+'"'),p[_.row][_.column]=g}}catch(e){i={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}return p.map((function(t){return t.join(e.delimiter)})).join("\r\n")},r.prototype.SaveLocalFile=function(e,t,r,o){void 0===e&&(e=Vr.treb),void 0===t&&(t=!0),void 0===r&&(r=!1);var i,n,a=this.grid.model.document_name||"document",s=e.split(/\./).filter((function(e){return e.trim().length})),l=s.length?s[s.length-1].toLowerCase():Vr.treb;switch(s.length<=1&&(e=(l===Vr.csv||l===Vr.tsv)&&this.grid.model.sheets.length>1?(a+"-"+this.grid.model.active_sheet.name).toLowerCase().replace(/\W+/g,"-")+"."+l:a.toLowerCase().replace(/\W+/g,"-")+"."+l),l){case Vr.csv:n=this.ExportDelimited({delimiter:","});break;case Vr.tsv:n=this.ExportDelimited({delimiter:"\t"});break;case Vr.treb:case Vr.json:i=this.SerializeDocument(t,void 0,o),n=JSON.stringify(i,void 0,r?2:void 0),this.last_save_version=this.file_version;break;default:throw new Error("invalid file type")}if(n&&e){var c=new Blob([n],{type:"text/plain;charset=utf-8"});po.saveAs(c,e,{autoBom:!1})}},r.prototype.LoadCSV=function(e,t){this.grid.FromCSV(e),this.ResetInternal(),this.grid.Update(!0),this.Publish({type:"load",source:t}),this.UpdateDocumentStyles()},r.prototype.LoadDocument=function(e,t,r,o,i,n,a){var l,c,d=this;if(void 0===r&&(r=!0),void 0===o&&(o=!1),n&&e.sheet_data){var u=Array.isArray(e.sheet_data)?e.sheet_data:[e.sheet_data];try{for(var h=s(u),f=h.next();!f.done;f=h.next()){var p=f.value;if(p.id===n.target.sheet_id){p.selection=n;break}}}catch(e){l={error:e}}finally{try{f&&!f.done&&(c=h.return)&&c.call(h)}finally{if(l)throw l.error}}}this.ImportDocumentData(e,i),this.calculator.Reset(),e.rendered_values&&!o?(this.grid.Update(),this.calculator.RebuildClean(this.grid.model,!0)):(console.info("load recalc"),this.Recalculate()),this.InflateAnnotations(),r&&this.FlushUndo(),this.Publish({type:"load",source:a}),this.UpdateDocumentStyles(),this.loaded=!0,t&&J().then((function(){d.ScrollTo(t)}))},r.prototype.SetNote=function(e){this.grid.SetNote(void 0,e)},r.prototype.ClearName=function(e){this.grid.SetName(e)},r.prototype.DefineName=function(e,t){if(t)this.grid.SetName(e,new f(t.start,t.end));else{var r=this.grid.GetSelection();r.empty||this.grid.SetName(e,r.area)}},r.prototype.RemoveFunction=function(e){var t,r,o=e.toUpperCase(),i=Object.keys(this.grid.model.macro_functions);try{for(var n=s(i),a=n.next();!a.done;a=n.next()){var l=a.value;l.toUpperCase()===o&&delete this.grid.model.macro_functions[l]}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}this.grid.SetAutocompleteFunctions(this.calculator.SupportedFunctions())},r.prototype.DefineFunction=function(e,t,r){var o,i;if(void 0===t&&(t=""),void 0===r&&(r="0"),!e.length||/^[^A-Za-z]/.test(e)||/[^\w_.]/.test(e))throw new Error("invalid function name");"string"==typeof t&&(t=t?t.split(this.parser.argument_separator).map((function(e){return e.trim()})):[]);try{for(var n=s(t),a=n.next();!a.done;a=n.next()){var l=a.value;if(!l.length||/^[^A-Za-z]/.test(l)||/[^\w_.]/.test(l))throw new Error("invalid argument name")}}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}this.RemoveFunction(e),this.grid.model.macro_functions[e.toUpperCase()]={name:e,function_def:r,argument_names:t,expression:this.parser.Parse(r).expression},this.grid.SetAutocompleteFunctions(this.calculator.SupportedFunctions())},r.prototype.UpdateAnnotations=function(){var e,t;try{for(var r=s(this.grid.model.active_sheet.annotations),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.temp.vertex){var n=i.temp.vertex;n.state_id!==i.temp.state&&(i.temp.state=n.state_id,i.update_callback&&i.update_callback(),this.grid.AnnotationUpdated(i))}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},r.prototype.SetHeadless=function(e){void 0===e&&(e=!0),this.grid.headless!==e&&(this.grid.headless=e,e||(this.grid.Update(!0),this.RebuildAllAnnotations()))},r.prototype.RebuildAllAnnotations=function(){var e,t;try{for(var r=s(this.grid.model.active_sheet.annotations),o=r.next();!o.done;o=r.next()){var i=o.value;this.InflateAnnotation(i),i.resize_callback&&i.resize_callback(),i.update_callback&&i.update_callback()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},r.prototype.InflateAnnotations=function(){var e,t;try{for(var r=s(this.grid.model.active_sheet.annotations),o=r.next();!o.done;o=r.next()){var i=o.value;this.InflateAnnotation(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},r.prototype.InflateAnnotation=function(e){var t,r=this;if(!this.grid.headless)if(e.inflated)e.dirty&&(e.resize_callback&&e.resize_callback(),e.dirty=!1);else if(e.inflated=!0,e.dirty&&(e.dirty=!1),e.content_node&&e.data)if("treb-chart"===e.type){var o=new uo;o.Initialize(e.content_node),this.registered_libraries["treb-charts"]||(this.calculator.RegisterFunction(fo),this.registered_libraries["treb-charts"]=!0,this.grid.SetAutocompleteFunctions(this.calculator.SupportedFunctions()));var i=function(){if(e.formula){var t=r.parser.Parse(e.formula);if(t&&t.expression&&"call"===t.expression.type){r.parser.Walk(t.expression,(function(e){return"address"!==e.type&&"range"!==e.type||r.calculator.ResolveSheetID(e),!0}));var i=t.expression.name.toLowerCase(),n=r.calculator.CalculateExpression(t.expression);o.Exec(i,n)}}o.Update()};e.resize_callback=function(){r.grid.headless||(o.Resize(),o.Update())},e.update_callback=function(){r.grid.headless||i()},(null===(t=e.node)||void 0===t?void 0:t.parentElement)&&(this.grid.headless||i())}else if("image"===e.type){var n=document.createElement("img");"string"==typeof e.data.src&&/^data:image/i.test(e.data.src)&&n.setAttribute("src",e.data.src),n.style.width="100%",n.style.height="100%",e.content_node.appendChild(n)}},r.prototype.SerializeDocument=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r={});var i=o(o({shrink:!0},r),{rendered_values:t}),n=this.grid.Serialize(i),a=o({app:"treb",version:"11.0.1",name:this.grid.model.document_name,user_data:this.grid.model.user_data,decimal_mark:M.decimal_separator},n);return t&&(a.rendered_values=!0),a},r.prototype.Recalculate=function(e){return n(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return e&&"data"===e.type&&e.area&&(t=e.area),[4,this.calculator.Calculate(this.grid.model,t)];case 1:return r.sent(),this.grid.Update(!0),this.UpdateAnnotations(),this.Publish({type:"data"}),[2]}}))}))},r.prototype.SaveLocalStorage=function(e){if(e||(e=this.options.storage_key),e){var t=JSON.stringify(this.SerializeDocument(!0,!0,{rendered_values:!0,expand_arrays:!0}));localStorage.setItem(e,t)}else console.info("not saving, no key")},r.prototype.DocumentChange=function(e){var t=this;J().then((function(){var r=JSON.stringify(t.SerializeDocument(!1,!0,{rendered_values:!0,expand_arrays:!0}));t.options.storage_key&&localStorage.setItem(t.options.storage_key,r),t.options.undo&&t.PushUndo(r,e),t.Publish({type:"document-change"})}))},r.prototype.PushUndo=function(e,t){var r=t||this.last_selection;this.undo_stack[this.undo_pointer-1]&&(this.undo_stack[this.undo_pointer-1].selection=r),e||(e=JSON.stringify(this.SerializeDocument(!1,!0,{rendered_values:!0,expand_arrays:!0}))),this.undo_stack[this.undo_pointer++]={data:e,selection:void 0};var o=this.undo_stack.length;if(o>16){var i=o-16;this.undo_stack=this.undo_stack.slice(i),this.undo_pointer-=i}this.file_version++},r.prototype.FlushUndo=function(e){void 0===e&&(e=!0),this.undo_stack=[],this.undo_pointer=0,e&&this.PushUndo(),this.last_save_version=this.file_version=0},r.prototype.Undo=function(){if(this.undo_pointer<=1)console.warn("nothing to undo");else{var e=this.undo_stack[--this.undo_pointer-1],t=e.selection?JSON.parse(e.selection):void 0;this.LoadDocument(JSON.parse(e.data),void 0,!1,void 0,void 0,t,Hr.UNDO),this.file_version--}},r.prototype.UpdateSelection=function(e){this.last_selection=JSON.stringify(e),this.Publish({type:"selection"})},r.prototype.About=function(){var e;null===(e=this.dialog)||void 0===e||e.ShowDialog({type:xr.about})},r.prototype.CreateToolbar=function(e){var t=this;return this.toolbar=new to(e,this.options,this.grid.theme),this.toolbar.Subscribe((function(e){var r,o,i,n,a,s,l,c={},d=function(e){var r=t.grid.GetSelection();if(r&&!r.empty){var o=r.area.spreadsheet_label;t.InsertAnnotation("="+e+"("+o+',,"'+o+'")')}};if("format"===e.type)c.number_format=e.format||"General";else if("button"===e.type)switch(e.command){case"update-comment":t.SetNote((null===(r=e.data)||void 0===r?void 0:r.comment)||"");break;case"clear-comment":t.SetNote("");break;case"border":var u=1,h=((null===(o=e.data)||void 0===o?void 0:o.border)||"").replace(/^border-/,"");"double-bottom"===h&&(h="bottom",u=2),h&&t.grid.ApplyBorders2(void 0,h,(null===(i=e.data)||void 0===i?void 0:i.color)||void 0,u);break;case"color":case"background-color":case"foreground-color":case"border-color":switch(null===(n=e.data)||void 0===n?void 0:n.target){case"border":c.border_top_fill=c.border_bottom_fill=c.border_left_fill=c.border_right_fill=(null===(a=e.data)||void 0===a?void 0:a.color)||{};break;case"foreground":c.text=(null===(s=e.data)||void 0===s?void 0:s.color)||{theme:1};break;case"background":c.fill=(null===(l=e.data)||void 0===l?void 0:l.color)||{}}break;case"insert-row":t.grid.InsertRow();break;case"insert-column":t.grid.InsertColumn();break;case"delete-row":t.grid.DeleteRows();break;case"delete-column":t.grid.DeleteColumns();break;case"insert-sheet":t.grid.InsertSheet();break;case"delete-sheet":t.grid.DeleteSheet();break;case"freeze":var f=t.grid.GetFreeze();f.rows||f.columns?t.Freeze(0,0):t.FreezeSelection();break;case"insert-image":t.InsertImage();break;case"donut-chart":d("Donut.Chart");break;case"column-chart":d("Column.Chart");break;case"bar-chart":d("Bar.Chart");break;case"line-chart":d("Line.Chart");break;case"increase-decimal":case"decrease-decimal":if(t.active_selection_style){var p=ue.Get(t.active_selection_style.number_format||"General");if(p.date_format)break;var m=new de(p.pattern);"increase-decimal"===e.command?m.IncreaseDecimal():m.DecreaseDecimal(),c.number_format=m.toString()}break;case"merge":t.grid.MergeSelection();break;case"unmerge":t.grid.UnmergeSelection();break;case"lock":c={locked:!t.active_selection_style||!t.active_selection_style.locked};break;case"wrap":c={wrap:!t.active_selection_style||!t.active_selection_style.wrap};break;case"align-left":c={horizontal_align:R.HorizontalAlign.Left};break;case"align-center":c={horizontal_align:R.HorizontalAlign.Center};break;case"align-right":c={horizontal_align:R.HorizontalAlign.Right};break;case"align-top":c={vertical_align:R.VerticalAlign.Top};break;case"align-middle":c={vertical_align:R.VerticalAlign.Middle};break;case"align-bottom":c={vertical_align:R.VerticalAlign.Bottom};break;case"reset":t.Reset();break;case"import-desktop":t.LoadLocalFile();break;case"save-json":t.SaveLocalFile();break;case"save-csv":t.SaveLocalFile(Vr.csv);break;case"export-xlsx":t.Export();break;case"recalculate":t.Recalculate();break;default:console.info("unhandled",e.command)}Object.keys(c).length&&t.grid.ApplyStyle(void 0,c,!0),t.Focus()})),this.UpdateDocumentStyles(!1),this.UpdateSelectionStyle(void 0,!1),this.toolbar},r.prototype.UpdateSelectionStyle=function(e,t){var r;void 0===t&&(t=!0);var i=this.grid.GetFreeze(),n={frozen:!!i.rows||!!i.columns};if(e||(e=this.grid.GetSelection()),e&&!e.empty){n.selection=e,n.merge=!1;var a=this.grid.model.active_sheet.CellData(e.target);n.merge=!!a.merge_area,n.merge&&a.merge_area&&(a.merge_area.start.row!==e.target.row||a.merge_area.start.column!==e.target.column)&&(a=this.grid.model.active_sheet.CellData(a.merge_area.start)),this.active_selection_style=a.style,n.comment=a.note,n.style=a.style?o({},a.style):void 0}else this.active_selection_style={};null===(r=this.toolbar)||void 0===r||r.UpdateState(n)},r.prototype.UpdateDocumentStyles=function(e){var t,r;if(void 0===e&&(e=!0),this.toolbar){var o={},i={};try{for(var n=s(this.grid.model.sheets),a=n.next();!a.done;a=n.next())a.value.NumberFormatsAndColors(i,o)}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}this.toolbar.UpdateDocumentStyles(Object.keys(o),Object.keys(i),e)}},r.prototype.InitCalculator=function(){return new Ur},r.prototype.ConvertLocale=function(e){var t,r,o,i,n,a,l,c,d,u,h,f,p,m=new Z;"."===e.decimal_mark?(m.decimal_mark=z.Period,m.argument_separator=E.Comma,f=z.Comma,p=E.Semicolon):(m.decimal_mark=z.Comma,m.argument_separator=E.Semicolon,f=z.Period,p=E.Comma);var v=function(e){var t=m.Parse(e);if(t.expression)return"="+m.Render(t.expression,void 0,"",f,p)};if(e.macro_functions)try{for(var y=s(e.macro_functions),_=y.next();!_.done;_=y.next()){var g=_.value;(F=v(g.function_def))&&(g.function_def=F)}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}if(e.sheet_data){var b=Array.isArray(e.sheet_data)?e.sheet_data:[e.sheet_data];try{for(var w=s(b),x=w.next();!x.done;x=w.next()){var S=x.value;if(S.annotations)try{for(var A=(n=void 0,s(S.annotations)),k=A.next();!k.done;k=A.next()){var M=k.value;M.formula&&(F=v(M.formula))&&(M.formula=F)}}catch(e){n={error:e}}finally{try{k&&!k.done&&(a=A.return)&&a.call(A)}finally{if(n)throw n.error}}if(null===(h=S.data)||void 0===h?void 0:h.length)try{for(var R=(l=void 0,s(S.data)),T=R.next();!T.done;T=R.next()){var L=T.value,D=C(L)?[L]:L.cells;try{for(var P=(d=void 0,s(D)),N=P.next();!N.done;N=P.next()){var F,I=N.value;I.value&&"string"==typeof I.value&&"="===I.value[0]&&(F=v(I.value.slice(1)))&&(I.value=F)}}catch(e){d={error:e}}finally{try{N&&!N.done&&(u=P.return)&&u.call(P)}finally{if(d)throw d.error}}}}catch(e){l={error:e}}finally{try{T&&!T.done&&(c=R.return)&&c.call(R)}finally{if(l)throw l.error}}}}catch(e){o={error:e}}finally{try{x&&!x.done&&(i=w.return)&&i.call(w)}finally{if(o)throw o.error}}}},r.prototype.CompareVersions=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var r=e.split(".").map((function(e){return Number(e)||0})).concat([0,0,0]),o=t.split(".").map((function(e){return Number(e)||0})).concat([0,0,0]),i=["major","minor","patch"],n={match:0},a=0;a<3;a++)if(r[a]!==o[a]){n.match=r[a]>o[a]?1:-1,n.level=i[a];break}return n},r.prototype.ImportDocumentData=function(e,t){var r,i,n=[],a=this.CompareVersions(e.version,"11.0.1");a.match>0&&("major"!==a.level&&"minor"!==a.level||console.warn("The file you are opening was created with a newer version of TREB ("+e.version+" vs 11.0.1).\nYou may encounter compatibility errors.")),e.sheet_data&&(Array.isArray(e.sheet_data)?n=e.sheet_data:n.push(e.sheet_data)),e.decimal_mark&&e.decimal_mark!==M.decimal_separator&&this.ConvertLocale(e),this.grid.UpdateSheets(n,void 0,t||e.active_sheet);var l=this.grid.model;l.document_name=e.name,l.user_data=e.user_data,l.named_ranges.Reset();var c=e.named_ranges;if(!c&&n[0]&&n[0].named_ranges&&(c=n[0].named_ranges),c&&l.named_ranges.Deserialize(c),l.macro_functions={},e.macro_functions)try{for(var d=s(e.macro_functions),u=d.next();!u.done;u=d.next()){var h=u.value;l.macro_functions[h.name.toUpperCase()]=o(o({},h),{expression:this.parser.Parse(h.function_def||"").expression})}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}},r.prototype.LoadWorker=function(e){return n(this,void 0,void 0,(function(){var t,o,i;return a(this,(function(n){switch(n.label){case 0:return r.treb_language&&(e+="-"+r.treb_language),/\.js$/.test(e)||(e+="-11.0.1.js"),(o=r.treb_base_path)&&(/\/$/.test(o)||(o+="/"),e=o+e),/^(http:|https:|\/\/)/.test(e)?[4,this.Fetch(e)]:[3,2];case 1:return i=n.sent(),t=new Worker(URL.createObjectURL(new Blob([i],{type:"application/javascript"}))),[3,3];case 2:if(/^file:/.test(e))throw new Error("invalid URI");t=new Worker(e),n.label=3;case 3:return[2,t]}}))}))},r.prototype.HandleKeyDown=function(e){!e.ctrlKey||"KeyZ"!==e.code&&"z"!==e.key||(e.stopPropagation(),e.preventDefault(),this.Undo())},r.treb_base_path="",r.treb_language="",r.treb_script_host="",r.treb_embedded_script_path="",r.enable_engine=!1,r.enable_formatter=!1,r}(X),_o=function(e){return e.length===3+e[2]?{column:e[0],row:e[1],sheet_id:0,data:e.subarray(3)}:{column:e[0],row:e[1],sheet_id:e[2],data:e.subarray(4)}},go=function(e){var t,r;if(1===e.length)return e[0];var o=0,i=0;try{for(var n=s(e),a=n.next();!a.done;a=n.next()){var l=a.value;o=Math.max(o,l.elapsed),i+=l.trials}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}for(var c=e[0],d=c.results.map((function(e){var t=new Float64Array(4+i);return t.set(new Float64Array(e)),t})),u=c.trials+4,h=1;h<e.length;h++){var f=e[h];f.results.forEach((function(e,t){var r=new Float64Array(e),o=d[t];if(o[0]!==r[0]||o[1]!==r[1]||o[2]!==r[2])throw new Error("mismatch in result address");o.set(r.subarray(4),u)})),u+=f.trials}return{elapsed:o,trials:i,results:d.map((function(e){return e.buffer}))}},bo=r(4691);!function(e){e[e.Null=0]="Null",e[e.Prep=1]="Prep",e[e.Simulation=2]="Simulation",e[e.Post=3]="Post"}(vo||(vo={}));var wo=function(e){for(var t=bo.MC.Uniform(e),r=[],o=0;o<e;o++)r[o]=o;for(o=0;o<e;o++){var i=o+Math.floor(t[o]*(e-o)),n=r[o];r[o]=r[i],r[i]=n}return r},xo=function(){function e(){this.address={row:0,column:0},this.volatile=!1,this.iteration=0,this.iterations=0,this.call_index=0,this.lhs=!1,this.state=vo.Null,this.results=[],this.elapsed=0,this.trials=0,this.distributions=[],this.correlated_distributions={},this.functions={"Multivariate.Normal":{description:"Returns a sample from the multivariate normal distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"mean",description:"Distribution Mean",default:0},{name:"stdev",description:"Standard Deviation",default:1}],fn:this.multivariate_normal.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"Multivariate.LogNormal":{description:"Returns a sample from the multivariate log-normal distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"mean",description:"Mean of underlying Normal distribution",default:0},{name:"stdev",description:"Standard Deviation of underlying Normal distribution",default:1}],fn:this.multivariate_lognormal.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"Multivariate.Uniform":{description:"Returns a sample from the multivariate uniform distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"min",description:"Minimum Value",default:0},{name:"max",description:"Maximum Value",default:1}],fn:this.multivariate_uniform.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"Multivariate.Beta":{description:"Returns a sample from the multivariate beta distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"w",description:"Shape Parameter"},{name:"v",description:"Shape Parameter"}],fn:this.multivariate_beta.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"Multivariate.PERT":{description:"Returns a sample from the multivariate PERT distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"min",description:"Minimum Value"},{name:"mode",description:"Most-Likely Value"},{name:"max",description:"Maximum Value"},{name:"lambda",default:4}],fn:this.multivariate_pert.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"Multivariate.Triangular":{description:"Returns a sample from the multivariate triangular distribution",simulation_volatile:!0,arguments:[{name:"range of values",description:"Set of Correlated Distributions (N)",address:!0},{name:"correlation",description:"Correlation Matrix (NxN)"},{name:"min",description:"Minimum Value"},{name:"mode",description:"Most-Likely Value"},{name:"max",description:"Maximum Value"}],fn:this.multivariate_triangular.bind(this),category:["RiskAMP Random Distributions"],extension:!0},UniformRangeSample:{description:"Returns one of a set of values, with equal probability and with replacement",simulation_volatile:!0,arguments:[{name:"range",description:"Range of Values"}],fn:this.uniformrangesample.bind(this),category:["RiskAMP Random Distributions"],extension:!0},SampleValue:{description:"Returns one of a set of values, with equal probability and with replacement",simulation_volatile:!0,arguments:[{name:"range",description:"Range of Values"}],fn:this.samplevalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"SampleValue.Weighted":{description:"Returns one of a set of values, weighted by a second set of values",simulation_volatile:!0,arguments:[{name:"range",description:"Range of Values"},{name:"weights",description:"Range of Weights"}],fn:this.samplevalue_weighted.bind(this),category:["RiskAMP Random Distributions"],extension:!0},BernoulliValue:{description:"Returns true or false (boolean) based on the given probability",simulation_volatile:!0,arguments:[{name:"p",description:"Probability to return True",default:.5}],fn:this.bernoullivalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},ProbabilityValue:{description:"Returns true or false (boolean) based on the given probability",simulation_volatile:!0,arguments:[{name:"p",description:"Probability to return True",default:.5}],fn:this.probabilityvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},UniformValue:{description:"Returns a sample from the uniform distribution",simulation_volatile:!0,arguments:[{name:"min",description:"Minimum",default:0},{name:"max",description:"Maximum",default:1}],fn:this.uniformvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},BetaValue:{description:"Returns a sample from the beta distribution",simulation_volatile:!0,arguments:[{name:"w",description:"Shape Parameter"},{name:"v",description:"Shape Parameter"}],fn:this.betavalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},TruncatedNormalValue:{description:"Returns a sample from the normal distribution",simulation_volatile:!0,arguments:[{name:"mean",description:"Mean",default:0},{name:"stdev",description:"Standard Deviation",default:1},{name:"min",description:"Minimum Value"},{name:"max",description:"Maximum Value"}],fn:this.truncatednormalvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},NormalValue:{description:"Returns a sample from the normal distribution",simulation_volatile:!0,arguments:[{name:"mean",description:"Mean",default:0},{name:"stdev",description:"Standard Deviation",default:1}],fn:this.normalvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},PERTValue:{description:"Returns a sample from the beta-PERT distribution",simulation_volatile:!0,arguments:[{name:"min",description:"Minimum Value",default:0},{name:"mode",description:"Most-Likely Value",default:.5},{name:"max",description:"Maximum Value",default:1},{name:"lambda",default:4}],fn:this.pertvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},LognormalValue:{description:"Returns a sample from the log-normal distribution",simulation_volatile:!0,arguments:[{name:"mean",description:"Mean of underlying Normal distribution",default:0},{name:"stdev",description:"Standard Deviation of underlying Normal distribution",default:1}],fn:this.lognormalvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},SequentialValue:{description:"Returns one from a set of values, in order",simulation_volatile:!0,arguments:[{name:"values",description:"Data Array"},{name:"count",description:"Count",default:0}],fn:this.sequentialvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},IndexValue:{description:"Returns a monotonically increasing value",simulation_volatile:!0,arguments:[{name:"max",description:"Maximum",default:0}],fn:this.indexvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},"PERTValue.P":{description:"Returns a sample from the beta-PERT distribution",simulation_volatile:!0,arguments:[{name:"p10",description:"10th-Percentile Value",default:0},{name:"mode",description:"Most-Likely Value",default:.5},{name:"p90",description:"90th-Percentile Value",default:1},{name:"lambda",default:4}],fn:this.pertvalue_p.bind(this),category:["RiskAMP Random Distributions"],extension:!0},TriangularValue:{description:"Returns a sample from the triangular distribution",simulation_volatile:!0,arguments:[{name:"min",description:"Minimum Value",default:0},{name:"mode",description:"Most Likely Value",default:.5},{name:"max",description:"Maximum Value",default:1}],fn:this.triangularvalue.bind(this),category:["RiskAMP Random Distributions"],extension:!0},SimulationCorrelation:{description:"Returns the correlation between the data from two cells in the simulation",arguments:[{name:"reference cell",description:"Cell 1",collector:!0},{name:"reference cell",description:"Cell 2",collector:!0}],fn:this.simulationcorrelation.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationRSquared:{description:"Returns the r-squared value (coefficient of correlation) of the data from two cells in the simulation",arguments:[{name:"dependent",description:"Dependent Value",collector:!0},{name:"independent",description:"Indepdendent Value",collector:!0}],fn:this.simulationrsquared.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationSkewness:{description:"Returns the skewness of data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationskewness.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationKurtosis:{description:"Returns the kurtosis (peakedness) of data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationkurtosis.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationPercentile:{description:"Returns the value of a cell at a given percentile in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0},{name:"percentile",description:"Percentile (as %)"}],fn:this.simulationpercentile.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationInterval:{description:"Returns the portion of results in the simulation that fall within some bounds (as a percentage)",arguments:[{name:"reference cell",description:"Source Cell",collector:!0},{name:"min",description:"Minimum Value (optional, inclusive)"},{name:"max",description:"Maximum Value (optional, inclusive)"}],fn:this.simulationinterval.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationMean:{description:"Returns the mean (average) value of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationmean.bind(this),extension:!0,category:["RiskAMP Simulation Functions"]},SimulationMedian:{description:"Returns the median value of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationmedian.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationValue:{description:"Returns the value of this cell in the simulation at the given trial number",arguments:[{name:"reference cell",description:"Source Cell",collector:!0},{name:"iteration",description:"Trial Number"}],fn:this.simulationvalue.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationValuesArray:{description:"Returns all values of this cell in the simulation, as an array",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationvaluesarray.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SortedSimulationIndex:{description:"Returns the iteration number of a sorted value for this cell",arguments:[{name:"reference cell",description:"Source Cell",collector:!0},{name:"index"}],fn:this.sortedsimulationindex.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},"SimulationValuesArray.Ordered":{description:"Returns all values of this cell in the simulation, as an array, ordered by a second cell",arguments:[{name:"reference cell",description:"Source Cell",collector:!0},{name:"order by",description:"Reference Cell for Ordering",collector:!0}],fn:this.simulationvaluesarray_ordered.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationMin:{description:"Returns the minimum value of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationmin.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationMax:{description:"Returns the maximum value of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationmax.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationStandardError:{description:"Returns the standard error of the mean from this cell in the simulation",arguments:[{name:"reference cell",collector:!0}],fn:this.simulationstandarderror.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationStandardDeviation:{description:"Returns the standard deviation of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationstandarddeviation.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationVariance:{description:"Returns the variance of the data from this cell in the simulation",arguments:[{name:"reference cell",description:"Source Cell",collector:!0}],fn:this.simulationvariance.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationTrials:{description:"Returns the number of trials from the last simulation",fn:this.simulationtrials.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},SimulationTime:{description:"Returns the elapsed time of the last simulation",fn:this.simulationtime.bind(this),category:["RiskAMP Simulation Functions"],extension:!0},IsPosDef:{description:"Checks that a matrix is positive-definite",arguments:[{name:"matrix"}],fn:function(e){if(e.some((function(e){return e.some((function(e){return"number"!=typeof e}))})))return yt();var t=bo.Matrix.FromArray(e);return{type:u.boolean,value:t.IsPosDef()}},extension:!0},MakePosDef:{description:"Returns a matrix that is positive-definite",arguments:[{name:"matrix"}],fn:function(e){return e.some((function(e){return e.some((function(e){return"number"!=typeof e}))}))?yt():bo.Matrix.FromArray(e).MakePosDef().ToArray().map((function(e){return e.map((function(e){return{type:u.number,value:e}}))}))},extension:!0},Cholesky:{arguments:[{name:"matrix"},{name:"transpose",default:!1}],fn:function(e,t){return void 0===t&&(t=!1),bo.Matrix.FromArray(e).Cholesky(t).ToArray().map((function(e){return e.map((function(e){return{type:u.number,value:e}}))}))},extension:!0},EigenValues:{description:"Returns the eigenvalues of the matrix (as column vector)",arguments:[{name:"matrix"}],fn:function(e){return e.some((function(e){return e.some((function(e){return"number"!=typeof e}))}))?yt():[bo.Matrix.FromArray(e).EigenSystem().realvalues.map((function(e){return{type:u.number,value:e}}))]},extension:!0},EigenVectors:{description:"Returns the eigenvectors of the matrix (as matrix)",arguments:[{name:"matrix"}],fn:function(e){return e.some((function(e){return e.some((function(e){return"number"!=typeof e}))}))?yt():bo.Matrix.FromArray(e).EigenSystem().vectors.map((function(e){return Array.from(e).map((function(e){return{type:u.number,value:e}}))}))},extension:!0},"RiskAMP.Scale":{description:"Creates a uniform scale within a given range",arguments:[{name:"min"},{name:"max"}],fn:this.Scale.bind(this),extension:!0},"RiskAMP.HistogramTable":{description:"Creates a histogram table from a source cell",arguments:[{name:"reference cell",collector:!0}],fn:this.HistogramTable.bind(this),extension:!0},"RiskAMP.Permutation":{description:"Creates a random permutation of source data",arguments:[{name:"range",boxed:!0}],fn:this.Permutation.bind(this),extension:!0,simulation_volatile:!0}}}return Object.defineProperty(e.prototype,"seed",{set:function(e){bo.Random.Seed(e)},enumerable:!1,configurable:!0}),e.prototype.CallerArea=function(){var e,t,r,o,i=1,n=1;if(this.address.sheet_id)try{for(var a=s((null===(r=this.model)||void 0===r?void 0:r.sheets)||[]),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.id===this.address.sheet_id){c.cells.data[this.address.row]&&(o=c.cells.data[this.address.row][this.address.column]);break}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return(null==o?void 0:o.area)&&(i=o.area.rows,n=o.area.columns),{rows:i,columns:n}},e.prototype.CorrelateDistributions=function(){var e,t,r=this,o=function(e){var t=i.correlated_distributions[e],o=t.addresses.map((function(e){return r.distributions[e.sheet_id||0][e.column][e.row][e.call_index]}));try{var n=bo.MC.CorrelateCDM(t.correlation,o,!0);t.addresses.forEach((function(e,t){r.distributions[e.sheet_id||0][e.column][e.row][e.call_index]=n[t]}))}catch(e){console.warn(e)}},i=this;try{for(var n=s(Object.keys(this.correlated_distributions)),a=n.next();!a.done;a=n.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.InitDistribution=function(){if(!this.address)throw new Error("invalid address");if(!this.address.sheet_id)throw new Error("address missing sheet ID");this.distributions[this.address.sheet_id]||(this.distributions[this.address.sheet_id]=[]);var e=this.distributions[this.address.sheet_id];e[this.address.column]||(e[this.address.column]=[]);var t=e[this.address.column];t[this.address.row]||(t[this.address.row]=[])},e.prototype.StoreCellResults=function(e){if(e||(e=this.address),e){if(!e.sheet_id)throw new Error("SCR called without sheet id");this.results[e.sheet_id]||(this.results[e.sheet_id]=[]),this.results[e.sheet_id][e.column]||(this.results[e.sheet_id][e.column]=[]);var t=this.results[e.sheet_id][e.column];return t[e.row]||(t[e.row]=[]),t[e.row]}},e.prototype.PrepMultivariate=function(e,t){if(!this.correlated_distributions[e]){var r=bo.CDMatrix.FromArray(t);if(!r.IsSymmetric()){for(var o=1;o<t.length;o++)for(var i=0;i<o;i++)if(t[o][i]){console.warn("invalid lower-triangular matrix");break}r=r.Symmetrize(!0)}this.correlated_distributions[e]={correlation:r,addresses:[]}}this.correlated_distributions[e].addresses.push({column:this.address.column,row:this.address.row,sheet_id:this.address.sheet_id,call_index:this.call_index}),this.InitDistribution()},e.prototype.ValidateCorrelationMatrix=function(e){var t=bo.Matrix.FromArray(e);return t.IsSymmetric()||(t=t.Symmetrize(!0)),!(e.some((function(e){return e.some((function(e){return"number"!=typeof e&&void 0!==e}))}))||!t.IsPosDef())},e.prototype.multivariate_normal=function(e,t,r,o){if(void 0===r&&(r=0),void 0===o&&(o=1),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Normal(this.iterations,{mean:r,sd:o,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.Normal(1,{mean:r,sd:o})[0]}:pt()},e.prototype.multivariate_lognormal=function(e,t,r,o){if(void 0===r&&(r=0),void 0===o&&(o=1),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.LogNormal(this.iterations,{mean:r,sd:o,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.LogNormal(1,{mean:r,sd:o})[0]}:pt()},e.prototype.multivariate_beta=function(e,t,r,o){if(void 0===r&&(r=1),void 0===o&&(o=2),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Beta(this.iterations,{a:r,b:o,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.Beta(1,{a:r,b:o})[0]}:pt()},e.prototype.multivariate_uniform=function(e,t,r,o){if(void 0===r&&(r=0),void 0===o&&(o=1),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Uniform(this.iterations,{min:r,max:o,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.Uniform(1,{min:r,max:o})[0]}:pt()},e.prototype.multivariate_pert=function(e,t,r,o,i,n){if(void 0===r&&(r=0),void 0===o&&(o=.5),void 0===i&&(i=1),void 0===n&&(n=4),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.PERT(this.iterations,{a:r,b:i,c:o,lambda:n,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.PERT(1,{a:r,b:i,c:o,lambda:n})[0]}:pt()},e.prototype.multivariate_triangular=function(e,t,r,o,i){if(void 0===r&&(r=0),void 0===o&&(o=.5),void 0===i&&(i=1),this.state===vo.Prep)this.PrepMultivariate(e,t),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Triangular(this.iterations,{a:r,b:i,c:o,lhs:this.lhs,ordered:!0});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return this.ValidateCorrelationMatrix(t)?{type:u.number,value:bo.MC.Triangular(1,{a:r,b:i,c:o})[0]}:pt()},e.prototype.uniformvalue=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Uniform(this.iterations,{min:e,max:t,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.Uniform(1,{min:e,max:t})[0]}},e.prototype.bernoullivalue=function(e){if(void 0===e&&(e=.5),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Bernoulli(this.iterations,{p:e,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.boolean,value:bo.MC.Bernoulli(1,{p:e})[0]}},e.prototype.probabilityvalue=function(e){return void 0===e&&(e=.5),this.bernoullivalue(e)},e.prototype.sequentialvalue=function(e,t){if(void 0===t&&(t=0),this.state===vo.Prep)this.InitDistribution();else if(this.state===vo.Simulation){var r=this.iteration;t>0&&(r=this.iteration%t);var o=e[0].length,i=Math.floor(r/o)%e.length,n=r%o;return{type:u.number,value:e[i][n]}}return{type:u.number,value:e[0][0]}},e.prototype.indexvalue=function(e){if(void 0===e&&(e=0),this.state===vo.Prep)this.InitDistribution();else if(this.state===vo.Simulation)return e>0?{type:u.number,value:this.iteration%e+1}:{type:u.number,value:this.iteration+1};return{type:u.number,value:1}},e.prototype.lognormalvalue=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.LogNormal(this.iterations,{mean:e,sd:t,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.LogNormal(1,{mean:e,sd:t})[0]}},e.prototype.truncatednormalvalue=function(e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.TruncatedNormal(this.iterations,{mean:e,sd:t,lhs:this.lhs,min:r,max:o});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.TruncatedNormal(1,{mean:e,sd:t,min:r,max:o})[0]}},e.prototype.normalvalue=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Normal(this.iterations,{mean:e,sd:t,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.Normal(1,{mean:e,sd:t})[0]}},e.prototype.pertvalue=function(e,t,r,o){if(void 0===e&&(e=0),void 0===t&&(t=.5),void 0===r&&(r=1),void 0===o&&(o=4),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.PERT(this.iterations,{a:e,b:r,c:t,lambda:o,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.PERT(1,{a:e,b:r,c:t,lambda:o})[0]}},e.prototype.pertvalue_p=function(e,t,r,i){if(void 0===e&&(e=0),void 0===t&&(t=.5),void 0===r&&(r=1),void 0===i&&(i=4),this.state===vo.Prep){var n=bo.MC.P80Pert(e,r,t,i);this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.PERT(this.iterations,o(o({},n),{lambda:i,lhs:this.lhs}))}else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};var a=bo.MC.P80Pert(e,r,t,i);return{type:u.number,value:bo.MC.PERT(1,o(o({},a),{lambda:i}))[0]}},e.prototype.CommonDistributionFunction=function(e,t,r){if(this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=e.apply(t,[this.iterations].concat(r));else if(this.state===vo.Simulation)return this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration];return e.apply(t,[1].concat(r))[0]},e.prototype.triangularvalue=function(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=.5),void 0===r&&(r=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Triangular(this.iterations,{a:e,b:r,c:t,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.Triangular(1,{a:e,b:r,c:t})[0]}},e.prototype.betavalue=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=1),this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Beta(this.iterations,{a:e,b:t,lhs:this.lhs});else if(this.state===vo.Simulation)return{type:u.number,value:this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]};return{type:u.number,value:bo.MC.Beta(1,{a:e,b:t})[0]}},e.prototype.samplevalue=function(e){return this.uniformrangesample(e)},e.prototype.samplevalue_weighted=function(e,t){if(this.state===vo.Prep)this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Uniform(this.iterations,{min:0,max:1,lhs:this.lhs});else{var r=this.state===vo.Simulation?this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]:bo.MC.Uniform(1,{min:0,max:1})[0];if(!e||!e.length)return{type:u.undefined,value:void 0};for(var o=r*Kt(t).reduce((function(e,t){return void 0===t?e:e+Number(t)}),0),i=0,n=0;n<e.length;n++)for(var a=0;a<e[n].length;a++)if((i+=t[n][a])>=o)return{type:u.number,value:e[n][a]}}return{type:u.number,value:e[0][0]}},e.prototype.uniformrangesample=function(e){this.state===vo.Prep&&(this.InitDistribution(),this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index]=bo.MC.Uniform(this.iterations,{min:0,max:1,lhs:this.lhs}));var t=this.state===vo.Simulation?this.distributions[this.address.sheet_id||0][this.address.column][this.address.row][this.call_index][this.iteration]:bo.MC.Uniform(1,{min:0,max:1})[0];if(!e||!e.length)return{type:u.undefined,value:void 0};var r=Math.floor(e[0].length*e.length*t),o=e[r%e.length][Math.floor(r/e.length)]||"";return{value:o,type:v(o)}},e.prototype.simulationtrials=function(){return{type:u.number,value:this.trials}},e.prototype.simulationtime=function(){return{type:u.number,value:this.elapsed/1e3}},e.prototype.simulationvaluesarray=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();for(var t=[],r=0;r<e.length;r++)t[r]={type:u.number,value:e[r]};return[t]},e.prototype.simulationvaluesarray_ordered=function(e,t){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length||t&&!t.length)return pt();if(!t)return[Array.prototype.slice.call(e,0).sort((function(e,t){return e-t})).map((function(e){return{type:u.number,value:e}}))];var r=Array.from(e).map((function(e,r){return[e,t[r]]}));return r.sort((function(e,t){return e[1]-t[1]})),[r.map((function(e){return{type:u.number,value:e[0]}}))]},e.prototype.simulationrsquared=function(e,t){return this.state!==vo.Null?{type:u.number,value:0}:e&&e.length&&t&&t.length?{type:u.number,value:bo.Stats.R2(e,t)}:pt()},e.prototype.simulationcorrelation=function(e,t){return this.state!==vo.Null?{type:u.number,value:0}:e&&e.length&&t&&t.length?{type:u.number,value:bo.Stats.Correlation(e,t)}:pt()},e.prototype.sortedsimulationindex=function(e,t){if(void 0===t&&(t=1),this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();if(t<1||t>e.length)return vt();var r=Array.from(e).map((function(e,t){return[e,t+1]}));return r.sort((function(e,t){return e[0]-t[0]})),{type:u.number,value:r[t-1][1]}},e.prototype.simulationvalue=function(e,t){return void 0===t&&(t=1),this.state!==vo.Null?{type:u.number,value:0}:e&&e.length?t<1||t>e.length?vt():{type:u.number,value:e[t-1]}:pt()},e.prototype.simulationpercentile=function(e,t){return void 0===t&&(t=.5),this.state!==vo.Null?{type:u.number,value:0}:e&&e.length?{type:u.number,value:bo.Stats.Percentile(e,t)}:pt()},e.prototype.simulationstandarddeviation=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var t=bo.Stats.Statistics(e);return{type:u.number,value:t.stdev}},e.prototype.simulationvariance=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var t=bo.Stats.Statistics(e);return{type:u.number,value:t.variance}},e.prototype.simulationskewness=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var t=bo.Stats.Statistics(e);return{type:u.number,value:t.skewness}},e.prototype.simulationkurtosis=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var t=bo.Stats.Statistics(e);return{type:u.number,value:t.kurtosis}},e.prototype.simulationinterval=function(e,t,r){return this.state!==vo.Null?{type:u.number,value:0}:e&&e.length?{type:u.number,value:bo.Stats.Interval({data:e,min:t,max:r})}:pt()},e.prototype.simulationstandarderror=function(e){var t,r,o,i;if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var n=0,a=0;try{for(var l=s(e),c=l.next();!c.done;c=l.next())n+=c.value||0}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}var d=n/e.length;try{for(var h=s(e),f=h.next();!f.done;f=h.next()){var p=f.value-d;a+=p*p}}catch(e){o={error:e}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}return{type:u.number,value:Math.sqrt(a/e.length)/Math.sqrt(e.length)}},e.prototype.simulationmin=function(e){return this.state!==vo.Null?{type:u.number,value:0}:e&&e.length?{type:u.number,value:Math.min.apply(0,e)}:pt()},e.prototype.simulationmax=function(e){return this.state!==vo.Null?{type:u.number,value:0}:e&&e.length?{type:u.number,value:Math.max.apply(0,e)}:pt()},e.prototype.simulationmean=function(e){var t,r;if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var o=0;try{for(var i=s(e),n=i.next();!n.done;n=i.next())o+=n.value}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return{type:u.number,value:o/e.length}},e.prototype.simulationmedian=function(e){if(this.state!==vo.Null)return{type:u.number,value:0};if(!e||!e.length)return pt();var t=e.filter((function(e){return"number"==typeof e?e:0}));return t.sort((function(e,t){return e-t})),{type:u.number,value:t[Math.round(t.length/2)]}},e.prototype.Permutation=function(e){if(!e){var t=this.CallerArea(),r=t.rows,i=t.columns;if((p=r*i)<=0)return vt();for(var n=wo(p),a=[],s=0,l=0;l<i;l++){for(var c=[],d=0;d<r;d++)c.push({type:u.number,value:n[s++]});a.push(c)}return a}if(Array.isArray(e)){r=e.length;var h=e[0].length;if(!r||!h)return vt();var f=e.reduce((function(e,t){return t.concat(e)}),[]),p=r*h;if(f.length!==p)throw console.info("invalid?",p,e,f),new Error("invalid length");for(n=wo(p),a=[],s=0,d=0;d<r;d++){var m=[];for(l=0;l<h;l++){var v=n[s++];m.push(o({},f[v]))}a.push(m)}return a}return o({},e)},e.prototype.Scale=function(e,t){var r=this.CallerArea(),o=r.rows,i=r.columns,n=Math.max(o,i),a=e>t?ee(t,e,n-1,!0):ee(e,t,n-1,!0),s=a.min,l=[[]];if(a.count<n-1&&(s=a.min-Math.floor((n-1-a.count)/2)*a.step),e>t)for(var c=0;c<n;c++){var d=s+c*a.step;l[0][n-1-c]={type:u.number,value:d}}else for(c=0;c<n;c++)d=s+c*a.step,l[0][c]={type:u.number,value:d};return o<i?Wt(l):l},e.prototype.HistogramTable=function(e){var t=this.CallerArea(),r=t.rows,o=t.columns,i=Math.max(r,o),n=Math.min(r,o);if(Array.isArray(e)||e instanceof Float64Array||e instanceof Float32Array){if(e.length<=1)return{type:u.number,value:0};Array.isArray(e)||(e=Array.prototype.slice.call(e)),e.sort((function(e,t){return e-t}));var a=e[0]||0,s=e[e.length-1]||0;if(s===a)return{type:u.number,value:0};var l=[[],[]],c=ee(a,s,i,!0),d=c.min,h=0;c.count<i&&(d=c.min-Math.ceil(i-c.count)/2*c.step);for(var f=0;f<i;f++){for(var p=d+(f+1)*c.step,m=0;h<e.length&&e[h]<p;h++,m++);l[1][f]={type:u.number,value:m},l[0][f]={type:u.number,value:p}}return 1===n&&(l=[l[1]]),o>r?Wt(l):l}return{type:u.number,value:0}},e}(),Co=function(e){function r(t,r){var o=e.call(this,t,r)||this;return o.simulation_model=new xo,o.context=o.simulation_model,o}return t(r,e),r.prototype.CallExpression=function(e,t){var r=this;void 0===t&&(t=!1);var o=this.library.Get(e.name);if(!o)return function(e){return gt()};var i=o.arguments||[];return this.simulation_model.state===vo.Prep&&e.args.forEach((function(e,t){var o=i[t]||{};if(e&&o.collector)if("address"===e.type)r.simulation_model.StoreCellResults(e);else if("identifier"===e.type){var n=r.named_range_map[e.name.toUpperCase()];n&&r.simulation_model.StoreCellResults(n.start)}else if("call"===e.type){var a=r.CalculateExpression(e,!0);a&&Zt(a)&&("address"===a.value.type?r.simulation_model.StoreCellResults(a.value):"range"===a.value.type&&r.simulation_model.StoreCellResults(a.value.start))}})),function(n){var a=r.call_index++;r.simulation_model.volatile=r.simulation_model.volatile||!!o.volatile||!!o.simulation_volatile&&r.simulation_model.state!==vo.Null;var s,l="IF"===e.name.toUpperCase(),c=-1,d=n.args.map((function(e,t){if(!s){var o=i[Math.min(t,i.length-1)]||{};if(t===c)return o.boxed?b():void 0;if(void 0===e)return l&&0===t&&(c=1),o.boxed?b():void 0;if(o.address)return o.boxed?{type:u.string,value:r.parser.Render(e).replace(/\$/g,"")}:r.parser.Render(e).replace(/\$/g,"");if(o.metadata)return r.GetMetadata(e,(function(e,t){return{simulation_data:r.simulation_model.state===vo.Null?r.simulation_model.StoreCellResults(t):[]}}));if(o.collector&&r.simulation_model.state===vo.Null){if("address"===e.type)return r.simulation_model.StoreCellResults(e);if("range"===e.type)return r.simulation_model.StoreCellResults(e.start);if("identifier"===e.type){var n=r.named_range_map[e.name.toUpperCase()];if(n)return r.simulation_model.StoreCellResults(n.start)}else if("call"===e.type&&(a=r.CalculateExpression(e,!0))&&Zt(a)){if("address"===a.value.type)return r.simulation_model.StoreCellResults(a.value);if("range"===a.value.type)return r.simulation_model.StoreCellResults(a.value.start)}return s=_t()}var a=r.CalculateExpression(e);if(!Array.isArray(a)&&a.type===u.error)return o.allow_error?a:void(s=a);if(l&&0===t&&!Array.isArray(a)){var d=!1;if(a.type===u.string){var h=a.value.toLowerCase().trim();d="false"!==h&&"f"!==h}else d=!!a.value;c=d?2:1}return o.boxed?a:Array.isArray(a)?a.map((function(e){return e.map((function(e){return e.value}))})):a.value}}));if(s)return s;if(r.context.call_index=a,o.return_type===ut.reference){var h=o.fn.apply(null,d);if(t)return h;if(Zt(h)){if("address"===h.value.type)return r.CellFunction2(h.value)();if("range"===h.value.type)return r.CellFunction4(h.value.start,h.value.end)}return h}return o.fn.apply(null,d)}},r}(qt),So=function(e){function r(){var t=e.call(this)||this;return t.expression_calculator=t.simulation_expression_calculator=new Co(t.library,t.parser),t.library.Register(t.simulation_expression_calculator.simulation_model.functions),t}return t(r,e),r.prototype.InitSimulation=function(e,t,r,o,i){var n,a,l,c,d,u=this.simulation_expression_calculator.simulation_model;if(u.iterations=e,u.results=[],u.lhs=t,u.correlated_distributions={},"number"==typeof i&&(u.seed=i),this.Reset(),this.AttachModel(r),o&&o.length)try{for(var h=s(o),f=h.next();!f.done;f=h.next()){var p=f.value;if(!p.sheet_id)throw new Error("additional cell passed without sheet id");try{for(var m=(l=void 0,s((null===(d=this.model)||void 0===d?void 0:d.sheets)||[])),v=m.next();!v.done;v=m.next()){var y=v.value;if(y.id===p.sheet_id){y.cells.GetCell(p,!1)&&u.StoreCellResults(p);break}}}catch(e){l={error:e}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(l)throw l.error}}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}if(this.RebuildGraph(),this.LoopCheck())throw new Error("Loop (circular dependency) found in graph");return u.state=vo.Prep,u.iteration=0,this.Recalculate(),u.CorrelateDistributions(),u.state=vo.Simulation,at.OK},r.prototype.GetResults=function(){return this.simulation_expression_calculator.simulation_model.results},r.prototype.SimulationTrial=function(e){var t=this.simulation_expression_calculator.simulation_model;t.iteration=e;try{for(var r in this.Recalculate(),t.results){var o=this.cells_map[r];for(var i in t.results[r]){var n=t.results[r][i];for(var a in n){var s=o.GetCell({row:Number(a),column:Number(i)});if(s){var l=s.GetValue();switch(typeof l){case"number":n[a][e]=l;break;case"boolean":n[a][e]=l?1:0;break;default:n[a][e]=0}}}}}return{status:at.OK,reference:null}}catch(e){return console.info("calculation error trapped",e),{status:at.CalculationError,reference:null}}},r.prototype.FlattenedResults=function(){var e,t,r,o=this.simulation_expression_calculator.simulation_model,i=[];for(var n in o.results)for(var a in o.results[n]){var s=o.results[n][a];for(var l in s)i.push((e={row:Number(l),column:Number(a),sheet_id:Number(n),data:s[l]},void 0,r=void 0,t=4+e.data.length,r=new Float64Array(t),r[0]=e.column,r[1]=e.row,r[2]=e.sheet_id,r[3]=e.data.length,r.set(e.data,4),r).buffer)}return i},r.prototype.FlushSimulationResults=function(){var e=this.simulation_expression_calculator.simulation_model;e.results=[],e.elapsed=0,e.trials=0},r.prototype.ShiftSimulationResults=function(e,t,r,o){},r.prototype.UpdateResults=function(e,t,r){var o,i;if(void 0===t&&(t=this.model),void 0===r&&(r=!0),!t)throw new Error("UpdateResults called without model");var n=this.simulation_expression_calculator.simulation_model;if(e){n.results=[],n.elapsed=e.elapsed,n.trials=e.trials;try{for(var a=s(e.results),l=a.next();!l.done;l=a.next()){var c=l.value,d=c instanceof ArrayBuffer?_o(new Float64Array(c)):c;d.sheet_id||(d.sheet_id=t.active_sheet.id),n.results[d.sheet_id]||(n.results[d.sheet_id]=[]),n.results[d.sheet_id][d.column]||(n.results[d.sheet_id][d.column]=[]),n.results[d.sheet_id][d.column][d.row]=d.data,r&&this.SetDirty(d)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}else n.results=[],n.elapsed=0,n.trials=0},r}(Ur),Ao=(function(){function e(e){this.base_worker=e,this.trials=0,this.lhs=!1,this.data_model={active_sheet:Ae.Blank({}),sheets:[Ae.Blank({})],named_ranges:new et,macro_functions:{}},this.screen_updates=!1,this.calculator=new So,this.start_time=0,this.additional_cells=[],this.iteration=0}e.prototype.Timestamp=function(){return self.performance?performance.now():Date.now()},e.prototype.OnMessage=function(e){var t,r,o=e.data;if(o)switch(o.type){case"configure":if(o.locale&&o.locale!==M.locale&&(M.UpdateLocale(o.locale),this.calculator.UpdateLocale()),this.data_model.sheets=o.sheets.map((function(e){return Ae.FromJSON(e,{})})),this.data_model.active_sheet=this.data_model.sheets[0],o.additional_cells&&(this.additional_cells=o.additional_cells),this.data_model.named_ranges.Deserialize(o.named_ranges),this.data_model.macro_functions={},o.macro_functions)try{for(var i=s(o.macro_functions),n=i.next();!n.done;n=i.next()){var a=n.value;this.data_model.macro_functions[a.name.toUpperCase()]=a}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}this.seed=o.seed;break;case"step":this.SimulationStep();break;case"start":this.trials=o.trials||1e3,this.lhs=!!o.lhs,this.screen_updates=!!o.screen_updates,this.Start()}},e.prototype.Post=function(e,t){this.base_worker.postMessage(e,t)},e.prototype.SimulationStep=function(){if(!(this.iteration>=this.trials)){this.calculator.SimulationTrial(this.iteration);var e=Math.floor(this.iteration/this.trials*100);if(++this.iteration!==this.trials){var t=this.calculator.FlattenedResults(),r=this.Timestamp()-this.start_time;this.Post({type:"update",percent_complete:e,cells:this.data_model.active_sheet.cells.toJSON(),trial_data:{results:t,trials:this.iteration,elapsed:r}},t)}else this.Finish()}},e.prototype.Start=function(){if(!this.trials)throw new Error("invalid trial count");this.start_time=this.Timestamp();var e=this.calculator.InitSimulation(this.trials,this.lhs,this.data_model,this.additional_cells,this.seed);if(this.seed=void 0,e!==at.OK)throw new Error("graph failed");var t=0;if(this.screen_updates)this.iteration=0,this.SimulationStep();else{for(var r=0;r<this.trials;r++){this.calculator.SimulationTrial(r);var o=Math.floor(r/this.trials*100);o!==t&&(t=o,this.Post({type:"progress",percent_complete:t}))}this.Finish()}},e.prototype.Finish=function(){this.Post({type:"progress",percent_complete:100});var e=this.calculator.FlattenedResults(),t=this.Timestamp()-this.start_time;this.Post({type:"complete",trial_data:{results:e,trials:this.trials,elapsed:t}},e)}}(),r(9742)),ko=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],Mo=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];function Ro(e){if(e.length%4)return null;for(var t="",r=0,o=0,i="string"==typeof e?function(e,t){return e.charCodeAt(t)}:function(e,t){return e[t]};r<e.length;)if(o=256*o+i(e,r++),r%4==0){for(var n=52200625;n>=1;)t+=ko[Math.floor(o/n)%85],n/=85;o=0}return t}function To(e){if(e.length%5)return null;for(var t=new Uint8Array(4*e.length/5),r=0,o=0,i=0;o<e.length;){if(!ko.includes(e.charAt(o)))return null;var n=e.charCodeAt(o++)-32;if(i=85*i+Mo[n],o%5==0){for(var a=16777216;a>=1;)t[r++]=i/a%256,a/=256;i=0}}return t}var Lo,Eo=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.replay_buffer=[],t.simulation_resolution=[],t.workers=[],t.simulation_status={running:!1,threads:0,results:[],completed:0,progress:[],aggregate_progress:0},t}return t(r,e),r.prototype.ResetInternal=function(){e.prototype.ResetInternal.call(this),this.FlushSimulationResults()},r.prototype.SimulationData=function(e){(e=this.EnsureAddress(e)).sheet_id||(e.sheet_id=this.grid.model.active_sheet.id);var t=this.calculator.GetResults();if(t&&t[e.sheet_id]&&t[e.sheet_id][e.column]){var r=t[e.sheet_id][e.column][e.row];return r?Array.isArray(r)?r.slice(0):Array.from(r):void 0}},r.prototype.FlushSimulationResults=function(){this.calculator.FlushSimulationResults(),this.last_simulation_data=void 0},r.prototype.SerializeDocument=function(t,r,o){void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===o&&(o={});var i=e.prototype.SerializeDocument.call(this,t,r,o);return t&&this.last_simulation_data&&(i.simulation_data={elapsed:this.last_simulation_data.elapsed,trials:this.last_simulation_data.trials,results:void 0},o.use_float32?(i.simulation_data.bitness=32,i.simulation_data.results=(this.last_simulation_data.results||[]).map((function(e){var t=Float32Array.from(new Float64Array(e));return o.use_z85?Ro(new Uint8Array(t.buffer)):Ao.JQ(new Uint8Array(t.buffer))}))):i.simulation_data.results=(this.last_simulation_data.results||[]).map((function(e){return o.use_z85?Ro(new Uint8Array(e)):Ao.JQ(new Uint8Array(e))})),o.use_z85&&(i.simulation_data.encoding="z85")),i},r.prototype.InitWorkers=function(e){return void 0===e&&(e=this.options.max_workers),n(this,void 0,void 0,(function(){var t,r,o,i,n,l,c,d,u=this;return a(this,(function(h){switch(h.label){case 0:if(e=e||1,this.workers.length){try{for(t=s(this.workers),r=t.next();!r.done;r=t.next())r.value.terminate()}catch(e){c={error:e}}finally{try{r&&!r.done&&(d=t.return)&&d.call(t)}finally{if(c)throw c.error}}this.workers=[]}o=Math.max(1,e),"number"==typeof navigator.hardwareConcurrency&&(o=Math.min(o,navigator.hardwareConcurrency)),console.info("creating "+o+" thread"+(1===o?"":"s")),i=function(e){var t,r;return a(this,(function(o){switch(o.label){case 0:return t=n.workers,r=e,[4,n.LoadWorker("embedded-treb-worker")];case 1:return t[r]=o.sent(),n.workers[e].onmessage=function(t){var r=t.data;u.HandleWorkerMessage(r,e)},n.workers[e].onerror=function(t){var r,o,i,n,a;console.error("worker error (worker #"+e+")"),console.info(t);var l=t.message||"Worker error.";null===(a=u.dialog)||void 0===a||a.ShowDialog({title:"Calculation failed",message:l,close_box:!0,type:xr.error,timeout:3e3});try{for(var c=(r=void 0,s(u.simulation_resolution)),d=c.next();!d.done;d=c.next())d.value.call(u)}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}u.simulation_resolution=[],u.simulation_status.running=!1;try{for(var h=(i=void 0,s(u.workers)),f=h.next();!f.done;f=h.next())f.value.terminate()}catch(e){i={error:e}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}u.workers=[]},[2]}}))},n=this,l=0,h.label=1;case 1:return l<o?[5,i(l)]:[3,4];case 2:h.sent(),h.label=3;case 3:return l++,[3,1];case 4:return[2]}}))}))},r.prototype.RunSimulation=function(e,t){var r,i,l;return void 0===e&&(e=this.options.default_trials||5e3),void 0===t&&(t={}),n(this,void 0,void 0,(function(){var n,c,d,u,h,f,p,m,v,y,_,g,b,w,x,C,S,A,k,R,T,L,E,z,D,P,N,F,I=this;return a(this,(function(a){switch(a.label){case 0:if(n=o({abort_on_dialog_close:!0,lhs:!!this.options.lhs,stepped:!!this.options.screen_updates},t),c=n.lhs,d=n.stepped,u=n.abort_on_dialog_close,h=t.additional_cells||[],this.simulation_status.running)throw new Error("simulation already running");if("number"==typeof t.seed&&bo.Random.Seed(t.seed),null===(r=this.dialog)||void 0===r||r.ShowDialog({title:"Running Monte Carlo simulation",message:"Starting"}).then((function(){I.simulation_status.running&&u&&I.AbortSimulation()})),this.workers.length)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.InitWorkers()];case 2:return a.sent(),[3,4];case 3:throw a.sent(),null===(i=this.dialog)||void 0===i||i.ShowDialog({title:"Calculation failed",message:"Worker not initialized.",close_box:!0,type:xr.error,timeout:3e3}),new Error("worker not initialized");case 4:if(!this.workers[0])throw null===(l=this.dialog)||void 0===l||l.ShowDialog({title:"Calculation failed",message:"Worker not initialized.",close_box:!0,type:xr.error,timeout:3e3}),new Error("worker not initialized");for(this.Publish({type:"running-simulation",trials:e}),this.simulation_status.running=!0,this.simulation_status.threads=this.workers.length,this.simulation_status.progress=[],this.simulation_status.results=[],this.simulation_status.aggregate_progress=0,this.simulation_status.completed=0,C=0;C<this.workers.length;C++)this.simulation_status.progress.push(0);try{for(f=s(this.grid.model.active_sheet.annotations),p=f.next();!p.done;p=f.next())(m=p.value).formula&&(h=h.concat(this.calculator.MetadataReferences(m.formula)))}catch(e){E={error:e}}finally{try{p&&!p.done&&(z=f.return)&&z.call(f)}finally{if(E)throw E.error}}if(h=this.calculator.FlattenCellList(h),this.grid.model.macro_functions){v=[],y=Object.keys(this.grid.model.macro_functions);try{for(_=s(y),g=_.next();!g.done;g=_.next())b=g.value,w=this.grid.model.macro_functions[b],v.push(JSON.parse(JSON.stringify(w)))}catch(e){D={error:e}}finally{try{g&&!g.done&&(P=_.return)&&P.call(_)}finally{if(D)throw D.error}}}for(x=this.workers.map((function(){return 1e14*bo.Random.Next()})),t.replay&&this.replay_buffer.map((function(e,t){return x[t]=e})),C=0;C<this.workers.length;C++)this.workers[C].postMessage({type:"configure",seed:x[C],locale:M.locale,sheets:this.grid.model.sheets.map((function(e){return e.toJSON({rendered_values:!0,preserve_type:!0})})),named_ranges:this.grid.model.named_ranges.Serialize(),macro_functions:v,additional_cells:h});this.replay_buffer=x,bo.Random.Seed(x[0]),S=e,A=this.workers.length;try{for(k=s(this.workers),R=k.next();!R.done;R=k.next())T=R.value,L=Math.floor(S/A--),T.postMessage({type:"start",trials:L,lhs:c,screen_updates:d}),S-=L}catch(e){N={error:e}}finally{try{R&&!R.done&&(F=k.return)&&F.call(k)}finally{if(N)throw N.error}}return[4,new Promise((function(e){I.simulation_resolution.push(e)}))];case 5:return a.sent(),[2]}}))}))},r.prototype.InitCalculator=function(){return new So},r.prototype.ImportDocumentData=function(t,r){if(e.prototype.ImportDocumentData.call(this,t,r),t.simulation_data){var o="z85"===t.simulation_data.encoding;this.last_simulation_data=t.simulation_data,32===t.simulation_data.bitness?this.last_simulation_data.results=(this.last_simulation_data.results||[]).map((function(e){if(o){var t=To(e);return t?Float64Array.from(t).buffer:(new Float64Array).buffer}var r=new Float32Array(Ao.b$(e).buffer);return Float64Array.from(r).buffer})):this.last_simulation_data.results=(this.last_simulation_data.results||[]).map((function(e){if(o){var t=To(e);return t?t.buffer:(new Uint8Array).buffer}return Ao.b$(e).buffer})),this.calculator.UpdateResults(this.last_simulation_data,this.grid.model,!1)}else this.FlushSimulationResults()},r.prototype.UpdateProgress=function(e,t){var r;this.simulation_status.progress[t]=e||0;var o=Math.round(this.simulation_status.progress.reduce((function(e,t){return e+t}),0)/this.simulation_status.threads);o!==this.simulation_status.aggregate_progress&&(this.simulation_status.aggregate_progress=o,null===(r=this.dialog)||void 0===r||r.Update({message:o+"% complete"}),this.Publish({type:"simulation-progress",progress:o}))},r.prototype.HandleWorkerMessage=function(e,t){var r=this;switch(e.type){case"update":this.UpdateProgress(e.percent_complete,t),this.simulation_status.results[t]=e.trial_data,this.last_simulation_data=go(this.simulation_status.results.filter((function(e){return!!e}))),this.calculator.UpdateResults(this.last_simulation_data),this.Recalculate().then((function(){r.workers[t].postMessage({type:"step"})}));break;case"progress":this.UpdateProgress(e.percent_complete,t);break;case"complete":this.simulation_status.progress[t]=100,this.simulation_status.results[t]=e.trial_data,this.simulation_status.completed++,this.simulation_status.completed===this.simulation_status.threads?(this.simulation_status.running=!1,this.last_simulation_data=go(this.simulation_status.results),requestAnimationFrame((function(){r.calculator.UpdateResults(r.last_simulation_data),r.Recalculate().then((function(){r.grid.headless||r.Focus()})),setTimeout((function(){var e,t,o,i,n;null===(o=r.dialog)||void 0===o||o.HideDialog(),r.Publish({type:"simulation-complete",elapsed:(null===(i=r.last_simulation_data)||void 0===i?void 0:i.elapsed)||0,trials:(null===(n=r.last_simulation_data)||void 0===n?void 0:n.trials)||0});try{for(var a=s(r.simulation_resolution),l=a.next();!l.done;l=a.next())l.value.call(r)}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}r.simulation_resolution=[]}),500)}))):this.UpdateProgress(100,t);break;default:console.info("unhandled worker message",e)}},r.prototype.AbortSimulation=function(){var e,t,r=this;console.warn("aborting simulation");try{for(var o=s(this.workers),i=o.next();!i.done;i=o.next())i.value.terminate()}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.workers=[],this.simulation_status.running=!1,requestAnimationFrame((function(){var e,t;r.Recalculate().then((function(){r.grid.headless||r.Focus()})),r.Publish({type:"simulation-aborted"});try{for(var o=s(r.simulation_resolution),i=o.next();!i.done;i=o.next())i.value.call(r)}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r.simulation_resolution=[]}))},r}(yo),zo={"treb-popout-icon":{viewbox:"0 0 28 28",paths:["M22 14.5v5c0 2.484-2.016 4.5-4.5 4.5h-13c-2.484 0-4.5-2.016-4.5-4.5v-13c0-2.484 2.016-4.5 4.5-4.5h11c0.281 0 0.5 0.219 0.5 0.5v1c0 0.281-0.219 0.5-0.5 0.5h-11c-1.375 0-2.5 1.125-2.5 2.5v13c0 1.375 1.125 2.5 2.5 2.5h13c1.375 0 2.5-1.125 2.5-2.5v-5c0-0.281 0.219-0.5 0.5-0.5h1c0.281 0 0.5 0.219 0.5 0.5zM28 1v8c0 0.547-0.453 1-1 1-0.266 0-0.516-0.109-0.703-0.297l-2.75-2.75-10.187 10.187c-0.094 0.094-0.234 0.156-0.359 0.156s-0.266-0.063-0.359-0.156l-1.781-1.781c-0.094-0.094-0.156-0.234-0.156-0.359s0.063-0.266 0.156-0.359l10.187-10.187-2.75-2.75c-0.187-0.187-0.297-0.438-0.297-0.703 0-0.547 0.453-1 1-1h8c0.547 0 1 0.453 1 1z"]},"treb-toolbar-icon":{viewbox:"0 0 24 28",paths:["M5.5 22v2h-5.5v-2h5.5zM11 20c0.547 0 1 0.453 1 1v4c0 0.547-0.453 1-1 1h-4c-0.547 0-1-0.453-1-1v-4c0-0.547 0.453-1 1-1h4zM13.5 14v2h-13.5v-2h13.5zM3.5 6v2h-3.5v-2h3.5zM24 22v2h-11.5v-2h11.5zM9 4c0.547 0 1 0.453 1 1v4c0 0.547-0.453 1-1 1h-4c-0.547 0-1-0.453-1-1v-4c0-0.547 0.453-1 1-1h4zM19 12c0.547 0 1 0.453 1 1v4c0 0.547-0.453 1-1 1h-4c-0.547 0-1-0.453-1-1v-4c0-0.547 0.453-1 1-1h4zM24 14v2h-3.5v-2h3.5zM24 6v2h-13.5v-2h13.5z"]},"treb-export-icon":{viewbox:"0 0 26 28",paths:["M20 21c0-0.547-0.453-1-1-1s-1 0.453-1 1 0.453 1 1 1 1-0.453 1-1zM24 21c0-0.547-0.453-1-1-1s-1 0.453-1 1 0.453 1 1 1 1-0.453 1-1zM26 17.5v5c0 0.828-0.672 1.5-1.5 1.5h-23c-0.828 0-1.5-0.672-1.5-1.5v-5c0-0.828 0.672-1.5 1.5-1.5h7.266l2.109 2.125c0.578 0.562 1.328 0.875 2.125 0.875s1.547-0.313 2.125-0.875l2.125-2.125h7.25c0.828 0 1.5 0.672 1.5 1.5zM20.922 8.609c0.156 0.375 0.078 0.812-0.219 1.094l-7 7c-0.187 0.203-0.453 0.297-0.703 0.297s-0.516-0.094-0.703-0.297l-7-7c-0.297-0.281-0.375-0.719-0.219-1.094 0.156-0.359 0.516-0.609 0.922-0.609h4v-7c0-0.547 0.453-1 1-1h4c0.547 0 1 0.453 1 1v7h4c0.406 0 0.766 0.25 0.922 0.609z"]},"treb-reset-icon":{viewbox:"0 0 24 28",paths:["M23.609 16.5c0 0.031 0 0.078-0.016 0.109-1.328 5.531-5.891 9.391-11.656 9.391-3.047 0-6-1.203-8.219-3.313l-2.016 2.016c-0.187 0.187-0.438 0.297-0.703 0.297-0.547 0-1-0.453-1-1v-7c0-0.547 0.453-1 1-1h7c0.547 0 1 0.453 1 1 0 0.266-0.109 0.516-0.297 0.703l-2.141 2.141c1.469 1.375 3.422 2.156 5.437 2.156 2.781 0 5.359-1.437 6.813-3.813 0.375-0.609 0.562-1.203 0.828-1.828 0.078-0.219 0.234-0.359 0.469-0.359h3c0.281 0 0.5 0.234 0.5 0.5zM24 4v7c0 0.547-0.453 1-1 1h-7c-0.547 0-1-0.453-1-1 0-0.266 0.109-0.516 0.297-0.703l2.156-2.156c-1.484-1.375-3.437-2.141-5.453-2.141-2.781 0-5.359 1.437-6.813 3.813-0.375 0.609-0.562 1.203-0.828 1.828-0.078 0.219-0.234 0.359-0.469 0.359h-3.109c-0.281 0-0.5-0.234-0.5-0.5v-0.109c1.344-5.547 5.953-9.391 11.719-9.391 3.063 0 6.047 1.219 8.266 3.313l2.031-2.016c0.187-0.187 0.438-0.297 0.703-0.297 0.547 0 1 0.453 1 1z"]},"treb-about-icon":{viewbox:"0 0 24 28",paths:["M14 21.5v-3c0-0.281-0.219-0.5-0.5-0.5h-3c-0.281 0-0.5 0.219-0.5 0.5v3c0 0.281 0.219 0.5 0.5 0.5h3c0.281 0 0.5-0.219 0.5-0.5zM18 11c0-2.859-3-5-5.688-5-2.547 0-4.453 1.094-5.797 3.328-0.141 0.219-0.078 0.5 0.125 0.656l2.063 1.563c0.078 0.063 0.187 0.094 0.297 0.094 0.141 0 0.297-0.063 0.391-0.187 0.734-0.938 1.047-1.219 1.344-1.437 0.266-0.187 0.781-0.375 1.344-0.375 1 0 1.922 0.641 1.922 1.328 0 0.812-0.422 1.219-1.375 1.656-1.109 0.5-2.625 1.797-2.625 3.313v0.562c0 0.281 0.219 0.5 0.5 0.5h3c0.281 0 0.5-0.219 0.5-0.5v0c0-0.359 0.453-1.125 1.188-1.547 1.188-0.672 2.812-1.578 2.812-3.953zM24 14c0 6.625-5.375 12-12 12s-12-5.375-12-12 5.375-12 12-12 12 5.375 12 12z"]},"treb-simulation-icon":{viewbox:"0 0 24 28",paths:["M18.5 14c0 0.359-0.187 0.688-0.5 0.859l-8.5 5c-0.156 0.094-0.328 0.141-0.5 0.141s-0.344-0.047-0.5-0.125c-0.313-0.187-0.5-0.516-0.5-0.875v-10c0-0.359 0.187-0.688 0.5-0.875 0.313-0.172 0.703-0.172 1 0.016l8.5 5c0.313 0.172 0.5 0.5 0.5 0.859z","M20.5 14c0-4.688-3.813-8.5-8.5-8.5s-8.5 3.813-8.5 8.5 3.813 8.5 8.5 8.5 8.5-3.813 8.5-8.5zM24 14c0 6.625-5.375 12-12 12s-12-5.375-12-12 5.375-12 12-12 12 5.375 12 12z"]},"treb-fork-icon":{viewbox:"0 0 16 28",paths:["M4.5 23c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5 1.5-0.672 1.5-1.5zM4.5 5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5 1.5-0.672 1.5-1.5zM14.5 7c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5 0.672 1.5 1.5 1.5 1.5-0.672 1.5-1.5zM16 7c0 1.109-0.609 2.078-1.5 2.594-0.047 5.641-4.047 6.891-6.703 7.734-2.484 0.781-3.297 1.156-3.297 2.672v0.406c0.891 0.516 1.5 1.484 1.5 2.594 0 1.656-1.344 3-3 3s-3-1.344-3-3c0-1.109 0.609-2.078 1.5-2.594v-12.812c-0.891-0.516-1.5-1.484-1.5-2.594 0-1.656 1.344-3 3-3s3 1.344 3 3c0 1.109-0.609 2.078-1.5 2.594v7.766c0.797-0.391 1.641-0.656 2.406-0.891 2.906-0.922 4.562-1.609 4.594-4.875-0.891-0.516-1.5-1.484-1.5-2.594 0-1.656 1.344-3 3-3s3 1.344 3 3z"]},"treb-chevron-left-icon":{viewbox:"0 0 21 28",paths:["M18.297 4.703l-8.297 8.297 8.297 8.297c0.391 0.391 0.391 1.016 0 1.406l-2.594 2.594c-0.391 0.391-1.016 0.391-1.406 0l-11.594-11.594c-0.391-0.391-0.391-1.016 0-1.406l11.594-11.594c0.391-0.391 1.016-0.391 1.406 0l2.594 2.594c0.391 0.391 0.391 1.016 0 1.406z"]},"treb-chevron-right-icon":{viewbox:"0 0 19 28",paths:["M17.297 13.703l-11.594 11.594c-0.391 0.391-1.016 0.391-1.406 0l-2.594-2.594c-0.391-0.391-0.391-1.016 0-1.406l8.297-8.297-8.297-8.297c-0.391-0.391-0.391-1.016 0-1.406l2.594-2.594c0.391-0.391 1.016-0.391 1.406 0l11.594 11.594c0.391 0.391 0.391 1.016 0 1.406z"]}},Do=r(9609),Po=(Ne()(Do.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),Do.Z.locals,r(1811)),No=(Ne()(Po.Z,{injectType:"singletonStyleTag",insert:"head",singleton:!0}),Po.Z.locals,"sidebar-open"),Fo="toolbar-open",Io="http://www.w3.org/2000/svg",Uo=function(){function e(t){var r=this,i="string"==typeof t.container?document.querySelector(t.container):t.container;if(!i)throw new Error("missing container");this.options=o(o({},Zr),t),this.outer_container=i,"static"===window.getComputedStyle(i).position&&(i.style.position="relative");var n=this.outer_container.getBoundingClientRect();this.options.headless||n.width&&n.height||this.outer_container.classList.add("default-spreadsheet-size"),this.inner_container=document.createElement("div"),this.inner_container.classList.add("embedded-spreadsheet-container"),this.options.collapsed||this.outer_container.classList.add("sidebar-open"),"show"!==this.options.toolbar&&"show-narrow"!==this.options.toolbar||this.outer_container.classList.add("toolbar-open"),this.outer_container.appendChild(this.inner_container),this.sheet=new Eo(o(o({},this.options),{container:this.inner_container,resizable:!1})),this.sidebar=document.createElement("div"),this.sidebar.classList.add("embedded-spreadsheet-sidebar"),e.EnsureSymbols(),this.options.mc&&this.AddSidebarButton({icon:"treb-simulation-icon",title:"Run Simulation",click:function(){return r.sheet.RunSimulation()}}),this.AddSidebarButton({icon:"treb-reset-icon",title:"Recalculate",click:function(){return r.sheet.Recalculate()}}),this.options.toolbar&&(this.toolbar_container=document.createElement("div"),this.toolbar_container.classList.add("toolbar-container"),this.toolbar_button=this.AddSidebarButton({icon:"treb-toolbar-icon",title:"Show Toolbar",click:function(){return r.ToggleToolbar()}}),this.outer_container.appendChild(this.toolbar_container),this.sheet.toolbar_ctl={Show:function(e){return r.ShowToolbar(e)}}),this.options.export&&this.AddSidebarButton({icon:"treb-export-icon",title:"Download as XLSX",click:function(){return r.sheet.Export()}}),this.options.popout&&this.AddSidebarButton({icon:"treb-popout-icon",title:"Open in New Tab",click:function(){return r.Popout()}}),this.options.fork&&this.AddSidebarButton({icon:"treb-fork-icon",title:"Fork and Edit",click:function(){var e="https://treb.app",t=window.open(e+"/edit?fork");t&&r.sheet.PostDocument(t,e)}}),this.AddSidebarButton({icon:"treb-about-icon",title:"What's This?",click:function(){return r.sheet.About()}});var a=document.createElement("div");a.classList.add("sidebar-spacer"),this.sidebar.appendChild(a),this.AddSidebarButton({icon:"treb-chevron-right-icon",classes:"smaller",title:"Hide Sidebar",click:function(){return r.HideSidebar()}}),this.outer_container.appendChild(this.sidebar);var s=this.AddSidebarButton({icon:"treb-chevron-left-icon",classes:["smaller","show-sidebar-button"],title:"Show Sidebar",click:function(){return r.ShowSidebar()}},void 0);if(this.outer_container.appendChild(s),this.options.resizable){var l=i.querySelector(".treb-grid"),c=i.querySelector(".treb-layout-master");l&&Y.Create({container:this.outer_container,node:l,resize_callback:function(){return r.sheet.Resize()},layout_reference:c||void 0})}"show"!==this.options.toolbar&&"show-narrow"!==this.options.toolbar||this.ShowToolbar(!0),t.container._spreadsheet=this.sheet}return e.EnsureSymbols=function(){var e,t,r,o;if(!this.symbols_injected){this.symbols_injected=!0;var i=document.createElementNS(Io,"svg");i.setAttribute("aria-hidden","true"),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden";var n=document.createElementNS(Io,"defs");i.appendChild(n);try{for(var a=s(Object.keys(zo)),l=a.next();!l.done;l=a.next()){var c=l.value,d=zo[c],u=document.createElementNS(Io,"symbol");u.setAttribute("id",c),d.viewbox&&u.setAttribute("viewBox",d.viewbox);try{for(var h=(r=void 0,s(d.paths||[])),f=h.next();!f.done;f=h.next()){var p=f.value,m=document.createElementNS(Io,"path");m.setAttribute("d",p),u.appendChild(m)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}n.appendChild(u)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}document.body.insertBefore(i,document.body.firstChild||null)}},e.Create=function(t){return new e(t).sheet},e.prototype.Popout=function(){var e=window.open("","_blank");if(e){e.document.head.innerHTML="<title>"+(this.sheet.document_name?"TREB: "+this.sheet.document_name:"TREB: Untitled Document")+"</title><meta charset='utf-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width,initial-scale=1'><link rel='icon' type='image/svg+xml' href='https://treb.app/leaf.svg'>";var t=e.document.createElement("script");t.src=this.sheet.script_path,t.setAttribute("type","text/javascript"),e.document.body.appendChild(t);var r=JSON.stringify(this.sheet.SerializeDocument(!0,!0)),i=e.document.createElement("style");i.setAttribute("type","text/css"),i.textContent="*{box-sizing:border-box;padding:0;margin:0;}body,html{height:100%;width:100%;position:relative;}.treb{top:0;left:0;right:0;bottom:0;position:absolute;background:#fff;}",e.document.head.appendChild(i);var n=e.document.createElement("div");n.setAttribute("class","treb treb-fullscreen-padding"),e.document.body.appendChild(n);var a=window.screen.availWidth>=1200,s=e.document.createElement("script"),l=o(o({},this.options),{container:void 0,network_document:void 0,storage_key:void 0,resizable:!1,export:!0,scroll:void 0,toolbar:!a||"show",file_menu:!0,prompt_save:!0,expand_formula_button:a,popout:!1,add_tab:!0,tab_bar:"auto",headless:!1,dnd:!0,collapsed:!a});s.textContent="("+function(e,t){var r=0,o=function(){e.container=document.querySelector(".treb"),e.container&&window.TREB?(window.sheet=window.TREB.CreateSpreadsheet(e),window.sheet.LoadDocument(t)):++r<32&&setTimeout((function(){return o()}),100)};o()}.toString()+")("+JSON.stringify(l)+","+r+")",e.document.body.appendChild(s),e.document.close()}},e.prototype.AddSidebarButton=function(e,t){var r,o;void 0===e&&(e={}),void 0===t&&(t=this.sidebar);var i=document.createElement("div");if(i.classList.add("sidebar-button"),e.classes){var n="string"==typeof e.classes?[e.classes]:e.classes;try{for(var a=s(n),l=a.next();!l.done;l=a.next()){var c=l.value;i.classList.add(c)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}}if(e.title&&i.setAttribute("title",e.title),e.text&&(i.textContent=e.text),e.click){var d=e.click;i.addEventListener("click",(function(){return d()}))}if(e.icon){var u=document.createElementNS(Io,"svg");i.appendChild(u);var h=document.createElementNS(Io,"use");h.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+e.icon),u.appendChild(h)}return t&&t.appendChild(i),i},e.prototype.ToggleSidebar=function(){this.outer_container.classList.toggle(No)},e.prototype.ShowSidebar=function(e){void 0===e&&(e=!0),e?this.outer_container.classList.add(No):this.outer_container.classList.remove(No)},e.prototype.HideSidebar=function(){this.ShowSidebar(!1)},e.prototype.ToggleToolbar=function(){this.ShowToolbar(!this.outer_container.classList.contains(Fo))},e.prototype.ShowToolbar=function(e){void 0===e&&(e=!0);var t="Hide Toolbar";e?(this.toolbar_container&&!this.toolbar&&(this.toolbar=this.sheet.CreateToolbar(this.toolbar_container)),this.outer_container.classList.add(Fo)):(this.outer_container.classList.remove(Fo),t="Show Toolbar"),this.toolbar_button&&this.toolbar_button.setAttribute("title",t)},e.prototype.HideToolbar=function(){this.ShowToolbar(!1)},e.symbols_injected=!1,e}(),Oo=function(){function e(){}return e.Run=function(){for(var e,t,r=document.querySelectorAll("div[data-treb]"),o=0;o<r.length;o++){var i=r[o];if(!i._spreadsheet){var n=i.dataset||{},a={container:i,network_document:n.treb||void 0},c=n.options;if(c){var d=c.split(/,/g);try{for(var u=(e=void 0,s(d)),h=u.next();!h.done;h=u.next()){var f=l(h.value.split("="),2),p=f[0],m=f[1];p&&(void 0===m?a[p]=!0:/^(?:true|false)/i.test(m)?a[p]="false"!==m.toLowerCase():isNaN(m)?a[p]=m:a[p]=Number(m))}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}}var v=Uo.Create(a),y=a.load||n.load;if(y){var _=self;_[y]?_[y](v,i):console.warn("function "+y+" not found")}}}},e}();(Lo=self.TREB||{}).CreateSpreadsheet||(yo.SniffPath(),Lo.version="11.0.1",yo.enable_engine&&(Lo.CreateEngine=function(e){return void 0===e&&(e={}),new Eo(e)}),Lo.CreateSpreadsheet=function(e){return Uo.Create(e)},yo.enable_formatter&&(Lo.Format={format:function(e,t){return ue.Get(t).Format(e)},parse:function(e){return pe.TryParse(e).value}}),self.TREB=Lo,document.addEventListener("DOMContentLoaded",(function(){return Oo.Run()})),document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&Oo.Run()}))),r(7633),r(9116),r(4370),r(1045)}()}();